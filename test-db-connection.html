<!DOCTYPE html>
<html>
<head>
    <title>Database Connection Test</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Database Connection Test</h1>
    <button onclick="testConnection()">Test Supabase Connection</button>
    <div id="results"></div>

    <script>
        const supabaseUrl = 'https://lmrrdcaavwwletcjcpqv.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ1NzQ4NjcsImV4cCI6MjA1MDE1MDg2N30.8Qj8Qj8Qj8Qj8Qj8Qj8Qj8Qj8Qj8Qj8Qj8Qj8Qj8Qj8';
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        async function testConnection() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Testing connection...</p>';

            try {
                // Test 1: Check if order_menu_system_customizations table exists
                console.log('Testing order_menu_system_customizations table...');
                const { data: customizations, error: customizationsError } = await supabase
                    .from('order_menu_system_customizations')
                    .select('*')
                    .limit(1);

                if (customizationsError) {
                    resultsDiv.innerHTML += `<p style="color: red;">❌ order_menu_system_customizations table error: ${customizationsError.message}</p>`;
                } else {
                    resultsDiv.innerHTML += `<p style="color: green;">✅ order_menu_system_customizations table exists</p>`;
                }

                // Test 2: Check if order_menu_items table exists
                console.log('Testing order_menu_items table...');
                const { data: items, error: itemsError } = await supabase
                    .from('order_menu_items')
                    .select('*')
                    .limit(1);

                if (itemsError) {
                    resultsDiv.innerHTML += `<p style="color: red;">❌ order_menu_items table error: ${itemsError.message}</p>`;
                } else {
                    resultsDiv.innerHTML += `<p style="color: green;">✅ order_menu_items table exists</p>`;
                }

                // Test 3: Try to insert test data
                console.log('Testing data insertion...');
                const testData = {
                    user_email: 'test@example.com',
                    restaurant_name: 'Test Restaurant',
                    owner_name: 'Test Owner',
                    restaurant_address: 'Test Address',
                    contact_email: 'test@example.com',
                    contact_phone: '+1234567890',
                    primary_color: '#3B82F6',
                    secondary_color: '#000000',
                    accent_color: '#F59E0B',
                    text_color: '#1F2937',
                    additional_requirements: 'Test requirements',
                    cart_status: 'pending'
                };

                const { data: insertData, error: insertError } = await supabase
                    .from('order_menu_system_customizations')
                    .insert(testData)
                    .select()
                    .single();

                if (insertError) {
                    resultsDiv.innerHTML += `<p style="color: red;">❌ Insert test failed: ${insertError.message}</p>`;
                } else {
                    resultsDiv.innerHTML += `<p style="color: green;">✅ Insert test successful. ID: ${insertData.id}</p>`;
                    
                    // Clean up test data
                    await supabase
                        .from('order_menu_system_customizations')
                        .delete()
                        .eq('id', insertData.id);
                }

            } catch (error) {
                resultsDiv.innerHTML += `<p style="color: red;">❌ Connection error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
