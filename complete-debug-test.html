<!DOCTYPE html>
<html>
<head>
    <title>Complete Debug Test - Supabase Storage</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #e8f5e8; border-color: #4caf50; }
        .error { background: #ffebee; border-color: #f44336; }
        .warning { background: #fff3e0; border-color: #ff9800; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; white-space: pre-wrap; }
        button { background: #3B82F6; color: white; padding: 10px 20px; border: none; cursor: pointer; margin: 5px; border-radius: 5px; }
        button:hover { background: #2563eb; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f5f5f5; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Complete Debug Test - Supabase Storage</h1>
        <p>This page will test every aspect of the Supabase connection and data storage.</p>
        
        <div class="test-section">
            <h2>Step 1: Test Database Connection</h2>
            <button onclick="testConnection()">Test Connection</button>
            <div id="connection-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Step 2: Test Simple Insert</h2>
            <button onclick="testSimpleInsert()">Test Simple Insert</button>
            <div id="insert-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Step 3: Test Form Data Insert</h2>
            <form id="test-form">
                <div class="form-group">
                    <label>Project Name *</label>
                    <input type="text" id="projectName" value="Debug Test Project" required>
                </div>
                <div class="form-group">
                    <label>Contact Person *</label>
                    <input type="text" id="contactPerson" value="Debug User" required>
                </div>
                <div class="form-group">
                    <label>App Name *</label>
                    <input type="text" id="appName" value="DebugApp" required>
                </div>
                <div class="form-group">
                    <label>Restaurant Name</label>
                    <input type="text" id="restaurantName" value="Debug Restaurant">
                </div>
                <div class="form-group">
                    <label>Cuisine Type</label>
                    <select id="cuisineType">
                        <option value="">Select cuisine type</option>
                        <option value="Italian" selected>Italian</option>
                        <option value="Chinese">Chinese</option>
                        <option value="Indian">Indian</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="email" value="debug@test.com" required>
                </div>
                <div class="form-group">
                    <label>Phone *</label>
                    <input type="tel" id="phone" value="+1234567890" required>
                </div>
                <button type="submit">Test Form Insert</button>
            </form>
            <div id="form-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Step 4: View All Data</h2>
            <button onclick="loadAllData()">Load All Data</button>
            <div id="data-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Step 5: Test Dashboard Form</h2>
            <button onclick="testDashboardForm()">Test Dashboard Form (Same as Real Form)</button>
            <div id="dashboard-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Debug Log</h2>
            <button onclick="clearLog()">Clear Log</button>
            <div id="debug-log"></div>
        </div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js@2';
        
        const SUPABASE_URL = 'https://lmrrdcaavwwletcjcpqv.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ';
        
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('debug-log');
            const div = document.createElement('div');
            div.className = `log`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> [${type.toUpperCase()}]: ${message}`;
            logDiv.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="log ${type}">${message}</div>`;
        }
        
        window.clearLog = function() {
            document.getElementById('debug-log').innerHTML = '';
        };
        
        window.testConnection = async function() {
            log('Testing Supabase connection...');
            showResult('connection-result', 'Testing connection...', 'warning');
            
            try {
                const { data, error } = await supabase
                    .from('customization_forms')
                    .select('count')
                    .limit(1);
                
                if (error) {
                    log(`Connection failed: ${error.message}`, 'error');
                    showResult('connection-result', `‚ùå Connection failed: ${error.message}<br><br>Error details: ${JSON.stringify(error, null, 2)}`, 'error');
                } else {
                    log('Connection successful!', 'success');
                    showResult('connection-result', '‚úÖ Connection successful! Table exists and is accessible.', 'success');
                }
            } catch (err) {
                log(`Connection exception: ${err.message}`, 'error');
                showResult('connection-result', `‚ùå Connection exception: ${err.message}`, 'error');
            }
        };
        
        window.testSimpleInsert = async function() {
            log('Testing simple insert...');
            showResult('insert-result', 'Testing simple insert...', 'warning');
            
            const testData = {
                product_type: 'restaurant-website',
                product_name: 'Simple Test Product',
                product_price: '‚Çπ299',
                project_name: 'Simple Test Project',
                contact_person: 'Test User',
                app_name: 'TestApp',
                contact_email: 'simple@test.com',
                contact_phone: '+1234567890',
                status: 'pending'
            };
            
            try {
                log('Inserting simple test data...');
                const { data, error } = await supabase
                    .from('customization_forms')
                    .insert(testData)
                    .select()
                    .single();
                
                if (error) {
                    log(`Simple insert failed: ${error.message}`, 'error');
                    showResult('insert-result', `‚ùå Simple insert failed: ${error.message}<br><br>Error details: ${JSON.stringify(error, null, 2)}`, 'error');
                } else {
                    log(`Simple insert successful! ID: ${data.id}`, 'success');
                    showResult('insert-result', `‚úÖ Simple insert successful!<br><br>Record ID: ${data.id}<br>Project: ${data.project_name}<br>Created: ${new Date(data.created_at).toLocaleString()}`, 'success');
                }
            } catch (err) {
                log(`Simple insert exception: ${err.message}`, 'error');
                showResult('insert-result', `‚ùå Simple insert exception: ${err.message}`, 'error');
            }
        };
        
        document.getElementById('test-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            log('Testing form data insert...');
            showResult('form-result', 'Testing form data insert...', 'warning');
            
            const formData = {
                product_type: 'restaurant-website',
                product_name: 'Restaurant Website',
                product_price: '‚Çπ299',
                project_name: document.getElementById('projectName').value,
                contact_person: document.getElementById('contactPerson').value,
                app_name: document.getElementById('appName').value,
                product_description: 'Debug test project',
                restaurant_name: document.getElementById('restaurantName').value,
                cuisine_type: document.getElementById('cuisineType').value,
                contact_email: document.getElementById('email').value,
                contact_phone: document.getElementById('phone').value,
                primary_color: '#3B82F6',
                secondary_color: '#10B981',
                accent_color: '#F59E0B',
                text_color: '#1F2937',
                additional_requirements: 'Debug test requirements',
                status: 'pending'
            };
            
            try {
                log('Inserting form data...');
                const { data, error } = await supabase
                    .from('customization_forms')
                    .insert(formData)
                    .select()
                    .single();
                
                if (error) {
                    log(`Form insert failed: ${error.message}`, 'error');
                    showResult('form-result', `‚ùå Form insert failed: ${error.message}<br><br>Error details: ${JSON.stringify(error, null, 2)}`, 'error');
                } else {
                    log(`Form insert successful! ID: ${data.id}`, 'success');
                    showResult('form-result', `‚úÖ Form insert successful!<br><br>Record ID: ${data.id}<br>Project: ${data.project_name}<br>Restaurant: ${data.restaurant_name}<br>Cuisine: ${data.cuisine_type}<br>Created: ${new Date(data.created_at).toLocaleString()}`, 'success');
                }
            } catch (err) {
                log(`Form insert exception: ${err.message}`, 'error');
                showResult('form-result', `‚ùå Form insert exception: ${err.message}`, 'error');
            }
        });
        
        window.loadAllData = async function() {
            log('Loading all data...');
            showResult('data-result', 'Loading all data...', 'warning');
            
            try {
                const { data, error } = await supabase
                    .from('customization_forms')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    log(`Load data failed: ${error.message}`, 'error');
                    showResult('data-result', `‚ùå Load data failed: ${error.message}`, 'error');
                } else {
                    log(`Loaded ${data.length} records`, 'success');
                    
                    if (data.length === 0) {
                        showResult('data-result', 'No data found in the table.', 'warning');
                    } else {
                        let html = `<h3>Found ${data.length} records:</h3><table><tr><th>ID</th><th>Project</th><th>Restaurant</th><th>Cuisine</th><th>Email</th><th>Created</th></tr>`;
                        data.forEach(record => {
                            html += `<tr>
                                <td>${record.id.substring(0, 8)}...</td>
                                <td>${record.project_name}</td>
                                <td>${record.restaurant_name || 'N/A'}</td>
                                <td>${record.cuisine_type || 'N/A'}</td>
                                <td>${record.contact_email}</td>
                                <td>${new Date(record.created_at).toLocaleString()}</td>
                            </tr>`;
                        });
                        html += '</table>';
                        showResult('data-result', html, 'success');
                    }
                }
            } catch (err) {
                log(`Load data exception: ${err.message}`, 'error');
                showResult('data-result', `‚ùå Load data exception: ${err.message}`, 'error');
            }
        };
        
        window.testDashboardForm = async function() {
            log('Testing dashboard form (same as real form)...');
            showResult('dashboard-result', 'Testing dashboard form...', 'warning');
            
            // This simulates exactly what the dashboard form does
            const dashboardFormData = {
                productName: 'Restaurant Website',
                productPrice: '‚Çπ299',
                projectName: 'Dashboard Test Project',
                contactPerson: 'Dashboard User',
                appName: 'DashboardApp',
                productDescription: 'Dashboard test project',
                restaurantName: 'Dashboard Restaurant',
                cuisineType: 'Italian',
                email: 'dashboard@test.com',
                phone: '+1234567890',
                primaryColor: '#3B82F6',
                secondaryColor: '#10B981',
                accentColor: '#F59E0B',
                textColor: '#1F2937',
                additionalRequirements: 'Dashboard test requirements'
            };
            
            try {
                log('Inserting dashboard form data...');
                const { data, error } = await supabase
                    .from('customization_forms')
                    .insert({
                        product_type: 'restaurant-website',
                        product_name: dashboardFormData.productName,
                        product_price: dashboardFormData.productPrice,
                        project_name: dashboardFormData.projectName,
                        contact_person: dashboardFormData.contactPerson,
                        app_name: dashboardFormData.appName,
                        product_description: dashboardFormData.productDescription,
                        restaurant_name: dashboardFormData.restaurantName,
                        cuisine_type: dashboardFormData.cuisineType,
                        contact_email: dashboardFormData.email,
                        contact_phone: dashboardFormData.phone,
                        primary_color: dashboardFormData.primaryColor,
                        secondary_color: dashboardFormData.secondaryColor,
                        accent_color: dashboardFormData.accentColor,
                        text_color: dashboardFormData.textColor,
                        additional_requirements: dashboardFormData.additionalRequirements,
                        status: 'pending'
                    })
                    .select()
                    .single();
                
                if (error) {
                    log(`Dashboard form insert failed: ${error.message}`, 'error');
                    showResult('dashboard-result', `‚ùå Dashboard form insert failed: ${error.message}<br><br>Error details: ${JSON.stringify(error, null, 2)}`, 'error');
                } else {
                    log(`Dashboard form insert successful! ID: ${data.id}`, 'success');
                    showResult('dashboard-result', `‚úÖ Dashboard form insert successful!<br><br>Record ID: ${data.id}<br>Project: ${data.project_name}<br>Restaurant: ${data.restaurant_name}<br>Cuisine: ${data.cuisine_type}<br>Created: ${new Date(data.created_at).toLocaleString()}`, 'success');
                }
            } catch (err) {
                log(`Dashboard form insert exception: ${err.message}`, 'error');
                showResult('dashboard-result', `‚ùå Dashboard form insert exception: ${err.message}`, 'error');
            }
        };
        
        // Auto-run connection test on page load
        window.addEventListener('load', function() {
            log('Page loaded, starting auto-tests...');
            testConnection();
        });
    </script>
</body>
</html>
