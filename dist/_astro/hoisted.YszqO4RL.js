import"./AdminLayout.astro_astro_type_script_index_3_lang.LJYybVYx.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2";import"./ProductDialog.astro_astro_type_script_index_0_lang.CG_DSVmw.js";import"https://unpkg.com/@supabase/supabase-js@2";const m="https://lmrrdcaavwwletcjcpqv.supabase.co",u="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ";let o=null;function c(){return new Promise(t=>{window.supabase?(o=window.supabase.createClient(m,u),t(o)):setTimeout(()=>c().then(t),100)})}document.addEventListener("DOMContentLoaded",async()=>{console.log("üîÑ Loading admin profile..."),await g(),await p(),await f(),y()});async function g(){try{console.log("üîÑ Loading admin info..."),o||await c();const{data:{user:t},error:i}=await o.auth.getUser();if(i){console.error("Error getting user:",i);return}if(t){const{data:a,error:r}=await o.from("profiles").select("*").eq("id",t.id).single();if(r)console.error("Error getting profile:",r),document.getElementById("admin-full-name").textContent=t.user_metadata?.full_name||"Admin User",document.getElementById("admin-email").textContent=t.email||"No email";else{document.getElementById("admin-full-name").textContent=a.full_name||"Admin User",document.getElementById("admin-email").textContent=a.email||t.email||"No email",document.getElementById("admin-display-name").textContent=a.full_name||"Admin User",document.getElementById("admin-display-email").textContent=a.email||t.email||"No email";const n=document.getElementById("admin-avatar-large");if(n){const e=a.full_name||t.user_metadata?.full_name||t.email||"A";n.textContent=e.charAt(0).toUpperCase()}a.created_at&&(document.getElementById("admin-created-at").textContent=new Date(a.created_at).toLocaleDateString()),t.last_sign_in_at&&(document.getElementById("admin-last-login").textContent=new Date(t.last_sign_in_at).toLocaleDateString())}}else document.getElementById("admin-full-name").textContent="No user logged in",document.getElementById("admin-email").textContent="No email"}catch(t){console.error("Error loading admin info:",t)}}async function p(){try{console.log("üîÑ Loading admin stats..."),o||await c();const[t,i,a,r]=await Promise.all([o.from("profiles").select("*",{count:"exact",head:!0}),o.from("contact_submissions").select("*",{count:"exact",head:!0}),o.from("support_tickets").select("*",{count:"exact",head:!0}),o.from("customization_forms").select("*",{count:"exact",head:!0})]),n=t.count||0,e=i.count||0,s=a.count||0,l=r.count||0;document.getElementById("orders-managed").textContent=l.toString(),document.getElementById("users-managed").textContent=n.toString(),document.getElementById("tickets-resolved").textContent=s.toString(),document.getElementById("contact-forms").textContent=e.toString(),console.log("‚úÖ Admin stats loaded:",{totalUsers:n,totalContacts:e,totalTickets:s,totalCarts:l})}catch(t){console.error("Error loading admin stats:",t)}}async function f(){const t=document.getElementById("recent-activity");if(t)try{console.log("üîÑ Loading recent activity..."),o||await c();const[i,a,r]=await Promise.all([o.from("contact_submissions").select("*").order("created_at",{ascending:!1}).limit(3),o.from("support_tickets").select("*").order("created_at",{ascending:!1}).limit(3),o.from("customization_forms").select("*").order("created_at",{ascending:!1}).limit(3)]),n=[];if(i.data&&i.data.forEach(e=>{n.push({type:"contact",icon:"user-plus",color:"green",title:"New Contact Submission",description:`${e.first_name} ${e.last_name} - ${e.project_type||"General Inquiry"}`,time:new Date(e.created_at).toLocaleDateString()})}),a.data&&a.data.forEach(e=>{n.push({type:"ticket",icon:"question-mark-circle",color:"yellow",title:`Support Ticket ${e.status||"New"}`,description:`${e.subject||"No subject"} - ${e.category||"General"}`,time:new Date(e.created_at).toLocaleDateString()})}),r.data&&r.data.forEach(e=>{n.push({type:"cart",icon:"shopping-cart",color:"blue",title:"New Cart Customization",description:`${e.project_name||"Custom Project"} - ‚Çπ${e.total_amount||"0"}`,time:new Date(e.created_at).toLocaleDateString()})}),n.sort((e,s)=>new Date(s.time).getTime()-new Date(e.time).getTime()),n.splice(5),n.length===0){t.innerHTML=`
          <div class="text-center py-8 text-gray-500">
            <p>No recent activity</p>
          </div>
        `;return}t.innerHTML=n.map(e=>`
        <div class="flex items-center space-x-4 p-3 bg-gray-50 rounded-lg">
          <div class="w-8 h-8 bg-${e.color}-100 rounded-full flex items-center justify-center">
            <svg class="w-4 h-4 text-${e.color}-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              ${h(e.icon)}
            </svg>
          </div>
          <div class="flex-1">
            <p class="text-sm font-medium text-gray-900">${e.title}</p>
            <p class="text-sm text-gray-500">${e.description}</p>
          </div>
          <span class="text-sm text-gray-400">${e.time}</span>
        </div>
      `).join(""),console.log("‚úÖ Recent activity loaded:",n.length,"activities")}catch(i){console.error("Error loading recent activity:",i),t.innerHTML=`
        <div class="text-center py-8 text-gray-500">
          <p>Error loading recent activity</p>
        </div>
      `}}function h(t){switch(t){case"shopping-cart":return'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>';case"question-mark-circle":return'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>';case"user-plus":return'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>';default:return'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>'}}function y(){console.log("‚úÖ Profile page loaded - edit functionality removed"),document.addEventListener("keydown",t=>{t.key==="Escape"&&(console.log("‚å®Ô∏è Escape key pressed - going back to admin dashboard"),d())})}function d(){console.log("üîÑ Navigating back to admin dashboard..."),window.location.href="/admin"}window.goBackToAdminDashboard=d;
