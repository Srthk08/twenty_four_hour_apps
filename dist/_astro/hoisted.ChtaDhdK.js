import"./Toast.astro_astro_type_script_index_0_lang.Y7UP99DS.js";import"https://unpkg.com/@supabase/supabase-js@2";const p=document.getElementById("contact-form"),y=document.getElementById("success-message"),I=document.getElementById("error-message"),S=document.getElementById("error-text");let c=null;const b=()=>{const n="https://lmrrdcaavwwletcjcpqv.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ";return window.supabase&&typeof window.supabase.createClient=="function"?(c=window.supabase.createClient(n,t),console.log("‚úÖ Supabase client initialized directly"),!0):window.supabase?(c=window.supabase,console.log("‚úÖ Using existing Supabase client"),!0):(console.error("‚ùå Supabase library not available"),!1)};function j(){b()?console.log("‚úÖ Supabase client ready:",!!c):(console.log("‚è≥ Supabase not ready, retrying in 100ms..."),setTimeout(j,100))}j();function F(){const n=new URLSearchParams(window.location.search);return{product:n.get("product"),projectType:n.get("project_type"),projectDetails:n.get("project_details"),price:n.get("price")}}window.clearForm=function(){console.log("üßπ Clearing contact form fields...");const t=document.getElementById("first_name"),a=document.getElementById("last_name"),d=document.getElementById("email"),e=document.getElementById("phone"),l=document.getElementById("company"),i=document.getElementById("project_type"),u=document.getElementById("message");t&&(t.value="",t.placeholder="Your first name",t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0}))),a&&(a.value="",a.placeholder="Your last name",a.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0}))),d&&(d.value="",d.placeholder="your.email@example.com",d.dispatchEvent(new Event("input",{bubbles:!0})),d.dispatchEvent(new Event("change",{bubbles:!0}))),e&&(e.value="",e.placeholder="+1 (555) 123-4567",e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0}))),l&&(l.value="",l.placeholder="Your company name",l.dispatchEvent(new Event("input",{bubbles:!0})),l.dispatchEvent(new Event("change",{bubbles:!0}))),i&&(i.value="",i.selectedIndex=0,i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0}))),u&&(u.value="",u.placeholder="Tell us about your project...",u.dispatchEvent(new Event("input",{bubbles:!0})),u.dispatchEvent(new Event("change",{bubbles:!0}))),document.querySelectorAll("input, select, textarea").forEach(o=>{o.classList.remove("border-red-500"),o.classList.add("border-gray-300")}),console.log("‚úÖ Contact form cleared")};window.prefillForm=async function(){try{console.log("üîÑ Starting form pre-fill process..."),console.log("üîç Available global objects:",{globalAuthManager:!!window.globalAuthManager,simpleAuthManager:!!window.simpleAuthManager,supabase:!!window.supabase}),console.log("üßπ Clearing form first to ensure clean state..."),window.clearForm();const t=F(),a=window.globalAuthManager||window.simpleAuthManager,d=a&&a.isUserLoggedIn();if(d&&t.projectType){const e=document.getElementById("project_type");e&&(e.value=t.projectType,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),console.log("‚úÖ Pre-filled project type for logged in user:",t.projectType))}if(d&&t.projectDetails){const e=document.getElementById("message");if(e){let l=decodeURIComponent(t.projectDetails);if(t.product&&(l=`Project: ${decodeURIComponent(t.product)}

${l}`),t.price){const i=decodeURIComponent(t.price);l+=`

Budget: ‚Çπ${i}`}e.value=l,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),console.log("‚úÖ Pre-filled project details for logged in user")}}else if(!d){console.log("üë§ User not logged in - not pre-filling project details");const e=document.getElementById("project_type"),l=document.getElementById("message");e&&(e.value=""),l&&(l.value="",l.placeholder="Tell us about your project...")}if(c||(console.log("üîÑ Supabase not available in prefill, trying to reinitialize..."),b()),console.log("üîç Checking for logged in user using global auth manager..."),a&&a.isUserLoggedIn()){const e=a.getCurrentUser();if(console.log("üë§ User found via global auth manager:",e?.email),e&&e.email){const l=document.getElementById("first_name"),i=document.getElementById("last_name"),u=document.getElementById("email"),r=document.getElementById("phone"),o=document.getElementById("company");if(e&&e.full_name){const s=e.full_name.split(" ");l&&(l.value=s[0]||"",l.dispatchEvent(new Event("input",{bubbles:!0})),l.dispatchEvent(new Event("change",{bubbles:!0})),console.log("‚úÖ Pre-filled first name:",s[0])),i&&s.length>1&&(i.value=s.slice(1).join(" "),i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0})),console.log("‚úÖ Pre-filled last name:",s.slice(1).join(" ")))}u&&e.email&&(u.value=e.email,u.dispatchEvent(new Event("input",{bubbles:!0})),u.dispatchEvent(new Event("change",{bubbles:!0})),console.log("‚úÖ Pre-filled email:",e.email)),r&&e.phone&&(r.value=e.phone,r.dispatchEvent(new Event("input",{bubbles:!0})),r.dispatchEvent(new Event("change",{bubbles:!0})),console.log("‚úÖ Pre-filled phone:",e.phone)),o&&e.company_name&&(o.value=e.company_name,o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0})),console.log("‚úÖ Pre-filled company:",e.company_name)),console.log("‚úÖ Form pre-filled successfully with global auth manager data"),setTimeout(()=>w(),100)}else console.log("üë§ User not properly authenticated - clearing form"),window.clearForm()}else console.log("üë§ No auth manager available - clearing form"),window.clearForm();if(c)try{console.log("üîç Fallback: Checking Supabase auth...");const{data:{user:e}}=await c.auth.getUser();if(e){console.log("üë§ User found via Supabase auth:",e.email);const l=document.getElementById("first_name"),i=document.getElementById("last_name"),u=document.getElementById("email"),r=document.getElementById("phone"),o=document.getElementById("company");u&&e.email&&(u.value=e.email,u.dispatchEvent(new Event("input",{bubbles:!0})),u.dispatchEvent(new Event("change",{bubbles:!0})),console.log("‚úÖ Pre-filled email:",e.email));try{const{data:s}=await c.from("profiles").select("*").eq("id",e.id).single();if(s){if(s.full_name){const g=s.full_name.split(" ");l&&(l.value=g[0]||"",l.dispatchEvent(new Event("input",{bubbles:!0})),l.dispatchEvent(new Event("change",{bubbles:!0})),console.log("‚úÖ Pre-filled first name:",g[0])),i&&g.length>1&&(i.value=g.slice(1).join(" "),i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0})),console.log("‚úÖ Pre-filled last name:",g.slice(1).join(" ")))}r&&s.phone&&(r.value=s.phone,r.dispatchEvent(new Event("input",{bubbles:!0})),r.dispatchEvent(new Event("change",{bubbles:!0})),console.log("‚úÖ Pre-filled phone:",s.phone)),o&&s.company_name&&(o.value=s.company_name,o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0})),console.log("‚úÖ Pre-filled company:",s.company_name))}}catch(s){console.log("‚ö†Ô∏è Could not fetch profile data:",s)}console.log("‚úÖ Form pre-filled successfully with Supabase auth data"),setTimeout(()=>w(),100)}else console.log("‚ÑπÔ∏è No user logged in via Supabase auth - clearing form"),window.clearForm()}catch(e){console.log("‚ÑπÔ∏è Supabase auth check failed:",e)}else console.log("‚ÑπÔ∏è Neither global auth manager nor Supabase available - clearing form"),window.clearForm()}catch(t){console.error("‚ùå Error pre-filling form:",t)}};function m(){const n=window.globalAuthManager||window.simpleAuthManager,t=n&&n.isUserLoggedIn();if(!t){console.log("üë§ User not logged in - clearing form and project details"),window.clearForm();const a=document.getElementById("project_type"),d=document.getElementById("message");a&&(a.value="",a.selectedIndex=0),d&&(d.value="",d.placeholder="Tell us about your project...")}return t}function w(){console.log("üîÑ Forcing form validation..."),document.querySelectorAll("input, select, textarea").forEach(t=>{t.value&&t.value.trim()&&(console.log(`üîç Forcing validation for field: ${t.id} = "${t.value}"`),t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),t.dispatchEvent(new Event("blur",{bubbles:!0})),t.setCustomValidity&&t.setCustomValidity(""),t.focus(),t.blur())}),console.log("‚úÖ Form validation forced")}function v(){const n=document.createElement("div");n.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    `;const t=document.createElement("div");t.style.cssText=`
      background: white;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      max-width: 400px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    `,t.innerHTML=`
      <h3 style="margin-bottom: 20px; color: #333;">Authentication Required</h3>
      <p style="margin-bottom: 30px; color: #666;">Please sign up or login to submit the contact form.</p>
      <div style="display: flex; gap: 15px; justify-content: center;">
        <button id="signup-btn" style="
          background: #3B82F6;
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
        ">Sign Up</button>
        <button id="login-btn" style="
          background: #6B7280;
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
        ">Login</button>
      </div>
    `,n.appendChild(t),document.body.appendChild(n),document.getElementById("signup-btn").addEventListener("click",()=>{document.body.removeChild(n),window.location.href="/signup"}),document.getElementById("login-btn").addEventListener("click",()=>{document.body.removeChild(n),window.location.href="/login"}),n.addEventListener("click",a=>{a.target===n&&document.body.removeChild(n)})}p?.addEventListener("submit",async n=>{if(n.preventDefault(),console.log("üìù Contact form submission started..."),!m()){v();return}if(!c&&(console.log("üîÑ Supabase not available, trying to reinitialize..."),!b())){console.error("‚ùå Failed to initialize Supabase client"),alert("Database connection not available. Please refresh the page and try again.");return}w();const t=new FormData(p),a=Object.fromEntries(t);console.log("üìù Form data collected for validation:",a);const d=[{id:"first_name",name:"First Name",value:a.first_name},{id:"last_name",name:"Last Name",value:a.last_name},{id:"email",name:"Email",value:a.email},{id:"project_type",name:"Project Type",value:a.project_type},{id:"message",name:"Message",value:a.message}];let e=!0;const l=[];for(const r of d){const o=document.getElementById(r.id),s=r.value?r.value.toString().trim():"";console.log(`üîç Validating ${r.name}: "${s}"`),s?o&&(o.classList.remove("border-red-500"),o.classList.add("border-gray-300")):(e=!1,l.push(r.name),o&&(o.classList.add("border-red-500"),o.classList.remove("border-gray-300")))}if(!e){showError(`Please fill in all required fields: ${l.join(", ")}`);return}console.log("‚úÖ All required fields are filled - proceeding with submission"),y?.classList.add("hidden"),I?.classList.add("hidden");const i=p.querySelector('button[type="submit"]'),u=i.textContent;i.disabled=!0,i.innerHTML=`
      <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      Sending...
    `;try{if(!c&&(console.log("üîÑ Supabase not available, trying to reinitialize..."),!b()))throw console.error("‚ùå Failed to initialize Supabase client"),new Error("Database connection not available. Please refresh the page and try again.");if(!c||typeof c.from!="function")throw console.error("‚ùå Supabase client is not properly initialized"),console.log("Supabase object:",c),console.log("Available methods:",c?Object.keys(c):"No supabase object"),new Error("Database connection not properly initialized. Please refresh the page and try again.");console.log("‚úÖ Supabase client verified and ready");const r=new FormData(p),o=Object.fromEntries(r);console.log("üìù Form data collected:",o);let s=null;try{const{data:{user:E}}=await c.auth.getUser();s=E,console.log("üë§ Current user:",s?s.email:"Not logged in")}catch{console.log("‚ÑπÔ∏è User not logged in, proceeding without authentication")}const g={first_name:o.first_name,last_name:o.last_name,email:o.email,phone:o.phone||null,company_name:o.company||null,project_type:o.project_type,project_details:o.message,message:o.message,user_id:s?s.id:null};console.log("üìù Sending contact data to Supabase:",g),console.log("üîç Testing Supabase connection...");const{data:U,error:f}=await c.from("contact_submissions").select("id").limit(1);if(f)throw console.error("‚ùå Supabase connection test failed:",f),new Error(`Database connection failed: ${f.message}`);console.log("‚úÖ Supabase connection test successful");const{data:x,error:h}=await c.from("contact_submissions").insert([g]).select();if(h)throw console.error("‚ùå Error saving contact message:",h),new Error(`Failed to save your message: ${h.message}`);console.log("‚úÖ Contact message saved successfully:",x),y?.classList.remove("hidden"),p.reset(),await prefillForm()}catch(r){console.error("Contact form error:",r),S&&(S.textContent=r.message||"An error occurred while sending your message."),I?.classList.remove("hidden")}finally{i.disabled=!1,i.innerHTML=u}});window.checkUserStatus=function(){console.log("üîç Checking user status..."),console.log("Global auth manager available:",!!window.globalAuthManager),console.log("Simple auth manager available:",!!window.simpleAuthManager),console.log("Supabase available:",!!window.supabase),window.globalAuthManager&&(console.log("User logged in (global):",window.globalAuthManager.isUserLoggedIn()),console.log("Current user (global):",window.globalAuthManager.getCurrentUser())),window.simpleAuthManager&&(console.log("User logged in (simple):",window.simpleAuthManager.isUserLoggedIn()),console.log("Current user (simple):",window.simpleAuthManager.getCurrentUser()))};window.reinitSupabase=function(){return console.log("üîÑ Reinitializing Supabase..."),b()?(console.log("‚úÖ Supabase reinitialized successfully"),!0):(console.log("‚ùå Failed to reinitialize Supabase"),!1)};window.testSupabaseConnection=async function(){if(!c)return console.log("‚ùå Supabase not initialized"),!1;try{const{data:n,error:t}=await c.from("contact_submissions").select("id").limit(1);return t?(console.error("‚ùå Supabase test failed:",t),!1):(console.log("‚úÖ Supabase test successful:",n),!0)}catch(n){return console.error("‚ùå Supabase test error:",n),!1}};document.addEventListener("DOMContentLoaded",()=>{["first_name","last_name","email","phone","company","project_type","message"].forEach(t=>{const a=document.getElementById(t);a&&(a.addEventListener("focus",()=>{m()||v()}),a.addEventListener("click",()=>{m()||v()}))})});m()||window.clearForm();setTimeout(()=>{m()||window.clearForm()},100);document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{window.checkUserStatus()},100),setTimeout(()=>{const n=window.globalAuthManager||window.simpleAuthManager;n&&n.isUserLoggedIn()?(console.log("üë§ User is logged in - pre-filling form"),prefillForm()):(console.log("üë§ User is not logged in - clearing form"),window.clearForm())},500)});window.addEventListener("user-logged-out",()=>{console.log("üë§ User logged out - clearing contact form"),window.clearForm()});window.addEventListener("load",()=>{console.log("üîÑ Window loaded - ensuring form is cleared"),window.clearForm();const n=window.globalAuthManager||window.simpleAuthManager;!n||!n.isUserLoggedIn()?(console.log("üë§ User not logged in on window load - clearing form"),window.clearForm()):(console.log("üë§ User is logged in on window load - will pre-fill form"),setTimeout(()=>{window.prefillForm()},200))});document.addEventListener("visibilitychange",()=>{document.hidden||(console.log("üîÑ Page became visible - checking authentication"),m()?console.log("üë§ User is logged in - keeping form data"):(console.log("üë§ User not logged in - clearing form"),window.clearForm()))});
