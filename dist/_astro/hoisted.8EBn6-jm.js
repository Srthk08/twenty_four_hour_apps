import{c as C}from"./index.BFAZBQoJ.js";import"./ProductDialog.astro_astro_type_script_index_0_lang.BQOC59sz.js";import"https://unpkg.com/@supabase/supabase-js@2";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2";const f=void 0,v=void 0,r=C(f,v);console.log("üîß Supabase configuration:");console.log("- URL:",f);console.log("- Key:","Missing");let p=null;function M(){return new Promise(e=>{let t=0;const o=50,a=()=>{if(t++,window.supabase)try{r=window.supabase.createClient(f,v),console.log("‚úÖ Supabase client initialized successfully"),e(r)}catch(s){console.error("‚ùå Error initializing Supabase:",s),e(null)}else t<o?setTimeout(a,100):(console.warn("‚ö†Ô∏è Supabase not available after timeout, continuing with demo data"),e(null))};a()})}document.addEventListener("DOMContentLoaded",async()=>{console.log("üìÑ DOM Content Loaded - Starting Menu Operator Dashboard initialization"),console.log("üîÑ UPDATED: Product Customizations Dashboard Loading..."),console.log("üîÑ Loading demo data immediately..."),h(),P(),console.log("‚úÖ Dashboard initialized with demo data - Page is ready!"),setTimeout(async()=>{try{console.log("üîÑ Attempting to load real data in background..."),await g(),console.log("‚úÖ Real data loaded successfully")}catch(e){console.warn("‚ö†Ô∏è Could not load real data, continuing with demo data:",e.message)}},1e3)});window.addEventListener("load",()=>{console.log("üîÑ Window loaded - Ensuring dashboard is ready"),document.getElementById("customizations-table-body").innerHTML.includes("Loading")&&(console.log("üîÑ Page still loading, forcing demo data"),h())});function h(){console.log("üîÑ Loading demo data immediately...");const e=z(),t=k();_(e),E(t),S(e),console.log("‚úÖ Demo data loaded - Customizations:",e.length,"Photos:",t.length)}async function g(){try{if(console.log("üîÑ Loading real data from Supabase..."),!await M()){console.warn("‚ö†Ô∏è Supabase not available, keeping demo data");return}await I();const t=await L(),o=await x();console.log("üîÑ Real data fetched - Customizations:",t?.length||0,"Photos:",o?.length||0),t&&t.length>0&&(_(t),console.log("‚úÖ Updated with real customizations data")),o&&o.length>0&&(E(o),console.log("‚úÖ Updated with real photos data")),t||o?(S(t||[],o||[]),console.log("‚úÖ Real data loaded and displayed successfully!")):console.log("‚ÑπÔ∏è No real data found, keeping demo data")}catch(e){console.warn("‚ö†Ô∏è Error loading real data, keeping demo data:",e.message)}}async function L(){try{if(console.log("üîÑ Attempting to load from product_customizations table..."),console.log("üîÑ Supabase client status:",r?"Available":"Not available"),!r)throw console.error("‚ùå Supabase client not available"),new Error("Supabase not available");console.log("üîÑ Executing Supabase query...");const{data:e,error:t}=await r.from("product_customizations").select("*").order("created_at",{ascending:!1}).limit(50);if(console.log("üîÑ Supabase query completed. Data:",e,"Error:",t),t)throw console.error("‚ùå Supabase error:",t),t;return console.log("‚úÖ Loaded customizations from product_customizations:",e?.length||0),console.log("üîÑ Sample data:",e?.[0]||"No data"),e||[]}catch(e){throw console.error("‚ùå Error loading real product customizations from product_customizations:",e),e}}async function x(){try{if(console.log("üîÑ Attempting to load from menu_photos table..."),!r)throw console.error("‚ùå Supabase client not available"),new Error("Supabase not available");const{data:e,error:t}=await r.from("menu_photos").select("*").order("created_at",{ascending:!1}).limit(50);if(t)throw console.error("‚ùå Supabase error:",t),t;return console.log("‚úÖ Loaded photos from menu_photos:",e?.length||0),e||[]}catch(e){throw console.error("‚ùå Error loading real menu photos:",e),e}}function _(e){console.log("üîÑ Displaying customizations:",e?.length||0);const t=document.getElementById("customizations-table-body");if(!t){console.error("‚ùå Table body not found! Looking for: customizations-table-body"),console.log("Available elements:",document.querySelectorAll('[id*="table"]'));return}if(!e||e.length===0){console.log("‚ö†Ô∏è No customizations to display - showing empty state"),t.innerHTML='<tr><td colspan="7" class="px-6 py-4 text-center text-gray-500">No product customizations found in database. <button onclick="loadRealData()" class="text-blue-600 hover:text-blue-800 underline">Refresh to try again</button></td></tr>';return}t.innerHTML=e.map(o=>`
      <tr class="hover:bg-gray-50">
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="text-sm font-medium text-gray-900">${o.product_name||"Product Customization"}</div>
          <div class="text-sm text-gray-500">${o.project_name||"No project name"}</div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="text-sm text-gray-900">${o.customer_name||"Not specified"}</div>
          <div class="text-sm text-gray-500">${o.company_name||"No company"}</div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="text-sm text-gray-900">${o.email||"No email"}</div>
          <div class="text-sm text-gray-500">${o.phone||"No phone"}</div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${o.status==="completed"?"bg-green-100 text-green-800":o.status==="in_progress"?"bg-yellow-100 text-yellow-800":o.status==="pending"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}">
            ${o.status||"pending"}
          </span>
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
          ‚Çπ${(o.price||0).toLocaleString("en-IN")}
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
          ${o.created_at?new Date(o.created_at).toLocaleDateString():"Unknown"}
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
          <button class="text-blue-600 hover:text-blue-900 mr-3" onclick="viewCustomization('${o.id}')">View</button>
          <button class="text-green-600 hover:text-green-900" onclick="processCustomization('${o.id}')">Process</button>
        </td>
      </tr>
    `).join(""),console.log("‚úÖ Customizations table updated with",e.length,"items")}function E(e){const t=document.getElementById("photos-table-body");if(t){if(!e||e.length===0){console.log("‚ö†Ô∏è No photos to display - showing empty state"),t.innerHTML='<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">No photos found in database. <button onclick="loadRealData()" class="text-blue-600 hover:text-blue-800 underline">Refresh to try again</button></td></tr>';return}t.innerHTML=e.map(o=>`
      <tr class="hover:bg-gray-50">
        <td class="px-6 py-4 whitespace-nowrap">
          ${o.photo_url?`<img src="${o.photo_url}" alt="Menu photo" class="w-12 h-12 rounded object-cover">`:'<div class="w-12 h-12 bg-gray-200 rounded flex items-center justify-center"><svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div>'}
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="text-sm text-gray-900">${o.original_filename||"Unknown"}</div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${o.conversion_status==="completed"?"bg-green-100 text-green-800":o.conversion_status==="processing"?"bg-yellow-100 text-yellow-800":o.conversion_status==="failed"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}">
            ${o.conversion_status||"pending"}
          </span>
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
          ${o.file_size?(o.file_size/1024).toFixed(1)+" KB":"Unknown size"}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
          ${o.created_at?new Date(o.created_at).toLocaleDateString():"Unknown"}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <button class="text-blue-600 hover:text-blue-900 mr-3" onclick="viewPhoto('${o.id}')">View</button>
              ${o.conversion_status==="completed"?`<button class="text-green-600 hover:text-green-900" onclick="downloadText('`+o.id+`')">Download</button>`:'<button class="text-gray-400 cursor-not-allowed" disabled>Download</button>'}
            </td>
          </tr>
        `).join("")}}function S(e,t){const o=document.getElementById("total-customizations"),a=document.getElementById("pending-customizations"),s=document.getElementById("in-progress-customizations"),n=document.getElementById("completed-customizations");if(o&&(o.textContent=e.length),a){const i=e.filter(d=>d.status==="pending"||d.status==="new").length;a.textContent=i}if(s){const i=e.filter(d=>d.status==="in_progress"||d.status==="processing").length;s.textContent=i}if(n){const i=e.filter(d=>d.status==="completed"||d.status==="processed").length;n.textContent=i}}function z(){return[{id:"demo-1",product_name:"Restaurant Menu System",project_name:"Bella Vista Digital Menu",customer_name:"Maria Rodriguez",company_name:"Bella Vista Restaurant",email:"maria@bellavista.com",phone:"+1 (555) 123-4567",requirements:"QR code ordering system with real-time updates",status:"pending",price:25e3,created_at:new Date(Date.now()-2*24*60*60*1e3).toISOString()},{id:"demo-2",product_name:"Android TV App",project_name:"Golden Dragon Streaming App",customer_name:"David Chen",company_name:"Golden Dragon Media",email:"david@goldendragon.com",phone:"+1 (555) 987-6543",requirements:"Multi-language support and content management",status:"in_progress",price:55e3,created_at:new Date(Date.now()-5*24*60*60*1e3).toISOString()},{id:"demo-3",product_name:"Restaurant Website",project_name:"Caf√© Del Sol Website",customer_name:"Sophie Martin",company_name:"Caf√© Del Sol",email:"sophie@cafedelsol.com",phone:"+1 (555) 456-7890",requirements:"Online ordering integration with delivery partners",status:"completed",price:15e3,created_at:new Date(Date.now()-7*24*60*60*1e3).toISOString()},{id:"demo-4",product_name:"Streaming Mobile App",project_name:"Pizza Palace Mobile App",customer_name:"Tony Romano",company_name:"Pizza Palace",email:"tony@pizzapalace.com",phone:"+1 (555) 321-9876",requirements:"Real-time order tracking and push notifications",status:"pending",price:45e3,created_at:new Date(Date.now()-10*24*60*60*1e3).toISOString()},{id:"demo-5",product_name:"Restaurant Menu System",project_name:"Sushi Master Digital Menu",customer_name:"Yuki Tanaka",company_name:"Sushi Master",email:"yuki@sushimaster.com",phone:"+1 (555) 654-3210",requirements:"Customizable menu categories and seasonal updates",status:"in_progress",price:25e3,created_at:new Date(Date.now()-12*24*60*60*1e3).toISOString()}]}function k(){return[{id:"photo-1",original_filename:"bella-vista-menu.jpg",photo_url:"https://via.placeholder.com/100x100/4F46E5/FFFFFF?text=BV",conversion_status:"completed",created_at:new Date(Date.now()-1*24*60*60*1e3).toISOString(),file_size:24e5},{id:"photo-2",original_filename:"golden-dragon-menu.jpg",photo_url:"https://via.placeholder.com/100x100/DC2626/FFFFFF?text=GD",conversion_status:"processing",created_at:new Date(Date.now()-3*24*60*60*1e3).toISOString(),file_size:18e5},{id:"photo-3",original_filename:"cafe-del-sol-menu.jpg",photo_url:"https://via.placeholder.com/100x100/059669/FFFFFF?text=CD",conversion_status:"completed",created_at:new Date(Date.now()-5*24*60*60*1e3).toISOString(),file_size:31e5}]}async function I(){try{if(typeof window.supabase>"u"){console.error("Supabase client not available");return}const e=window.supabase,{data:{user:t},error:o}=await e.auth.getUser();if(o||!t){console.error("Error getting user:",o),window.location.href="/login";return}p=t,console.log("üîç Loading profile for user:",t.email);const{data:a,error:s}=await e.from("profiles").select("*").eq("id",t.id).eq("role","menu_operator").single();if(s){console.error("Error loading profile:",s);const{data:n,error:i}=await e.from("profiles").select("*").eq("id",t.id).single();if(i){console.error("Error loading fallback profile:",i),window.location.href="/login";return}if(console.log("üîç Fallback profile loaded:",n),console.log("üîç Role value from database:",JSON.stringify(n.role)),!n.role||n.role.toLowerCase().trim()!=="menu_operator"){console.log("User does not have menu_operator role. Role:",n.role),n.role==="admin"?window.location.href="/admin":window.location.href="/dashboard";return}console.log("‚úÖ User has menu_operator role, proceeding...");return}if(console.log("üîç Profile loaded:",a),console.log("üîç Role value from database:",JSON.stringify(a.role)),!a.role||a.role.toLowerCase().trim()!=="menu_operator"){console.log("User does not have menu_operator role. Role:",a.role),a.role==="admin"?window.location.href="/admin":window.location.href="/dashboard";return}console.log("‚úÖ User has menu_operator role, proceeding...")}catch(e){console.error("Error loading user profile:",e)}}function P(){const e=document.getElementById("refresh-customizations");e&&e.addEventListener("click",async()=>{console.log("üîÑ Manual refresh of product customizations triggered"),await g()});const t=document.getElementById("refresh-photos");t&&t.addEventListener("click",async()=>{console.log("üîÑ Manual refresh of photos triggered"),await g()});const o=document.getElementById("photo-upload-input");o&&o.addEventListener("change",O)}async function O(e){const t=e.target.files[0];if(t){if(!t.type.startsWith("image/")){alert("Please select an image file");return}if(t.size>10*1024*1024){alert("File size must be less than 10MB");return}try{const o=t.name.split(".").pop(),a=`${p.id}/${Date.now()}.${o}`,{data:s,error:n}=await r.storage.from("menu-photos").upload(a,t);if(n)throw n;const{data:{publicUrl:i}}=r.storage.from("menu-photos").getPublicUrl(a),{data:d,error:w}=await r.from("menu_photos").insert({user_id:p.id,photo_url:i,original_filename:t.name,file_size:t.size,mime_type:t.type,conversion_status:"pending"});if(w)throw w;await x(),e.target.value="",alert("Photo uploaded successfully!")}catch(o){console.error("Upload error:",o),alert("Error uploading file: "+o.message)}}}window.viewCustomization=async function(e){console.log("üîÑ Loading product customization details for:",e);try{const{data:t,error:o}=await r.from("product_customizations").select("*").eq("id",e).single();if(o){console.error("Error loading product customization details:",o),alert("Error loading customization details: "+o.message);return}const a=`
Product Customization Details:
=============================

Product Information:
-------------------
Product Name: ${t.product_name||"Not provided"}
Project Name: ${t.project_name||"Not provided"}
Status: ${t.status||"Not provided"}
Price: ‚Çπ${(t.price||0).toLocaleString("en-IN")}

Customer Information:
-------------------
Customer Name: ${t.customer_name||"Not provided"}
Company Name: ${t.company_name||"Not provided"}
Email: ${t.email||"Not provided"}
Phone: ${t.phone||"Not provided"}

Project Details:
---------------
Requirements: ${t.requirements||"No requirements provided"}
Created: ${new Date(t.created_at).toLocaleString()}
Updated: ${new Date(t.updated_at||t.created_at).toLocaleString()}

${t.notes?`Notes: ${t.notes}`:""}
        `;alert(a)}catch(t){console.error("Error viewing product customization details:",t),alert("Error viewing customization details: "+t.message)}};window.processCustomization=function(e){console.log("Process product customization:",e),alert("Processing customization: "+e)};window.viewPhoto=function(e){console.log("View photo:",e)};window.downloadText=function(e){console.log("Download text for photo:",e)};console.log("üîÑ Script loaded - Force loading data...");setTimeout(()=>{h()},100);const N="https://lmrrdcaavwwletcjcpqv.supabase.co",U="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ";let l=null;function m(){return new Promise(e=>{window.supabase?(l=window.supabase.createClient(N,U),e(l)):setTimeout(()=>m().then(e),100)})}async function u(){try{console.log("üîí MenuOperatorGuard: Checking menu operator access..."),l||await m();const{data:{user:e},error:t}=await l.auth.getUser();if(t){console.error("‚ùå MenuOperatorGuard: Error getting user:",t),c("Authentication error. Please login again.");return}if(!e){console.log("‚ùå MenuOperatorGuard: No user logged in"),c("Please login to access menu operator panel");return}console.log("‚úÖ MenuOperatorGuard: User found:",e.email);const{data:o,error:a}=await l.from("profiles").select("role").eq("id",e.id).single();if(a){console.error("‚ùå MenuOperatorGuard: Error getting profile:",a),c("Error checking user permissions");return}if(o.role!=="menu_operator"){console.log("‚ùå MenuOperatorGuard: User does not have menu_operator role. Role:",o.role),c("Access denied. Menu operator privileges required.");return}console.log("‚úÖ MenuOperatorGuard: Menu operator access granted for user:",e.email),D()}catch(e){console.error("‚ùå MenuOperatorGuard: Error checking menu operator access:",e),c("Error checking menu operator access. Please try again.")}}function c(e){const t=document.getElementById("menu-operator-guard");t&&(t.innerHTML=`
          <div class="text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
              <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
              </svg>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">Access Denied</h3>
            <p class="text-gray-600 mb-6">${e}</p>
            <div class="space-x-3">
              <a href="/login" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors">
                Go to Login
              </a>
              <a href="/" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors">
                Back to Home
              </a>
            </div>
          </div>
        `)}function D(){const e=document.getElementById("menu-operator-guard");if(e){e.style.display="none",e.style.visibility="hidden",e.style.opacity="0",e.style.height="0",e.style.overflow="hidden";const t=document.getElementById("menu-operator-admin-layout");t&&(t.classList.remove("hidden"),t.style.display="block",t.style.visibility="visible",t.style.opacity="1",$()),window.dispatchEvent(new CustomEvent("menu-operator-access-granted"))}}async function $(){try{l||await m();const{data:{user:e}}=await l.auth.getUser();if(e){const{data:t}=await l.from("profiles").select("full_name").eq("id",e.id).single(),o=document.getElementById("menu-operator-name");o&&(o.textContent=t?.full_name||e.user_metadata?.full_name||e.email||"Menu Operator");const a=document.getElementById("menu-operator-avatar");if(a){const s=t?.full_name||e.user_metadata?.full_name||e.email||"M";a.textContent=s.charAt(0).toUpperCase()}}}catch(e){console.warn("Could not update menu operator info:",e)}}async function A(){try{console.log("Menu operator signing out..."),l||await m(),await l.auth.signOut(),sessionStorage.clear(),localStorage.removeItem("supabase-auth-session"),window.location.href="/"}catch(e){console.error("Error during menu operator sign out:",e),window.location.href="/"}}window.handleMenuOperatorSignOut=A;document.addEventListener("DOMContentLoaded",u);window.addEventListener("auth-state-changed",u);document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u();setTimeout(()=>{const e=document.getElementById("menu-operator-guard");e&&e.style.display!=="none"&&(console.warn("‚ö†Ô∏è Menu operator access check timed out, showing content anyway"),D())},1e4);console.log("MenuOperatorAdminLayout loaded successfully");function y(){console.log("üîß Fixing text visibility..."),document.querySelectorAll(".text-white, .text-light, .text-muted").forEach(o=>{(o.style.color==="white"||o.style.color==="#ffffff"||o.style.color==="#fff")&&(o.style.color="#1f2937",o.style.backgroundColor="#f8fafc",o.style.padding="2px 4px",o.style.borderRadius="4px")}),document.querySelectorAll("input, textarea, select").forEach(o=>{(o.style.color==="white"||o.style.color==="#ffffff")&&(o.style.color="#1f2937",o.style.backgroundColor="#ffffff",o.style.border="2px solid #d1d5db")}),console.log("‚úÖ Text visibility fixed!")}function b(){document.body.classList.add("menu-operator-admin-active"),window.hideUserNavbar&&window.hideUserNavbar(),document.addEventListener("click",function(e){const t=e.target.closest('a[href="/"]');t&&t.textContent.includes("Back to Site")&&(console.log('üîÑ Menu Operator clicked "Back to Site" - preparing to show user navbar'),document.body.classList.remove("menu-operator-admin-active"),setTimeout(()=>{window.showUserNavbar&&(window.showUserNavbar(),console.log("‚úÖ User navbar shown after delay"))},50))}),window.addEventListener("beforeunload",function(){window.location.pathname.startsWith("/menu-operator")||(document.body.classList.remove("menu-operator-admin-active"),window.showUserNavbar&&window.showUserNavbar())})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){y(),b()}):(y(),b());(function(){document.documentElement.classList.add("menu-operator-admin-active"),document.body.classList.add("menu-operator-admin-active");function e(){const t=document.querySelector("header");t&&(t.style.display="none",t.style.visibility="hidden",t.style.opacity="0",t.style.height="0",t.style.maxHeight="0",t.style.overflow="hidden",t.style.position="absolute",t.style.top="-9999px",t.style.left="-9999px",t.style.zIndex="-9999",t.style.pointerEvents="none",t.style.transform="translateY(-100vh)",t.style.transition="none",t.style.animation="none")}e(),document.readyState==="loading"&&document.addEventListener("DOMContentLoaded",e),setTimeout(e,0),setTimeout(e,10),setTimeout(e,50)})();
