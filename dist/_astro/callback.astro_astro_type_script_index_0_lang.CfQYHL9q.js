import{c as l}from"./index.9NDAT-bh.js";import"./preload-helper.BlTxHScW.js";const u="https://lmrrdcaavwwletcjcpqv.supabase.co",w="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ",r=l(u,w);async function h(){try{const s=window.location.hash||"";if(s.includes("access_token")){const t=new URLSearchParams(s.replace("#","")),n=t.get("access_token"),e=t.get("refresh_token")||t.get("provider_refresh_token");if(t.get("type")==="recovery"&&n&&e){console.log("Password reset callback detected, redirecting to reset-password page"),window.location.href=`/reset-password${s}`;return}if(n&&e){const{data:i}=await r.auth.setSession({access_token:n,refresh_token:e});i?.session?.user&&(sessionStorage.setItem("simple-auth-session",JSON.stringify({user:i.session.user,access_token:i.session.access_token,timestamp:Date.now()})),window.dispatchEvent(new CustomEvent("user-logged-in",{detail:i.session.user}))),window.history.replaceState({},document.title,"/auth/callback"),window.location.href="/dashboard";return}}if(window.location.search.includes("code="))if(new URLSearchParams(window.location.search).get("type")==="recovery"){const{data:e,error:o}=await r.auth.exchangeCodeForSession(window.location.href);if(o){console.error("Auth callback (PKCE recovery) error:",o),window.location.href="/reset-password?error=invalid_token";return}else if(e?.session){window.location.href="/reset-password";return}}else{const{data:e,error:o}=await r.auth.exchangeCodeForSession(window.location.href);if(o)console.error("Auth callback (PKCE) error:",o);else if(e?.session){sessionStorage.setItem("simple-auth-session",JSON.stringify({user:e.session.user,access_token:e.session.access_token,timestamp:Date.now()})),window.dispatchEvent(new CustomEvent("user-logged-in",{detail:e.session.user})),window.history.replaceState({},document.title,"/auth/callback"),window.location.href="/dashboard";return}}const{data:a,error:d}=await r.auth.getSession();if(d){console.error("Auth callback error:",d);return}a.session?.user&&(sessionStorage.setItem("simple-auth-session",JSON.stringify({user:a.session.user,access_token:a.session.access_token,timestamp:Date.now()})),window.dispatchEvent(new CustomEvent("user-logged-in",{detail:a.session.user})),setTimeout(()=>{window.location.href="/dashboard"},1e3))}catch(s){console.error("Callback error:",s)}}h();r.auth.onAuthStateChange((s,c)=>{s==="SIGNED_IN"&&c?.user&&(console.log("User signed in:",c.user),setTimeout(()=>{window.location.href="/dashboard"},1e3))});
