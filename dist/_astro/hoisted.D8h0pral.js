const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/supabase.DO6XXPT9.js","_astro/index.BFAZBQoJ.js"])))=>i.map(i=>d[i]);
import{c as U,_ as z}from"./index.BFAZBQoJ.js";import"./ProductDialog.astro_astro_type_script_index_0_lang.C4tfig-4.js";import"https://unpkg.com/@supabase/supabase-js@2";import"./AuthGuard.astro_astro_type_script_index_0_lang.D4Znhmp3.js";const R="https://lmrrdcaavwwletcjcpqv.supabase.co",j="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ",T=U(R,j),$={"restaurant-website":"restaurant-website","streaming-mobile-app":"streaming-mobile-app","android-tv-app":"android-tv-app","restaurant-menu-system":"restaurant-menu-system","order-menu-system":"restaurant-menu-system"};async function Y(e,s){try{if(console.log("💾 Saving customization form to Supabase...",{formData:e,productType:s}),s==="order-menu-system")return await J(e);const u={product_type:$[s]||s,product_name:e.productName||e.product_name||"Unknown Product",product_price:e.productPrice||e.product_price||"₹0",project_name:e.projectName||e.project_name||"",contact_person:e.contactPerson||e.contact_person||"",app_name:e.appName||e.app_name||"",product_description:e.productDescription||e.product_description||"",restaurant_name:e.restaurantName||e.restaurant_name||null,cuisine_type:e.cuisineType||e.cuisine_type||null,logo_url:e.logoUrl||e.logo_url||null,logo_filename:e.logoFilename||e.logo_filename||null,logo_mime_type:e.logoMimeType||e.logo_mime_type||null,logo_size:e.logoSize||e.logo_size||null,contact_email:e.email||e.contact_email||e.contactEmail||"",contact_phone:e.phone||e.contact_phone||e.contactPhone||"",primary_color:e.primaryColor||e.primary_color||"#3B82F6",secondary_color:e.secondaryColor||e.secondary_color||"#10B981",accent_color:e.accentColor||e.accent_color||"#F59E0B",text_color:e.textColor||e.text_color||"#1F2937",additional_requirements:e.additionalRequirements||e.additional_requirements||"",menu_items:e.menuItems||e.menu_items||[],restaurant_address:e.restaurantAddress||e.restaurant_address||null,owner_name:e.ownerName||e.owner_name||null,status:"pending"};console.log("🧩 Inserting customization form for other products...");const{data:t,error:l}=await T.from("customization_forms").insert(u).select().single();return l?(console.error("❌ Error inserting customization form:",l),console.error("❌ Error details:",{message:l.message,details:l.details,hint:l.hint,code:l.code}),{success:!1,error:l.message,data:null}):(console.log("✅ Customization form inserted successfully:",t),{success:!0,error:null,data:t})}catch(o){return console.error("❌ Unexpected error saving customization form:",o),{success:!1,error:o.message,data:null}}}async function J(e){try{console.log("💾 Saving OMS customization form to Supabase...",{formData:e});const{data:s,error:o}=await T.rpc("upsert_oms_customization",{p_user_email:e.email||e.contact_email||e.contactEmail||"",p_project_name:e.projectName||e.project_name||"",p_restaurant_name:e.restaurantName||e.restaurant_name||"Default Restaurant",p_owner_name:e.ownerName||e.owner_name||e.contactPerson||e.contact_person||"",p_restaurant_address:e.restaurantAddress||e.restaurant_address||"Not provided",p_contact_person:e.contactPerson||e.contact_person||"",p_phone_number:e.phone||e.contact_phone||e.contactPhone||"",p_user_id:null,p_logo_url:e.logoUrl||e.logo_url||null,p_logo_filename:e.logoFilename||e.logo_filename||null,p_logo_size:e.logoSize||e.logo_size||null,p_menu_categories:e.menuCategories||e.menu_categories||[],p_menu_items:e.menuItems||e.menu_items||[],p_primary_color:e.primaryColor||e.primary_color||"#3B82F6",p_secondary_color:e.secondaryColor||e.secondary_color||"#10B981",p_accent_color:e.accentColor||e.accent_color||"#F59E0B",p_text_color:e.textColor||e.text_color||"#1F2937",p_additional_requirements:e.additionalRequirements||e.additional_requirements||""});if(o)return console.error("❌ Error inserting OMS customization:",o),console.error("❌ Error details:",{message:o.message,details:o.details,hint:o.hint,code:o.code}),{success:!1,error:o.message,data:null};if(s&&s.length>0){const u=s[0];return console.log("✅ OMS customization result:",u),u.is_duplicate?(console.log("⚠️ Duplicate data detected:",u.message),{success:!0,error:null,data:{id:u.data_id},isUpdate:!1,isDuplicate:!0,message:u.message}):(console.log("✅ OMS customization saved successfully, ID:",u.data_id),{success:!0,error:null,data:{id:u.data_id},isUpdate:!1,isDuplicate:!1,message:u.message})}else return console.error("❌ No data returned from OMS function"),{success:!1,error:"No data returned from OMS function",data:null}}catch(s){return console.error("❌ Unexpected error saving OMS customization form:",s),{success:!1,error:s.message,data:null}}}console.log("Dashboard loaded - using global auth manager");async function V(e){try{console.log("🔍 Fetching user profile from Supabase for user:",e);const{supabase:s}=await z(async()=>{const{supabase:t}=await import("./supabase.DO6XXPT9.js");return{supabase:t}},__vite__mapDeps([0,1])),{data:o,error:u}=await s.from("profiles").select("*").eq("id",e).single();return u?(console.error("Error fetching user profile:",u),null):(console.log("✅ User profile fetched from Supabase:",o),o)}catch(s){return console.error("Error in fetchUserProfile:",s),null}}async function L(){console.log("🔄 Updating user info...");let e=null,s="";const o=[{key:"simple-auth-session",storage:sessionStorage,path:"user"},{key:"simple-auth-user",storage:localStorage,path:null},{key:"simple-auth-session",storage:localStorage,path:"user"}];for(const t of o)try{const l=t.storage.getItem(t.key);if(l){const i=JSON.parse(l);if(e=t.path?i[t.path]:i,e&&e.email){s=t.key,console.log(`✅ Found user data in ${t.key}:`,e.email);break}}}catch(l){console.log(`Error reading ${t.key}:`,l)}if(!e){console.log("No stored user data found, checking URL...");const t=new URLSearchParams(window.location.search),l=t.get("email")||"user@example.com",i=t.get("name")||"User";e={email:l,full_name:i,phone:"Not set",company_name:"Not set"},s="URL parameters",console.log("Using fallback data:",e)}if(e){if(e.user_metadata&&(e.full_name=e.user_metadata.full_name||e.full_name,e.phone=e.user_metadata.phone||e.phone,e.company_name=e.user_metadata.company_name||e.company_name),e.id&&(!e.full_name||e.full_name==="User"||!e.phone||e.phone==="Not set")){console.log("🔄 Incomplete user data, fetching from Supabase...");try{const t=await V(e.id);t&&(e={...e,...t,email:e.email||t.email},console.log("✅ Enhanced user data with profile:",e))}catch(t){console.log("Error fetching profile data:",t)}}e.full_name=e.full_name||e.fullName||"User",e.phone=e.phone||"Not set",e.company_name=e.company_name||e.companyName||"Not set",e.email=e.email||"user@example.com",console.log("📋 Final normalized user data:",e)}const u=document.getElementById("user-welcome");if(u){const t=e.full_name||e.fullName||e.email?.split("@")[0]||"User";u.textContent=t,console.log("👋 Welcome message updated to:",t)}console.log(`✅ Dashboard updated successfully from ${s}`),setTimeout(()=>{console.log("🔄 Force update welcome message...");const t=document.getElementById("user-welcome");if(t){const l=e.full_name||e.fullName||e.email?.split("@")[0]||"User";t.textContent=l,console.log("Force updated welcome to:",t.textContent)}},100)}function H(){const e=new URLSearchParams(window.location.search),s=e.get("product"),o=e.get("price");if(console.log("🔍 Checking for product selection:",{productId:s,price:o}),s&&o){console.log("✅ Product selected, showing customization form");const t=[{id:"1",name:"Restaurant Menu System",description:"Digital menu system with QR code integration, online ordering, and real-time updates. Perfect for restaurants looking to modernize their customer experience.",price:25e3,type:"restaurant"},{id:"2",name:"Android TV App",description:"Custom Android TV applications with beautiful UI, content management, and remote control support. Perfect for streaming services and media companies.",price:55e3,type:"non-restaurant"},{id:"3",name:"Streaming Mobile App",description:"Mobile streaming applications for iOS and Android with custom features, user authentication, and content management.",price:35e3,type:"non-restaurant"},{id:"4",name:"Restaurant Website",description:"Professional restaurant website with online ordering, menu display, and customer management features.",price:2e4,type:"restaurant"},{id:"5",name:"Order Menu System",description:"Complete order management system with digital menu integration, real-time order tracking, and payment processing. Perfect for restaurants looking to streamline their ordering process.",price:999,type:"order-menu"}].find(l=>l.id===s);if(t){const l=document.getElementById("product-customization-form"),i=document.getElementById("order-menu-customization-form"),g=document.getElementById("recent-activity");l&&!l.classList.contains("hidden")&&(l.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",l.style.opacity="0",l.style.transform="translateY(-10px)",setTimeout(()=>l.classList.add("hidden"),300)),i&&!i.classList.contains("hidden")&&(i.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",i.style.opacity="0",i.style.transform="translateY(-10px)",setTimeout(()=>i.classList.add("hidden"),300)),g&&!g.classList.contains("hidden")&&(g.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",g.style.opacity="0",g.style.transform="translateY(-10px)",setTimeout(()=>g.classList.add("hidden"),300)),setTimeout(()=>{const n=t.type==="order-menu"?999:parseInt(o);if(t.type==="order-menu"){document.getElementById("order-menu-product-name").textContent=t.name,document.getElementById("order-menu-product-price").textContent=`₹${n.toLocaleString()}`;const c=document.getElementById("order-menu-customization-form");c.classList.remove("hidden"),c.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",c.style.opacity="0",c.style.transform="translateY(10px)",setTimeout(()=>{c.style.opacity="1",c.style.transform="translateY(0)"},50)}else{document.getElementById("selected-product-name").textContent=t.name,document.getElementById("selected-product-price").textContent=`₹${n.toLocaleString()}`;const c=document.getElementById("cuisine-type-field"),m=document.getElementById("restaurant-name-field");t.type==="restaurant"?(c.classList.remove("hidden"),c.querySelector("select").required=!0,m.classList.remove("hidden"),m.querySelector("input").required=!0):(c.classList.add("hidden"),c.querySelector("select").required=!1,m.classList.add("hidden"),m.querySelector("input").required=!1);const a=document.getElementById("product-customization-form");a.classList.remove("hidden"),a.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",a.style.opacity="0",a.style.transform="translateY(10px)",setTimeout(()=>{a.style.opacity="1",a.style.transform="translateY(0)"},50)}},350),setTimeout(()=>N(),500)}}}function Q(){const e=document.getElementById("order-menu-form"),s=document.getElementById("close-order-menu-form"),o=document.getElementById("cancel-order-menu"),u=document.getElementById("order-menu-logo-upload"),t=document.querySelector("#order-menu-customization-form .border-dashed"),l=document.getElementById("add-menu-item"),i=document.getElementById("menu-items-container"),g=document.getElementById("oms-category-input"),n=document.getElementById("oms-add-category-btn"),c=document.getElementById("oms-clear-all-categories-btn"),m=document.getElementById("oms-category-pills"),a=document.getElementById("oms-current-category"),S=document.getElementById("oms-prev-page"),I=document.getElementById("oms-next-page"),q=document.getElementById("oms-page-indicator"),b=[];let w=-1;const M=6;let x=1;function P(){m.innerHTML="",b.forEach((d,h)=>{const r=document.createElement("button");r.type="button",r.className=`px-3 py-1 rounded-full text-sm ${h===w?"bg-amber-600 text-white":"bg-gray-100"} flex items-center`;const y=document.createElement("span");y.textContent=d,y.className="mr-2",r.appendChild(y);const p=document.createElement("span");p.textContent="✕",p.className="text-xs opacity-70 hover:opacity-100 ml-1",p.addEventListener("click",f=>{f.stopPropagation();const B=b.splice(h,1)[0];w>=b.length&&(w=b.length-1),i.querySelectorAll(".menu-item-row").forEach(_=>{const A=_.querySelector(".oms-category-field");A&&A.value===B&&(A.value="")}),a.textContent=b[w]||"Uncategorized",P(),v()}),r.appendChild(p),r.addEventListener("click",()=>{w=h,a.textContent=d,P(),v()}),m.appendChild(r)})}c?.addEventListener("click",()=>{b.splice(0,b.length),w=-1,a.textContent="Uncategorized",P(),v(),i.querySelectorAll(".oms-category-field").forEach(d=>d.value="")}),n?.addEventListener("click",()=>{const d=g.value.trim();d&&(b.includes(d)||(b.push(d),w=b.length-1,a.textContent=d,P(),i.querySelectorAll(".oms-category-field").forEach(h=>{h.value||(h.value=d)}),g.value=""))});function v(){const d=Array.from(i.querySelectorAll(".menu-item-row"));if(d.forEach(y=>y.style.display=""),w>=0){const y=b[w];d.forEach(p=>{const f=p.querySelector(".oms-category-field");f&&f.value&&f.value!==y&&(p.style.display="none")})}const h=d.filter(y=>y.style.display!=="none"),r=Math.max(1,Math.ceil(h.length/M));x=Math.min(x,r),q.textContent=`Page ${x} / ${r}`,h.forEach((y,p)=>{const f=Math.floor(p/M)+1;y.style.display=f===x?"":"none"})}S?.addEventListener("click",()=>{x>1&&(x-=1,v())}),I?.addEventListener("click",()=>{x+=1,v()}),t?.addEventListener("click",()=>{u?.click()}),u?.addEventListener("change",d=>{const h=d.target.files[0];if(h){const r=h.name,y=(h.size/1024/1024).toFixed(2);t.innerHTML=`
          <div class="flex flex-col items-center">
            <svg class="w-12 h-12 text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <p class="text-green-600 mb-1 font-medium">Logo uploaded successfully</p>
            <p class="text-sm text-gray-500">${r} (${y} MB)</p>
          </div>
        `}});function C(){const d=e?.querySelectorAll('input[type="color"]'),h=e?.querySelectorAll('input[name$="ColorText"]');d?.forEach((r,y)=>{const p=h?.[y];p&&(r.addEventListener("input",()=>{p.value=r.value}),p.addEventListener("input",()=>{/^#[0-9A-F]{6}$/i.test(p.value)&&(r.value=p.value)}))})}C();let E=1;l?.addEventListener("click",()=>{const d=document.createElement("div");if(d.className="menu-item-row grid grid-cols-1 md:grid-cols-4 gap-4 mb-4 p-4 border border-gray-200 rounded-lg",d.innerHTML=`
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Item Name</label>
          <input type="text" name="menuItems[${E}][item_name]" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500" placeholder="e.g., Margherita Pizza" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Price (₹)</label>
          <input type="number" name="menuItems[${E}][price]" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500" placeholder="299" step="0.01" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
          <input type="text" name="menuItems[${E}][item_category]" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 oms-category-field" placeholder="Type or pick from pills" required>
        </div>
        <div class="flex items-end">
          <button type="button" class="remove-menu-item px-3 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 text-sm">
            Remove
          </button>
        </div>
      `,i?.appendChild(d),E++,w>=0){const h=b[w],r=d.querySelector(".oms-category-field");r&&!r.value&&(r.value=h)}v()}),i?.addEventListener("click",d=>{d.target.classList.contains("remove-menu-item")&&(d.target.closest(".menu-item-row").remove(),v())}),v(),s?.addEventListener("click",()=>{k(),window.history.replaceState({},document.title,window.location.pathname)}),o?.addEventListener("click",()=>{k(),window.history.replaceState({},document.title,window.location.pathname)}),e?.addEventListener("submit",async d=>{d.preventDefault();const h=new FormData(e),r=Object.fromEntries(h);console.log("📝 Order Menu requirements saved:",r);const y={productId:"5",productName:"Order Menu System",productDescription:"Complete order management system with digital menu integration, real-time order tracking, and payment processing. Perfect for restaurants looking to streamline their ordering process.",productPrice:"₹25,000",projectName:r.projectName,restaurantName:r.restaurantName,ownerName:r.ownerName,restaurantAddress:r.restaurantAddress,contactPerson:r.contactPerson,email:r.email,phone:r.phone,additionalRequirements:r.additionalRequirements,restaurantLogo:r.restaurantLogo,primaryColor:r.primaryColor,secondaryColor:r.secondaryColor,accentColor:r.accentColor,textColor:r.textColor,menuItems:Array.from(document.querySelectorAll(".menu-item-row")).map((p,f)=>({item_name:p.querySelector(`input[name="menuItems[${f}][item_name]"]`)?.value||"",price:p.querySelector(`input[name="menuItems[${f}][price]"]`)?.value||"",item_category:p.querySelector(`input[name="menuItems[${f}][item_category]"]`)?.value||""})).filter(p=>p.item_name),timestamp:new Date().toISOString()};try{console.log("💾 Saving OMS data to Supabase...");const{supabase:p}=await z(async()=>{const{supabase:f}=await import("./supabase.DO6XXPT9.js");return{supabase:f}},__vite__mapDeps([0,1]));if(p){const{data:f,error:B}=await p.rpc("upsert_oms_customization",{p_user_email:r.email,p_project_name:r.projectName,p_restaurant_name:r.restaurantName,p_owner_name:r.ownerName,p_restaurant_address:r.restaurantAddress,p_contact_person:r.contactPerson,p_phone_number:r.phone,p_user_id:null,p_logo_url:null,p_logo_filename:null,p_logo_size:null,p_menu_categories:y.menuItems?JSON.stringify(Array.from(new Set(y.menuItems.map(_=>_.item_category).filter(_=>_&&_.trim()!==""))).map((_,A)=>({id:`cat_${A+1}`,name:_}))):"[]",p_menu_items:y.menuItems?JSON.stringify(y.menuItems):"[]",p_primary_color:r.primaryColor||"#3B82F6",p_secondary_color:r.secondaryColor||"#10B981",p_accent_color:r.accentColor||"#F59E0B",p_text_color:r.textColor||"#1F2937",p_additional_requirements:r.additionalRequirements||""});if(B){console.error("❌ Error saving to Supabase:",B);const _=JSON.parse(localStorage.getItem("order-menu-requirements")||"[]");_.push(y),localStorage.setItem("order-menu-requirements",JSON.stringify(_)),alert("Order Menu requirements saved locally! Our team will contact you soon.")}else if(f&&f.length>0){const _=f[0];if(_.is_duplicate)alert(`⚠️ Data Already Exists!

${_.message}

Record ID: ${_.data_id}`);else if(console.log("✅ OMS data saved to Supabase with ID:",_.data_id),alert("Order Menu requirements saved successfully! Opening payment page..."),window.open("https://payments.pabbly.com/subscribe/68c084369dbcfe4b619b80ce/six-months-inr","_blank"))setTimeout(()=>{window.location.href="/orders?order=success&product=order-menu-system"},2e3);else{alert("Please allow popups for this site to proceed with payment, or click the payment link manually.");const O=document.createElement("div");O.innerHTML=`
                  <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                              background: white; padding: 20px; border: 2px solid #4CAF50; 
                              border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 9999;">
                    <h3 style="color: #4CAF50; margin-bottom: 15px;">Payment Required</h3>
                    <p style="margin-bottom: 15px;">Please complete your payment to proceed:</p>
                    <a href="https://payments.pabbly.com/subscribe/68c084369dbcfe4b619b80ce/six-months-inr" 
                       target="_blank" style="display: inline-block; padding: 10px 20px; 
                       background: #4CAF50; color: white; text-decoration: none; border-radius: 5px;">
                      Open Payment Page
                    </a>
                    <button onclick="this.parentElement.remove()" style="margin-left: 10px; padding: 10px 15px; 
                            background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer;">
                      Close
                    </button>
                  </div>
                `,document.body.appendChild(O)}}else{console.error("❌ No data returned from OMS function");const _=JSON.parse(localStorage.getItem("order-menu-requirements")||"[]");_.push(y),localStorage.setItem("order-menu-requirements",JSON.stringify(_)),alert("Order Menu requirements saved locally! Our team will contact you soon.")}}else{console.error("❌ Supabase not available, saving locally only");const f=JSON.parse(localStorage.getItem("order-menu-requirements")||"[]");f.push(y),localStorage.setItem("order-menu-requirements",JSON.stringify(f)),alert("Order Menu requirements saved locally! Our team will contact you soon.")}window.history.replaceState({},document.title,window.location.pathname),k(),e.reset()}catch(p){console.error("Error saving order menu requirements:",p),alert("Error saving order menu requirements. Please try again.")}})}function W(){const e=document.getElementById("customization-form"),s=document.getElementById("close-customization-form"),o=document.getElementById("cancel-customization"),u=document.getElementById("restaurant-logo-upload"),t=document.querySelector("#product-customization-form .border-dashed");t?.addEventListener("click",()=>{u?.click()}),u?.addEventListener("change",i=>{const g=i.target.files[0];if(g){const n=g.name,c=(g.size/1024/1024).toFixed(2);t.innerHTML=`
          <div class="flex flex-col items-center">
            <svg class="w-12 h-12 text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <p class="text-green-600 mb-1 font-medium">Logo uploaded successfully</p>
            <p class="text-sm text-gray-500">${n} (${c} MB)</p>
          </div>
        `}});function l(){const i=e?.querySelectorAll('input[type="color"]'),g=e?.querySelectorAll('input[name$="ColorText"]');i?.forEach((n,c)=>{const m=g?.[c];m&&(n.addEventListener("input",()=>{m.value=n.value}),m.addEventListener("input",()=>{/^#[0-9A-F]{6}$/i.test(m.value)&&(n.value=m.value)}))})}l(),s?.addEventListener("click",()=>{k(),window.history.replaceState({},document.title,window.location.pathname)}),o?.addEventListener("click",()=>{k(),window.history.replaceState({},document.title,window.location.pathname)}),e?.addEventListener("submit",async i=>{i.preventDefault();const g=new FormData(e),n=Object.fromEntries(g);console.log("📝 Project requirements saved:",n);const c=document.getElementById("selected-product-name").textContent,m=document.getElementById("selected-product-price").textContent,a={productId:new URLSearchParams(window.location.search).get("product")||"1",productName:c,productPrice:m,projectName:n.projectName,appName:n.appName,contactPerson:n.contactPerson,productDescriptionCustom:n.productDescription,email:n.email,phone:n.phone,additionalRequirements:n.additionalRequirements,restaurantLogo:n.restaurantLogo,primaryColor:n.primaryColor,secondaryColor:n.secondaryColor,accentColor:n.accentColor,textColor:n.textColor,timestamp:new Date().toISOString()};a.restaurantName=n.restaurantName||a.restaurantName||"",a.cuisineType=n.cuisineType||a.cuisineType||"";try{console.log("💾 Saving project form to database...");const I=(C=>(C||"").toLowerCase())(c);let q="restaurant-website";I.includes("order menu")?q="restaurant-menu-system":I.includes("restaurant website")?q="restaurant-website":I.includes("android tv")?q="android-tv-app":I.includes("streaming")&&(q="streaming-mobile-app");let b=a.logoUrl||null,w=a.logoFilename||null,M=a.logoMimeType||null,x=a.logoSize||null;try{const E=e.querySelector('input[name="restaurantLogo"]')?.files?.[0];if(E){const{supabase:d}=await z(async()=>{const{supabase:f}=await import("./supabase.DO6XXPT9.js");return{supabase:f}},__vite__mapDeps([0,1])),h=E.name.replace(/\s+/g,"_");if(E.size>10*1024*1024)throw new Error("Logo file exceeds 10MB limit");const r=`${Date.now()}_${h}`,y=await E.arrayBuffer(),{error:p}=await d.storage.from("logos").upload(r,y,{upsert:!0,contentType:E.type,cacheControl:"3600"});if(!p){const{data:f}=d.storage.from("logos").getPublicUrl(r);if(b=f?.publicUrl||null,!b){const{data:B,error:_}=await d.storage.from("logos").createSignedUrl(r,31536e3);_||(b=B?.signedUrl||null)}w=E.name,M=E.type,x=E.size}}}catch(C){console.warn("Logo upload skipped:",C)}const P={productName:c,productPrice:m,projectName:a.projectName,contactPerson:a.contactPerson,appName:a.appName,productDescription:a.productDescriptionCustom,restaurantName:a.restaurantName,cuisineType:a.cuisineType,email:a.email,phone:a.phone,primaryColor:a.primaryColor,secondaryColor:a.secondaryColor,accentColor:a.accentColor,textColor:a.textColor,additionalRequirements:a.additionalRequirements,logoUrl:b,logoFilename:w,logoMimeType:M,logoSize:x},v=await Y(P,q);if(v.success)console.log("✅ Project form saved to Supabase database:",v.data),alert(`✅ Project requirements saved to database successfully!

Record ID: ${v.data.id}
Project: ${v.data.project_name}
Restaurant: ${v.data.restaurant_name||"N/A"}
Cuisine: ${v.data.cuisine_type||"N/A"}

Our team will contact you soon!`);else{console.error("❌ Error saving to database:",v.error);const C=JSON.parse(localStorage.getItem("project-requirements")||"[]");C.push(a),localStorage.setItem("project-requirements",JSON.stringify(C)),alert(`❌ Database save failed: ${v.error}

Data saved locally as backup. Our team will contact you soon.`)}window.history.replaceState({},document.title,window.location.pathname),k(),e.reset(),t&&(t.innerHTML=`
            <div class="flex flex-col items-center">
              <svg class="w-12 h-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              <p class="text-gray-600 mb-2">Click to upload restaurant logo</p>
              <p class="text-sm text-gray-500">PNG, JPG, SVG up to 10MB</p>
            </div>
          `)}catch(S){console.error("Error saving requirements:",S),alert("Error saving project requirements. Please try again.")}})}function k(){const e=document.getElementById("product-customization-form"),s=document.getElementById("order-menu-customization-form"),o=document.getElementById("recent-activity");e&&!e.classList.contains("hidden")&&(e.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",e.style.opacity="0",e.style.transform="translateY(-10px)",setTimeout(()=>e.classList.add("hidden"),300)),s&&!s.classList.contains("hidden")&&(s.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",s.style.opacity="0",s.style.transform="translateY(-10px)",setTimeout(()=>s.classList.add("hidden"),300)),setTimeout(()=>{o&&(o.style.display="block",o.classList.remove("hidden"),o.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",o.style.opacity="0",o.style.transform="translateY(10px)",setTimeout(()=>{o.style.opacity="1",o.style.transform="translateY(0)"},50))},350)}function N(){console.log("🔄 Attempting to auto-fill user details...");const e=()=>{const s=window.globalAuthManager||window.simpleAuthManager;if(s&&s.isUserLoggedIn()){const o=s.getCurrentUser();return console.log("👤 Current user from auth manager:",o),o&&o.email&&(console.log("📧 Auto-filling email:",o.email),document.querySelectorAll('input[name="email"], input[type="email"]').forEach(t=>{t.value=o.email,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Filled email field:",t)})),o&&o.phone&&(console.log("📱 Auto-filling phone:",o.phone),document.querySelectorAll('input[name="phone"], input[type="tel"]').forEach(t=>{t.value=o.phone,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Filled phone field:",t)})),o&&o.full_name&&(console.log("👤 Auto-filling contact person:",o.full_name),document.querySelectorAll('input[name="contactPerson"]').forEach(t=>{t.value=o.full_name,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Filled contact person field:",t)})),console.log("✅ Auto-fill completed with auth manager data"),!0}return!1};if(!e()){let s=0;const o=50,u=setInterval(()=>{if(s++,(e()||s>=o)&&(clearInterval(u),s>=o)){console.log("⏰ Auth manager timeout, trying fallback methods...");const t=sessionStorage.getItem("simple-auth-session");if(t)try{const i=JSON.parse(t).user;i&&i.email&&document.querySelectorAll('input[name="email"], input[type="email"]').forEach(n=>{n.value=i.email,n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0}))}),i&&i.phone&&document.querySelectorAll('input[name="phone"], input[type="tel"]').forEach(n=>{n.value=i.phone,n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0}))}),i&&i.full_name&&document.querySelectorAll('input[name="contactPerson"]').forEach(n=>{n.value=i.full_name,n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0}))}),console.log("✅ Auto-fill completed with session storage fallback")}catch(l){console.error("❌ Error parsing session data:",l)}}},100)}}document.addEventListener("DOMContentLoaded",()=>{console.log("Dashboard DOM loaded - initializing with global auth manager");const e=new URLSearchParams(window.location.search),s=e.get("product"),o=e.get("price"),u=document.getElementById("recent-activity");if(!s||!o?u&&(u.style.display="block",console.log("✅ Showing browse products section - no product selected")):u&&(u.style.display="none",console.log("✅ Hiding browse products section - product selected")),document.body.style.transition="opacity 0.3s ease-in-out",document.body.style.opacity="0",setTimeout(()=>{document.body.style.opacity="1"},50),s&&o){const n=[{id:"1",name:"Restaurant Menu System",description:"Digital menu system with QR code integration, online ordering, and real-time updates. Perfect for restaurants looking to modernize their customer experience.",price:25e3,type:"restaurant"},{id:"2",name:"Android TV App",description:"Custom Android TV applications with beautiful UI, content management, and remote control support. Perfect for streaming services and media companies.",price:55e3,type:"non-restaurant"},{id:"3",name:"Streaming Mobile App",description:"Mobile streaming applications for iOS and Android with custom features, user authentication, and content management.",price:35e3,type:"non-restaurant"},{id:"4",name:"Restaurant Website",description:"Professional restaurant website with online ordering, menu display, and customer management features.",price:2e4,type:"restaurant"},{id:"5",name:"Order Menu System",description:"Complete order management system with digital menu integration, real-time order tracking, and payment processing. Perfect for restaurants looking to streamline their ordering process.",price:999,type:"order-menu"}].find(c=>c.id===s);if(n){document.getElementById("selected-product-name").textContent=n.name,document.getElementById("selected-product-price").textContent=`₹${n.price.toLocaleString()}`,document.getElementById("order-menu-product-name").textContent=n.name,document.getElementById("order-menu-product-price").textContent=`₹${n.price.toLocaleString()}`;const c=document.getElementById("recent-activity"),m=document.getElementById("product-customization-form"),a=document.getElementById("order-menu-customization-form");c&&(c.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",c.style.opacity="0",c.style.transform="translateY(-10px)",setTimeout(()=>{c.classList.add("hidden")},300)),setTimeout(()=>{if(n.type==="order-menu")a&&(a.classList.remove("hidden"),a.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",a.style.opacity="0",a.style.transform="translateY(10px)",setTimeout(()=>{a.style.opacity="1",a.style.transform="translateY(0)"},50));else{m&&(m.classList.remove("hidden"),m.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",m.style.opacity="0",m.style.transform="translateY(10px)",setTimeout(()=>{m.style.opacity="1",m.style.transform="translateY(0)"},50));const S=document.getElementById("cuisine-type-field"),I=document.getElementById("restaurant-name-field");n.type==="restaurant"?(S.classList.remove("hidden"),S.querySelector("select").setAttribute("required","required"),I.classList.remove("hidden"),I.querySelector("input").setAttribute("required","required")):(S.classList.add("hidden"),S.querySelector("select").removeAttribute("required"),I.classList.add("hidden"),I.querySelector("input").removeAttribute("required"))}},300),setTimeout(()=>N(),500)}}H(),W(),Q(),N(),setTimeout(()=>N(),1e3),setTimeout(()=>N(),2e3);const t=new MutationObserver(g=>{g.forEach(n=>{if(n.type==="attributes"&&n.attributeName==="class"){const c=n.target;(c.id==="product-customization-form"||c.id==="order-menu-customization-form")&&(c.classList.contains("hidden")||(console.log("👁️ Form became visible, auto-filling..."),setTimeout(()=>N(),100)))}})}),l=document.getElementById("product-customization-form"),i=document.getElementById("order-menu-customization-form");l&&t.observe(l,{attributes:!0,attributeFilter:["class"]}),i&&t.observe(i,{attributes:!0,attributeFilter:["class"]}),L(),setTimeout(()=>L(),100),setTimeout(()=>L(),500),setTimeout(()=>L(),1e3),setTimeout(()=>L(),2e3),setTimeout(()=>{const g=new URLSearchParams(window.location.search),n=g.get("product"),c=g.get("price"),m=document.getElementById("recent-activity");!n||!c?m&&(m.style.display="block",m.classList.remove("hidden"),console.log("✅ Browse products section confirmed visible - no product selected")):m&&(m.style.display="none",console.log("✅ Browse products section confirmed hidden - product selected"))},1e3)});window.addEventListener("load",()=>{console.log("Window loaded - trying again"),L()});let F=0;const G=5,X=setInterval(()=>{F++,console.log(`Attempt ${F} to load user data...`),L(),F>=G&&(clearInterval(X),console.log("Max attempts reached"))},2e3);window.addEventListener("user-logged-in",()=>{console.log("User logged in event received in dashboard"),L()});window.addEventListener("user-logged-out",()=>{console.log("User logged out event received in dashboard"),L()});console.log("✅ Dashboard script initialized with global auth manager");
