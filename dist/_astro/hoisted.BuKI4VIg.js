import{c as d}from"./index.BFAZBQoJ.js";import"./ProductDialog.astro_astro_type_script_index_0_lang.BY4S3r1x.js";import"https://unpkg.com/@supabase/supabase-js@2";const l="https://lmrrdcaavwwletcjcpqv.supabase.co",u="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ",a=d(l,u);async function h(){try{const s=window.location.hash||"";if(s.includes("access_token")){const e=new URLSearchParams(s.replace("#","")),t=e.get("access_token"),c=e.get("refresh_token")||e.get("provider_refresh_token");if(t&&c){const{data:n}=await a.auth.setSession({access_token:t,refresh_token:c});n?.session?.user&&(sessionStorage.setItem("simple-auth-session",JSON.stringify({user:n.session.user,access_token:n.session.access_token,timestamp:Date.now()})),window.dispatchEvent(new CustomEvent("user-logged-in",{detail:n.session.user}))),window.history.replaceState({},document.title,"/auth/callback"),window.location.href="/dashboard";return}}if(window.location.search.includes("code=")){const{data:e,error:t}=await a.auth.exchangeCodeForSession(window.location.href);if(t)console.error("Auth callback (PKCE) error:",t);else if(e?.session){sessionStorage.setItem("simple-auth-session",JSON.stringify({user:e.session.user,access_token:e.session.access_token,timestamp:Date.now()})),window.dispatchEvent(new CustomEvent("user-logged-in",{detail:e.session.user})),window.history.replaceState({},document.title,"/auth/callback"),window.location.href="/dashboard";return}}const{data:o,error:r}=await a.auth.getSession();if(r){console.error("Auth callback error:",r);return}o.session?.user&&(sessionStorage.setItem("simple-auth-session",JSON.stringify({user:o.session.user,access_token:o.session.access_token,timestamp:Date.now()})),window.dispatchEvent(new CustomEvent("user-logged-in",{detail:o.session.user})),setTimeout(()=>{window.location.href="/dashboard"},1e3))}catch(s){console.error("Callback error:",s)}}h();a.auth.onAuthStateChange((s,i)=>{s==="SIGNED_IN"&&i?.user&&(console.log("User signed in:",i.user),setTimeout(()=>{window.location.href="/dashboard"},1e3))});
