const b=document.getElementById("contact-form"),D=document.getElementById("success-message"),U=document.getElementById("error-message"),j=document.getElementById("error-text");function T(){const t=document.getElementById("first_name"),e=document.getElementById("last_name"),n=document.getElementById("email"),a=document.getElementById("phone"),l=document.getElementById("company");return{firstNameInput:t,lastNameInput:e,emailInput:n,phoneInput:a,companyInput:l}}function k(t){t&&(t.setAttribute("autocomplete","off"),t.setAttribute("data-orig-name",t.name||""),t.name=`${t.id}_noautofill`)}function P(t){if(!t)return;const e=t.getAttribute("data-orig-name");e&&(t.name=e)}function I(){const{firstNameInput:t,lastNameInput:e,emailInput:n,phoneInput:a,companyInput:l}=T();[t,e,n,a,l].forEach(o=>{o&&(o.value="",o.disabled=!0,k(o))});const s=b?.querySelector('button[type="submit"]');s&&(s.disabled=!0)}function L(){const{firstNameInput:t,lastNameInput:e,emailInput:n,phoneInput:a,companyInput:l}=T();[t,e,n,a,l].forEach(i=>{i&&(i.disabled=!1,P(i))});const s=document.getElementById("project_type"),o=document.getElementById("message");s&&(s.disabled=!1),o&&(o.disabled=!1,o.placeholder="Tell us about your project requirements...");const r=b?.querySelector('button[type="submit"]');r&&(r.disabled=!1);const d=document.getElementById("auth-message");d&&d.remove()}I();window.addEventListener("user-logged-in",()=>{L()});window.addEventListener("user-logged-out",()=>{I()});document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{const t=window.globalAuthManager||window.simpleAuthManager,e=sessionStorage.getItem("simple-auth-session"),n=e&&e!=="null"&&e!=="{}";(!t||!t.isUserLoggedIn()||!n)&&(console.log("üö´ User not authenticated - forcing form clear"),I(),window.clearForm())},100)});let m=null;const _=()=>{const t="https://lmrrdcaavwwletcjcpqv.supabase.co",e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ";return window.supabase&&typeof window.supabase.createClient=="function"?(m=window.supabase.createClient(t,e),console.log("‚úÖ Supabase client initialized directly"),!0):window.supabase?(m=window.supabase,console.log("‚úÖ Using existing Supabase client"),!0):(console.error("‚ùå Supabase library not available"),!1)};_()?console.log("‚úÖ Supabase client ready:",!!m):console.error("‚ùå Failed to initialize Supabase client");window.clearForm=function(){console.log("üßπ Clearing contact form fields...");const e=document.getElementById("first_name"),n=document.getElementById("last_name"),a=document.getElementById("email"),l=document.getElementById("phone"),s=document.getElementById("company"),o=document.getElementById("project_type"),r=document.getElementById("message");e&&(e.value="",e.placeholder="Your first name",e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0}))),n&&(n.value="",n.placeholder="Your last name",n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0}))),a&&(a.value="",a.placeholder="your.email@example.com",a.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0}))),l&&(l.value="",l.placeholder="+1 (555) 123-4567",l.dispatchEvent(new Event("input",{bubbles:!0})),l.dispatchEvent(new Event("change",{bubbles:!0}))),s&&(s.value="",s.placeholder="Your company name",s.dispatchEvent(new Event("input",{bubbles:!0})),s.dispatchEvent(new Event("change",{bubbles:!0}))),o&&(o.value="",o.selectedIndex=0,o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0}))),r&&(r.value="",r.placeholder="Tell us about your project...",r.dispatchEvent(new Event("input",{bubbles:!0})),r.dispatchEvent(new Event("change",{bubbles:!0}))),document.querySelectorAll("input, select, textarea").forEach(i=>{i.classList.remove("border-red-500"),i.classList.add("border-gray-300")}),console.log("‚úÖ Contact form cleared")};window.prefillForm=async function(){console.log("üîÑ Checking authentication status...");const e=window.globalAuthManager||window.simpleAuthManager,n=sessionStorage.getItem("simple-auth-session"),a=n&&n!=="null"&&n!=="{}";if(e&&e.isUserLoggedIn()&&a){console.log("‚úÖ User is logged in - enabling form"),L();const s=e.getCurrentUser();if(!s||!a){console.log("‚ö†Ô∏è User object is null or session invalid - clearing form"),I();return}if(s&&s.email){const o=document.getElementById("first_name"),r=document.getElementById("last_name"),d=document.getElementById("email"),i=document.getElementById("phone"),p=document.getElementById("company");if(s.full_name){const g=s.full_name.split(" ");o&&(o.value=g[0]||""),r&&g.length>1&&(r.value=g.slice(1).join(" "))}if(d&&(d.value=s.email||""),i&&s.phone){const g=s.phone.toString(),u=document.getElementById("phone_country_code");if(g.startsWith("+91"))u&&(u.value="+91"),i.value=g.substring(3).replace(/\D/g,"");else if(g.startsWith("+")){const c=g.match(/^(\+\d{1,4})(\d+)$/);c&&u?(u.value=c[1],i.value=c[2]):i.value=g.replace(/\D/g,"")}else i.value=g.replace(/\D/g,"")}p&&s.company_name&&(p.value=s.company_name)}}else{console.log("‚ùå User not logged in - clearing and disabling form"),I();const s=document.getElementById("contact-form");if(s){let o=document.getElementById("auth-message");o||(o=document.createElement("div"),o.id="auth-message",o.className="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",s.insertBefore(o,s.firstChild)),o.innerHTML=`
          <div class="flex items-center">
            <svg class="w-5 h-5 text-blue-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div>
              <p class="text-blue-800 font-medium">Authentication Required</p>
              <p class="text-blue-700 text-sm">Please sign in to send us a message or view our products.</p>
              <div class="mt-2">
                <a href="/login" class="text-blue-600 hover:text-blue-800 font-medium text-sm mr-4">Sign In</a>
                <a href="/signup" class="text-blue-600 hover:text-blue-800 font-medium text-sm">Create Account</a>
              </div>
            </div>
          </div>
        `}}};function M(){const t=window.globalAuthManager||window.simpleAuthManager,e=sessionStorage.getItem("simple-auth-session"),n=e&&e!=="null"&&e!=="{}",a=t&&t.isUserLoggedIn()&&n;if(!a){console.log("üë§ User not logged in - clearing form and project details"),window.clearForm();const l=document.getElementById("project_type"),s=document.getElementById("message");l&&(l.value="",l.selectedIndex=0),s&&(s.value="",s.placeholder="Tell us about your project...")}return a}function N(){console.log("üîÑ Forcing form validation..."),document.querySelectorAll("input, select, textarea").forEach(e=>{e.value&&e.value.trim()&&(console.log(`üîç Forcing validation for field: ${e.id} = "${e.value}"`),e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new Event("blur",{bubbles:!0})),e.setCustomValidity&&e.setCustomValidity(""))}),console.log("‚úÖ Form validation forced")}function A(){const t=document.createElement("div");t.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    `;const e=document.createElement("div");e.style.cssText=`
      background: white;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      max-width: 400px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    `,e.innerHTML=`
      <h3 style="margin-bottom: 20px; color: #333;">Authentication Required</h3>
      <p style="margin-bottom: 30px; color: #666;">Please sign up or login to submit the contact form.</p>
      <div style="display: flex; gap: 15px; justify-content: center;">
        <button id="signup-btn" style="
          background: #3B82F6;
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
        ">Sign Up</button>
        <button id="login-btn" style="
          background: #6B7280;
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
        ">Login</button>
      </div>
    `,t.appendChild(e),document.body.appendChild(t),document.getElementById("signup-btn").addEventListener("click",()=>{document.body.removeChild(t),window.location.href="/signup"}),document.getElementById("login-btn").addEventListener("click",()=>{document.body.removeChild(t),window.location.href="/login"}),t.addEventListener("click",n=>{n.target===t&&document.body.removeChild(t)})}b?.addEventListener("submit",async t=>{if(t.preventDefault(),!M()){A();return}const e=document.getElementById("phone"),n=document.getElementById("phone_country_code"),a=e?.value?.trim()||"",l=n?.value||"+91";console.log("üîí Captured phone value early:",a),console.log("üîí Captured country code early:",l),N();const s=new FormData(b),o=Object.fromEntries(s);if(a&&!o.phone&&(o.phone=a,console.log("üìû Restored phone value from early capture:",o.phone)),console.log("üìù Form data collected for validation:",o),console.log("üìù Phone input element value:",e?.value),e&&e.value.trim()){const u=e.value.replace(/\D/g,"");if(l==="+91"&&u.length!==10){showError("Please enter a valid 10-digit phone number for India"),e?.focus();return}}const r=[{id:"first_name",name:"First Name",value:o.first_name},{id:"last_name",name:"Last Name",value:o.last_name},{id:"email",name:"Email",value:o.email},{id:"project_type",name:"Project Type",value:o.project_type},{id:"message",name:"Message",value:o.message}];let d=!0;const i=[];for(const u of r){const c=document.getElementById(u.id),h=u.value?u.value.toString().trim():"";console.log(`üîç Validating ${u.name}: "${h}"`),h?c&&(c.classList.remove("border-red-500"),c.classList.add("border-gray-300")):(d=!1,i.push(u.name),c&&(c.classList.add("border-red-500"),c.classList.remove("border-gray-300")))}if(!d){showError(`Please fill in all required fields: ${i.join(", ")}`);return}console.log("‚úÖ All required fields are filled - proceeding with submission"),D?.classList.add("hidden"),U?.classList.add("hidden");const p=b.querySelector('button[type="submit"]'),g=p.textContent;p.disabled=!0,p.innerHTML=`
      <svg class="animate-spin h-5 w-5 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    `;try{if(!m&&(console.log("üîÑ Supabase not available, trying to reinitialize..."),!_()))throw console.error("‚ùå Failed to initialize Supabase client"),new Error("Database connection not available. Please refresh the page and try again.");if(!m||typeof m.from!="function")throw console.error("‚ùå Supabase client is not properly initialized"),console.log("Supabase object:",m),console.log("Available methods:",m?Object.keys(m):"No supabase object"),new Error("Database connection not properly initialized. Please refresh the page and try again.");console.log("‚úÖ Supabase client verified and ready");const u=new FormData(b),c=Object.fromEntries(u);console.log("üìù Form data collected:",c);let h=null;try{const{data:{user:F}}=await m.auth.getUser();h=F,console.log("üë§ Current user:",h?h.email:"Not logged in")}catch{console.log("‚ÑπÔ∏è User not logged in, proceeding without authentication")}let v=a||c.phone||"",f=l||c.phone_country_code||"+91";f&&!f.startsWith("+")&&(f="+"+f.replace(/^\+/,"")),!v&&e&&(v=e.value?.trim()||"",console.log("üìû Phone from input element (final fallback):",v)),console.log("üìû Final phone number captured:",v),console.log("üìû Final country code:",f),console.log("üìû Phone input element exists:",!!e),console.log("üìû Phone input element current value:",e?.value),console.log("üìû Phone input element disabled:",e?.disabled);const y=v?v.replace(/\D/g,""):"",x=y&&y.length>0?`${f}${y}`:null;console.log("üìû Phone digits extracted:",y,"(length:",y.length,")"),console.log("üìû Formatted phone:",x),console.log("üìû Will save phone as:",x),e&&e.value&&!x&&console.warn("‚ö†Ô∏è Phone input has value but formatted phone is null!",{inputValue:e.value,phoneDigits:y,countryCode:f});const C={first_name:c.first_name,last_name:c.last_name,email:c.email,phone:x,company_name:c.company||null,project_type:c.project_type,project_details:c.message,message:c.message,user_id:h?h.id:null};console.log("üìù Sending contact data to Supabase:",C),console.log("üìù Phone field in contactData:",C.phone),console.log("üîç Testing Supabase connection...");const{data:O,error:S}=await m.from("contact_submissions").select("id").limit(1);if(S)throw console.error("‚ùå Supabase connection test failed:",S),new Error(`Database connection failed: ${S.message}`);console.log("‚úÖ Supabase connection test successful");const{data:w,error:B}=await m.from("contact_submissions").insert([C]).select();if(B)throw console.error("‚ùå Error saving contact message:",B),new Error(`Failed to save your message: ${B.message}`);console.log("‚úÖ Contact message saved successfully:",w),w&&w.length>0&&(console.log("üìû Phone number saved in database:",w[0].phone),console.log("üìû Full saved contact data:",w[0])),D?.classList.remove("hidden"),b.reset(),await prefillForm()}catch(u){console.error("Contact form error:",u),j&&(j.textContent=u.message||"An error occurred while sending your message."),U?.classList.remove("hidden")}finally{p.disabled=!1,p.innerHTML=g}});window.checkUserStatus=function(){console.log("üîç Checking user status..."),console.log("Global auth manager available:",!!window.globalAuthManager),console.log("Simple auth manager available:",!!window.simpleAuthManager),console.log("Supabase available:",!!window.supabase),window.globalAuthManager&&(console.log("User logged in (global):",window.globalAuthManager.isUserLoggedIn()),console.log("Current user (global):",window.globalAuthManager.getCurrentUser())),window.simpleAuthManager&&(console.log("User logged in (simple):",window.simpleAuthManager.isUserLoggedIn()),console.log("Current user (simple):",window.simpleAuthManager.getCurrentUser()))};window.reinitSupabase=function(){return console.log("üîÑ Reinitializing Supabase..."),_()?(console.log("‚úÖ Supabase reinitialized successfully"),!0):(console.log("‚ùå Failed to reinitialize Supabase"),!1)};window.testSupabaseConnection=async function(){if(!m)return console.log("‚ùå Supabase not initialized"),!1;try{const{data:t,error:e}=await m.from("contact_submissions").select("id").limit(1);return e?(console.error("‚ùå Supabase test failed:",e),!1):(console.log("‚úÖ Supabase test successful:",t),!0)}catch(t){return console.error("‚ùå Supabase test error:",t),!1}};function V(){const t=document.getElementById("phone_country_code"),e=document.getElementById("phone"),n=document.getElementById("phone-error");if(!t||!e)return;function a(){return t.value}const l={"+91":10,"+1":10,"+44":10,"+61":9,"+86":11,"+81":10,"+49":11,"+33":9,"+971":9,"+966":9};function s(){const o=a(),r=e.value.replace(/\D/g,""),d=l[o]||10;return e.maxLength=d,e.pattern=`[0-9]{1,${d}}`,o==="+91"?r.length>0&&r.length!==10?(n?.classList.remove("hidden"),n.textContent="Please enter a valid 10-digit phone number",e.classList.add("border-red-500"),!1):(n?.classList.add("hidden"),e.classList.remove("border-red-500"),!0):r.length>0&&r.length!==d?(n?.classList.remove("hidden"),n.textContent=`Please enter a valid ${d}-digit phone number`,e.classList.add("border-red-500"),!1):(n?.classList.add("hidden"),e.classList.remove("border-red-500"),!0)}e.addEventListener("input",function(o){const r=o.target.value.replace(/\D/g,""),d=a(),i=l[d]||10;o.target.value=r.slice(0,i),s()}),t.addEventListener("change",function(){e.value="";const o=a();e.placeholder=o==="+91"?"9876543210":"Enter phone number",s()}),e.addEventListener("blur",s)}document.addEventListener("DOMContentLoaded",()=>{V(),["first_name","last_name","email","phone","company","project_type","message"].forEach(e=>{const n=document.getElementById(e);n&&(n.addEventListener("focus",()=>{M()||A()}),n.addEventListener("click",()=>{M()||A()}))})});function E(){console.log("üö´ FORCE CLEARING FORM - NO USER DETAILS ALLOWED WITHOUT LOGIN");const t=document.getElementById("first_name"),e=document.getElementById("last_name"),n=document.getElementById("email"),a=document.getElementById("phone"),l=document.getElementById("company"),s=document.getElementById("project_type"),o=document.getElementById("message");t&&(t.value="",t.disabled=!0),e&&(e.value="",e.disabled=!0),n&&(n.value="",n.disabled=!0),a&&(a.value="",a.disabled=!0),l&&(l.value="",l.disabled=!0),s&&(s.value="",s.disabled=!0),o&&(o.value="",o.disabled=!0,o.placeholder="Please sign in to send us a message.");const r=document.querySelector('button[type="submit"]');r&&(r.disabled=!0);const d=document.getElementById("contact-form");if(d){let i=document.getElementById("auth-message");i||(i=document.createElement("div"),i.id="auth-message",i.className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",d.insertBefore(i,d.firstChild)),i.innerHTML=`
        <div class="flex items-center">
          <svg class="w-5 h-5 text-red-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
          </svg>
          <div>
            <p class="text-red-800 font-medium">Authentication Required</p>
            <p class="text-red-700 text-sm">You must be logged in to access this form and view our products.</p>
            <div class="mt-2">
              <a href="/login" class="text-red-600 hover:text-red-800 font-medium text-sm mr-4">Sign In</a>
              <a href="/signup" class="text-red-600 hover:text-red-800 font-medium text-sm">Create Account</a>
            </div>
          </div>
        </div>
      `}}document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{const t=window.globalAuthManager||window.simpleAuthManager,e=sessionStorage.getItem("simple-auth-session"),n=e&&e!=="null"&&e!=="{}";t&&t.isUserLoggedIn()&&n?(console.log("‚úÖ User is logged in - enabling form"),L(),prefillForm()):(console.log("‚ùå User not logged in - clearing form"),E())},100)});window.addEventListener("user-logged-out",()=>{console.log("üë§ User logged out - FORCE CLEARING contact form"),sessionStorage.removeItem("simple-auth-session"),localStorage.removeItem("simple-auth-user"),E(),setTimeout(()=>{const t=window.globalAuthManager||window.simpleAuthManager,e=sessionStorage.getItem("simple-auth-session"),n=e&&e!=="null"&&e!=="{}";(!t||!t.isUserLoggedIn()||!n)&&E()},100)});window.addEventListener("user-logged-in",()=>{console.log("üë§ User logged in - pre-filling contact form"),setTimeout(()=>{prefillForm()},100)});window.addEventListener("load",()=>{console.log("üîÑ Window loaded - checking authentication status...");const t=()=>{const e=window.globalAuthManager||window.simpleAuthManager;if(e){console.log("‚úÖ Auth manager found on window load, checking user status...");const n=sessionStorage.getItem("simple-auth-session"),a=n&&n!=="null"&&n!=="{}";e.isUserLoggedIn()&&a?(console.log("üë§ User is logged in on window load - enabling form"),L(),prefillForm()):(console.log("üë§ User not logged in on window load - clearing form"),E())}else console.log("‚è≥ Auth manager not ready on window load, retrying in 100ms..."),setTimeout(t,100)};setTimeout(t,100)});document.addEventListener("visibilitychange",()=>{if(!document.hidden){console.log("üîÑ Page became visible - checking authentication");const t=window.globalAuthManager||window.simpleAuthManager,e=sessionStorage.getItem("simple-auth-session"),n=e&&e!=="null"&&e!=="{}";!t||!t.isUserLoggedIn()||!n?(console.log("üë§ User not logged in - FORCE CLEARING form"),E()):console.log("üë§ User is logged in - keeping form data")}});
