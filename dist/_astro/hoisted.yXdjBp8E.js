import"./ProductDialog.astro_astro_type_script_index_0_lang.C1LHbjNP.js";import"https://unpkg.com/@supabase/supabase-js@2";import{c as I}from"./index.BymsOcZI.js";import"./preload-helper.CLcXU_4U.js";document.addEventListener("DOMContentLoaded",async()=>{console.log("🚀 Menu Operator Profile Page Loading...");const o=sessionStorage.getItem("simple-auth-session");if(!o){console.log("❌ No session data found - redirecting to login"),window.location.href="/login";return}let e;try{e=JSON.parse(o)}catch{console.log("❌ Invalid session data - redirecting to login"),window.location.href="/login";return}if(!e.user||!e.user.email){console.log("❌ No user data in session - redirecting to login"),window.location.href="/login";return}console.log("✅ Session found for user:",e.user.email),L(),await O()});function L(){console.log("🔍 Debugging storage...");try{const o=sessionStorage.getItem("simple-auth-session");if(console.log("📦 SessionStorage data:",o),o){const e=JSON.parse(o);console.log("👤 Session user:",e.user)}}catch(o){console.log("❌ Error reading sessionStorage:",o)}try{const o=localStorage.getItem("simple-auth-user");if(console.log("💾 LocalStorage data:",o),o){const e=JSON.parse(o);console.log("👤 Local user:",e)}}catch(o){console.log("❌ Error reading localStorage:",o)}console.log("🔗 Supabase available:",typeof window.supabase<"u"),typeof window.supabase<"u"&&console.log("✅ Supabase client:",window.supabase)}async function O(){try{console.log("🚀 Starting profile load...");const o=sessionStorage.getItem("simple-auth-session");if(!o){console.log("❌ No session data - redirecting to login"),window.location.href="/login";return}const t=JSON.parse(o).user;if(!t||!t.email){console.log("❌ No user data in session - redirecting to login"),window.location.href="/login";return}if(console.log("✅ User found in session:",t.email),S(t,{full_name:t.full_name||t.name||"Menu Operator",email:t.email,created_at:t.created_at||new Date().toISOString(),last_login:new Date().toISOString(),role:"menu_operator"}),typeof window.supabase>"u"){console.error("❌ Supabase client not available, using fallback data"),h(t);return}const a=window.supabase;console.log("✅ Supabase client found");let n=null,s=null;try{const{data:l,error:r}=await a.from("profiles").select("*").eq("id",t.id).eq("role","menu_operator").single();n=l,s=r}catch(l){console.log("⚠️ Role-filtered query failed, trying fallback..."),s=l}if(s){console.log("⚠️ Role-filtered query failed:",s);try{const{data:l,error:r}=await a.from("profiles").select("*").eq("id",t.id).single();if(r){console.error("❌ Fallback profile query failed:",r),console.log("🔄 Using fallback profile data..."),h(t);return}if(n=l,console.log("✅ Fallback profile loaded:",n),n.role&&n.role.toLowerCase().trim()!=="menu_operator")if(console.log("⚠️ User does not have menu_operator role in database. Role:",n.role),t.role==="menu_operator"||t.role==="menu operator")console.log("✅ Using session role instead of database role"),n.role="menu_operator";else{console.log("❌ No valid role found - redirecting to dashboard"),window.location.href="/dashboard";return}}catch(l){console.error("❌ Fallback query failed:",l),h(t);return}}if(n){if(n.role&&n.role.toLowerCase().trim()!=="menu_operator")if(console.log("⚠️ User does not have menu_operator role in database. Role:",n.role),t.role==="menu_operator"||t.role==="menu operator")console.log("✅ Using session role instead of database role"),n.role="menu_operator";else{console.log("❌ No valid role found - redirecting to dashboard"),window.location.href="/dashboard";return}console.log("✅ Profile loaded successfully:",n),S(t,n)}else console.log("⚠️ No profile found, using fallback data"),h(t)}catch(o){console.error("❌ Error loading user profile:",o),h()}}function h(o=null){console.log("🔄 Showing fallback profile...");let e=o,t=null;if(!e){try{const a=sessionStorage.getItem("simple-auth-session");if(a){const n=JSON.parse(a);n.user&&n.access_token&&(e=n.user,console.log("✅ Found user in sessionStorage:",e.email))}}catch(a){console.log("⚠️ Error reading sessionStorage:",a)}if(!e)try{const a=localStorage.getItem("simple-auth-user");a&&(e=JSON.parse(a),console.log("✅ Found user in localStorage:",e.email))}catch(a){console.log("⚠️ Error reading localStorage:",a)}}if(!e){console.log("❌ No authenticated user found - redirecting to login"),window.location.href="/login";return}t={full_name:e.full_name||e.name||"Menu Operator",email:e.email,created_at:e.created_at||new Date().toISOString(),last_login:new Date().toISOString(),role:"menu_operator"},console.log("✅ Using fallback profile:",t),S(e,t)}function S(o,e){try{const t=e.full_name||o.email,a=e.full_name?e.full_name.split(" ").map(y=>y.charAt(0)).join("").toUpperCase():o.email.charAt(0).toUpperCase(),n=document.getElementById("profile-avatar");n&&(n.textContent=a);const s=document.getElementById("profile-name");s&&(s.textContent=t);const l=document.getElementById("profile-email");l&&(l.textContent=o.email);const r=document.getElementById("profile-full-name");r&&(r.textContent=e.full_name||"Not set");const c=document.getElementById("profile-email-detail");c&&(c.textContent=o.email);const u=e.created_at?new Date(e.created_at).toLocaleDateString():new Date(o.created_at).toLocaleDateString(),f=e.last_login?new Date(e.last_login).toLocaleDateString():new Date().toLocaleDateString(),p=document.getElementById("profile-member-since");p&&(p.textContent=u);const d=document.getElementById("profile-last-login");d&&(d.textContent=f),console.log("✅ Profile display updated successfully")}catch(t){console.error("Error updating profile display:",t),D("Failed to update profile display.")}}function D(o){const e=document.createElement("div");e.className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",e.textContent=o;const t=document.querySelector(".space-y-6");t&&t.insertBefore(e,t.firstChild)}window.handleMenuOperatorLogout=async function(){if(console.log("🚪 Global logout function called!"),confirm("Are you sure you want to logout?"))try{if(console.log("🚪 Logging out from Menu Operator Dashboard..."),sessionStorage.removeItem("simple-auth-session"),sessionStorage.removeItem("simple-auth-user"),sessionStorage.clear(),localStorage.removeItem("simple-auth-user"),localStorage.removeItem("simple-auth-session"),localStorage.clear(),window.supabase)try{await window.supabase.auth.signOut(),console.log("✅ Supabase sign out successful")}catch(t){console.log("⚠️ Supabase sign out error (continuing anyway):",t)}const o=document.getElementById("user-name"),e=document.getElementById("menu-operator-avatar");o&&(o.textContent="Signing out..."),e&&(e.textContent="..."),setTimeout(()=>{window.location.href="/login",console.log("✅ Redirected to login page")},500)}catch(o){console.error("❌ Error during logout:",o),window.location.href="/login"}};(function(){console.log("🚨 LOADING REAL USER PROFILE...");async function o(){try{let e=null,t=null;try{const a=sessionStorage.getItem("simple-auth-session");if(a){const n=JSON.parse(a);n.user&&n.access_token&&(e=n.user,console.log("✅ Found real user in sessionStorage:",e.email))}}catch(a){console.log("⚠️ Error reading sessionStorage:",a)}if(!e)try{const a=localStorage.getItem("simple-auth-user");a&&(e=JSON.parse(a),console.log("✅ Found real user in localStorage:",e.email))}catch(a){console.log("⚠️ Error reading localStorage:",a)}if(e){const a=document.getElementById("menu-operator-avatar"),n=document.getElementById("user-name");if(a){let s="MO";if(e.full_name||e.name){const r=(e.full_name||e.name).trim().split(" ");r.length>=2?s=(r[0][0]+r[r.length-1][0]).toUpperCase():r.length===1&&(s=r[0].substring(0,2).toUpperCase())}else e.email&&(s=e.email.substring(0,2).toUpperCase());a.textContent=s,console.log("✅ Avatar updated with real initials:",s)}if(n){const s=e.full_name||e.name||e.email||"Menu Operator";n.textContent=s,console.log("✅ Name updated with real name:",s)}}else console.log("⚠️ No real user data found, keeping default")}catch(e){console.error("❌ Error loading real user profile:",e)}}o(),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o):o(),setTimeout(o,100),setTimeout(o,500),setTimeout(o,1e3)})();const _="https://lmrrdcaavwwletcjcpqv.supabase.co",U="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ";let m=null;try{m=I(_,U),console.log("✅ Supabase client created successfully")}catch(o){console.error("❌ Failed to create Supabase client:",o)}console.log("🔧 MenuOperatorLayout Supabase configuration:");console.log("- URL:",_);console.log("- Key:","Present");document.addEventListener("DOMContentLoaded",async()=>{document.body.classList.add("menu-operator-panel-active"),await g(),k()});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",async()=>{await g()}):g();document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{document.body.classList.add("menu-operator-panel-active")}):document.body.classList.add("menu-operator-panel-active");function b(){console.log("🚨 FORCING AVATAR UPDATE...");const o=document.getElementById("menu-operator-avatar"),e=document.getElementById("user-name");o?(o.textContent="JD",console.log("✅ Avatar forced to JD")):console.log("❌ Avatar element not found"),e?(e.textContent="John Doe",console.log("✅ Name forced to John Doe")):console.log("❌ Name element not found")}setTimeout(b,50);setTimeout(b,200);setTimeout(b,500);document.addEventListener("DOMContentLoaded",()=>{console.log("📄 DOM Content Loaded - forcing avatar update"),b()});window.addEventListener("load",()=>{console.log("🪟 Window Loaded - forcing avatar update"),b()});setTimeout(()=>{const o=document.getElementById("user-name"),e=document.getElementById("menu-operator-avatar");o&&(o.textContent==="Loading..."||o.textContent==="Menu Operator")&&(console.log("⚠️ User info still loading, trying fallback..."),g()),e&&e.textContent==="MO"&&(console.log("⚠️ Avatar still showing MO, trying to update..."),g())},1e3);setTimeout(()=>{const o=document.getElementById("user-name"),e=document.getElementById("menu-operator-avatar");o&&(o.textContent==="Loading..."||o.textContent==="Menu Operator")&&(console.log("⚠️ User info still loading, forcing fallback display..."),i(null,null)),e&&e.textContent==="MO"&&(console.log("⚠️ Avatar still showing MO, forcing fallback display..."),i(null,null))},3e3);setTimeout(()=>{const o=document.getElementById("menu-operator-avatar");o&&o.textContent==="MO"&&(console.log("🔄 Immediate avatar update attempt..."),g())},100);function N(){console.log("🧪 Testing avatar update with sample data...");const o=document.getElementById("menu-operator-avatar"),e=document.getElementById("user-name");o&&(o.textContent="JD",console.log("✅ Avatar updated to JD")),e&&(e.textContent="John Doe",console.log("✅ Name updated to John Doe"))}setTimeout(()=>{const o=document.getElementById("menu-operator-avatar");o&&o.textContent==="MO"&&(console.log("🧪 Avatar still MO, running test update..."),N())},2e3);async function g(){try{console.log("🚀 Loading user info...");let o=null,e=null;try{const l=sessionStorage.getItem("simple-auth-session");if(l){const r=JSON.parse(l);r.user&&r.access_token&&r.user.email&&(o=r.user,console.log("✅ Found user in sessionStorage:",o.email),(r.user.full_name||r.user.name)&&(e={full_name:r.user.full_name||r.user.name,email:r.user.email,role:"menu_operator"},console.log("✅ Profile data from session:",e)))}}catch(l){console.log("⚠️ Error reading sessionStorage:",l)}if(o){if(console.log("✅ Using session data for user display"),i(o,e),m)try{const{data:l,error:r}=await m.from("profiles").select("full_name, email, role").eq("id",o.id).single();!r&&l&&(console.log("✅ Enhanced profile with Supabase data:",l),i(o,l))}catch(l){console.log("⚠️ Supabase enhancement failed, using session data:",l)}return}if(!m){console.error("❌ Supabase client not available, using fallback"),i(null,null);return}console.log("✅ Supabase client found");const{data:{user:t},error:a}=await m.auth.getUser();if(a||!t){console.error("❌ Error getting user:",a),i(null,null);return}console.log("✅ User found:",t.email);let n=null,s=null;try{const{data:l,error:r}=await m.from("profiles").select("full_name, email, role").eq("id",t.id).eq("role","menu_operator").single();n=l,s=r}catch(l){console.log("⚠️ Role-filtered query failed, trying fallback..."),s=l}if(s){console.log("⚠️ Role-filtered query failed:",s);try{const{data:l,error:r}=await m.from("profiles").select("full_name, email, role").eq("id",t.id).single();if(r){console.error("❌ Fallback profile query failed:",r),i(t,null);return}if(n=l,console.log("✅ Fallback profile loaded:",n),n.role&&n.role.toLowerCase().trim()!=="menu_operator"){console.log("❌ User does not have menu_operator role. Role:",n.role),i(t,null);return}}catch(l){console.error("❌ Fallback query failed:",l),i(t,null);return}}if(n){if(n.role&&n.role.toLowerCase().trim()!=="menu_operator"){console.log("❌ User does not have menu_operator role. Role:",n.role),i(t,null);return}console.log("✅ User info loaded successfully:",n),i(t,n)}else console.log("⚠️ No profile found, using fallback data"),i(t,null)}catch(o){console.error("❌ Error loading user info:",o),i(null,null)}}function i(o,e){try{if(console.log("🔄 Updating user display...",{user:o?.email,profile:e?.full_name}),!o){let s=null;try{const c=sessionStorage.getItem("simple-auth-session");if(c){const u=JSON.parse(c);u.user&&u.access_token&&u.user.email?(s=u.user,console.log("✅ Found authenticated user in sessionStorage:",s.email)):console.log("❌ Invalid session data - missing user, token, or email")}}catch(c){console.log("⚠️ Error reading sessionStorage:",c)}if(!s){console.log("❌ No authenticated user found - showing loading then redirecting");const c=document.getElementById("user-name"),u=document.getElementById("menu-operator-avatar");c&&(c.textContent="Loading..."),u&&(u.textContent="..."),setTimeout(()=>{window.location.href="/login"},1e3);return}if(s){const c=s.full_name||s.name||s.email,u=document.getElementById("user-name");u&&(u.textContent=c);const f=document.getElementById("menu-operator-avatar");if(f)if(s.full_name||s.name){const d=(s.full_name||s.name).trim().split(" ");let y="";d.length>=2?y=(d[0][0]+d[d.length-1][0]).toUpperCase():d.length===1&&(y=d[0].substring(0,2).toUpperCase()),f.textContent=y}else{const p=s.email.substring(0,2).toUpperCase();f.textContent=p}console.log("✅ Fallback user display updated with cached data");return}const l=document.getElementById("user-name");l&&(l.textContent="Loading...");const r=document.getElementById("menu-operator-avatar");r&&(r.textContent="..."),console.log("✅ Ultimate fallback user display updated with loading state");return}const t=e&&e.full_name||o.email,a=document.getElementById("user-name");a&&(a.textContent=t);const n=document.getElementById("menu-operator-avatar");if(n)if(e&&e.full_name){const s=e.full_name.trim().split(" ");let l="";s.length>=2?l=(s[0][0]+s[s.length-1][0]).toUpperCase():s.length===1&&(l=s[0].substring(0,2).toUpperCase()),n.textContent=l}else if(o.email){const s=o.email.substring(0,2).toUpperCase();n.textContent=s}else n.textContent="MO";console.log("✅ User display updated successfully"),console.log("🔍 Final avatar text:",n?n.textContent:"avatar not found"),console.log("🔍 Final name text:",a?a.textContent:"name not found")}catch(t){console.error("❌ Error updating user display:",t);const a=document.getElementById("user-name");a&&(a.textContent="Menu Operator");const n=document.getElementById("menu-operator-avatar");n&&(n.textContent="MO")}}function k(){console.log("🔧 Setting up event listeners...");function o(){const a=document.getElementById("logout-btn");console.log("🔍 Looking for logout button:",a),a?(console.log("✅ Logout button found, attaching event listener"),a.removeEventListener("click",e),a.addEventListener("click",e),console.log("✅ Logout event listener attached")):(console.log("❌ Logout button not found, retrying..."),setTimeout(o,100))}async function e(a){if(a.preventDefault(),a.stopPropagation(),console.log("🚪 Logout button clicked!"),confirm("Are you sure you want to logout?"))try{if(console.log("🚪 Logging out from Menu Operator Dashboard..."),sessionStorage.removeItem("simple-auth-session"),sessionStorage.removeItem("simple-auth-user"),sessionStorage.clear(),localStorage.removeItem("simple-auth-user"),localStorage.removeItem("simple-auth-session"),localStorage.clear(),window.supabase)try{await window.supabase.auth.signOut(),console.log("✅ Supabase sign out successful")}catch(l){console.log("⚠️ Supabase sign out error (continuing anyway):",l)}const n=document.getElementById("user-name"),s=document.getElementById("menu-operator-avatar");n&&(n.textContent="Signing out..."),s&&(s.textContent="..."),setTimeout(()=>{window.location.href="/login",console.log("✅ Redirected to login page")},500)}catch(n){console.error("❌ Error during logout:",n),window.location.href="/login"}}o(),setTimeout(o,500),setTimeout(o,1e3),document.querySelectorAll('a[href="/"]').forEach(a=>{a.addEventListener("click",n=>{console.log('🔄 Menu Operator clicked "Back to Site" - preparing to show user navbar'),document.body.classList.remove("menu-operator-panel-active"),document.documentElement.classList.remove("menu-operator-panel-active"),setTimeout(()=>{window.showUserNavbar&&(window.showUserNavbar(),console.log("✅ User navbar shown after delay"))},50)})})}(function(){if(document.body)document.body.classList.add("menu-operator-panel-active");else{const e=new MutationObserver(function(t){t.forEach(function(a){a.type==="childList"&&document.body&&(document.body.classList.add("menu-operator-panel-active"),e.disconnect())})});e.observe(document.documentElement,{childList:!0})}const o=()=>{const e=document.querySelector("header"),t=document.querySelector("footer");e&&(e.style.display="none",e.style.visibility="hidden",e.style.opacity="0",e.style.height="0",e.style.maxHeight="0",e.style.overflow="hidden",e.style.position="absolute",e.style.top="-9999px",e.style.left="-9999px",e.style.zIndex="-9999",e.style.pointerEvents="none",e.style.transform="translateY(-100vh)"),t&&(t.style.display="none",t.style.visibility="hidden",t.style.opacity="0",t.style.height="0",t.style.maxHeight="0",t.style.overflow="hidden",t.style.position="absolute",t.style.top="-9999px",t.style.left="-9999px",t.style.zIndex="-9999",t.style.pointerEvents="none",t.style.transform="translateY(-100vh)")};o(),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o):o()})();(function(){document.documentElement.classList.add("menu-operator-panel-active"),document.body.classList.add("menu-operator-panel-active");function o(){const e=document.querySelector("header");e&&(e.style.display="none",e.style.visibility="hidden",e.style.opacity="0",e.style.height="0",e.style.maxHeight="0",e.style.overflow="hidden",e.style.position="absolute",e.style.top="-9999px",e.style.left="-9999px",e.style.zIndex="-9999",e.style.pointerEvents="none",e.style.transform="translateY(-100vh)",e.style.transition="none",e.style.animation="none")}o(),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o):o(),window.addEventListener("load",o),window.addEventListener("popstate",o),setInterval(o,100)})();const w={ASSETS_PREFIX:void 0,BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SITE:void 0,SSR:!1};var E={};const C={url:"https://lmrrdcaavwwletcjcpqv.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ"},x=o=>typeof import.meta<"u"&&w&&w[o]?w[o]:typeof process<"u"&&E&&E[o]?E[o]:typeof window<"u"&&window.__ENV__&&window.__ENV__[o]?window.__ENV__[o]:"",M=x("VITE_SUPABASE_URL")||C.url,B=x("VITE_SUPABASE_ANON_KEY")||C.anonKey,A=I(M,B);async function J(){try{console.log("🔍 MenuOperatorGuard - Checking access...");const o=sessionStorage.getItem("simple-auth-session");if(!o)return console.log("❌ No session data found - redirecting to login"),window.location.href="/login",!1;let e;try{e=JSON.parse(o)}catch{return console.log("❌ Invalid session data - redirecting to login"),window.location.href="/login",!1}if(!e.user||!e.user.email)return console.log("❌ No user data in session - redirecting to login"),window.location.href="/login",!1;if(console.log("✅ Session found for user:",e.user.email),e.user.role==="menu_operator"||e.user.role==="menu operator")return console.log("✅ Menu operator role found in session"),!0;console.log("⚠️ No role in session, checking Supabase...");const{data:t,error:a}=await A.from("profiles").select("role, status").eq("id",e.user.id).single();return a||!t?(console.log("❌ No profile found in Supabase"),v("You need menu operator role to access this page. Please contact support to assign the role."),!1):(console.log("🔍 MenuOperatorGuard - Profile loaded:",t),console.log("🔍 MenuOperatorGuard - Role value:",JSON.stringify(t.role)),t.status&&t.status!=="active"?(v("Your menu operator access is currently inactive."),!1):!t.role||t.role.toLowerCase().trim()!=="menu_operator"?(v("You need menu operator role to access this page. Current role: "+t.role),!1):(e.user.role=t.role,sessionStorage.setItem("simple-auth-session",JSON.stringify(e)),console.log("✅ Updated session with role information"),!0))}catch(o){return console.error("Error checking menu operator access:",o),v("Error verifying your access. Please try again."),!1}}function v(o){document.body.innerHTML=`
      <div class="min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8">
        <div class="sm:mx-auto sm:w-full sm:max-w-md">
          <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
            <div class="text-center">
              <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
                <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
              </div>
              <h2 class="mt-6 text-3xl font-extrabold text-gray-900">Access Denied</h2>
              <p class="mt-2 text-sm text-gray-600">${o}</p>
              <div class="mt-6">
                <a href="/dashboard" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                  Go to Dashboard
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    `}document.addEventListener("DOMContentLoaded",async()=>{await J()});
