const d="https://lmrrdcaavwwletcjcpqv.supabase.co",m="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ";let a=null;function l(){return new Promise(e=>{window.supabase&&window.supabase.auth&&typeof window.supabase.auth.getUser=="function"?(a=window.supabase,e(a)):window.supabase&&typeof window.supabase.createClient=="function"?(a=window.supabase.createClient(d,m),e(a)):setTimeout(()=>l().then(e),100)})}async function c(){try{console.log("üîí MenuOperatorGuard: Checking menu operator access..."),a||await l();const{data:{user:e},error:t}=await a.auth.getUser();if(t){console.error("‚ùå MenuOperatorGuard: Error getting user:",t),i("Authentication error. Please login again.");return}if(!e){console.log("‚ùå MenuOperatorGuard: No user logged in"),i("Please login to access menu operator panel");return}console.log("‚úÖ MenuOperatorGuard: User found:",e.email);const{data:o,error:n}=await a.from("profiles").select("role").eq("id",e.id).single();if(n){console.error("‚ùå MenuOperatorGuard: Error getting profile:",n),i("Error checking user permissions");return}if(o.role!=="menu_operator"){console.log("‚ùå MenuOperatorGuard: User does not have menu_operator role. Role:",o.role),i("Access denied. Menu operator privileges required.");return}console.log("‚úÖ MenuOperatorGuard: Menu operator access granted for user:",e.email),g()}catch(e){console.error("‚ùå MenuOperatorGuard: Error checking menu operator access:",e),i("Error checking menu operator access. Please try again.")}}function i(e){const t=document.getElementById("menu-operator-guard");t&&(t.innerHTML=`
          <div class="text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
              <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
              </svg>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">Access Denied</h3>
            <p class="text-gray-600 mb-6">${e}</p>
            <div class="space-x-3">
              <a href="/login" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors">
                Go to Login
              </a>
              <a href="/" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors">
                Back to Home
              </a>
            </div>
          </div>
        `)}function g(){const e=document.getElementById("menu-operator-guard");if(e){e.style.display="none",e.style.visibility="hidden",e.style.opacity="0",e.style.height="0",e.style.overflow="hidden";const t=document.getElementById("menu-operator-admin-layout");t&&(t.classList.remove("hidden"),t.style.display="block",t.style.visibility="visible",t.style.opacity="1",f()),window.dispatchEvent(new CustomEvent("menu-operator-access-granted"))}}async function f(){try{a||await l();const{data:{user:e}}=await a.auth.getUser();if(e){const{data:t}=await a.from("profiles").select("full_name").eq("id",e.id).single(),o=document.getElementById("menu-operator-name");o&&(o.textContent=t?.full_name||e.user_metadata?.full_name||e.email||"Menu Operator");const n=document.getElementById("menu-operator-avatar");if(n){const r=t?.full_name||e.user_metadata?.full_name||e.email||"M";n.textContent=r.charAt(0).toUpperCase()}}}catch(e){console.warn("Could not update menu operator info:",e)}}function w(){return new Promise(e=>{const t=document.getElementById("logout-confirmation-modal"),o=document.getElementById("logout-confirm-btn"),n=document.getElementById("logout-cancel-btn");if(!t||!o||!n){console.error("Logout modal elements not found"),e(!1);return}t.classList.remove("hidden"),document.body.style.overflow="hidden";const r=()=>{t.classList.add("hidden"),document.body.style.overflow="",o.removeEventListener("click",r),n.removeEventListener("click",s),e(!0)},s=()=>{t.classList.add("hidden"),document.body.style.overflow="",o.removeEventListener("click",r),n.removeEventListener("click",s),e(!1)};o.addEventListener("click",r),n.addEventListener("click",s);const u=p=>{p.target===t&&(t.classList.add("hidden"),document.body.style.overflow="",t.removeEventListener("click",u),o.removeEventListener("click",r),n.removeEventListener("click",s),e(!1))};t.addEventListener("click",u)})}async function h(e){e&&(e.preventDefault(),e.stopPropagation());try{const o=document.querySelector('[x-data*="open"]');o&&o.__x&&(o.__x.$data.open=!1);const n=document.querySelector("[x-data]");n&&n.__x&&n.__x.$data&&typeof n.__x.$data.open<"u"&&(n.__x.$data.open=!1)}catch(o){console.log("Could not close dropdown programmatically:",o)}if(await w())try{console.log("üö™ Menu operator signing out...");const o=document.getElementById("menu-operator-name"),n=document.getElementById("menu-operator-avatar");o&&(o.textContent="Signing out..."),n&&(n.textContent="...");let r=a;if(r||(r=await l()),!r&&window.supabase&&(window.supabase.auth&&typeof window.supabase.auth.signOut=="function"?r=window.supabase:typeof window.supabase.createClient=="function"&&(r=window.supabase.createClient(d,m))),r&&r.auth&&typeof r.auth.signOut=="function")try{await r.auth.signOut(),console.log("‚úÖ Supabase sign out successful")}catch(s){console.warn("‚ö†Ô∏è Supabase sign out error (continuing anyway):",s)}else console.warn("‚ö†Ô∏è Supabase client not available for sign out");sessionStorage.clear(),localStorage.clear(),localStorage.removeItem("supabase-auth-session"),localStorage.removeItem("simple-auth-user"),localStorage.removeItem("simple-auth-session"),sessionStorage.removeItem("simple-auth-session"),sessionStorage.removeItem("simple-auth-user"),window.globalAuthManager&&(window.globalAuthManager.isAuthenticated=!1,window.globalAuthManager.currentUser=null),window.simpleAuthManager&&(window.simpleAuthManager.isAuthenticated=!1,window.simpleAuthManager.currentUser=null),console.log("‚úÖ All storage cleared"),window.dispatchEvent(new CustomEvent("user-logged-out")),await new Promise(s=>setTimeout(s,200)),window.location.href="/login",console.log("‚úÖ Redirecting to login page")}catch(o){console.error("‚ùå Error during menu operator sign out:",o);try{sessionStorage.clear(),localStorage.clear()}catch(n){console.warn("Error clearing storage:",n)}window.location.href="/login"}}window.handleMenuOperatorSignOut=h;document.addEventListener("DOMContentLoaded",()=>{c()});window.addEventListener("auth-state-changed",c);document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c();setTimeout(()=>{const e=document.getElementById("menu-operator-guard");e&&e.style.display!=="none"&&(console.warn("‚ö†Ô∏è Menu operator access check timed out, showing content anyway"),g())},1e4);console.log("MenuOperatorAdminLayout loaded successfully");
