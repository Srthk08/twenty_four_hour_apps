const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/supabase.DeXTyW8I.js","_astro/index.9NDAT-bh.js","_astro/preload-helper.BlTxHScW.js"])))=>i.map(i=>d[i]);
import{_ as G}from"./preload-helper.BlTxHScW.js";import{c as ie}from"./index.9NDAT-bh.js";const ce="https://lmrrdcaavwwletcjcpqv.supabase.co",de="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ",se=ie(ce,de),ue={"restaurant-website":"restaurant-website","streaming-mobile-app":"streaming-mobile-app","android-tv-app":"android-tv-app","restaurant-menu-system":"restaurant-menu-system","order-menu-system":"restaurant-menu-system"};async function me(e,o){try{if(console.log("üíæ Saving customization form to Supabase...",{formData:e,productType:o}),o==="order-menu-system")return await ge(e);const l={product_type:ue[o]||o,product_name:e.productName||e.product_name||"Unknown Product",product_price:e.productPrice||e.product_price||"‚Çπ0",project_name:e.projectName||e.project_name||"",contact_person:e.contactPerson||e.contact_person||"",app_name:e.appName||e.app_name||"",product_description:e.productDescription||e.product_description||"",restaurant_name:e.restaurantName||e.restaurant_name||null,cuisine_type:e.cuisineType||e.cuisine_type||null,logo_url:e.logoUrl||e.logo_url||null,logo_filename:e.logoFilename||e.logo_filename||null,logo_mime_type:e.logoMimeType||e.logo_mime_type||null,logo_size:e.logoSize||e.logo_size||null,contact_email:e.email||e.contact_email||e.contactEmail||"",contact_phone:e.phone||e.contact_phone||e.contactPhone||"",primary_color:e.primaryColor||e.primary_color||"#3B82F6",secondary_color:e.secondaryColor||e.secondary_color||"#10B981",accent_color:e.accentColor||e.accent_color||"#F59E0B",text_color:e.textColor||e.text_color||"#1F2937",additional_requirements:e.additionalRequirements||e.additional_requirements||"",menu_items:e.menuItems||e.menu_items||[],restaurant_address:e.restaurantAddress||e.restaurant_address||null,owner_name:e.ownerName||e.owner_name||null,status:"pending"};console.log("üß© Inserting customization form for other products...");const{data:r,error:n}=await se.from("customization_forms").insert(l).select().single();return n?(console.error("‚ùå Error inserting customization form:",n),console.error("‚ùå Error details:",{message:n.message,details:n.details,hint:n.hint,code:n.code}),{success:!1,error:n.message,data:null}):(console.log("‚úÖ Customization form inserted successfully:",r),{success:!0,error:null,data:r})}catch(t){return console.error("‚ùå Unexpected error saving customization form:",t),{success:!1,error:t.message,data:null}}}async function ge(e){try{console.log("üíæ Saving OMS customization form to Supabase...",{formData:e});const{data:o,error:t}=await se.rpc("upsert_oms_customization",{p_user_email:e.email||e.contact_email||e.contactEmail||"",p_project_name:e.projectName||e.project_name||"",p_restaurant_name:e.restaurantName||e.restaurant_name||"Default Restaurant",p_owner_name:e.ownerName||e.owner_name||e.contactPerson||e.contact_person||"",p_restaurant_address:e.restaurantAddress||e.restaurant_address||"Not provided",p_contact_person:e.contactPerson||e.contact_person||"",p_phone_number:e.phone||e.contact_phone||e.contactPhone||"",p_user_id:null,p_logo_url:e.logoUrl||e.logo_url||null,p_logo_filename:e.logoFilename||e.logo_filename||null,p_logo_size:e.logoSize||e.logo_size||null,p_menu_categories:e.menuCategories||e.menu_categories||[],p_menu_items:e.menuItems||e.menu_items||[],p_primary_color:e.primaryColor||e.primary_color||"#3B82F6",p_secondary_color:e.secondaryColor||e.secondary_color||"#10B981",p_accent_color:e.accentColor||e.accent_color||"#F59E0B",p_text_color:e.textColor||e.text_color||"#1F2937",p_additional_requirements:e.additionalRequirements||e.additional_requirements||""});if(t)return console.error("‚ùå Error inserting OMS customization:",t),console.error("‚ùå Error details:",{message:t.message,details:t.details,hint:t.hint,code:t.code}),{success:!1,error:t.message,data:null};if(o&&o.length>0){const l=o[0];return console.log("‚úÖ OMS customization result:",l),l.is_duplicate?(console.log("‚ö†Ô∏è Duplicate data detected:",l.message),{success:!0,error:null,data:{id:l.data_id},isUpdate:!1,isDuplicate:!0,message:l.message}):(console.log("‚úÖ OMS customization saved successfully, ID:",l.data_id),{success:!0,error:null,data:{id:l.data_id},isUpdate:!1,isDuplicate:!1,message:l.message})}else return console.error("‚ùå No data returned from OMS function"),{success:!1,error:"No data returned from OMS function",data:null}}catch(o){return console.error("‚ùå Unexpected error saving OMS customization form:",o),{success:!1,error:o.message,data:null}}}window.addEventListener("unhandledrejection",e=>{if(console.error("‚ùå‚ùå‚ùå UNHANDLED PROMISE REJECTION ‚ùå‚ùå‚ùå"),console.error("‚ùå Error:",e.reason),console.error("‚ùå Promise:",e.promise),e.reason&&typeof e.reason=="object"&&"message"in e.reason){const o=e.reason.message||"";if(o.includes("save")||o.includes("database")||o.includes("insert")){console.log("üîÑ Detected save-related error, resetting save button...");const t=document.getElementById("save-and-pay");t&&(t.disabled=!1,t.textContent="Save and Make Payment",console.log("‚úÖ Save button reset via global error handler"))}}e.preventDefault()});window.addEventListener("error",e=>{console.error("‚ùå‚ùå‚ùå GLOBAL ERROR ‚ùå‚ùå‚ùå"),console.error("‚ùå Error:",e.error),console.error("‚ùå Message:",e.message),console.error("‚ùå Source:",e.filename,":",e.lineno);const o=document.getElementById("save-and-pay");o&&o.disabled&&(console.log("üîÑ Resetting stuck save button due to global error..."),o.disabled=!1,o.textContent="Save and Make Payment")});let k=[],D=[],j=null;function ae(){try{const e=document.getElementById("order-menu-logo-upload");e&&(e.value="");const o=document.getElementById("order-menu-logo-upload-area");o&&(o.innerHTML=`
          <div class="flex flex-col items-center">
            <svg class="w-12 h-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            <p class="text-gray-600 mb-2">Click to upload logo</p>
            <p class="text-sm text-gray-500">PNG, JPG, SVG up to 10MB</p>
          </div>
        `);const t=document.getElementById("order-menu-logo-preview");t&&t.classList.add("hidden");const l=document.getElementById("menu-photos-upload");l&&(l.value="");const r=document.getElementById("menu-photos-upload-area");r&&(r.innerHTML=`
          <div class="flex flex-col items-center">
            <svg class="w-12 h-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            <p class="text-gray-600 mb-2">Click to upload menu photos</p>
            <p class="text-sm text-gray-500">PNG, JPG up to 5MB each</p>
          </div>
        `,l&&r.addEventListener("click",()=>{l.click()}));const n=document.getElementById("menu-photos-preview");n&&n.classList.add("hidden");const a=document.getElementById("menu-photos-grid");a&&(a.innerHTML=""),D=[],j=null,typeof k<"u"&&(k=[]),console.log("‚úÖ Form file fields cleared successfully")}catch(e){console.error("‚ùå Error clearing form file fields:",e)}}console.log("Dashboard loaded - using global auth manager");async function pe(e){try{console.log("üîç Fetching user profile from Supabase for user:",e);const{supabase:o}=await G(async()=>{const{supabase:r}=await import("./supabase.DeXTyW8I.js");return{supabase:r}},__vite__mapDeps([0,1,2])),{data:t,error:l}=await o.from("profiles").select("*").eq("id",e).single();return l?(console.error("Error fetching user profile:",l),null):(console.log("‚úÖ User profile fetched from Supabase:",t),t)}catch(o){return console.error("Error in fetchUserProfile:",o),null}}async function O(){console.log("üîÑ Updating user info...");const e=window.globalAuthManager||window.simpleAuthManager;if(!e||!e.isUserLoggedIn()){console.log("‚ùå User not logged in - showing generic welcome message");const n=document.getElementById("user-welcome");n&&(n.textContent="Guest",console.log("üëã Welcome message updated to: Guest")),console.log("‚úÖ Dashboard updated for guest user");return}let o=null,t="";const l=e.getCurrentUser();if(l&&l.email&&(o=l,t="auth-manager",console.log("‚úÖ Found authenticated user data:",o.email)),!o){console.log("No auth manager data, checking storage...");const n=[{key:"simple-auth-session",storage:sessionStorage,path:"user"},{key:"simple-auth-user",storage:localStorage,path:null},{key:"simple-auth-session",storage:localStorage,path:"user"}];for(const a of n)try{const u=a.storage.getItem(a.key);if(u){const p=JSON.parse(u);if(o=a.path?p[a.path]:p,o&&o.email){t=a.key,console.log(`‚úÖ Found user data in ${a.key}:`,o.email);break}}}catch(u){console.log(`Error reading ${a.key}:`,u)}}if(!o){console.log("‚ùå No authenticated user data found");const n=document.getElementById("user-welcome");n&&(n.textContent="Guest",console.log("üëã Welcome message updated to: Guest")),console.log("‚úÖ Dashboard updated for guest user");return}if(o){if(o.user_metadata&&(o.full_name=o.user_metadata.full_name||o.full_name,o.phone=o.user_metadata.phone||o.phone,o.company_name=o.user_metadata.company_name||o.company_name),o.id&&(!o.full_name||o.full_name==="User"||!o.phone||o.phone==="Not set")){console.log("üîÑ Incomplete user data, fetching from Supabase...");try{const n=await pe(o.id);n&&(o={...o,...n,email:o.email||n.email},console.log("‚úÖ Enhanced user data with profile:",o))}catch(n){console.log("Error fetching profile data:",n)}}if(o.full_name=o.full_name||o.fullName||"User",o.phone=o.phone||"Not set",o.company_name=o.company_name||o.companyName||"Not set",!o.email){console.log("‚ùå No email found in authenticated user data");return}console.log("üìã Final normalized user data:",o)}const r=document.getElementById("user-welcome");if(r){const n=o.full_name||o.fullName||o.email?.split("@")[0]||"User";r.textContent=n,console.log("üëã Welcome message updated to:",n)}console.log(`‚úÖ Dashboard updated successfully from ${t}`),setTimeout(()=>{console.log("üîÑ Force update welcome message...");const n=document.getElementById("user-welcome");if(n){const a=o.full_name||o.fullName||o.email?.split("@")[0]||"User";n.textContent=a,console.log("Force updated welcome to:",n.textContent)}},100)}function he(){const e=new URLSearchParams(window.location.search),o=e.get("product"),t=e.get("price");if(console.log("üîç Checking for product selection:",{productId:o,price:t}),o&&t){console.log("‚úÖ Product selected, showing customization form");const r=[{id:"1",name:"Restaurant Menu System",description:"Digital menu system with QR code integration, online ordering, and real-time updates. Perfect for restaurants looking to modernize their customer experience.",price:25e3,type:"restaurant"},{id:"2",name:"Android TV App",description:"Custom Android TV applications with beautiful UI, content management, and remote control support. Perfect for streaming services and media companies.",price:55e3,type:"non-restaurant"},{id:"3",name:"Streaming Mobile App",description:"Mobile streaming applications for iOS and Android with custom features, user authentication, and content management.",price:35e3,type:"non-restaurant"},{id:"4",name:"Restaurant Website",description:"Professional restaurant website with online ordering, menu display, and customer management features.",price:2e4,type:"restaurant"},{id:"5",name:"Order Menu System",description:"Complete order management system with digital menu integration, real-time order tracking, and payment processing. Perfect for restaurants looking to streamline their ordering process.",price:999,type:"order-menu"}].find(n=>n.id===o);if(r){const n=document.getElementById("product-customization-form"),a=document.getElementById("order-menu-customization-form"),u=document.getElementById("order-menu-price-page"),p=document.getElementById("recent-activity");n&&!n.classList.contains("hidden")&&(n.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",n.style.opacity="0",n.style.transform="translateY(-10px)",setTimeout(()=>n.classList.add("hidden"),300)),a&&!a.classList.contains("hidden")&&(a.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",a.style.opacity="0",a.style.transform="translateY(-10px)",setTimeout(()=>a.classList.add("hidden"),300)),u&&!u.classList.contains("hidden")&&(u.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",u.style.opacity="0",u.style.transform="translateY(-10px)",setTimeout(()=>u.classList.add("hidden"),300)),p&&!p.classList.contains("hidden")&&(p.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",p.style.opacity="0",p.style.transform="translateY(-10px)",setTimeout(()=>p.classList.add("hidden"),300)),setTimeout(()=>{const m=r.type==="order-menu"?999:parseInt(t);if(r.type==="order-menu"){document.getElementById("order-menu-product-name").textContent=r.name;const s=document.getElementById("order-menu-customization-form");s.classList.remove("hidden"),s.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",s.style.opacity="0",s.style.transform="translateY(10px)",setTimeout(()=>{s.style.opacity="1",s.style.transform="translateY(0)",window.reinitializePincodeAutocomplete&&window.reinitializePincodeAutocomplete(),setTimeout(()=>$(),200)},50)}else{document.getElementById("selected-product-name").textContent=r.name,document.getElementById("selected-product-price").textContent=`‚Çπ${m.toLocaleString()}`;const s=document.getElementById("cuisine-type-field"),i=document.getElementById("restaurant-name-field");r.type==="restaurant"?(s.classList.remove("hidden"),s.querySelector("select").required=!0,i.classList.remove("hidden"),i.querySelector("input").required=!0):(s.classList.add("hidden"),s.querySelector("select").required=!1,i.classList.add("hidden"),i.querySelector("input").required=!1);const d=document.getElementById("product-customization-form");d.classList.remove("hidden"),d.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",d.style.opacity="0",d.style.transform="translateY(10px)",setTimeout(()=>{d.style.opacity="1",d.style.transform="translateY(0)"},50)}},350),setTimeout(()=>$(),500)}}}const le=["Mumbai","Delhi","Bangalore","Hyderabad","Chennai","Kolkata","Pune","Ahmedabad","Jaipur","Surat","Lucknow","Kanpur","Nagpur","Indore","Thane","Bhopal","Visakhapatnam","Pimpri-Chinchwad","Patna","Vadodara","Ghaziabad","Ludhiana","Agra","Nashik","Faridabad","Meerut","Rajkot","Kalyan-Dombivali","Vasai-Virar","Varanasi","Srinagar","Aurangabad","Navi Mumbai","Solapur","Vijayawada","Kolhapur","Amritsar","Noida","Ranchi","Howrah","Coimbatore","Raipur","Jabalpur","Gwalior","Chandigarh","Tiruchirappalli","Mysore","Bhubaneswar","Kochi","Bhavnagar","Salem","Warangal","Guntur","Bhiwandi","Amravati","Nanded","Sangli","Malegaon","Ulhasnagar","Jalgaon","Latur","Ahmadnagar","Dhule","Ichalkaranji","Parbhani","Jalna","Bhusawal","Panvel","Satara","Beed","Yavatmal","Kamptee","Gondia","Barshi","Achalpur","Osmanabad","Nandurbar","Wardha","Udgir","Amalner","Akot","Pandharpur","Shirpur","Parli","Pathri","Sinnar","Shirur","Mangrulpir","Phaltan","Pulgaon","Pimpri","Pachora","Paratwada","Pusad","Purna","Rahuri","Rajura","Ramtek","Ratnagiri","Raver","Risod","Sailu","Sangamner","Sasvad","Satana","Shahpur","Shegaon","Shendurjana","Shirdi","Shrigonda","Shrirampur","Sillod","Soyagaon","Talegaon Dabhade","Talode","Tasgaon","Telhara","Tirora","Tuljapur","Tumsar","Uchgaon","Umarga","Umarkhed","Umred","Uran","Uran Islampur","Vadgaon Kasba","Vaijapur","Vasai","Virar","Vita","Wadgaon Road","Wai","Wani","Warora","Warud","Washim","Yawal","Yevla"],X=["Andhra Pradesh","Arunachal Pradesh","Assam","Bihar","Chhattisgarh","Goa","Gujarat","Haryana","Himachal Pradesh","Jharkhand","Karnataka","Kerala","Madhya Pradesh","Maharashtra","Manipur","Meghalaya","Mizoram","Nagaland","Odisha","Punjab","Rajasthan","Sikkim","Tamil Nadu","Telangana","Tripura","Uttar Pradesh","Uttarakhand","West Bengal","Andaman and Nicobar Islands","Chandigarh","Dadra and Nagar Haveli and Daman and Diu","Delhi","Jammu and Kashmir","Ladakh","Lakshadweep","Puducherry"];function fe(){const e=document.getElementById("pincode-input"),o=document.getElementById("city-input"),t=document.getElementById("state-input"),l=document.getElementById("phone-input");if(e&&e.addEventListener("input",function(n){n.target.value=n.target.value.replace(/[^0-9]/g,""),n.target.value.length>6&&(n.target.value=n.target.value.slice(0,6));const a=document.getElementById("pincode-error");n.target.value.length>0&&n.target.value.length!==6?a.classList.remove("hidden"):a.classList.add("hidden")}),o){const n=document.getElementById("city-suggestions");o.addEventListener("input",function(a){const u=a.target.value.toLowerCase(),p=le.filter(s=>s.toLowerCase().includes(u));u.length>0&&p.length>0?(n.innerHTML=p.map(s=>`<div class="px-4 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0" data-value="${s}">${s}</div>`).join(""),n.classList.remove("hidden")):n.classList.add("hidden");const m=document.getElementById("city-error");a.target.value===""?m.classList.remove("hidden"):m.classList.add("hidden")}),n.addEventListener("click",function(a){a.target.dataset.value&&(o.value=a.target.dataset.value,n.classList.add("hidden"),document.getElementById("city-error").classList.add("hidden"))}),document.addEventListener("click",function(a){!o.contains(a.target)&&!n.contains(a.target)&&n.classList.add("hidden")})}if(t){const n=document.getElementById("state-suggestions");t.addEventListener("input",function(a){const u=a.target.value.toLowerCase(),p=X.filter(s=>s.toLowerCase().includes(u));u.length>0&&p.length>0?(n.innerHTML=p.map(s=>`<div class="px-4 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0" data-value="${s}">${s}</div>`).join(""),n.classList.remove("hidden")):n.classList.add("hidden");const m=document.getElementById("state-error");a.target.value===""||!X.includes(a.target.value)?m.classList.remove("hidden"):m.classList.add("hidden")}),n.addEventListener("click",function(a){a.target.dataset.value&&(t.value=a.target.dataset.value,n.classList.add("hidden"),document.getElementById("state-error").classList.add("hidden"))}),document.addEventListener("click",function(a){!t.contains(a.target)&&!n.contains(a.target)&&n.classList.add("hidden")})}const r=document.getElementById("phone_country_code");if(l&&r){let n=function(){return r.value},a=function(){const p=n(),m=l.value.replace(/\D/g,""),s=u[p]||10;if(l.maxLength=s,l.pattern=`[0-9]{1,${s}}`,p==="+91"){const i=document.getElementById("phone-error");m.length>0&&m.length!==10?(i?.classList.remove("hidden"),i.textContent="Please enter a valid 10-digit phone number",l.classList.add("border-red-500")):(i?.classList.add("hidden"),l.classList.remove("border-red-500"))}else{const i=document.getElementById("phone-error");m.length>0&&m.length!==s?(i?.classList.remove("hidden"),i.textContent=`Please enter a valid ${s}-digit phone number`,l.classList.add("border-red-500")):(i?.classList.add("hidden"),l.classList.remove("border-red-500"))}};const u={"+91":10,"+1":10,"+44":10,"+61":9,"+86":11,"+81":10,"+49":11,"+33":9,"+971":9,"+966":9};l.addEventListener("input",function(p){const m=p.target.value.replace(/[^0-9]/g,""),s=n(),i=u[s]||10;p.target.value=m.slice(0,i),a()}),r.addEventListener("change",function(){l.value="";const p=n();l.placeholder=p==="+91"?"9876543210":"Enter phone number",a()}),l.addEventListener("blur",a)}}function ye(){document.querySelectorAll("#order-menu-form input, #order-menu-form select, #order-menu-form textarea").forEach(t=>{t.addEventListener("input",ee),t.addEventListener("change",ee),t.addEventListener("focus",ee)});const o=document.getElementById("menu-photos-upload");o&&o.addEventListener("change",()=>{const t=document.getElementById("menu-photos-error");t&&t.classList.add("hidden")})}function ee(){const e=document.getElementById("validation-errors");e&&e.classList.add("hidden"),document.querySelectorAll("#pincode-error, #city-error, #state-error, #phone-error").forEach(r=>{r&&r.classList.add("hidden")});const t=document.getElementById("validation-popup");t&&t.remove(),document.querySelectorAll("#order-menu-form input, #order-menu-form select, #order-menu-form textarea").forEach(r=>{r.classList.remove("border-red-500","ring-2","ring-red-200"),r.classList.add("border-gray-300")})}function K(){console.log("üîç validateFormFields() called");const e=document.getElementById("pincode-input"),o=document.getElementById("city-input"),t=document.getElementById("state-input"),l=document.getElementById("phone-input"),r=document.getElementById("order-menu-form");if(!r)return console.error("Order menu form not found for validation"),!1;const n=r.querySelector('input[name="projectName"]'),a=r.querySelector('input[name="restaurantName"]'),u=r.querySelector('input[name="ownerName"]'),p=r.querySelector('input[name="contactPerson"]'),m=r.querySelector('input[name="email"]'),s=r.querySelector('input[name="houseNumber"]'),i=r.querySelector('input[name="addressLine1"]'),d=r.querySelector('select[name="country"]');console.log("üîç Form fields found:"),console.log("  - projectName:",n?n.value:"not found"),console.log("  - restaurantName:",a?a.value:"not found"),console.log("  - ownerName:",u?u.value:"not found"),console.log("  - contactPerson:",p?p.value:"not found"),console.log("  - email:",m?m.value:"not found"),console.log("  - houseNumber:",s?s.value:"not found"),console.log("  - addressLine1:",i?i.value:"not found"),console.log("  - country:",d?d.value:"not found"),console.log("  - phone:",l?l.value:"not found"),console.log("  - city:",o?o.value:"not found"),console.log("  - state:",t?t.value:"not found"),console.log("  - pincode:",e?e.value:"not found");let g=!0,y=[],E=[];if(ve(),(!n||!n.value.trim())&&(console.log("üîç Project Name validation failed:"),console.log("  - projectName element:",n),console.log("  - projectName.value:",n?n.value:"element not found"),E.push("Project Name"),y.push("Project Name is required"),g=!1,A(n)),(!a||!a.value.trim())&&(console.log("üîç Restaurant Name validation failed:"),console.log("  - restaurantName element:",a),console.log("  - restaurantName.value:",a?a.value:"element not found"),E.push("Restaurant Name"),y.push("Restaurant Name is required"),g=!1,A(a)),(!u||!u.value.trim())&&(E.push("Owner Name"),y.push("Owner Name is required"),g=!1,A(u)),(!p||!p.value.trim())&&(E.push("Contact Person"),y.push("Contact Person is required"),g=!1,A(p)),!m||!m.value.trim()?(E.push("Email"),y.push("Email is required"),g=!1,A(m)):/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m.value)||(y.push("Please enter a valid email address"),g=!1,A(m)),(!s||!s.value.trim())&&(E.push("House/Flat Number"),y.push("House/Flat Number is required"),g=!1,A(s)),(!i||!i.value.trim())&&(E.push("Address Line 1"),y.push("Address Line 1 is required"),g=!1,A(i)),e&&(!e.value||e.value.length!==6||!/^[0-9]{6}$/.test(e.value))){const B=document.getElementById("pincode-error");B&&(B.classList.remove("hidden"),B.textContent="Pincode must be exactly 6 digits"),E.push("Pincode"),y.push("Pincode must be exactly 6 digits"),g=!1,A(e)}if(o&&(!o.value||!o.value.trim())){console.log("üîç City validation failed:"),console.log("  - cityInput.value:",o.value);const B=document.getElementById("city-error");B&&(B.classList.remove("hidden"),B.textContent="City is required"),E.push("City"),y.push("City is required"),g=!1,A(o)}if(t&&(!t.value||!X.includes(t.value))){const B=document.getElementById("state-error");B&&(B.classList.remove("hidden"),B.textContent="Please select a valid state"),E.push("State"),y.push("Please select a valid state"),g=!1,A(t)}(!d||!d.value)&&(E.push("Country"),y.push("Country is required"),g=!1,A(d));const S=document.getElementById("phone_country_code");if(l&&S){const B=S.value,M=l.value.replace(/\D/g,"");if(B==="+91"){if(!M||M.length!==10||!/^[0-9]{10}$/.test(M)){const T=document.getElementById("phone-error");T&&(T.classList.remove("hidden"),T.textContent="Please enter a valid 10-digit phone number for India"),E.push("Phone Number"),y.push("Please enter a valid 10-digit phone number for India"),g=!1,A(l)}}else{const _={"+1":10,"+44":10,"+61":9,"+86":11,"+81":10,"+49":11,"+33":9,"+971":9,"+966":9}[B]||10;if(!M||M.length!==_||!/^[0-9]+$/.test(M)){const I=document.getElementById("phone-error");I&&(I.classList.remove("hidden"),I.textContent=`Please enter a valid ${_}-digit phone number`),E.push("Phone Number"),y.push(`Please enter a valid ${_}-digit phone number`),g=!1,A(l)}}}if(g)console.log("‚úÖ Form validation passed - all required fields are filled");else{console.log("‚ùå Form validation failed with errors:",y),be(E);const B=document.getElementById("order-menu-form");B&&B.scrollIntoView({behavior:"smooth",block:"start"})}return console.log("üîç validateFormFields() returning:",g),g}function A(e){e&&(e.classList.add("border-red-500","ring-2","ring-red-200"),e.classList.remove("border-gray-300","ring-primary-500"))}function ve(){document.querySelectorAll("#order-menu-form input, #order-menu-form select, #order-menu-form textarea").forEach(t=>{t.classList.remove("border-red-500","ring-2","ring-red-200"),t.classList.add("border-gray-300")}),document.querySelectorAll("#pincode-error, #city-error, #state-error, #phone-error").forEach(t=>{t&&t.classList.add("hidden")})}function be(e,o){let t=document.getElementById("validation-popup");if(!t)t=document.createElement("div"),t.id="validation-popup",t.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",t.innerHTML=`
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-red-600">Required Fields Missing</h3>
            <button id="close-validation-popup" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
          <div class="mb-4">
            <p class="text-gray-700 mb-3">Please fill in all required fields marked with <span class="text-red-500 font-bold">*</span>:</p>
            <ul class="list-disc list-inside text-red-600 space-y-1">
              ${e.map(l=>`<li>${l}</li>`).join("")}
            </ul>
          </div>
          <div class="flex justify-end">
            <button id="ok-validation-popup" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
              OK
            </button>
          </div>
        </div>
      `,document.body.appendChild(t),document.getElementById("close-validation-popup").addEventListener("click",()=>{t.remove()}),document.getElementById("ok-validation-popup").addEventListener("click",()=>{t.remove()}),t.addEventListener("click",l=>{l.target===t&&t.remove()});else{const l=t.querySelector("ul");l.innerHTML=e.map(r=>`<li>${r}</li>`).join("")}}function we(){const e=document.getElementById("order-menu-form");console.log("handleOrderMenuForm called - form found:",e);const o=document.getElementById("close-order-menu-form"),t=document.getElementById("cancel-order-menu");console.log("üîç Close button found:",o),console.log("üîç Cancel button found:",t);const l=document.getElementById("order-menu-logo-upload"),r=document.getElementById("order-menu-logo-upload-area");document.getElementById("order-menu-logo-preview"),document.getElementById("order-menu-logo-preview-img"),document.getElementById("order-menu-logo-filename"),document.getElementById("order-menu-logo-remove");const n=document.getElementById("menu-photos-upload"),a=document.getElementById("menu-photos-upload-area"),u=document.getElementById("menu-photos-preview"),p=document.getElementById("menu-photos-grid");if(console.log("menuPhotosPreview element found:",u),console.log("menuPhotosGrid element found:",p),console.log("menuPhotosUpload element found:",n),n)console.log("File input element found successfully");else{console.error("CRITICAL: File input element not found! Creating fallback...");const c=document.createElement("input");c.type="file",c.name="menuPhotos",c.accept="image/*",c.multiple=!0,c.className="hidden",c.id="menu-photos-upload";const v=document.getElementById("order-menu-form");v&&(v.appendChild(c),console.log("Fallback file input created and added to form"))}document.getElementById("remove-all-menu-photos"),a&&n&&(a.addEventListener("click",()=>{n.click()}),n.addEventListener("change",c=>{const v=Array.from(c.target.files);if(v.length>0){const f=v.filter(b=>b.size/1048576<=5);if(f.length!==v.length){const b=document.getElementById("file-size-error");b&&(b.classList.remove("hidden"),b.textContent=`Some files were too large. Only files under 5MB are allowed. ${f.length}/${v.length} files uploaded.`)}k=[...k,...f],D=[...k],console.log("üì∏ Cached menu photos:",D.length,"files"),m(),a.classList.remove("border-red-300","bg-red-50"),a.classList.add("border-gray-300","bg-gray-50"),a.innerHTML=`
            <div class="flex flex-col items-center">
              <svg class="w-16 h-16 text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 13l4 4L19 7"></path>
              </svg>
              <p class="text-green-600 mb-2 font-medium">${f.length} photo(s) uploaded successfully</p>
              <p class="text-sm text-gray-500">Total: ${k.length} photos uploaded</p>
              <button type="button" onclick="document.getElementById('menu-photos-upload').click()" class="mt-4 px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg transition-all transform hover:scale-105 shadow-lg">
                <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                Add More Photos
              </button>
            </div>
          `,n.value=""}}));function m(){if(k.length>0){u.classList.remove("hidden"),p.innerHTML="";const c=document.createElement("div");c.className="col-span-full mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",c.innerHTML=`
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <svg class="w-6 h-6 text-green-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              <div>
                <span class="text-green-800 font-semibold text-lg">${k.length} Photo(s) Uploaded</span>
                <p class="text-sm text-green-600">Menu photos ready for your order system</p>
              </div>
            </div>
            <button type="button" onclick="removeAllMenuPhotos()" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white text-sm font-medium rounded-lg transition-colors">
              <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
              </svg>
              Remove All
            </button>
          </div>
        `,p.appendChild(c),k.forEach((v,f)=>{const b=new FileReader;b.onload=x=>{const P=document.createElement("div");P.className="relative group bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow",P.innerHTML=`
              <div class="relative">
                <img src="${x.target.result}" alt="Menu photo ${f+1}" class="w-full h-32 object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center">
                  <button type="button" class="opacity-0 group-hover:opacity-100 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm hover:bg-red-600 transition-all duration-200 shadow-lg" onclick="removeMenuPhoto(${f})">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                  </button>
                </div>
              </div>
              <div class="p-3">
                <p class="text-sm text-gray-700 font-medium truncate">${v.name}</p>
                <p class="text-xs text-gray-500">${(v.size/1024/1024).toFixed(2)} MB</p>
              </div>
            `,p.appendChild(P)},b.readAsDataURL(v)})}else u.classList.add("hidden")}window.removeMenuPhoto=c=>{console.log("removeMenuPhoto called, index:",c),console.log("Before removal - menuPhotos length:",k.length),k.splice(c,1),console.log("After removal - menuPhotos length:",k.length),m(),k.length===0&&(a.innerHTML=`
          <div class="flex flex-col items-center">
            <svg class="w-16 h-16 text-red-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
            <p class="text-red-600 mb-2 font-medium">Menu photos required!</p>
            <p class="text-sm text-gray-500 mb-2">Please upload at least one menu photo to continue</p>
            <div class="mt-3 flex items-center text-xs text-red-500 font-medium">
              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              This field is mandatory
            </div>
          </div>
        `,a.classList.add("border-red-300","bg-red-50"),a.classList.remove("border-gray-300","bg-gray-50"))},window.removeAllMenuPhotos=()=>{console.log("removeAllMenuPhotos called"),console.log("Before removal - menuPhotos length:",k.length),k=[],console.log("After removal - menuPhotos length:",k.length),m(),n.value="",a.innerHTML=`
        <div class="flex flex-col items-center">
          <svg class="w-16 h-16 text-red-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
          </svg>
          <p class="text-red-600 mb-2 font-medium">Menu photos required!</p>
          <p class="text-sm text-gray-500 mb-2">Please upload at least one menu photo to continue</p>
          <div class="mt-3 flex items-center text-xs text-red-500 font-medium">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            This field is mandatory
          </div>
        </div>
      `,a.classList.add("border-red-300","bg-red-50"),a.classList.remove("border-gray-300","bg-gray-50")};const s=document.getElementById("add-menu-item"),i=document.getElementById("menu-items-container"),d=document.getElementById("oms-category-input"),g=document.getElementById("oms-add-category-btn"),y=document.getElementById("oms-clear-all-categories-btn"),E=document.getElementById("oms-category-pills"),S=document.getElementById("oms-current-category"),B=document.getElementById("oms-prev-page"),M=document.getElementById("oms-next-page"),T=document.getElementById("oms-page-indicator"),_=[];let I=-1;const L=6;let C=1;function U(){E.innerHTML="",_.forEach((c,v)=>{const f=document.createElement("button");f.type="button",f.className=`px-3 py-1 rounded-full text-sm ${v===I?"bg-amber-600 text-white":"bg-gray-100"} flex items-center`;const b=document.createElement("span");b.textContent=c,b.className="mr-2",f.appendChild(b);const x=document.createElement("span");x.textContent="‚úï",x.className="text-xs opacity-70 hover:opacity-100 ml-1",x.addEventListener("click",P=>{P.stopPropagation();const R=_.splice(v,1)[0];I>=_.length&&(I=_.length-1),i&&i.querySelectorAll(".menu-item-row").forEach(z=>{const V=z.querySelector(".oms-category-field");V&&V.value===R&&(V.value="")}),S.textContent=_[I]||"Uncategorized",U(),F()}),f.appendChild(x),f.addEventListener("click",()=>{I=v,S.textContent=c,U(),F()}),E.appendChild(f)})}y?.addEventListener("click",()=>{_.splice(0,_.length),I=-1,S.textContent="Uncategorized",U(),F(),i&&i.querySelectorAll(".oms-category-field").forEach(c=>c.value="")}),g?.addEventListener("click",()=>{const c=d.value.trim();c&&(_.includes(c)||(_.push(c),I=_.length-1,S.textContent=c,U(),i&&i.querySelectorAll(".oms-category-field").forEach(v=>{v.value||(v.value=c)}),d.value=""))});function F(){if(!i)return;const c=Array.from(i.querySelectorAll(".menu-item-row"));if(c.forEach(b=>b.style.display=""),I>=0){const b=_[I];c.forEach(x=>{const P=x.querySelector(".oms-category-field");P&&P.value&&P.value!==b&&(x.style.display="none")})}const v=c.filter(b=>b.style.display!=="none"),f=Math.max(1,Math.ceil(v.length/L));C=Math.min(C,f),T&&(T.textContent=`Page ${C} / ${f}`),v.forEach((b,x)=>{const P=Math.floor(x/L)+1;b.style.display=P===C?"":"none"})}B?.addEventListener("click",()=>{C>1&&(C-=1,F())}),M?.addEventListener("click",()=>{C+=1,F()}),l?.addEventListener("change",c=>{const v=c.target.files[0];if(v){const f=v.name,b=(v.size/1024/1024).toFixed(2);r.innerHTML=`
          <div class="flex flex-col items-center">
            <svg class="w-12 h-12 text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <p class="text-green-600 mb-1 font-medium">Logo uploaded successfully</p>
            <p class="text-sm text-gray-500">${f} (${b} MB)</p>
          </div>
        `}});const N=document.querySelectorAll(".menu-style-option");N.forEach(c=>{c.addEventListener("click",()=>{N.forEach(f=>{f.classList.remove("border-primary-500","bg-primary-50"),f.classList.add("border-gray-200")}),c.classList.remove("border-gray-200"),c.classList.add("border-primary-500","bg-primary-50");const v=c.querySelector('input[type="radio"]');v&&(v.checked=!0)})});function h(){const c=e?.querySelectorAll('input[type="color"]'),v=e?.querySelectorAll('input[name$="ColorText"]');c?.forEach((f,b)=>{const x=v?.[b];x&&(f.addEventListener("input",()=>{x.value=f.value}),x.addEventListener("input",()=>{/^#[0-9A-F]{6}$/i.test(x.value)&&(f.value=x.value)}))})}h();let w=1;s?.addEventListener("click",()=>{const c=document.createElement("div");if(c.className="menu-item-row grid grid-cols-1 md:grid-cols-4 gap-4 mb-4 p-4 border border-gray-200 rounded-lg",c.innerHTML=`
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Item Name</label>
          <input type="text" name="menuItems[${w}][item_name]" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500" placeholder="e.g., Margherita Pizza" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Price (‚Çπ)</label>
          <input type="number" name="menuItems[${w}][price]" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500" placeholder="299" step="0.01" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
          <input type="text" name="menuItems[${w}][item_category]" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 oms-category-field" placeholder="Type or pick from pills" required>
        </div>
        <div class="flex items-end">
          <button type="button" class="remove-menu-item px-3 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 text-sm">
            Remove
          </button>
        </div>
      `,i?.appendChild(c),w++,I>=0){const v=_[I],f=c.querySelector(".oms-category-field");f&&!f.value&&(f.value=v)}F()}),i?.addEventListener("click",c=>{c.target.classList.contains("remove-menu-item")&&(c.target.closest(".menu-item-row").remove(),F())}),F(),o?.addEventListener("click",()=>{Y=!0,q(),J(),window.history.replaceState({},document.title,window.location.pathname)}),t?.addEventListener("click",()=>{Y=!0,q(),J(),window.history.replaceState({},document.title,window.location.pathname)}),console.log("Adding form submission event listener to form:",e),console.error("Form not found - cannot add event listener"),fe(),ye(),e?e.addEventListener("submit",c=>{if(console.log("Form submit event triggered!"),c.preventDefault(),c.stopPropagation(),console.log("üîç Running validation before form submit event..."),!K()){console.log("‚ùå Validation failed, preventing form submission");return}Z()}):console.error("Form not found for submit event listener")}async function Z(){console.log("üöÄüöÄüöÄ STARTING handleOrderMenuFormSubmission() üöÄüöÄüöÄ"),console.log("üìç Timestamp:",new Date().toISOString());const e=document.getElementById("order-menu-form");if(!e)throw console.error("‚ùå‚ùå‚ùå Order menu form not found ‚ùå‚ùå‚ùå"),new Error("Form not found. Please refresh the page and try again.");console.log("‚úÖ Form found:",e);const o=window.globalAuthManager||window.simpleAuthManager;if(console.log("üîç Auth manager check:",{globalAuthManager:!!window.globalAuthManager,simpleAuthManager:!!window.simpleAuthManager,authManager:!!o}),!o)throw console.error("‚ùå‚ùå‚ùå No auth manager found ‚ùå‚ùå‚ùå"),new Error("Please log in to submit this form. You must be authenticated to place an order.");const t=o.isUserLoggedIn();if(console.log("üîç User logged in:",t),!t)throw console.error("‚ùå‚ùå‚ùå User not logged in ‚ùå‚ùå‚ùå"),new Error("Please log in to submit this form. You must be authenticated to place an order.");const l=o.getCurrentUser();console.log("üë§ Current user:",l),console.log("üîç Running comprehensive validation before submission...");const r=K();if(console.log("üîç Form validation result:",r),!r)throw console.log("‚ùå Form validation failed - required fields missing"),new Error("Form validation failed. Please fill in all required fields.");const n=document.getElementById("menu-photos-upload");if(!(D&&D.length>0||n&&n.files&&n.files.length>0)){console.log("‚ùå Menu photos validation failed - no photos uploaded");const d=document.getElementById("menu-photos-error");d&&(d.classList.remove("hidden"),d.innerHTML='<div class="bg-red-50 border border-red-200 rounded-lg p-3"><p class="text-red-700 font-medium">Please upload at least one menu photo. This field is required for Order Menu System.</p></div>');const g=document.getElementById("validation-errors");g&&(g.classList.remove("hidden"),g.innerHTML='<div class="bg-red-50 border border-red-200 rounded-lg p-4"><h4 class="text-red-800 font-semibold mb-2">Please fix the following errors:</h4><ul class="list-disc list-inside text-red-700 space-y-1"><li>Please upload at least one menu photo. This field is required for Order Menu System.</li></ul></div>');const y=document.getElementById("menu-photos-upload-area");throw y&&y.scrollIntoView({behavior:"smooth",block:"center"}),new Error("Please upload at least one menu photo. This field is required for Order Menu System.")}console.log("‚úÖ All validations passed, proceeding with form submission"),console.log("üîç IMMEDIATE FILE CHECK:"),console.log("üì∏ Cached menu photos count:",D.length),console.log("üè∑Ô∏è Cached logo file:",j?"Yes":"No"),D.length>0&&console.log("üì∏ Cached menu photos details:",D.map(d=>({name:d.name,size:d.size,type:d.type}))),j&&console.log("üè∑Ô∏è Cached logo file details:",{name:j.name,size:j.size,type:j.type});const u=D.length;console.log("Cached files => menuPhotos:",u,"logo:",j?1:0);const m=new FormData(e),s=Object.fromEntries(m);console.log("üìù Form data collected:",s);const i=document.getElementById("phone_country_code");console.log("üìû Phone country code select:",i?i.value:"not found");try{let d;try{const h=G(()=>import("./supabase.DeXTyW8I.js"),__vite__mapDeps([0,1,2])),w=new Promise((v,f)=>{setTimeout(()=>f(new Error("Supabase import timed out")),5e3)});d=(await Promise.race([h,w])).supabase}catch(h){throw console.error("‚ùå Supabase import error:",h.message),new Error("Failed to load database connection. Please refresh the page and try again.")}if(!d||typeof d.from!="function")throw new Error("Database connection failed. Please refresh the page and try again.");let g=null;try{l&&l.id?g=l.id:o&&typeof o.getCurrentUser=="function"&&(g=o.getCurrentUser()?.id||null)}catch(h){console.warn("‚ö†Ô∏è Could not get user ID:",h)}let y=null;const S=document.getElementById("order-menu-logo-upload")?.files?.[0]||null,B=j||S;if(B)try{console.log("üì§ Uploading logo before database insert...");const h=Date.now(),w=Math.random().toString(36).substring(2,8),c=B.name.replace(/[^a-zA-Z0-9.-]/g,"_"),v=`logos/${h}_${w}_${c}`,{error:f}=await d.storage.from("logos").upload(v,B,{upsert:!0,contentType:B.type,cacheControl:"3600"});if(f)console.error("‚ùå Logo upload error:",f);else{const{data:b}=d.storage.from("logos").getPublicUrl(v);b?.publicUrl&&(y=b.publicUrl,console.log("‚úÖ Logo uploaded successfully:",y))}}catch(h){console.error("‚ùå Logo upload exception:",h)}const M=new Date().toISOString(),T={project_name:s.projectName||"",owner_name:s.ownerName||"",contact_person:s.contactPerson||"",email:s.email||"",phone_number:(()=>{const h=i?.value||"+91";return i?`${h}${(s.phone||"").replace(/\D/g,"")}`:s.phone||""})(),house_flat_number:s.houseNumber||"",address_line_1:s.addressLine1||"",city:s.city||"",state:s.state||"",pincode:s.pincode||"",country:s.country||"India",restaurant_name:s.restaurantName||"",restaurant_logo_url:y,menu_photos_urls:null,additional_requirements:s.additionalRequirements||"",base_package_cost:999,gst_amount:180,total_amount:1179,status:"completed",created_at:M,updated_at:M};g&&(T.user_id=g),console.log("üïê Timestamp added - Created at:",M),console.log("üíæ Saving order customization data...");const _=Date.now();console.log("üì§ Saving to database...");let I,L,C=null;try{const h=d.from("order_customizations").insert(T).select(),w=new Promise((f,b)=>{C=setTimeout(()=>{b(new Error("Database insert timed out after 15 seconds"))},15e3)}),c=await Promise.race([h,w]);C&&(clearTimeout(C),C=null),c&&typeof c=="object"?"error"in c?(I=c.data,L=c.error):"data"in c?(I=c.data,L=c.error||null):(I=c,L=null):(I=c,L=null);const v=Math.round((Date.now()-_)/1e3);console.log(`‚úÖ Database insert completed in ${v} seconds`),console.log("‚úÖ Insert result:",{savedData:I,saveError:L})}catch(h){C&&(clearTimeout(C),C=null),console.error("‚ùå Database insert exception:",h),console.error("‚ùå Error message:",h?.message),console.error("‚ùå Error stack:",h?.stack),h?.message&&h.message.includes("timed out")?L={message:"Database operation timed out. Please check your internet connection and try again.",code:"TIMEOUT",details:"The database insert took longer than 15 seconds to complete.",hint:"This may be due to network issues or database overload. Please try again."}:h?.error?L=h.error:L={message:h?.message||"Unknown database error occurred",code:h?.code||"UNKNOWN",details:h?.details||"",hint:h?.hint||"Please try again or contact support."},I=null}if(L){console.error("‚ùå Error saving:",L.message||L.code||"Unknown error"),console.error("‚ùå Full error object:",L);let h=L.message||L.hint||"Failed to save your order.",w="";L.code==="23505"?(h="This order already exists. A duplicate order with the same details was detected.",w="Please check if you have already submitted this order."):L.code==="23503"?(h="Database constraint violation. Some required reference data is missing.",w="Please refresh the page and try again."):L.code==="42501"?(h="Permission denied. You may not have permission to save orders.",w="Please ensure you are logged in and have the correct permissions."):L.code==="PGRST116"?(h="Table not found. The database table may not exist.",w="Please contact support. Error code: PGRST116"):L.code==="TIMEOUT"?(h="Database operation timed out.",w="Please check your internet connection and try again."):L.message&&(w=L.hint||L.details||"");const c=document.getElementById("validation-errors");if(c){c.classList.remove("hidden");const v=h.replace(/"/g,"&quot;").replace(/'/g,"&#39;"),f=w.replace(/"/g,"&quot;").replace(/'/g,"&#39;"),b=(L.code||"Unknown").replace(/"/g,"&quot;");c.innerHTML=`
            <div class="bg-red-50 border border-red-200 rounded-lg p-4">
              <h4 class="text-red-800 font-semibold mb-2">‚ùå Error Saving Order</h4>
              <p class="text-red-700 font-medium">${v}</p>
              ${f?`<p class="text-red-600 text-sm mt-2">${f}</p>`:""}
              <p class="text-red-600 text-sm mt-2">Error Code: ${b}</p>
              <p class="text-red-600 text-sm mt-2">If this problem persists, please contact support with the error code above.</p>
            </div>
          `}throw new Error(h)}if(!I||Array.isArray(I)&&I.length===0)throw console.error("‚ùå‚ùå‚ùå No data returned from insert operation ‚ùå‚ùå‚ùå"),console.error("‚ùå savedData:",I),console.error("‚ùå savedData type:",typeof I),console.error("‚ùå savedData is array:",Array.isArray(I)),console.error("‚ùå savedData length:",I?Array.isArray(I)?I.length:"not an array":"null/undefined"),new Error("Error saving your order. No data was returned from database. Please try again.");const U=Array.isArray(I)?I[0]:I;console.log("‚úÖ Order saved successfully! ID:",U?.id);const F=U?.id,N=document.getElementById("validation-errors");N&&(N.classList.remove("hidden"),N.innerHTML=`
          <div class="bg-green-50 border border-green-200 rounded-lg p-4">
            <h4 class="text-green-800 font-semibold mb-2">‚úÖ Order Submitted Successfully!</h4>
            <p class="text-green-700">Your order has been saved. Files are uploading in the background...</p>
          </div>
        `),Promise.resolve().then(async()=>{try{console.log("üì∏ Starting background file uploads...");let h=[],w=null;if(D&&D.length>0){console.log(`üì∏ Uploading ${D.length} menu photos in background...`);const c=D.map(async(f,b)=>{try{const x=Date.now(),P=Math.random().toString(36).substring(2,8),R=f.name.replace(/[^a-zA-Z0-9.-]/g,"_"),z=`menu_photos/${x}_${P}_${b}_${R}`,{error:V}=await d.storage.from("menu-photos").upload(z,f,{upsert:!0,contentType:f.type,cacheControl:"3600"});if(V)return console.error(`‚ùå Upload error for photo ${b+1}:`,V),null;const{data:ne}=d.storage.from("menu-photos").getPublicUrl(z);return ne?.publicUrl?{url:ne.publicUrl,filename:f.name,mimeType:f.type,size:f.size,path:z}:null}catch(x){return console.error(`‚ùå Exception uploading photo ${b+1}:`,x),null}});h=(await Promise.all(c)).filter(f=>f!==null),console.log(`‚úÖ ${h.length} menu photos uploaded successfully`)}if(F&&h.length>0){const c=h.length>0?h.map(f=>({url:f.url,filename:f.filename||"menu-photo",size:f.size||null,path:f.path||null,mimeType:f.mimeType||null})):null,{error:v}=await d.from("order_customizations").update({menu_photos_urls:c,updated_at:new Date().toISOString()}).eq("id",F);v?console.error("‚ùå Error updating record with file URLs:",v):console.log("‚úÖ Record updated with file URLs successfully")}}catch(h){console.error("‚ùå Background file upload error:",h)}}).catch(h=>{console.error("‚ùå Background upload promise error:",h)});return}catch(d){throw console.error("‚ùå Error in form submission:",d),new Error(d.message||"An error occurred while submitting your order. Please try again.")}}function Ee(){const e=document.getElementById("customization-form"),o=document.getElementById("close-customization-form"),t=document.getElementById("cancel-customization"),l=document.getElementById("restaurant-logo-upload"),r=document.getElementById("restaurant-logo-upload-area"),n=document.getElementById("restaurant-logo-preview"),a=document.getElementById("restaurant-logo-preview-img"),u=document.getElementById("restaurant-logo-filename"),p=document.getElementById("restaurant-logo-remove");r&&(r.onclick=()=>{const s=document.getElementById("restaurant-logo-upload");s?s.click():console.error("restaurant-logo-upload element not found in initial handler")}),l?.addEventListener("change",s=>{const i=s.target.files[0];if(i){const d=new FileReader;d.onload=g=>{a.src=g.target.result,u.textContent=i.name,n.classList.remove("hidden"),r.innerHTML=`
            <div class="flex flex-col items-center">
              <svg class="w-12 h-12 text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              <p class="text-green-600 mb-1 font-medium">Logo uploaded successfully</p>
              <p class="text-sm text-gray-500">${i.name}</p>
              <button type="button" onclick="const el = document.getElementById('restaurant-logo-upload'); if(el) el.click(); else console.error('restaurant-logo-upload element not found in button onclick');" class="mt-2 text-sm text-blue-600 hover:text-blue-800">Change Logo</button>
            </div>
          `},d.readAsDataURL(i)}}),p?.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),l.value="",n.classList.add("hidden"),r.innerHTML=`
        <div class="flex flex-col items-center">
          <svg class="w-12 h-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
          </svg>
          <p class="text-gray-600 mb-2">Click to upload logo</p>
          <p class="text-sm text-gray-500">PNG, JPG, SVG up to 10MB</p>
        </div>
      `,r.onclick=()=>{const i=document.getElementById("restaurant-logo-upload");i?i.click():console.error("restaurant-logo-upload element not found in reset handler")}});function m(){const s=e?.querySelectorAll('input[type="color"]'),i=e?.querySelectorAll('input[name$="ColorText"]');s?.forEach((d,g)=>{const y=i?.[g];y&&(d.addEventListener("input",()=>{y.value=d.value}),y.addEventListener("input",()=>{/^#[0-9A-F]{6}$/i.test(y.value)&&(d.value=y.value)}))})}m(),o?.addEventListener("click",()=>{Y=!0,q(),J(),window.history.replaceState({},document.title,window.location.pathname)}),t?.addEventListener("click",()=>{Y=!0,q(),J(),window.history.replaceState({},document.title,window.location.pathname)}),e?.addEventListener("submit",async s=>{s.preventDefault(),console.log("üöÄ FORM SUBMIT EVENT TRIGGERED!"),console.log("üöÄ Form element:",e),console.log("üöÄ Event target:",s.target);const i=window.globalAuthManager||window.simpleAuthManager;if(!i||!i.isUserLoggedIn()){alert("‚ùå Please log in to submit this form. You must be authenticated to place an order.");return}if(!K()){console.log("‚ùå Customization form validation failed, blocking save");return}const d=new FormData(e),g=Object.fromEntries(d);console.log("üìù Project requirements saved:",g),console.log("üìù Form data keys:",Object.keys(g)),console.log("üìù Form data values:",Object.values(g));const y=document.getElementById("selected-product-name").textContent,E=document.getElementById("selected-product-price").textContent;console.log("üß™ Not Order Menu System, skipping database save"),console.log("üß™ Product name was:",y);const S={productId:new URLSearchParams(window.location.search).get("product")||"1",productName:y,productPrice:E,projectName:g.projectName,appName:g.appName,contactPerson:g.contactPerson,productDescriptionCustom:g.productDescription,email:g.email,phone:g.phone,additionalRequirements:g.additionalRequirements,restaurantLogo:g.restaurantLogo,timestamp:new Date().toISOString()};S.restaurantName=g.restaurantName||S.restaurantName||"",S.cuisineType=g.cuisineType||S.cuisineType||"";try{console.log("üíæ Saving project form to database...");const M=(h=>(h||"").toLowerCase())(y);let T="restaurant-website";M.includes("order menu")?T="restaurant-menu-system":M.includes("restaurant website")?T="restaurant-website":M.includes("android tv")?T="android-tv-app":M.includes("streaming")&&(T="streaming-mobile-app");let _=S.logoUrl||null,I=S.logoFilename||null,L=S.logoMimeType||null,C=S.logoSize||null;try{const w=e.querySelector('input[name="restaurantLogo"]')?.files?.[0];if(w){const{supabase:c}=await G(async()=>{const{supabase:P}=await import("./supabase.DeXTyW8I.js");return{supabase:P}},__vite__mapDeps([0,1,2])),v=w.name.replace(/\s+/g,"_");if(w.size>10*1024*1024)throw new Error("Logo file exceeds 10MB limit");const f=`${Date.now()}_${v}`,b=await w.arrayBuffer(),{error:x}=await c.storage.from("logos").upload(f,b,{upsert:!0,contentType:w.type,cacheControl:"3600"});if(!x){const{data:P}=c.storage.from("logos").getPublicUrl(f);if(_=P?.publicUrl||null,!_){const{data:R,error:z}=await c.storage.from("logos").createSignedUrl(f,31536e3);z||(_=R?.signedUrl||null)}I=w.name,L=w.type,C=w.size}}}catch(h){console.warn("Logo upload skipped:",h)}let U=[];if(M.includes("order menu")&&k.length>0)try{console.log("üì∏ Starting menu photos upload to Supabase Storage...");const{supabase:h}=await G(async()=>{const{supabase:w}=await import("./supabase.DeXTyW8I.js");return{supabase:w}},__vite__mapDeps([0,1,2]));for(let w=0;w<k.length;w++){const c=k[w],v=c.name.replace(/[^a-zA-Z0-9.-]/g,"_"),b=`menu_photos/${Date.now()}_${w}_${v}`;console.log(`üì∏ Uploading photo ${w+1}/${k.length}: ${c.name}`),console.log(`üì∏ Upload path: ${b}`);const x=await c.arrayBuffer(),{error:P}=await h.storage.from("menu-photos").upload(b,x,{upsert:!0,contentType:c.type,cacheControl:"3600"});if(P)console.error(`‚ùå Error uploading photo ${w+1}:`,P);else{const{data:R}=h.storage.from("menu-photos").getPublicUrl(b);U.push({url:R?.publicUrl||null,filename:c.name,mimeType:c.type,size:c.size,path:b}),console.log(`‚úÖ Photo ${w+1} uploaded successfully:`,R?.publicUrl)}}console.log("üì∏ Menu photos upload completed. URLs:",U)}catch(h){console.error("‚ùå Menu photos upload failed:",h)}const F={productName:y,productPrice:E,projectName:S.projectName,contactPerson:S.contactPerson,appName:S.appName,productDescription:S.productDescriptionCustom,restaurantName:S.restaurantName,cuisineType:S.cuisineType,email:S.email,phone:S.phone,primaryColor:S.primaryColor,secondaryColor:S.secondaryColor,accentColor:S.accentColor,textColor:S.textColor,additionalRequirements:S.additionalRequirements,logoUrl:_,logoFilename:I,logoMimeType:L,logoSize:C,menuPhotosUrls:JSON.stringify(U)},N=await me(F,T);if(N.success)console.log("‚úÖ Project form saved to Supabase database:",N.data),alert(`‚úÖ Project requirements saved to database successfully!

Record ID: ${N.data.id}
Project: ${N.data.project_name}
Restaurant: ${N.data.restaurant_name||"N/A"}
Cuisine: ${N.data.cuisine_type||"N/A"}

Our team will contact you soon!`);else{console.error("‚ùå Error saving to database:",N.error);const h=JSON.parse(localStorage.getItem("project-requirements")||"[]");h.push(S),localStorage.setItem("project-requirements",JSON.stringify(h)),alert(`‚ùå Database save failed: ${N.error}

Data saved locally as backup. Our team will contact you soon.`)}window.history.replaceState({},document.title,window.location.pathname),q(),e.reset(),r&&(r.innerHTML=`
            <div class="flex flex-col items-center">
              <svg class="w-12 h-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              <p class="text-gray-600 mb-2">Click to upload restaurant logo</p>
              <p class="text-sm text-gray-500">PNG, JPG, SVG up to 10MB</p>
            </div>
          `)}catch(B){console.error("Error saving requirements:",B),alert("Error saving project requirements. Please try again.")}})}function q(){console.log("üîÑ Showing browse products section...");const e=document.getElementById("product-customization-form"),o=document.getElementById("order-menu-customization-form"),t=document.getElementById("recent-activity");console.log("Recent activity element found:",t),e&&!e.classList.contains("hidden")&&(console.log("Hiding product form..."),e.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",e.style.opacity="0",e.style.transform="translateY(-10px)",setTimeout(()=>e.classList.add("hidden"),300)),o&&!o.classList.contains("hidden")&&(console.log("Hiding order menu form..."),o.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",o.style.opacity="0",o.style.transform="translateY(-10px)",setTimeout(()=>o.classList.add("hidden"),300)),setTimeout(()=>{t?(console.log("Showing recent activity section..."),t.style.display="block",t.classList.remove("hidden"),t.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",t.style.opacity="0",t.style.transform="translateY(10px)",setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0)",console.log("‚úÖ Browse products section is now visible"),console.log("Recent activity display style:",t.style.display),console.log("Recent activity class list:",t.classList.toString())},50)):console.error("‚ùå Recent activity element not found!")},350)}window.showBrowseProductsSection=q;document.addEventListener("submit",e=>{if(console.log("üö´ FORM SUBMISSION EVENT DETECTED!"),console.log("üö´ Event target:",e.target),console.log("üö´ Event target ID:",e.target.id),console.log("üö´ Event target tagName:",e.target.tagName),console.log("üö´ Global form submission intercepted:",e.target.id),console.log("üö´ Current menuPhotos length:",typeof k<"u"?k.length:"undefined"),!(!e.target||e.target.id!=="order-menu-form")&&e.target.id==="order-menu-form"){e.preventDefault(),e.stopPropagation(),console.log("üîç Validating order-menu-form submission..."),console.log("üîç menuPhotos variable:",k),console.log("üîç menuPhotos type:",typeof k),console.log("üîç menuPhotos length:",k?k.length:"undefined");const o=document.getElementById("menu-photos-upload"),t=k&&k.length>0||o&&o.files&&o.files.length>0;if(console.log("üîç menuPhotos array length:",k?k.length:"undefined"),console.log("üîç menuPhotosInput files length:",o?o.files.length:"undefined"),console.log("üîç hasMenuPhotos:",t),!t){console.log("‚ùå Menu photos validation failed - no photos uploaded");const r=document.getElementById("menu-photos-error");r&&(r.classList.remove("hidden"),r.innerHTML='<div class="bg-red-50 border border-red-200 rounded-lg p-3"><p class="text-red-700 font-medium">Please upload at least one menu photo. This field is required for Order Menu System.</p></div>');const n=document.getElementById("validation-errors");n&&(n.classList.remove("hidden"),n.innerHTML='<div class="bg-red-50 border border-red-200 rounded-lg p-4"><h4 class="text-red-800 font-semibold mb-2">Please fix the following errors:</h4><ul class="list-disc list-inside text-red-700 space-y-1"><li>Please upload at least one menu photo. This field is required for Order Menu System.</li></ul></div>');const a=document.getElementById("menu-photos-upload-area");return a&&a.scrollIntoView({behavior:"smooth",block:"center"}),!1}console.log("üîç Running form field validation...");const l=K();if(console.log("üîç Form validation result:",l),!l)return console.log("‚ùå Form validation failed - required fields missing"),!1;console.log("‚úÖ All validations passed, proceeding with form submission"),Z()}});document.addEventListener("click",e=>{!e.target||!(e.target.type==="submit"||e.target.getAttribute("type")==="submit")||e.target.form&&e.target.form.id==="order-menu-form"&&console.log("üö´ Order menu form submit button clicked - letting submit event handle it")});document.addEventListener("DOMContentLoaded",()=>{console.log("üîß Setting up global event listeners for order menu form buttons");const e=document.getElementById("proceed-to-oms-form");e?(console.log("‚úÖ Proceed to OMS form button found, adding event listener"),e.addEventListener("click",l=>{l.preventDefault(),console.log("üöÄ Proceed to OMS form button clicked!");const r=document.getElementById("order-menu-price-page");r&&(r.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",r.style.opacity="0",r.style.transform="translateY(-10px)",setTimeout(()=>{r.classList.add("hidden")},300)),setTimeout(()=>{const n=document.getElementById("order-menu-customization-form");n&&(n.classList.remove("hidden"),n.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",n.style.opacity="0",n.style.transform="translateY(10px)",setTimeout(()=>{n.style.opacity="1",n.style.transform="translateY(0)",window.reinitializePincodeAutocomplete&&window.reinitializePincodeAutocomplete()},50))},300)})):console.log("‚ùå Proceed to OMS form button not found");const o=document.getElementById("close-order-menu-form");o?(console.log("‚úÖ Global close button found, adding event listener"),o.addEventListener("click",l=>{console.log("üöÄ Global close button clicked!"),l.preventDefault(),l.stopPropagation();const r=document.getElementById("order-menu-customization-form");r&&r.classList.add("hidden"),window.history.replaceState({},document.title,window.location.pathname),Y=!0,q(),J()})):console.log("‚ùå Global close button not found");const t=document.getElementById("cancel-order-menu");t?(console.log("‚úÖ Global cancel button found, adding event listener"),t.addEventListener("click",l=>{console.log("üöÄ Global cancel button clicked!"),l.preventDefault(),l.stopPropagation();const r=document.getElementById("order-menu-customization-form");r&&r.classList.add("hidden"),window.history.replaceState({},document.title,window.location.pathname),Y=!0,q(),J()})):console.log("‚ùå Global cancel button not found")});async function $(){console.log("üîÑ Attempting to auto-fill user details...");const e=async()=>{const o=window.globalAuthManager||window.simpleAuthManager;if(!o||!o.isUserLoggedIn())return console.log("‚ùå User not logged in - skipping auto-fill"),!1;let t=o.getCurrentUser();console.log("üë§ Current user from auth manager:",t);try{const r=sessionStorage.getItem("simple-auth-session");if(r){const n=JSON.parse(r);n.user&&n.user.email&&(t={...t,...n.user,full_name:n.user.full_name||t?.full_name,phone:n.user.phone||t?.phone,company_name:n.user.company_name||t?.company_name},console.log("‚úÖ Using updated user data from sessionStorage:",t))}}catch(r){console.warn("‚ö†Ô∏è Could not read sessionStorage:",r)}if(!t||!t.email)return console.log("‚ùå No valid user data found - skipping auto-fill"),!1;if(!t.id&&!t.user_id)return console.log("‚ùå User lacks proper authentication ID - skipping auto-fill"),!1;console.log("‚úÖ User is properly authenticated - proceeding with auto-fill"),t&&t.email&&(console.log("üìß Auto-filling email:",t.email),document.querySelectorAll('input[name="email"], input[type="email"]').forEach(n=>{n.value=t.email,n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0})),console.log("‚úÖ Filled email field:",n)}));const l=t?t.phone||t.phone_number||t?.user_metadata?.phone||t?.user_metadata?.phone_number:null;if(l){console.log("üì± Auto-filling phone from auth manager:",l);const r=document.getElementById("phone-input")||document.getElementById("phone")||document.querySelector('input[name="phone"]'),n=document.getElementById("phone_country_code");if(r&&n){const a=l.toString().trim();if(console.log("üì± Processing phone value from auth:",a),a.startsWith("+")){const u=["+971","+966","+91","+86","+81","+61","+49","+44","+33","+1"];let p="",m="";for(const s of u)if(a.startsWith(s)){p=s,m=a.substring(s.length).replace(/\D/g,"");break}if(!p){const s=a.match(/^(\+\d{1,4})(\d+)$/);s&&(p=s[1],m=s[2])}p&&m?Array.from(n.options).some(i=>i.value===p)?(n.value=p,r.value=m,console.log("‚úÖ Filled phone from auth: country code =",p,", number =",m)):(n.value="+91",r.value=m,console.log("‚úÖ Filled phone from auth with default country code +91, number =",m)):(r.value=a.replace(/\D/g,""),n.value="+91",console.log("‚ö†Ô∏è Could not parse phone from auth, using all digits"))}else r.value=a.replace(/\D/g,""),n.value="+91",console.log("‚úÖ Filled phone number from auth without country code");r.dispatchEvent(new Event("input",{bubbles:!0})),r.dispatchEvent(new Event("change",{bubbles:!0})),console.log("‚úÖ Successfully filled phone from auth manager")}else console.warn("‚ö†Ô∏è Phone input or country code select not found, using fallback"),document.querySelectorAll('input[name="phone"], input[type="tel"]').forEach(u=>{u.value=l.toString().replace(/\D/g,""),u.dispatchEvent(new Event("input",{bubbles:!0})),u.dispatchEvent(new Event("change",{bubbles:!0})),console.log("‚úÖ Filled phone field (fallback):",u)})}t&&t.full_name&&(console.log("üë§ Auto-filling contact person:",t.full_name),document.querySelectorAll('input[name="contactPerson"]').forEach(n=>{n.value=t.full_name,n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0})),console.log("‚úÖ Filled contact person field:",n)}));try{const{supabase:r}=await G(async()=>{const{supabase:a}=await import("./supabase.DeXTyW8I.js");return{supabase:a}},__vite__mapDeps([0,1,2])),{data:{user:n}}=await r.auth.getUser();if(n){console.log("üîç Attempting to fetch user profile from Supabase...");const{data:a,error:u}=await r.from("profiles").select("email, phone, phone_number, full_name, company_name").eq("id",n.id).single();if(u)return console.log("‚ö†Ô∏è Profile fetch failed (this is normal if profiles table doesn't exist):",u.message),!0;if(a){console.log("‚úÖ Profile data found:",a),a.email&&document.querySelectorAll('input[name="email"], input[type="email"]').forEach(m=>{m.value=a.email,m.dispatchEvent(new Event("input",{bubbles:!0})),m.dispatchEvent(new Event("change",{bubbles:!0}))});const p=a.phone||a.phone_number;console.log("üì± Profile phone value:",p),p?setTimeout(()=>{const m=document.getElementById("phone-input")||document.getElementById("phone")||document.querySelector('input[name="phone"]'),s=document.getElementById("phone_country_code");if(m&&s){const i=p.toString().trim();if(console.log("üì± Processing phone value:",i),i.startsWith("+")){const d=["+971","+966","+91","+86","+81","+61","+49","+44","+33","+1"];let g="",y="";for(const E of d)if(i.startsWith(E)){g=E,y=i.substring(E.length).replace(/\D/g,"");break}if(!g){const E=i.match(/^(\+\d{1,4})(\d+)$/);E&&(g=E[1],y=E[2])}g&&y?Array.from(s.options).some(S=>S.value===g)?(s.value=g,m.value=y,console.log("‚úÖ Filled phone: country code =",g,", number =",y)):(s.value="+91",m.value=y,console.log("‚úÖ Filled phone with default country code +91, number =",y)):(m.value=i.replace(/\D/g,""),s.value="+91",console.log("‚ö†Ô∏è Could not parse phone, using all digits"))}else m.value=i.replace(/\D/g,""),s.value="+91",console.log("‚úÖ Filled phone number without country code");m.dispatchEvent(new Event("input",{bubbles:!0})),m.dispatchEvent(new Event("change",{bubbles:!0})),console.log("‚úÖ Successfully filled phone from profile")}else console.warn("‚ö†Ô∏è Phone input or country code select not found"),document.querySelectorAll('input[name="phone"], input[type="tel"]').forEach(i=>{i.value=p.toString().replace(/\D/g,""),i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0}))})},100):console.log("‚ö†Ô∏è No phone number found in profile"),a.full_name&&document.querySelectorAll('input[name="contactPerson"]').forEach(m=>{m.value=a.full_name,m.dispatchEvent(new Event("input",{bubbles:!0})),m.dispatchEvent(new Event("change",{bubbles:!0}))})}}}catch(r){console.log("‚ö†Ô∏è Profile fetch error (this is normal):",r.message)}return console.log("‚úÖ Auto-fill completed with auth manager data"),!0};if(!await e()){let o=0;const t=50,l=setInterval(()=>{o++,e().then(r=>{if((r||o>=t)&&(clearInterval(l),o>=t)){console.log("‚è∞ Auth manager timeout - user appears to be not logged in"),console.log("‚ùå No authenticated user found - forms will remain empty");return}})},100)}}let Y=!1;async function oe(){const e=document.getElementById("activity-content");e&&(e.innerHTML=`
      <div class="text-center py-6">
        <p class="text-gray-800 text-base font-medium">Get started with your first order</p>
        <p class="text-gray-500 text-sm mt-1">Choose a product, submit your requirements, and track it in My Orders.</p>
        <div class="mt-4 flex items-center justify-center gap-3">
          <a href="/products" class="inline-flex items-center px-5 py-2.5 rounded-md bg-primary-600 text-white hover:bg-primary-700 transition-colors">Browse Products</a>
        </div>
      </div>
    `)}function J(){const e=document.getElementById("activity-content"),o=document.getElementById("recent-activity");o&&(o.classList.remove("hidden"),o.style.display="block"),e&&(e.innerHTML=`
      <div class="text-center py-6">
        <p class="text-gray-800 text-base font-medium">Get started with your first order</p>
        <p class="text-gray-500 text-sm mt-1">Choose a product, submit your requirements, and track it in My Orders.</p>
        <div class="mt-4 flex items-center justify-center gap-3">
          <a href="/products" class="inline-flex items-center px-5 py-2.5 rounded-md bg-primary-600 text-white hover:bg-primary-700 transition-colors">Browse Products</a>
        </div>
      </div>
    `)}window.viewOrderDetails=async function(e){console.log("üîÑ Loading order details for:",e);try{const{supabase:o}=await G(async()=>{const{supabase:n}=await import("./supabase.DeXTyW8I.js");return{supabase:n}},__vite__mapDeps([0,1,2])),{data:t,error:l}=await o.from("order_customizations").select("*").eq("id",e).single();if(l){console.error("Error loading customization details:",l),alert("Error loading order details: "+l.message);return}const r=`
Order Menu System Details:
=========================

Project Information:
-------------------
Project Name: ${t.project_name||"Not provided"}
Restaurant Name: ${t.restaurant_name||"Not provided"}
Owner Name: ${t.owner_name||"Not provided"}
Contact Person: ${t.contact_person||"Not provided"}

Contact Information:
-------------------
Email: ${t.email||"Not provided"}
Phone: ${t.phone_number||"Not provided"}

Address Information:
------------------
House/Flat Number: ${t.house_flat_number||"Not provided"}
Address: ${t.address_line_1||"Not provided"}
City: ${t.city||"Not provided"}
State: ${t.state||"Not provided"}
Pincode: ${t.pincode||"Not provided"}
Country: ${t.country||"Not provided"}

Additional Requirements:
-----------------------
${t.additional_requirements||"No additional requirements provided"}

Order Details:
-------------
Price: ‚Çπ${(t.total_amount||0).toLocaleString("en-IN")}
Submitted: ${new Date(t.created_at).toLocaleString()}
Status: Submitted
      `;alert(r)}catch(o){console.error("Error viewing order details:",o),alert("Error viewing order details: "+o.message)}};window.openImageModal=function(e,o){console.log("Opening image modal for:",o),document.body.style.overflow="hidden";const t=document.createElement("div");t.className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",t.innerHTML=`
      <div class="relative max-w-4xl max-h-full p-4">
        <button onclick="closeImageModal()" class="absolute top-2 right-2 z-10 bg-white bg-opacity-80 hover:bg-opacity-100 rounded-full p-2 transition-all">
          <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
        <img 
          src="${e}" 
          alt="${o}"
          class="max-w-full max-h-full object-contain rounded-lg shadow-2xl"
          onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDQwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yMDAgMTIwTDI0MCAxNjBIMTYwTDIwMCAxMjBaIiBmaWxsPSIjOUNBM0FGIi8+CjxjaXJjbGUgY3g9IjIwMCIgY3k9IjIwMCIgcj0iMjAiIGZpbGw9IiM5Q0EzQUYiLz4KPHRleHQgeD0iMjAwIiB5PSIyNDAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNiIgZm9udC13ZWlnaHQ9ImJvbGQiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiM2QjcyODAiPkltYWdlIFVuYXZhaWxhYmxlPC90ZXh0Pgo8L3N2Zz4K'"
        />
        <div class="absolute bottom-4 left-4 right-4 bg-black bg-opacity-50 text-white p-3 rounded-lg">
          <p class="text-sm font-medium">${o}</p>
        </div>
      </div>
    `,t.addEventListener("click",function(r){r.target===t&&closeImageModal()});const l=function(r){r.key==="Escape"&&(closeImageModal(),document.removeEventListener("keydown",l))};document.addEventListener("keydown",l),document.body.appendChild(t),window.currentImageModal=t};window.closeImageModal=function(){window.currentImageModal&&(document.body.removeChild(window.currentImageModal),window.currentImageModal=null,document.body.style.overflow="")};window.testFileUpload=async function(){console.log("üß™ Testing file upload...");const e=document.getElementById("menu-photos-upload");if(console.log("üì∏ File input element:",e),console.log("üì∏ Files in input:",e?e.files:"no input"),e&&e.files&&e.files.length>0){const o=e.files[0];console.log("üì∏ Testing with file:",o.name,o.size,o.type);try{const{supabase:t}=await G(async()=>{const{supabase:u}=await import("./supabase.DeXTyW8I.js");return{supabase:u}},__vite__mapDeps([0,1,2]));console.log("üì∏ Supabase client loaded");const l=await o.arrayBuffer();console.log("üì∏ File converted to buffer:",l.byteLength,"bytes");const n=`menu_photos/test_${Date.now()}_${o.name}`;console.log("üì∏ Upload path:",n);const{error:a}=await t.storage.from("menu-photos").upload(n,l,{upsert:!0,contentType:o.type});if(a)console.error("‚ùå Upload failed:",a);else{const{data:u}=t.storage.from("menu-photos").getPublicUrl(n);console.log("‚úÖ Upload successful:",u.publicUrl),console.log("üéØ Check your Supabase Storage menu-photos bucket!")}}catch(t){console.error("‚ùå Test failed:",t)}}else console.log("‚ùå No files selected")};document.addEventListener("DOMContentLoaded",()=>{console.log("Dashboard DOM loaded - initializing with global auth manager");const e=new URLSearchParams(window.location.search),o=e.has("product")&&e.has("price");window.location.search&&!o&&window.history.replaceState({},document.title,window.location.pathname);const t=new URLSearchParams(window.location.search),l=t.get("product"),r=t.get("price"),n=document.getElementById("recent-activity");if(!l||!r){n&&(n.style.display="block",n.classList.remove("hidden"),console.log("‚úÖ Showing browse products section - no product selected"),oe());const m=document.getElementById("product-customization-form"),s=document.getElementById("order-menu-customization-form");m&&m.classList.add("hidden"),s&&s.classList.add("hidden")}else n&&(n.style.display="none",n.classList.add("hidden"),console.log("‚úÖ Hiding browse products section - product selected"));if(document.body.style.opacity="1",l&&r){console.log("URL parameters detected - showing form for product:",l);const s=[{id:"1",name:"Restaurant Menu System",description:"Digital menu system with QR code integration, online ordering, and real-time updates. Perfect for restaurants looking to modernize their customer experience.",price:25e3,type:"restaurant"},{id:"2",name:"Android TV App",description:"Custom Android TV applications with beautiful UI, content management, and remote control support. Perfect for streaming services and media companies.",price:55e3,type:"non-restaurant"},{id:"3",name:"Streaming Mobile App",description:"Mobile streaming applications for iOS and Android with custom features, user authentication, and content management.",price:35e3,type:"non-restaurant"},{id:"4",name:"Restaurant Website",description:"Professional restaurant website with online ordering, menu display, and customer management features.",price:2e4,type:"restaurant"},{id:"5",name:"Order Menu System",description:"Complete order management system with digital menu integration, real-time order tracking, and payment processing. Perfect for restaurants looking to streamline their ordering process.",price:999,type:"order-menu"}].find(i=>i.id===l);if(s){document.getElementById("selected-product-name").textContent=s.name,document.getElementById("selected-product-price").textContent=`‚Çπ${s.price.toLocaleString()}`,document.getElementById("order-menu-product-name").textContent=s.name;const i=document.getElementById("recent-activity"),d=document.getElementById("product-customization-form"),g=document.getElementById("order-menu-customization-form");i&&(i.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",i.style.opacity="0",i.style.transform="translateY(-10px)",setTimeout(()=>{i.classList.add("hidden")},300)),setTimeout(()=>{if(s.type==="order-menu")g&&(g.classList.remove("hidden"),g.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",g.style.opacity="0",g.style.transform="translateY(10px)",setTimeout(()=>{g.style.opacity="1",g.style.transform="translateY(0)"},50));else{d&&(d.classList.remove("hidden"),d.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",d.style.opacity="0",d.style.transform="translateY(10px)",setTimeout(()=>{d.style.opacity="1",d.style.transform="translateY(0)"},50));const y=document.getElementById("cuisine-type-field"),E=document.getElementById("restaurant-name-field");s.type==="restaurant"?(y.classList.remove("hidden"),y.querySelector("select").setAttribute("required","required"),E.classList.remove("hidden"),E.querySelector("input").setAttribute("required","required")):(y.classList.add("hidden"),y.querySelector("select").removeAttribute("required"),E.classList.add("hidden"),E.querySelector("input").removeAttribute("required"))}},300),setTimeout(()=>$(),500)}}he(),Ee(),we(),$(),setTimeout(()=>$(),1e3),setTimeout(()=>$(),2e3);const a=new MutationObserver(m=>{m.forEach(s=>{if(s.type==="attributes"&&s.attributeName==="class"){const i=s.target;(i.id==="product-customization-form"||i.id==="order-menu-customization-form")&&(i.classList.contains("hidden")||(console.log("üëÅÔ∏è Form became visible, auto-filling..."),setTimeout(()=>$(),100)))}})}),u=document.getElementById("product-customization-form"),p=document.getElementById("order-menu-customization-form");u&&a.observe(u,{attributes:!0,attributeFilter:["class"]}),p&&a.observe(p,{attributes:!0,attributeFilter:["class"]}),O(),setTimeout(()=>O(),100),setTimeout(()=>O(),500),setTimeout(()=>O(),1e3),setTimeout(()=>O(),2e3),setTimeout(()=>{const m=new URLSearchParams(window.location.search),s=m.get("product"),i=m.get("price"),d=document.getElementById("recent-activity");!s||!i?d&&(d.style.display="block",d.classList.remove("hidden"),console.log("‚úÖ Browse products section confirmed visible - no product selected")):d&&(d.style.display="none",console.log("‚úÖ Browse products section confirmed hidden - product selected"))},1e3)});window.addEventListener("load",()=>{console.log("Window loaded - trying again"),O()});let te=0;const Ie=5,Se=setInterval(()=>{te++,console.log(`Attempt ${te} to load user data...`),O(),te>=Ie&&(clearInterval(Se),console.log("Max attempts reached"))},2e3);window.addEventListener("user-logged-in",()=>{console.log("User logged in event received in dashboard"),O(),setTimeout(()=>oe(),100)});window.addEventListener("user-logged-out",()=>{console.log("User logged out event received in dashboard"),O(),setTimeout(()=>oe(),100)});console.log("‚úÖ Dashboard script initialized with global auth manager");const Q={400001:{city:"Mumbai",state:"Maharashtra"},400002:{city:"Mumbai",state:"Maharashtra"},400003:{city:"Mumbai",state:"Maharashtra"},400004:{city:"Mumbai",state:"Maharashtra"},400005:{city:"Mumbai",state:"Maharashtra"},400006:{city:"Mumbai",state:"Maharashtra"},400007:{city:"Mumbai",state:"Maharashtra"},400008:{city:"Mumbai",state:"Maharashtra"},400009:{city:"Mumbai",state:"Maharashtra"},400010:{city:"Mumbai",state:"Maharashtra"},110001:{city:"New Delhi",state:"Delhi"},110002:{city:"New Delhi",state:"Delhi"},110003:{city:"New Delhi",state:"Delhi"},110004:{city:"New Delhi",state:"Delhi"},110005:{city:"New Delhi",state:"Delhi"},110006:{city:"New Delhi",state:"Delhi"},110007:{city:"New Delhi",state:"Delhi"},110008:{city:"New Delhi",state:"Delhi"},110009:{city:"New Delhi",state:"Delhi"},110010:{city:"New Delhi",state:"Delhi"},560001:{city:"Bangalore",state:"Karnataka"},560002:{city:"Bangalore",state:"Karnataka"},560003:{city:"Bangalore",state:"Karnataka"},560004:{city:"Bangalore",state:"Karnataka"},560005:{city:"Bangalore",state:"Karnataka"},560006:{city:"Bangalore",state:"Karnataka"},560007:{city:"Bangalore",state:"Karnataka"},560008:{city:"Bangalore",state:"Karnataka"},560009:{city:"Bangalore",state:"Karnataka"},560010:{city:"Bangalore",state:"Karnataka"},600001:{city:"Chennai",state:"Tamil Nadu"},600002:{city:"Chennai",state:"Tamil Nadu"},600003:{city:"Chennai",state:"Tamil Nadu"},600004:{city:"Chennai",state:"Tamil Nadu"},600005:{city:"Chennai",state:"Tamil Nadu"},600006:{city:"Chennai",state:"Tamil Nadu"},600007:{city:"Chennai",state:"Tamil Nadu"},600008:{city:"Chennai",state:"Tamil Nadu"},600009:{city:"Chennai",state:"Tamil Nadu"},600010:{city:"Chennai",state:"Tamil Nadu"},700001:{city:"Kolkata",state:"West Bengal"},700002:{city:"Kolkata",state:"West Bengal"},700003:{city:"Kolkata",state:"West Bengal"},700004:{city:"Kolkata",state:"West Bengal"},700005:{city:"Kolkata",state:"West Bengal"},700006:{city:"Kolkata",state:"West Bengal"},700007:{city:"Kolkata",state:"West Bengal"},700008:{city:"Kolkata",state:"West Bengal"},700009:{city:"Kolkata",state:"West Bengal"},700010:{city:"Kolkata",state:"West Bengal"},380001:{city:"Ahmedabad",state:"Gujarat"},380002:{city:"Ahmedabad",state:"Gujarat"},380003:{city:"Ahmedabad",state:"Gujarat"},380004:{city:"Ahmedabad",state:"Gujarat"},380005:{city:"Ahmedabad",state:"Gujarat"},380006:{city:"Ahmedabad",state:"Gujarat"},380007:{city:"Ahmedabad",state:"Gujarat"},380008:{city:"Ahmedabad",state:"Gujarat"},380009:{city:"Ahmedabad",state:"Gujarat"},380010:{city:"Ahmedabad",state:"Gujarat"},411001:{city:"Pune",state:"Maharashtra"},411002:{city:"Pune",state:"Maharashtra"},411003:{city:"Pune",state:"Maharashtra"},411004:{city:"Pune",state:"Maharashtra"},411005:{city:"Pune",state:"Maharashtra"},411006:{city:"Pune",state:"Maharashtra"},411007:{city:"Pune",state:"Maharashtra"},411008:{city:"Pune",state:"Maharashtra"},411009:{city:"Pune",state:"Maharashtra"},411010:{city:"Pune",state:"Maharashtra"},302001:{city:"Jaipur",state:"Rajasthan"},302002:{city:"Jaipur",state:"Rajasthan"},302003:{city:"Jaipur",state:"Rajasthan"},302004:{city:"Jaipur",state:"Rajasthan"},302005:{city:"Jaipur",state:"Rajasthan"},302006:{city:"Jaipur",state:"Rajasthan"},302007:{city:"Jaipur",state:"Rajasthan"},302008:{city:"Jaipur",state:"Rajasthan"},302009:{city:"Jaipur",state:"Rajasthan"},302010:{city:"Jaipur",state:"Rajasthan"},641001:{city:"Coimbatore",state:"Tamil Nadu"},641002:{city:"Coimbatore",state:"Tamil Nadu"},641003:{city:"Coimbatore",state:"Tamil Nadu"},641004:{city:"Coimbatore",state:"Tamil Nadu"},641005:{city:"Coimbatore",state:"Tamil Nadu"},625001:{city:"Madurai",state:"Tamil Nadu"},625002:{city:"Madurai",state:"Tamil Nadu"},625003:{city:"Madurai",state:"Tamil Nadu"},625004:{city:"Madurai",state:"Tamil Nadu"},625005:{city:"Madurai",state:"Tamil Nadu"},570001:{city:"Mysore",state:"Karnataka"},570002:{city:"Mysore",state:"Karnataka"},570003:{city:"Mysore",state:"Karnataka"},570004:{city:"Mysore",state:"Karnataka"},570005:{city:"Mysore",state:"Karnataka"},580001:{city:"Hubli",state:"Karnataka"},580002:{city:"Hubli",state:"Karnataka"},580003:{city:"Hubli",state:"Karnataka"},580004:{city:"Hubli",state:"Karnataka"},580005:{city:"Hubli",state:"Karnataka"},500001:{city:"Hyderabad",state:"Telangana"},500002:{city:"Hyderabad",state:"Telangana"},500003:{city:"Hyderabad",state:"Telangana"},500004:{city:"Hyderabad",state:"Telangana"},500005:{city:"Hyderabad",state:"Telangana"},500006:{city:"Hyderabad",state:"Telangana"},500007:{city:"Hyderabad",state:"Telangana"},500008:{city:"Hyderabad",state:"Telangana"},500009:{city:"Hyderabad",state:"Telangana"},500010:{city:"Hyderabad",state:"Telangana"},110001:{city:"Delhi",state:"Delhi"},110002:{city:"Delhi",state:"Delhi"},110003:{city:"Delhi",state:"Delhi"},110004:{city:"Delhi",state:"Delhi"},110005:{city:"Delhi",state:"Delhi"},110006:{city:"Delhi",state:"Delhi"},110007:{city:"Delhi",state:"Delhi"},110008:{city:"Delhi",state:"Delhi"},110009:{city:"Delhi",state:"Delhi"},110010:{city:"Delhi",state:"Delhi"},560001:{city:"Bangalore",state:"Karnataka"},560002:{city:"Bangalore",state:"Karnataka"},560003:{city:"Bangalore",state:"Karnataka"},560004:{city:"Bangalore",state:"Karnataka"},560005:{city:"Bangalore",state:"Karnataka"},560006:{city:"Bangalore",state:"Karnataka"},560007:{city:"Bangalore",state:"Karnataka"},560008:{city:"Bangalore",state:"Karnataka"},560009:{city:"Bangalore",state:"Karnataka"},560010:{city:"Bangalore",state:"Karnataka"},600001:{city:"Chennai",state:"Tamil Nadu"},600002:{city:"Chennai",state:"Tamil Nadu"},600003:{city:"Chennai",state:"Tamil Nadu"},600004:{city:"Chennai",state:"Tamil Nadu"},600005:{city:"Chennai",state:"Tamil Nadu"},600006:{city:"Chennai",state:"Tamil Nadu"},600007:{city:"Chennai",state:"Tamil Nadu"},600008:{city:"Chennai",state:"Tamil Nadu"},600009:{city:"Chennai",state:"Tamil Nadu"},600010:{city:"Chennai",state:"Tamil Nadu"},700001:{city:"Kolkata",state:"West Bengal"},700002:{city:"Kolkata",state:"West Bengal"},700003:{city:"Kolkata",state:"West Bengal"},700004:{city:"Kolkata",state:"West Bengal"},700005:{city:"Kolkata",state:"West Bengal"},700006:{city:"Kolkata",state:"West Bengal"},700007:{city:"Kolkata",state:"West Bengal"},700008:{city:"Kolkata",state:"West Bengal"},700009:{city:"Kolkata",state:"West Bengal"},700010:{city:"Kolkata",state:"West Bengal"}};function H(){const e=document.getElementById("pincode-input"),o=document.getElementById("city-input"),t=document.getElementById("state-input"),l=document.getElementById("city-suggestions"),r=document.getElementById("state-suggestions");e&&o&&t&&(console.log("Initializing pincode autocomplete..."),e.addEventListener("input",function(){const n=this.value.trim();if(console.log("Pincode entered:",n),n.length===6&&Q[n]){console.log("Found pincode data:",Q[n]),o.value=Q[n].city,t.value=Q[n].state;const a=document.getElementById("country-select");a&&(a.value="India")}}),o.addEventListener("input",function(){const n=this.value.toLowerCase();if(n.length>0){const a=le.filter(u=>u.toLowerCase().includes(n));re(l,a,o)}else W(l)}),t.addEventListener("input",function(){const n=this.value.toLowerCase();if(n.length>0){const a=X.filter(u=>u.toLowerCase().includes(n));re(r,a,t)}else W(r)}),document.addEventListener("click",function(n){!o.contains(n.target)&&!l.contains(n.target)&&W(l),!t.contains(n.target)&&!r.contains(n.target)&&W(r)}))}document.addEventListener("DOMContentLoaded",function(){H(),setTimeout(H,500),setTimeout(H,1e3),setTimeout(H,2e3)});setTimeout(H,3e3);setTimeout(H,5e3);function ke(){console.log("Reinitializing pincode autocomplete..."),H()}window.reinitializePincodeAutocomplete=ke;document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("test-save");e&&e.addEventListener("click",async function(){console.log("üß™ Test save button clicked!");const a=document.getElementById("requirements-form");if(a){const u=new FormData(a),p=Object.fromEntries(u);console.log("üß™ Test save - Form data:",p),await Le(p)}else console.error("‚ùå Form not found for test save")});const o=document.getElementById("simple-test");o&&o.addEventListener("click",async function(){console.log("üîµ Simple test button clicked!"),alert("üîµ Simple test button works!");const a={project_name:"Simple Test Project",restaurant_name:"Simple Test Restaurant",owner_name:"Simple Test Owner",contact_person:"Simple Test Contact",email:"test@example.com",phone_number:"1234567890",house_flat_number:"123",address_line_1:"Test Address",city:"Test City",state:"Test State",pincode:"123456",country:"India",restaurant_logo_url:null,menu_photos_urls:[],additional_requirements:"Simple test requirements",base_package_cost:999,gst_amount:180,total_amount:1179,status:"pending",payment_status:"pending"};console.log("üîµ Simple test data:",a);try{const{data:u,error:p}=await window.supabase.from("order_customizations").insert(a).select();p?(console.error("‚ùå Simple test failed:",p),alert("‚ùå Simple test failed: "+p.message)):(console.log("‚úÖ Simple test successful!",u),alert("‚úÖ Simple test successful! Data saved to database."))}catch(u){console.error("‚ùå Simple test error:",u),alert("‚ùå Simple test error: "+u.message)}});function t(){const a=document.getElementById("requirements-form");return console.log("üîç Form found:",!!a),console.log("üîç Form element:",a),a?(console.log("‚úÖ Form found, adding event listener..."),a.addEventListener("submit",async function(u){u.preventDefault(),console.log("üöÄ FORCE FORM SUBMISSION TRIGGERED!"),alert("üöÄ Form submission detected!");const p=new FormData(a),m=Object.fromEntries(p);console.log("üöÄ Form data collected:",m);try{const s={project_name:m.projectName||"Manual Test Project",restaurant_name:m.restaurantName||"Manual Test Restaurant",owner_name:m.ownerName||"Manual Test Owner",contact_person:m.contactPerson||"Manual Test Contact",email:m.email||"manual@test.com",phone_number:m.phone||"1234567890",house_flat_number:m.houseNumber||"123",address_line_1:m.addressLine1||"Manual Test Address",city:m.city||"Manual Test City",state:m.state||"Manual Test State",pincode:m.pincode||"123456",country:m.country||"India",restaurant_logo_url:null,menu_photos_urls:[],additional_requirements:m.additionalRequirements||"Manual test requirements",base_package_cost:999,gst_amount:180,total_amount:1179,status:"pending",payment_status:"pending"};console.log("üöÄ Insert data prepared:",s);const{data:i,error:d}=await window.supabase.from("order_customizations").insert(s).select();d?(console.error("‚ùå Force save failed:",d),alert("‚ùå Save failed: "+d.message)):(console.log("‚úÖ Force save successful!",i),alert("‚úÖ Data saved successfully to order_customizations table!"))}catch(s){console.error("‚ùå Force save error:",s),alert("‚ùå Save error: "+s.message)}}),!0):(console.log("‚è≥ Form not found yet, will retry..."),!1)}t()||setTimeout(()=>{console.log("üîÑ Retrying form setup after 1 second..."),t()||setTimeout(()=>{console.log("üîÑ Retrying form setup after 3 seconds..."),t()||setTimeout(()=>{console.log("üîÑ Retrying form setup after 5 seconds..."),t()},5e3)},3e3)},1e3),document.addEventListener("submit",function(a){console.log("üåç Global form submission detected!"),console.log("üåç Form element:",a.target),console.log("üåç Form ID:",a.target.id),a.target.id==="requirements-form"&&(console.log("üåç Requirements form submitted globally!"),alert("üåç Global form submission detected!"))}),console.log("üîç Looking for save button...");const l=document.getElementById("order-menu-form");let r=null;if(l&&(console.log("üîç Order menu form found:",l),r=l.querySelector('button[type="submit"]'),console.log("üîç Save button in order menu form:",r)),!r){const a=document.querySelectorAll("button");console.log("üîç All buttons found:",a.length);for(let u of a)if(u.textContent.includes("Save and Make Payment")&&l&&l.contains(u)){r=u,console.log("üîç Found save button by text in order menu form:",r);break}}if(console.log("üîçüîçüîç SEARCHING FOR SAVE BUTTON üîçüîçüîç"),console.log("üîç Order menu form:",l),console.log("üîç Target button (initial):",r),r){console.log("‚úÖ‚úÖ‚úÖ SAVE BUTTON FOUND! ‚úÖ‚úÖ‚úÖ"),console.log("üî¥ Save button element:",r),console.log("üî¥ Save button ID:",r.id),console.log("üî¥ Save button classes:",r.className),console.log("üî¥ Save button text:",r.textContent),console.log("üî¥ Save button type:",r.type);let a=!1;console.log("üìå Attaching click event listener to save button..."),r.addEventListener("click",async function(u){if(console.log("üî¥üî¥üî¥ SAVE BUTTON CLICKED! üî¥üî¥üî¥"),console.log("üìç Button element:",r),console.log("üìç Button ID:",r.id),console.log("üìç Button type:",r.type),console.log("üìç Event:",u),console.log("üìç Timestamp:",new Date().toISOString()),u.preventDefault(),u.stopPropagation(),a){console.log("‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è Save already in progress, ignoring click ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è"),alert("‚ö†Ô∏è Save is already in progress. Please wait...");return}console.log("üîçüîçüîç RUNNING VALIDATION FIRST üîçüîçüîç");const p=K();if(console.log("üîç Validation result:",p),!p){console.log("‚ùå‚ùå‚ùå Validation failed, preventing save ‚ùå‚ùå‚ùå"),alert("‚ùå Please fill in all required fields before saving.");return}console.log("‚úÖ Setting isSaving flag to true"),a=!0,r.disabled=!0;const m=r.innerHTML;r.innerHTML=`
          <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12a8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <span>Saving...</span>
        `;try{console.log("‚úÖ‚úÖ‚úÖ VALIDATION PASSED, CALLING handleOrderMenuFormSubmission() ‚úÖ‚úÖ‚úÖ"),console.log("üïê Save operation started at:",new Date().toISOString());const s=Date.now();let i=null,d=null;i=setTimeout(()=>{console.warn("‚ö†Ô∏è Save operation is taking longer than expected. Please wait...");const g=Math.round((Date.now()-s)/1e3);console.warn(`‚ö†Ô∏è Elapsed time: ${g} seconds`)},3e4);try{await Z(),i&&clearTimeout(i);const g=Math.round((Date.now()-s)/1e3);console.log("‚úÖ‚úÖ‚úÖ handleOrderMenuFormSubmission() COMPLETED ‚úÖ‚úÖ‚úÖ"),console.log("‚úÖ‚úÖ‚úÖ DATA SUCCESSFULLY SAVED TO SUPABASE ‚úÖ‚úÖ‚úÖ"),console.log(`üïê Save operation completed in ${g} seconds`),console.log("üïê Save operation completed at:",new Date().toISOString());try{document.getElementById("order-menu-form")?.reset()}catch{}try{document.getElementById("customization-form")?.reset()}catch{}ae(),console.log("‚úÖ Button will be reset in finally block")}catch(g){i&&clearTimeout(i);const y=Math.round((Date.now()-s)/1e3);throw console.error("‚ùå Save operation error:",g),console.error(`üïê Save operation failed after ${y} seconds`),g}}catch(s){console.error("‚ùå‚ùå‚ùå SAVE BUTTON ERROR ‚ùå‚ùå‚ùå"),console.error("üïê Error occurred at:",new Date().toISOString()),console.error("‚ùå Error object:",s),console.error("‚ùå Error message:",s?.message||"Unknown error"),console.error("‚ùå Error stack:",s?.stack);const i=s?.message||"An error occurred while saving. Please try again.",d=document.getElementById("validation-errors");if(d){d.classList.remove("hidden");const g=i.replace(/"/g,"&quot;").replace(/'/g,"&#39;");d.innerHTML=`
              <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                <h4 class="text-red-800 font-semibold mb-2">‚ùå Error Saving Order</h4>
                <p class="text-red-700">${g}</p>
                <p class="text-red-600 text-sm mt-2">Please check the console for more details and try again.</p>
              </div>
            `}}finally{console.log("üîÑ Resetting isSaving flag to false"),a=!1;try{r?(r.disabled=!1,r.innerHTML=m,console.log("‚úÖ Button state reset successfully")):console.error("‚ùå Target button not found during reset")}catch(s){console.error("‚ùå Error resetting button state:",s);try{const i=document.getElementById("save-and-pay");i&&(i.disabled=!1,i.textContent="Save and Make Payment",console.log("‚úÖ Button reset via fallback method"))}catch(i){console.error("‚ùå Fallback reset also failed:",i)}}}}),console.log("‚úÖ‚úÖ‚úÖ CLICK EVENT LISTENER ATTACHED SUCCESSFULLY ‚úÖ‚úÖ‚úÖ"),console.log("üß™ Testing button accessibility..."),console.log("üß™ Button is in DOM:",document.body.contains(r)),console.log("üß™ Button is visible:",r.offsetParent!==null),console.log("üß™ Button is enabled:",!r.disabled),window.testSaveButton=function(){console.log("üß™üß™üß™ MANUAL TEST: Triggering save button click üß™üß™üß™"),r.click()},console.log("üß™ Test function available: window.testSaveButton()")}else{console.error("‚ùå‚ùå‚ùå SAVE BUTTON NOT FOUND! ‚ùå‚ùå‚ùå"),console.error("‚ùå Attempting fallback search...");const a=document.getElementById("save-and-pay");if(console.log("üîç Fallback button search result:",a),a){console.log("‚úÖ‚úÖ‚úÖ FALLBACK BUTTON FOUND! ‚úÖ‚úÖ‚úÖ"),console.log("üî¥ Fallback button element:",a),console.log("üî¥ Fallback button ID:",a.id);let u=!1;console.log("üìå Attaching click event listener to fallback button..."),a.addEventListener("click",async p=>{if(console.log("üî¥üî¥üî¥ FALLBACK SAVE BUTTON CLICKED! üî¥üî¥üî¥"),p.preventDefault(),p.stopPropagation(),u){console.log("‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è Save already in progress, ignoring click ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è");return}if(console.log("üîç Running validation before fallback save button submission..."),!K()){console.log("‚ùå Validation failed, preventing save"),alert("‚ùå Please fill in all required fields before saving.");return}u=!0,a.disabled=!0;const s=a.innerHTML;a.innerHTML=`
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12a8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>Saving...</span>
          `;try{const i=Date.now();console.log("‚úÖ‚úÖ‚úÖ FALLBACK VALIDATION PASSED, CALLING handleOrderMenuFormSubmission() ‚úÖ‚úÖ‚úÖ"),console.log("üïê Fallback save operation started at:",new Date().toISOString());let d=null,g=null;d=setTimeout(()=>{console.warn("‚ö†Ô∏è Fallback save operation is taking longer than expected. Please wait...");const E=Math.round((Date.now()-i)/1e3);console.warn(`‚ö†Ô∏è Elapsed time: ${E} seconds`)},3e4),await Z(),d&&clearTimeout(d);const y=Math.round((Date.now()-i)/1e3);console.log("‚úÖ‚úÖ‚úÖ FALLBACK handleOrderMenuFormSubmission() COMPLETED ‚úÖ‚úÖ‚úÖ"),console.log(`üïê Fallback save operation completed in ${y} seconds`),console.log("üïê Fallback save operation completed at:",new Date().toISOString());try{document.getElementById("order-menu-form")?.reset()}catch{}try{document.getElementById("customization-form")?.reset()}catch{}ae()}catch(i){fallbackTimeoutWarning&&clearTimeout(fallbackTimeoutWarning),console.error("‚ùå‚ùå‚ùå FALLBACK SAVE BUTTON ERROR ‚ùå‚ùå‚ùå"),console.error("üïê Fallback error occurred at:",new Date().toISOString()),console.error("‚ùå Error object:",i),console.error("‚ùå Error message:",i?.message||"Unknown error"),console.error("‚ùå Error stack:",i?.stack);const d=document.getElementById("validation-errors");if(d){d.classList.remove("hidden");const g=(i?.message||"Unknown error").replace(/"/g,"&quot;").replace(/'/g,"&#39;");d.innerHTML=`
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                  <h4 class="text-red-800 font-semibold mb-2">‚ùå Error Saving Order</h4>
                  <p class="text-red-700">${g}</p>
                  <p class="text-red-600 text-sm mt-2">Please check the console for more details and try again.</p>
                </div>
              `}}finally{console.log("üîÑ Resetting fallback isSaving flag to false"),u=!1;try{a?(a.disabled=!1,a.innerHTML=s,console.log("‚úÖ Fallback button state reset successfully")):console.error("‚ùå Fallback button not found during reset")}catch(i){console.error("‚ùå Error resetting fallback button state:",i);try{const d=document.getElementById("save-and-pay");d&&(d.disabled=!1,d.textContent="Save and Make Payment",console.log("‚úÖ Fallback button reset via alternative method"))}catch(d){console.error("‚ùå Alternative fallback reset also failed:",d)}}}}),console.log("‚úÖ‚úÖ‚úÖ FALLBACK CLICK EVENT LISTENER ATTACHED SUCCESSFULLY ‚úÖ‚úÖ‚úÖ")}else console.error("‚ùå‚ùå‚ùå FALLBACK BUTTON ALSO NOT FOUND! ‚ùå‚ùå‚ùå"),console.error("‚ùå All save button search methods failed!"),alert("‚ùå Save button not found. Please refresh the page.")}const n=document.getElementById("direct-save");n&&n.addEventListener("click",async function(){if(console.log("üî¥ Direct save button clicked!"),console.log("üîç Running validation before direct save submission..."),!K()){console.log("‚ùå Validation failed, preventing direct save");return}try{await Z()}catch(u){console.error("‚ùå Direct save flow failed:",u),alert("‚ùå Direct save failed. See console.")}})});function re(e,o,t){if(o.length===0){W(e);return}e.innerHTML="",o.slice(0,5).forEach(l=>{const r=document.createElement("div");r.className="px-4 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-200",r.textContent=l,r.addEventListener("click",function(){t.value=l,W(e)}),e.appendChild(r)}),e.classList.remove("hidden"),e.style.position="absolute",e.style.zIndex="10",e.style.width=t.offsetWidth+"px",e.style.top=t.offsetTop+t.offsetHeight+"px",e.style.left=t.offsetLeft+"px"}function W(e){e.classList.add("hidden")}async function Le(e){try{console.log("üß™ Starting direct save test..."),console.log("üß™ Form data received:",e),console.log("üß™ Form data keys:",Object.keys(e)),console.log("üß™ Form data values:",Object.values(e));const t=(window.globalAuthManager||window.simpleAuthManager)?.getCurrentUser();if(console.log("üß™ Current user:",t),!t){console.error("‚ùå No user found for direct save test");return}if(!window.supabase){console.error("‚ùå Supabase not available for direct save test"),alert("‚ùå Supabase not available! Check console for details.");return}console.log("üß™ Testing Supabase connection...");try{const{data:a,error:u}=await window.supabase.from("order_customizations").select("count").limit(1);if(u){console.error("‚ùå Supabase connection test failed:",u),alert("‚ùå Supabase connection failed: "+u.message);return}else console.log("‚úÖ Supabase connection test successful")}catch(a){console.error("‚ùå Supabase connection error:",a),alert("‚ùå Supabase connection error: "+a.message);return}const l={project_name:e.projectName||"Test Project",restaurant_name:e.restaurantName||"Test Restaurant",owner_name:e.ownerName||"Test Owner",contact_person:e.contactPerson||"Test Contact",email:e.email||t.email,phone_number:e.phone||"1234567890",house_flat_number:e.houseNumber||"123",address_line_1:e.addressLine1||"Test Address",city:e.city||"Test City",state:e.state||"Test State",pincode:e.pincode||"123456",country:e.country||"India",restaurant_logo_url:null,menu_photos_urls:[],additional_requirements:e.additionalRequirements||"Test requirements",base_package_cost:999,gst_amount:180,total_amount:1179,status:"pending",payment_status:"pending"};console.log("üß™ Insert data prepared:",l);const{data:r,error:n}=await window.supabase.from("order_customizations").insert(l).select();n?(console.error("‚ùå Direct save test failed:",n),console.error("‚ùå Error details:",JSON.stringify(n,null,2))):(console.log("‚úÖ Direct save test successful!",r),alert("‚úÖ Data saved successfully to order_customizations table!"))}catch(o){console.error("‚ùå Direct save test error:",o)}}
