const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/supabase.B9-RI-CL.js","_astro/index.BymsOcZI.js","_astro/preload-helper.CLcXU_4U.js"])))=>i.map(i=>d[i]);
import{_ as j}from"./preload-helper.CLcXU_4U.js";import{c as se}from"./index.BymsOcZI.js";import"./ProductDialog.astro_astro_type_script_index_0_lang.C1LHbjNP.js";import"https://unpkg.com/@supabase/supabase-js@2";import"./AuthGuard.astro_astro_type_script_index_0_lang.DULNhCHQ.js";const re="https://lmrrdcaavwwletcjcpqv.supabase.co",ie="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ",ne=se(re,ie),le={"restaurant-website":"restaurant-website","streaming-mobile-app":"streaming-mobile-app","android-tv-app":"android-tv-app","restaurant-menu-system":"restaurant-menu-system","order-menu-system":"restaurant-menu-system"};async function ce(e,o){try{if(console.log("💾 Saving customization form to Supabase...",{formData:e,productType:o}),o==="order-menu-system")return await de(e);const r={product_type:le[o]||o,product_name:e.productName||e.product_name||"Unknown Product",product_price:e.productPrice||e.product_price||"₹0",project_name:e.projectName||e.project_name||"",contact_person:e.contactPerson||e.contact_person||"",app_name:e.appName||e.app_name||"",product_description:e.productDescription||e.product_description||"",restaurant_name:e.restaurantName||e.restaurant_name||null,cuisine_type:e.cuisineType||e.cuisine_type||null,logo_url:e.logoUrl||e.logo_url||null,logo_filename:e.logoFilename||e.logo_filename||null,logo_mime_type:e.logoMimeType||e.logo_mime_type||null,logo_size:e.logoSize||e.logo_size||null,contact_email:e.email||e.contact_email||e.contactEmail||"",contact_phone:e.phone||e.contact_phone||e.contactPhone||"",primary_color:e.primaryColor||e.primary_color||"#3B82F6",secondary_color:e.secondaryColor||e.secondary_color||"#10B981",accent_color:e.accentColor||e.accent_color||"#F59E0B",text_color:e.textColor||e.text_color||"#1F2937",additional_requirements:e.additionalRequirements||e.additional_requirements||"",menu_items:e.menuItems||e.menu_items||[],restaurant_address:e.restaurantAddress||e.restaurant_address||null,owner_name:e.ownerName||e.owner_name||null,status:"pending"};console.log("🧩 Inserting customization form for other products...");const{data:s,error:t}=await ne.from("customization_forms").insert(r).select().single();return t?(console.error("❌ Error inserting customization form:",t),console.error("❌ Error details:",{message:t.message,details:t.details,hint:t.hint,code:t.code}),{success:!1,error:t.message,data:null}):(console.log("✅ Customization form inserted successfully:",s),{success:!0,error:null,data:s})}catch(n){return console.error("❌ Unexpected error saving customization form:",n),{success:!1,error:n.message,data:null}}}async function de(e){try{console.log("💾 Saving OMS customization form to Supabase...",{formData:e});const{data:o,error:n}=await ne.rpc("upsert_oms_customization",{p_user_email:e.email||e.contact_email||e.contactEmail||"",p_project_name:e.projectName||e.project_name||"",p_restaurant_name:e.restaurantName||e.restaurant_name||"Default Restaurant",p_owner_name:e.ownerName||e.owner_name||e.contactPerson||e.contact_person||"",p_restaurant_address:e.restaurantAddress||e.restaurant_address||"Not provided",p_contact_person:e.contactPerson||e.contact_person||"",p_phone_number:e.phone||e.contact_phone||e.contactPhone||"",p_user_id:null,p_logo_url:e.logoUrl||e.logo_url||null,p_logo_filename:e.logoFilename||e.logo_filename||null,p_logo_size:e.logoSize||e.logo_size||null,p_menu_categories:e.menuCategories||e.menu_categories||[],p_menu_items:e.menuItems||e.menu_items||[],p_primary_color:e.primaryColor||e.primary_color||"#3B82F6",p_secondary_color:e.secondaryColor||e.secondary_color||"#10B981",p_accent_color:e.accentColor||e.accent_color||"#F59E0B",p_text_color:e.textColor||e.text_color||"#1F2937",p_additional_requirements:e.additionalRequirements||e.additional_requirements||""});if(n)return console.error("❌ Error inserting OMS customization:",n),console.error("❌ Error details:",{message:n.message,details:n.details,hint:n.hint,code:n.code}),{success:!1,error:n.message,data:null};if(o&&o.length>0){const r=o[0];return console.log("✅ OMS customization result:",r),r.is_duplicate?(console.log("⚠️ Duplicate data detected:",r.message),{success:!0,error:null,data:{id:r.data_id},isUpdate:!1,isDuplicate:!0,message:r.message}):(console.log("✅ OMS customization saved successfully, ID:",r.data_id),{success:!0,error:null,data:{id:r.data_id},isUpdate:!1,isDuplicate:!1,message:r.message})}else return console.error("❌ No data returned from OMS function"),{success:!1,error:"No data returned from OMS function",data:null}}catch(o){return console.error("❌ Unexpected error saving OMS customization form:",o),{success:!1,error:o.message,data:null}}}let E=[],C=[],te=null;console.log("Dashboard loaded - using global auth manager");async function ue(e){try{console.log("🔍 Fetching user profile from Supabase for user:",e);const{supabase:o}=await j(async()=>{const{supabase:s}=await import("./supabase.B9-RI-CL.js");return{supabase:s}},__vite__mapDeps([0,1,2])),{data:n,error:r}=await o.from("profiles").select("*").eq("id",e).single();return r?(console.error("Error fetching user profile:",r),null):(console.log("✅ User profile fetched from Supabase:",n),n)}catch(o){return console.error("Error in fetchUserProfile:",o),null}}async function F(){console.log("🔄 Updating user info...");const e=window.globalAuthManager||window.simpleAuthManager;if(!e||!e.isUserLoggedIn()){console.log("❌ User not logged in - showing generic welcome message");const t=document.getElementById("user-welcome");t&&(t.textContent="Guest",console.log("👋 Welcome message updated to: Guest")),console.log("✅ Dashboard updated for guest user");return}let o=null,n="";const r=e.getCurrentUser();if(r&&r.email&&(o=r,n="auth-manager",console.log("✅ Found authenticated user data:",o.email)),!o){console.log("No auth manager data, checking storage...");const t=[{key:"simple-auth-session",storage:sessionStorage,path:"user"},{key:"simple-auth-user",storage:localStorage,path:null},{key:"simple-auth-session",storage:localStorage,path:"user"}];for(const a of t)try{const i=a.storage.getItem(a.key);if(i){const d=JSON.parse(i);if(o=a.path?d[a.path]:d,o&&o.email){n=a.key,console.log(`✅ Found user data in ${a.key}:`,o.email);break}}}catch(i){console.log(`Error reading ${a.key}:`,i)}}if(!o){console.log("❌ No authenticated user data found");const t=document.getElementById("user-welcome");t&&(t.textContent="Guest",console.log("👋 Welcome message updated to: Guest")),console.log("✅ Dashboard updated for guest user");return}if(o){if(o.user_metadata&&(o.full_name=o.user_metadata.full_name||o.full_name,o.phone=o.user_metadata.phone||o.phone,o.company_name=o.user_metadata.company_name||o.company_name),o.id&&(!o.full_name||o.full_name==="User"||!o.phone||o.phone==="Not set")){console.log("🔄 Incomplete user data, fetching from Supabase...");try{const t=await ue(o.id);t&&(o={...o,...t,email:o.email||t.email},console.log("✅ Enhanced user data with profile:",o))}catch(t){console.log("Error fetching profile data:",t)}}if(o.full_name=o.full_name||o.fullName||"User",o.phone=o.phone||"Not set",o.company_name=o.company_name||o.companyName||"Not set",!o.email){console.log("❌ No email found in authenticated user data");return}console.log("📋 Final normalized user data:",o)}const s=document.getElementById("user-welcome");if(s){const t=o.full_name||o.fullName||o.email?.split("@")[0]||"User";s.textContent=t,console.log("👋 Welcome message updated to:",t)}console.log(`✅ Dashboard updated successfully from ${n}`),setTimeout(()=>{console.log("🔄 Force update welcome message...");const t=document.getElementById("user-welcome");if(t){const a=o.full_name||o.fullName||o.email?.split("@")[0]||"User";t.textContent=a,console.log("Force updated welcome to:",t.textContent)}},100)}function me(){const e=new URLSearchParams(window.location.search),o=e.get("product"),n=e.get("price");if(console.log("🔍 Checking for product selection:",{productId:o,price:n}),o&&n){console.log("✅ Product selected, showing customization form");const s=[{id:"1",name:"Restaurant Menu System",description:"Digital menu system with QR code integration, online ordering, and real-time updates. Perfect for restaurants looking to modernize their customer experience.",price:25e3,type:"restaurant"},{id:"2",name:"Android TV App",description:"Custom Android TV applications with beautiful UI, content management, and remote control support. Perfect for streaming services and media companies.",price:55e3,type:"non-restaurant"},{id:"3",name:"Streaming Mobile App",description:"Mobile streaming applications for iOS and Android with custom features, user authentication, and content management.",price:35e3,type:"non-restaurant"},{id:"4",name:"Restaurant Website",description:"Professional restaurant website with online ordering, menu display, and customer management features.",price:2e4,type:"restaurant"},{id:"5",name:"Order Menu System",description:"Complete order management system with digital menu integration, real-time order tracking, and payment processing. Perfect for restaurants looking to streamline their ordering process.",price:999,type:"order-menu"}].find(t=>t.id===o);if(s){const t=document.getElementById("product-customization-form"),a=document.getElementById("order-menu-customization-form"),i=document.getElementById("recent-activity");t&&!t.classList.contains("hidden")&&(t.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",t.style.opacity="0",t.style.transform="translateY(-10px)",setTimeout(()=>t.classList.add("hidden"),300)),a&&!a.classList.contains("hidden")&&(a.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",a.style.opacity="0",a.style.transform="translateY(-10px)",setTimeout(()=>a.classList.add("hidden"),300)),i&&!i.classList.contains("hidden")&&(i.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",i.style.opacity="0",i.style.transform="translateY(-10px)",setTimeout(()=>i.classList.add("hidden"),300)),setTimeout(()=>{const d=s.type==="order-menu"?999:parseInt(n);if(s.type==="order-menu"){document.getElementById("order-menu-product-name").textContent=s.name;const c=document.getElementById("order-menu-customization-form");c.classList.remove("hidden"),c.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",c.style.opacity="0",c.style.transform="translateY(10px)",setTimeout(()=>{c.style.opacity="1",c.style.transform="translateY(0)",window.reinitializePincodeAutocomplete&&window.reinitializePincodeAutocomplete()},50)}else{document.getElementById("selected-product-name").textContent=s.name,document.getElementById("selected-product-price").textContent=`₹${d.toLocaleString()}`;const c=document.getElementById("cuisine-type-field"),m=document.getElementById("restaurant-name-field");s.type==="restaurant"?(c.classList.remove("hidden"),c.querySelector("select").required=!0,m.classList.remove("hidden"),m.querySelector("input").required=!0):(c.classList.add("hidden"),c.querySelector("select").required=!1,m.classList.add("hidden"),m.querySelector("input").required=!1);const u=document.getElementById("product-customization-form");u.classList.remove("hidden"),u.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",u.style.opacity="0",u.style.transform="translateY(10px)",setTimeout(()=>{u.style.opacity="1",u.style.transform="translateY(0)"},50)}},350),setTimeout(()=>O(),500)}}}const V=["Mumbai","Delhi","Bangalore","Hyderabad","Chennai","Kolkata","Pune","Ahmedabad","Jaipur","Surat","Lucknow","Kanpur","Nagpur","Indore","Thane","Bhopal","Visakhapatnam","Pimpri-Chinchwad","Patna","Vadodara","Ghaziabad","Ludhiana","Agra","Nashik","Faridabad","Meerut","Rajkot","Kalyan-Dombivali","Vasai-Virar","Varanasi","Srinagar","Aurangabad","Navi Mumbai","Solapur","Vijayawada","Kolhapur","Amritsar","Noida","Ranchi","Howrah","Coimbatore","Raipur","Jabalpur","Gwalior","Chandigarh","Tiruchirappalli","Mysore","Bhubaneswar","Kochi","Bhavnagar","Salem","Warangal","Guntur","Bhiwandi","Amravati","Nanded","Sangli","Malegaon","Ulhasnagar","Jalgaon","Latur","Ahmadnagar","Dhule","Ichalkaranji","Parbhani","Jalna","Bhusawal","Panvel","Satara","Beed","Yavatmal","Kamptee","Gondia","Barshi","Achalpur","Osmanabad","Nandurbar","Wardha","Udgir","Amalner","Akot","Pandharpur","Shirpur","Parli","Pathri","Sinnar","Shirur","Mangrulpir","Phaltan","Pulgaon","Pimpri","Pachora","Paratwada","Pusad","Purna","Rahuri","Rajura","Ramtek","Ratnagiri","Raver","Risod","Sailu","Sangamner","Sasvad","Satana","Shahpur","Shegaon","Shendurjana","Shirdi","Shrigonda","Shrirampur","Sillod","Soyagaon","Talegaon Dabhade","Talode","Tasgaon","Telhara","Tirora","Tuljapur","Tumsar","Uchgaon","Umarga","Umarkhed","Umred","Uran","Uran Islampur","Vadgaon Kasba","Vaijapur","Vasai","Virar","Vita","Wadgaon Road","Wai","Wani","Warora","Warud","Washim","Yawal","Yevla"],J=["Andhra Pradesh","Arunachal Pradesh","Assam","Bihar","Chhattisgarh","Goa","Gujarat","Haryana","Himachal Pradesh","Jharkhand","Karnataka","Kerala","Madhya Pradesh","Maharashtra","Manipur","Meghalaya","Mizoram","Nagaland","Odisha","Punjab","Rajasthan","Sikkim","Tamil Nadu","Telangana","Tripura","Uttar Pradesh","Uttarakhand","West Bengal","Andaman and Nicobar Islands","Chandigarh","Dadra and Nagar Haveli and Daman and Diu","Delhi","Jammu and Kashmir","Ladakh","Lakshadweep","Puducherry"];function pe(){const e=document.getElementById("pincode-input"),o=document.getElementById("city-input"),n=document.getElementById("state-input"),r=document.getElementById("phone-input");if(e&&e.addEventListener("input",function(s){s.target.value=s.target.value.replace(/[^0-9]/g,""),s.target.value.length>6&&(s.target.value=s.target.value.slice(0,6));const t=document.getElementById("pincode-error");s.target.value.length>0&&s.target.value.length!==6?t.classList.remove("hidden"):t.classList.add("hidden")}),o){const s=document.getElementById("city-suggestions");o.addEventListener("input",function(t){const a=t.target.value.toLowerCase(),i=V.filter(c=>c.toLowerCase().includes(a));a.length>0&&i.length>0?(s.innerHTML=i.map(c=>`<div class="px-4 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0" data-value="${c}">${c}</div>`).join(""),s.classList.remove("hidden")):s.classList.add("hidden");const d=document.getElementById("city-error");t.target.value===""||!V.includes(t.target.value)?d.classList.remove("hidden"):d.classList.add("hidden")}),s.addEventListener("click",function(t){t.target.dataset.value&&(o.value=t.target.dataset.value,s.classList.add("hidden"),document.getElementById("city-error").classList.add("hidden"))}),document.addEventListener("click",function(t){!o.contains(t.target)&&!s.contains(t.target)&&s.classList.add("hidden")})}if(n){const s=document.getElementById("state-suggestions");n.addEventListener("input",function(t){const a=t.target.value.toLowerCase(),i=J.filter(c=>c.toLowerCase().includes(a));a.length>0&&i.length>0?(s.innerHTML=i.map(c=>`<div class="px-4 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0" data-value="${c}">${c}</div>`).join(""),s.classList.remove("hidden")):s.classList.add("hidden");const d=document.getElementById("state-error");t.target.value===""||!J.includes(t.target.value)?d.classList.remove("hidden"):d.classList.add("hidden")}),s.addEventListener("click",function(t){t.target.dataset.value&&(n.value=t.target.dataset.value,s.classList.add("hidden"),document.getElementById("state-error").classList.add("hidden"))}),document.addEventListener("click",function(t){!n.contains(t.target)&&!s.contains(t.target)&&s.classList.add("hidden")})}r&&r.addEventListener("input",function(s){let t=s.target.value;t.startsWith("+91")?(t="+91"+t.substring(3).replace(/[^0-9]/g,""),t.length>13&&(t=t.slice(0,13))):(t=t.replace(/[^0-9]/g,""),t.length>10&&(t=t.slice(0,10))),s.target.value=t;const a=document.getElementById("phone-error"),i=t.length===10||t.length===13&&t.startsWith("+91");t.length>0&&!i?a.classList.remove("hidden"):a.classList.add("hidden")})}function ge(){document.querySelectorAll("#order-menu-form input, #order-menu-form select, #order-menu-form textarea").forEach(n=>{n.addEventListener("input",Q),n.addEventListener("change",Q),n.addEventListener("focus",Q)});const o=document.getElementById("menu-photos-upload");o&&o.addEventListener("change",()=>{const n=document.getElementById("menu-photos-error");n&&n.classList.add("hidden")})}function Q(){const e=document.getElementById("validation-errors");e&&e.classList.add("hidden"),document.querySelectorAll("#pincode-error, #city-error, #state-error, #phone-error").forEach(n=>{n&&n.classList.add("hidden")})}function ae(){console.log("🔍 validateFormFields() called");const e=document.getElementById("pincode-input"),o=document.getElementById("city-input"),n=document.getElementById("state-input"),r=document.getElementById("phone-input"),s=document.querySelector('input[name="projectName"]'),t=document.querySelector('input[name="restaurantName"]'),a=document.querySelector('input[name="ownerName"]'),i=document.querySelector('input[name="contactPerson"]'),d=document.querySelector('input[name="email"]'),c=document.querySelector('input[name="houseNumber"]'),m=document.querySelector('input[name="addressLine1"]'),u=document.querySelector('select[name="country"]');console.log("🔍 Form fields found:"),console.log("  - projectName:",s?s.value:"not found"),console.log("  - restaurantName:",t?t.value:"not found"),console.log("  - ownerName:",a?a.value:"not found"),console.log("  - contactPerson:",i?i.value:"not found"),console.log("  - email:",d?d.value:"not found"),console.log("  - houseNumber:",c?c.value:"not found"),console.log("  - addressLine1:",m?m.value:"not found"),console.log("  - country:",u?u.value:"not found"),console.log("  - phone:",r?r.value:"not found"),console.log("  - city:",o?o.value:"not found"),console.log("  - state:",n?n.value:"not found"),console.log("  - pincode:",e?e.value:"not found");let p=!0,f=[];if((!s||!s.value.trim())&&(f.push("Project Name is required"),p=!1),(!t||!t.value.trim())&&(f.push("Restaurant Name is required"),p=!1),(!a||!a.value.trim())&&(f.push("Owner Name is required"),p=!1),(!i||!i.value.trim())&&(f.push("Contact Person is required"),p=!1),!d||!d.value.trim()?(f.push("Email is required"),p=!1):/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.value)||(f.push("Please enter a valid email address"),p=!1),(!c||!c.value.trim())&&(f.push("House/Flat Number is required"),p=!1),(!m||!m.value.trim())&&(f.push("Address Line 1 is required"),p=!1),e&&(!e.value||e.value.length!==6||!/^[0-9]{6}$/.test(e.value))){const v=document.getElementById("pincode-error");v&&(v.classList.remove("hidden"),v.textContent="Pincode must be exactly 6 digits"),f.push("Pincode must be exactly 6 digits"),p=!1}if(o&&(!o.value||!V.includes(o.value))){const v=document.getElementById("city-error");v&&(v.classList.remove("hidden"),v.textContent="Please select a valid city"),f.push("Please select a valid city"),p=!1}if(n&&(!n.value||!J.includes(n.value))){const v=document.getElementById("state-error");v&&(v.classList.remove("hidden"),v.textContent="Please select a valid state"),f.push("Please select a valid state"),p=!1}if((!u||!u.value)&&(f.push("Country is required"),p=!1),r&&(!r.value||!(/^[0-9]{10}$/.test(r.value)||/^\+91[0-9]{10}$/.test(r.value)))){const v=document.getElementById("phone-error");v&&(v.classList.remove("hidden"),v.textContent="Phone number must be 10 digits or +91 followed by 10 digits"),f.push("Phone number must be 10 digits or +91 followed by 10 digits"),p=!1}if(p)console.log("✅ Form validation passed - all required fields are filled");else{console.log("❌ Form validation failed with errors:",f);const v=document.getElementById("validation-errors");v&&(v.classList.remove("hidden"),v.innerHTML='<div class="bg-red-50 border border-red-200 rounded-lg p-4"><p class="text-red-800 font-semibold">All fields are required.</p></div>');const P=document.getElementById("order-menu-form");P&&P.scrollIntoView({behavior:"smooth",block:"start"})}return console.log("🔍 validateFormFields() returning:",p),p}function he(){const e=document.getElementById("order-menu-form");console.log("handleOrderMenuForm called - form found:",e);const o=document.getElementById("close-order-menu-form"),n=document.getElementById("cancel-order-menu");console.log("🔍 Close button found:",o),console.log("🔍 Cancel button found:",n);const r=document.getElementById("order-menu-logo-upload"),s=document.getElementById("order-menu-logo-upload-area");document.getElementById("order-menu-logo-preview"),document.getElementById("order-menu-logo-preview-img"),document.getElementById("order-menu-logo-filename"),document.getElementById("order-menu-logo-remove");const t=document.getElementById("menu-photos-upload"),a=document.getElementById("menu-photos-upload-area"),i=document.getElementById("menu-photos-preview"),d=document.getElementById("menu-photos-grid");if(console.log("menuPhotosPreview element found:",i),console.log("menuPhotosGrid element found:",d),console.log("menuPhotosUpload element found:",t),t)console.log("File input element found successfully");else{console.error("CRITICAL: File input element not found! Creating fallback...");const l=document.createElement("input");l.type="file",l.name="menuPhotos",l.accept="image/*",l.multiple=!0,l.className="hidden",l.id="menu-photos-upload";const y=document.getElementById("order-menu-form");y&&(y.appendChild(l),console.log("Fallback file input created and added to form"))}document.getElementById("remove-all-menu-photos"),a&&t&&(a.addEventListener("click",()=>{t.click()}),t.addEventListener("change",l=>{const y=Array.from(l.target.files);if(y.length>0){const g=y.filter(w=>w.size/1048576<=5);if(g.length!==y.length){const w=document.getElementById("file-size-error");w&&(w.classList.remove("hidden"),w.textContent=`Some files were too large. Only files under 5MB are allowed. ${g.length}/${y.length} files uploaded.`)}E=[...E,...g],C=[...E],console.log("📸 Cached menu photos:",C.length,"files"),c(),a.classList.remove("border-red-300","bg-red-50"),a.classList.add("border-gray-300","bg-gray-50"),a.innerHTML=`
            <div class="flex flex-col items-center">
              <svg class="w-16 h-16 text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 13l4 4L19 7"></path>
              </svg>
              <p class="text-green-600 mb-2 font-medium">${g.length} photo(s) uploaded successfully</p>
              <p class="text-sm text-gray-500">Total: ${E.length} photos uploaded</p>
              <button type="button" onclick="document.getElementById('menu-photos-upload').click()" class="mt-4 px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg transition-all transform hover:scale-105 shadow-lg">
                <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                Add More Photos
              </button>
            </div>
          `,t.value=""}}));function c(){if(E.length>0){i.classList.remove("hidden"),d.innerHTML="";const l=document.createElement("div");l.className="col-span-full mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",l.innerHTML=`
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <svg class="w-6 h-6 text-green-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              <div>
                <span class="text-green-800 font-semibold text-lg">${E.length} Photo(s) Uploaded</span>
                <p class="text-sm text-green-600">Menu photos ready for your order system</p>
              </div>
            </div>
            <button type="button" onclick="removeAllMenuPhotos()" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white text-sm font-medium rounded-lg transition-colors">
              <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
              </svg>
              Remove All
            </button>
          </div>
        `,d.appendChild(l),E.forEach((y,g)=>{const w=new FileReader;w.onload=B=>{const S=document.createElement("div");S.className="relative group bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow",S.innerHTML=`
              <div class="relative">
                <img src="${B.target.result}" alt="Menu photo ${g+1}" class="w-full h-32 object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center">
                  <button type="button" class="opacity-0 group-hover:opacity-100 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm hover:bg-red-600 transition-all duration-200 shadow-lg" onclick="removeMenuPhoto(${g})">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                  </button>
                </div>
              </div>
              <div class="p-3">
                <p class="text-sm text-gray-700 font-medium truncate">${y.name}</p>
                <p class="text-xs text-gray-500">${(y.size/1024/1024).toFixed(2)} MB</p>
              </div>
            `,d.appendChild(S)},w.readAsDataURL(y)})}else i.classList.add("hidden")}window.removeMenuPhoto=l=>{console.log("removeMenuPhoto called, index:",l),console.log("Before removal - menuPhotos length:",E.length),E.splice(l,1),console.log("After removal - menuPhotos length:",E.length),c(),E.length===0&&(a.innerHTML=`
          <div class="flex flex-col items-center">
            <svg class="w-16 h-16 text-red-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
            <p class="text-red-600 mb-2 font-medium">Menu photos required!</p>
            <p class="text-sm text-gray-500 mb-2">Please upload at least one menu photo to continue</p>
            <div class="mt-3 flex items-center text-xs text-red-500 font-medium">
              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              This field is mandatory
            </div>
          </div>
        `,a.classList.add("border-red-300","bg-red-50"),a.classList.remove("border-gray-300","bg-gray-50"))},window.removeAllMenuPhotos=()=>{console.log("removeAllMenuPhotos called"),console.log("Before removal - menuPhotos length:",E.length),E=[],console.log("After removal - menuPhotos length:",E.length),c(),t.value="",a.innerHTML=`
        <div class="flex flex-col items-center">
          <svg class="w-16 h-16 text-red-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
          </svg>
          <p class="text-red-600 mb-2 font-medium">Menu photos required!</p>
          <p class="text-sm text-gray-500 mb-2">Please upload at least one menu photo to continue</p>
          <div class="mt-3 flex items-center text-xs text-red-500 font-medium">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            This field is mandatory
          </div>
        </div>
      `,a.classList.add("border-red-300","bg-red-50"),a.classList.remove("border-gray-300","bg-gray-50")};const m=document.getElementById("add-menu-item"),u=document.getElementById("menu-items-container"),p=document.getElementById("oms-category-input"),f=document.getElementById("oms-add-category-btn"),v=document.getElementById("oms-clear-all-categories-btn"),P=document.getElementById("oms-category-pills"),I=document.getElementById("oms-current-category"),R=document.getElementById("oms-prev-page"),N=document.getElementById("oms-next-page"),A=document.getElementById("oms-page-indicator"),x=[];let M=-1;const z=6;let T=1;function h(){P.innerHTML="",x.forEach((l,y)=>{const g=document.createElement("button");g.type="button",g.className=`px-3 py-1 rounded-full text-sm ${y===M?"bg-amber-600 text-white":"bg-gray-100"} flex items-center`;const w=document.createElement("span");w.textContent=l,w.className="mr-2",g.appendChild(w);const B=document.createElement("span");B.textContent="✕",B.className="text-xs opacity-70 hover:opacity-100 ml-1",B.addEventListener("click",S=>{S.stopPropagation();const $=x.splice(y,1)[0];M>=x.length&&(M=x.length-1),u&&u.querySelectorAll(".menu-item-row").forEach(Y=>{const Z=Y.querySelector(".oms-category-field");Z&&Z.value===$&&(Z.value="")}),I.textContent=x[M]||"Uncategorized",h(),b()}),g.appendChild(B),g.addEventListener("click",()=>{M=y,I.textContent=l,h(),b()}),P.appendChild(g)})}v?.addEventListener("click",()=>{x.splice(0,x.length),M=-1,I.textContent="Uncategorized",h(),b(),u&&u.querySelectorAll(".oms-category-field").forEach(l=>l.value="")}),f?.addEventListener("click",()=>{const l=p.value.trim();l&&(x.includes(l)||(x.push(l),M=x.length-1,I.textContent=l,h(),u&&u.querySelectorAll(".oms-category-field").forEach(y=>{y.value||(y.value=l)}),p.value=""))});function b(){if(!u)return;const l=Array.from(u.querySelectorAll(".menu-item-row"));if(l.forEach(w=>w.style.display=""),M>=0){const w=x[M];l.forEach(B=>{const S=B.querySelector(".oms-category-field");S&&S.value&&S.value!==w&&(B.style.display="none")})}const y=l.filter(w=>w.style.display!=="none"),g=Math.max(1,Math.ceil(y.length/z));T=Math.min(T,g),A&&(A.textContent=`Page ${T} / ${g}`),y.forEach((w,B)=>{const S=Math.floor(B/z)+1;w.style.display=S===T?"":"none"})}R?.addEventListener("click",()=>{T>1&&(T-=1,b())}),N?.addEventListener("click",()=>{T+=1,b()}),r?.addEventListener("change",l=>{const y=l.target.files[0];if(y){const g=y.name,w=(y.size/1024/1024).toFixed(2);s.innerHTML=`
          <div class="flex flex-col items-center">
            <svg class="w-12 h-12 text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <p class="text-green-600 mb-1 font-medium">Logo uploaded successfully</p>
            <p class="text-sm text-gray-500">${g} (${w} MB)</p>
          </div>
        `}});const L=document.querySelectorAll(".menu-style-option");L.forEach(l=>{l.addEventListener("click",()=>{L.forEach(g=>{g.classList.remove("border-primary-500","bg-primary-50"),g.classList.add("border-gray-200")}),l.classList.remove("border-gray-200"),l.classList.add("border-primary-500","bg-primary-50");const y=l.querySelector('input[type="radio"]');y&&(y.checked=!0)})});function k(){const l=e?.querySelectorAll('input[type="color"]'),y=e?.querySelectorAll('input[name$="ColorText"]');l?.forEach((g,w)=>{const B=y?.[w];B&&(g.addEventListener("input",()=>{B.value=g.value}),B.addEventListener("input",()=>{/^#[0-9A-F]{6}$/i.test(B.value)&&(g.value=B.value)}))})}k();let _=1;m?.addEventListener("click",()=>{const l=document.createElement("div");if(l.className="menu-item-row grid grid-cols-1 md:grid-cols-4 gap-4 mb-4 p-4 border border-gray-200 rounded-lg",l.innerHTML=`
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Item Name</label>
          <input type="text" name="menuItems[${_}][item_name]" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500" placeholder="e.g., Margherita Pizza" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Price (₹)</label>
          <input type="number" name="menuItems[${_}][price]" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500" placeholder="299" step="0.01" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
          <input type="text" name="menuItems[${_}][item_category]" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 oms-category-field" placeholder="Type or pick from pills" required>
        </div>
        <div class="flex items-end">
          <button type="button" class="remove-menu-item px-3 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 text-sm">
            Remove
          </button>
        </div>
      `,u?.appendChild(l),_++,M>=0){const y=x[M],g=l.querySelector(".oms-category-field");g&&!g.value&&(g.value=y)}b()}),u?.addEventListener("click",l=>{l.target.classList.contains("remove-menu-item")&&(l.target.closest(".menu-item-row").remove(),b())}),b(),o?.addEventListener("click",()=>{H=!0,U(),G(),window.history.replaceState({},document.title,window.location.pathname)}),n?.addEventListener("click",()=>{H=!0,U(),G(),window.history.replaceState({},document.title,window.location.pathname)}),console.log("Adding form submission event listener to form:",e),console.error("Form not found - cannot add event listener"),pe(),ge(),e?e.addEventListener("submit",l=>{console.log("Form submit event triggered!"),l.preventDefault(),l.stopPropagation(),K()}):console.error("Form not found for submit event listener")}async function K(){console.log("🚀 Handling Order Menu Form submission..."),console.log("🔍 IMMEDIATE FILE CHECK:"),console.log("📸 Cached menu photos count:",C.length),console.log("🏷️ Cached logo file:","No"),C.length>0&&console.log("📸 Cached menu photos details:",C.map(i=>({name:i.name,size:i.size,type:i.type})));const e=C.length;console.log("Cached files => menuPhotos:",e,"logo:",0);const n=document.getElementById("order-menu-form");if(!n){console.error("Order menu form not found");return}const r=window.globalAuthManager||window.simpleAuthManager;if(!r||!r.isUserLoggedIn()){alert("❌ Please log in to submit this form. You must be authenticated to place an order.");return}const s=document.getElementById("menu-photos-upload");C&&C.length>0||s&&s.files&&s.files.length>0;const t=new FormData(n),a=Object.fromEntries(t);console.log("📝 Form data collected:",a);try{const{supabase:i}=await j(async()=>{const{supabase:h}=await import("./supabase.B9-RI-CL.js");return{supabase:h}},__vite__mapDeps([0,1,2]));console.log("✅ Supabase client loaded");let d=[];if(console.log("📸 Using cached menu photos:",C.length,"files"),console.log("📸 Cached menu photos:",C.map(h=>({name:h.name,size:h.size,type:h.type}))),C&&C.length>0){console.log(`📸 Found ${C.length} cached files`);try{console.log("📸 Starting menu photos upload to Supabase Storage...");for(let h=0;h<C.length;h++){const b=C[h];console.log(`📸 Uploading photo ${h+1}/${C.length}: ${b.name}`),console.log(`📸 File size: ${b.size} bytes`),console.log(`📸 File type: ${b.type}`);const L=Date.now(),k=Math.random().toString(36).substring(2,8),_=b.name.replace(/[^a-zA-Z0-9.-]/g,"_"),l=`menu_photos/${L}_${k}_${_}`;console.log(`📸 Upload path: ${l}`);try{const{error:y}=await i.storage.from("menu-photos").upload(l,b,{upsert:!0,contentType:b.type,cacheControl:"3600"});if(y){console.error(`❌ Upload error for photo ${h+1}:`,y);continue}const{data:g}=i.storage.from("menu-photos").getPublicUrl(l);g&&g.publicUrl?(d.push({url:g.publicUrl,filename:b.name,mimeType:b.type,size:b.size,path:l}),console.log(`✅ Photo ${h+1} uploaded successfully: ${g.publicUrl}`)):console.error(`❌ Failed to get public URL for photo ${h+1}`)}catch(y){console.error(`❌ Exception uploading photo ${h+1}:`,y)}}console.log(`📸 Menu photos upload completed. ${d.length} photos uploaded successfully.`),console.log("📸 Uploaded URLs:",d)}catch(h){console.error("❌ Menu photos upload failed:",h)}}else console.log("⚠️ No menu photos found in file input"),console.log("🔍 Checking menuPhotos array as fallback..."),console.log("📸 menuPhotos array:",E),console.log("📸 menuPhotos length:",E?E.length:"undefined");let c=null;const m=document.getElementById("order-menu-logo-upload"),u=m&&m.files&&m.files[0]?m.files[0]:null,p=te||u;if(console.log("🏷️ Using logo file:",p?p.name:"none","(source:",te?"cache":u?"input":"none",")"),p){const h=p;console.log(`🏷️ Uploading logo: ${h.name}`),console.log(`🏷️ Logo size: ${h.size} bytes`),console.log(`🏷️ Logo type: ${h.type}`);try{const{supabase:b}=await j(async()=>{const{supabase:g}=await import("./supabase.B9-RI-CL.js");return{supabase:g}},__vite__mapDeps([0,1,2]));console.log("🏷️ Starting restaurant logo upload to Supabase Storage...");const L=Date.now(),k=Math.random().toString(36).substring(2,8),_=h.name.replace(/[^a-zA-Z0-9.-]/g,"_"),l=`logos/${L}_${k}_${_}`;console.log(`🏷️ Upload path: ${l}`);const{error:y}=await b.storage.from("logos").upload(l,h,{upsert:!0,contentType:h.type,cacheControl:"3600"});if(y){console.error("❌ Logo upload error:",y);const g=document.getElementById("error-message");g&&(g.classList.remove("hidden"),g.textContent=`Logo upload failed: ${y.message||y}`)}else{const{data:g}=b.storage.from("logos").getPublicUrl(l);g&&g.publicUrl?(c=g.publicUrl,console.log(`✅ Logo uploaded successfully: ${g.publicUrl}`)):console.error("❌ Failed to get logo public URL")}}catch(b){console.error("❌ Logo upload failed:",b)}}else console.log("ℹ️ No logo uploaded (optional field)");const f={project_name:a.projectName,owner_name:a.ownerName,contact_person:a.contactPerson,email:a.email,phone_number:a.phone,house_flat_number:a.houseNumber,address_line_1:a.addressLine1,city:a.city,state:a.state,pincode:a.pincode,country:a.country,restaurant_name:a.restaurantName,restaurant_logo_url:c,menu_photos_urls:d,additional_requirements:a.additionalRequirements||"",base_package_cost:999,gst_amount:180,total_amount:1179,status:"pending",payment_status:"pending"};console.log("💾 Saving order customization data:",f);const{data:{session:v}}=await i.auth.getSession(),P=v?.access_token||"",{supabaseUrl:I,supabaseAnonKey:R}=await j(async()=>{const{supabaseUrl:h,supabaseAnonKey:b}=await import("./supabase.B9-RI-CL.js");return{supabaseUrl:h,supabaseAnonKey:b}},__vite__mapDeps([0,1,2])),N=R,x=`${I}/rest/v1/order_customizations?select=*`,M=await fetch(x,{method:"POST",headers:{"Content-Type":"application/json",Prefer:"return=representation",apikey:N,...P?{Authorization:`Bearer ${P}`}:{}},body:JSON.stringify(f)});if(!M.ok){const h=await M.text();console.error("❌ REST insert failed:",M.status,h),alert("❌ Error saving your order. Please try again.");return}const z=await M.json();console.log("✅ Order customization saved successfully (REST):",z);const T=document.getElementById("validation-errors");if(T){let h="";d.length>0&&(h+=`<p class="text-green-700 mt-2">📸 ${d.length} menu photo${d.length>1?"s":""} uploaded successfully!</p>`),c&&(h+='<p class="text-green-700 mt-2">🏷️ Restaurant logo uploaded successfully!</p>'),T.classList.remove("hidden"),T.innerHTML=`
          <div class="bg-green-50 border border-green-200 rounded-lg p-4">
            <h4 class="text-green-800 font-semibold mb-2">✅ Order Submitted Successfully!</h4>
            <p class="text-green-700">Your order has been saved with all uploaded files.</p>
            ${h}
            <p class="text-green-700 mt-2">You will be redirected to the payment page.</p>
          </div>
        `}try{document.getElementById("order-menu-form")?.reset()}catch{}try{document.getElementById("customization-form")?.reset()}catch{}try{const h=document.getElementById("order-menu-logo-upload"),b=document.getElementById("order-menu-logo-preview"),L=document.getElementById("order-menu-logo-upload-area");h&&(h.value=""),b&&b.classList.add("hidden"),L&&(L.innerHTML=`
          <div class="flex flex-col items-center">
            <svg class="w-12 h-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
            </svg>
            <p class="text-gray-600 mb-2">Click to upload logo</p>
            <p class="text-sm text-gray-500">PNG, JPG, SVG up to 10MB</p>
          </div>
        `)}catch{}try{const h=document.getElementById("menu-photos-upload"),b=document.getElementById("menu-photos-preview"),L=document.getElementById("menu-photos-grid"),k=document.getElementById("menu-photos-upload-area");h&&(h.value=""),b&&b.classList.add("hidden"),L&&(L.innerHTML=""),k&&(k.innerHTML=`
          <div class="flex flex-col items-center">
            <svg class="w-12 h-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
            </svg>
            <p class="text-gray-700 mb-2 font-medium">Click to upload menu photos</p>
            <p class="text-sm text-gray-500">PNG, JPG, SVG up to 10MB each</p>
            <button type="button" onclick="document.getElementById('menu-photos-upload').click()" class="mt-4 px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg transition-all transform hover:scale-105 shadow-lg">Choose Photos</button>
          </div>
        `)}catch{}}catch(i){console.error("❌ Error in form submission:",i),alert("❌ An error occurred while submitting your order. Please try again.")}}function ye(){const e=document.getElementById("customization-form"),o=document.getElementById("close-customization-form"),n=document.getElementById("cancel-customization"),r=document.getElementById("restaurant-logo-upload"),s=document.getElementById("restaurant-logo-upload-area"),t=document.getElementById("restaurant-logo-preview"),a=document.getElementById("restaurant-logo-preview-img"),i=document.getElementById("restaurant-logo-filename"),d=document.getElementById("restaurant-logo-remove");s&&(s.onclick=()=>{const m=document.getElementById("restaurant-logo-upload");m?m.click():console.error("restaurant-logo-upload element not found in initial handler")}),r?.addEventListener("change",m=>{const u=m.target.files[0];if(u){const p=new FileReader;p.onload=f=>{a.src=f.target.result,i.textContent=u.name,t.classList.remove("hidden"),s.innerHTML=`
            <div class="flex flex-col items-center">
              <svg class="w-12 h-12 text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              <p class="text-green-600 mb-1 font-medium">Logo uploaded successfully</p>
              <p class="text-sm text-gray-500">${u.name}</p>
              <button type="button" onclick="const el = document.getElementById('restaurant-logo-upload'); if(el) el.click(); else console.error('restaurant-logo-upload element not found in button onclick');" class="mt-2 text-sm text-blue-600 hover:text-blue-800">Change Logo</button>
            </div>
          `},p.readAsDataURL(u)}}),d?.addEventListener("click",m=>{m.preventDefault(),m.stopPropagation(),r.value="",t.classList.add("hidden"),s.innerHTML=`
        <div class="flex flex-col items-center">
          <svg class="w-12 h-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
          </svg>
          <p class="text-gray-600 mb-2">Click to upload logo</p>
          <p class="text-sm text-gray-500">PNG, JPG, SVG up to 10MB</p>
        </div>
      `,s.onclick=()=>{const u=document.getElementById("restaurant-logo-upload");u?u.click():console.error("restaurant-logo-upload element not found in reset handler")}});function c(){const m=e?.querySelectorAll('input[type="color"]'),u=e?.querySelectorAll('input[name$="ColorText"]');m?.forEach((p,f)=>{const v=u?.[f];v&&(p.addEventListener("input",()=>{v.value=p.value}),v.addEventListener("input",()=>{/^#[0-9A-F]{6}$/i.test(v.value)&&(p.value=v.value)}))})}c(),o?.addEventListener("click",()=>{H=!0,U(),G(),window.history.replaceState({},document.title,window.location.pathname)}),n?.addEventListener("click",()=>{H=!0,U(),G(),window.history.replaceState({},document.title,window.location.pathname)}),e?.addEventListener("submit",async m=>{m.preventDefault(),console.log("🚀 FORM SUBMIT EVENT TRIGGERED!"),console.log("🚀 Form element:",e),console.log("🚀 Event target:",m.target);const u=window.globalAuthManager||window.simpleAuthManager;if(!u||!u.isUserLoggedIn()){alert("❌ Please log in to submit this form. You must be authenticated to place an order.");return}if(!ae()){console.log("❌ Customization form validation failed, blocking save");return}const p=new FormData(e),f=Object.fromEntries(p);console.log("📝 Project requirements saved:",f),console.log("📝 Form data keys:",Object.keys(f)),console.log("📝 Form data values:",Object.values(f));const v=document.getElementById("selected-product-name").textContent,P=document.getElementById("selected-product-price").textContent;console.log("🧪 Not Order Menu System, skipping database save"),console.log("🧪 Product name was:",v);const I={productId:new URLSearchParams(window.location.search).get("product")||"1",productName:v,productPrice:P,projectName:f.projectName,appName:f.appName,contactPerson:f.contactPerson,productDescriptionCustom:f.productDescription,email:f.email,phone:f.phone,additionalRequirements:f.additionalRequirements,restaurantLogo:f.restaurantLogo,timestamp:new Date().toISOString()};I.restaurantName=f.restaurantName||I.restaurantName||"",I.cuisineType=f.cuisineType||I.cuisineType||"";try{console.log("💾 Saving project form to database...");const N=(k=>(k||"").toLowerCase())(v);let A="restaurant-website";N.includes("order menu")?A="restaurant-menu-system":N.includes("restaurant website")?A="restaurant-website":N.includes("android tv")?A="android-tv-app":N.includes("streaming")&&(A="streaming-mobile-app");let x=I.logoUrl||null,M=I.logoFilename||null,z=I.logoMimeType||null,T=I.logoSize||null;try{const _=e.querySelector('input[name="restaurantLogo"]')?.files?.[0];if(_){const{supabase:l}=await j(async()=>{const{supabase:S}=await import("./supabase.B9-RI-CL.js");return{supabase:S}},__vite__mapDeps([0,1,2])),y=_.name.replace(/\s+/g,"_");if(_.size>10*1024*1024)throw new Error("Logo file exceeds 10MB limit");const g=`${Date.now()}_${y}`,w=await _.arrayBuffer(),{error:B}=await l.storage.from("logos").upload(g,w,{upsert:!0,contentType:_.type,cacheControl:"3600"});if(!B){const{data:S}=l.storage.from("logos").getPublicUrl(g);if(x=S?.publicUrl||null,!x){const{data:$,error:Y}=await l.storage.from("logos").createSignedUrl(g,31536e3);Y||(x=$?.signedUrl||null)}M=_.name,z=_.type,T=_.size}}}catch(k){console.warn("Logo upload skipped:",k)}let h=[];if(N.includes("order menu")&&E.length>0)try{console.log("📸 Starting menu photos upload to Supabase Storage...");const{supabase:k}=await j(async()=>{const{supabase:_}=await import("./supabase.B9-RI-CL.js");return{supabase:_}},__vite__mapDeps([0,1,2]));for(let _=0;_<E.length;_++){const l=E[_],y=l.name.replace(/[^a-zA-Z0-9.-]/g,"_"),w=`menu_photos/${Date.now()}_${_}_${y}`;console.log(`📸 Uploading photo ${_+1}/${E.length}: ${l.name}`),console.log(`📸 Upload path: ${w}`);const B=await l.arrayBuffer(),{error:S}=await k.storage.from("menu-photos").upload(w,B,{upsert:!0,contentType:l.type,cacheControl:"3600"});if(S)console.error(`❌ Error uploading photo ${_+1}:`,S);else{const{data:$}=k.storage.from("menu-photos").getPublicUrl(w);h.push({url:$?.publicUrl||null,filename:l.name,mimeType:l.type,size:l.size,path:w}),console.log(`✅ Photo ${_+1} uploaded successfully:`,$?.publicUrl)}}console.log("📸 Menu photos upload completed. URLs:",h)}catch(k){console.error("❌ Menu photos upload failed:",k)}const b={productName:v,productPrice:P,projectName:I.projectName,contactPerson:I.contactPerson,appName:I.appName,productDescription:I.productDescriptionCustom,restaurantName:I.restaurantName,cuisineType:I.cuisineType,email:I.email,phone:I.phone,primaryColor:I.primaryColor,secondaryColor:I.secondaryColor,accentColor:I.accentColor,textColor:I.textColor,additionalRequirements:I.additionalRequirements,logoUrl:x,logoFilename:M,logoMimeType:z,logoSize:T,menuPhotosUrls:JSON.stringify(h)},L=await ce(b,A);if(L.success)console.log("✅ Project form saved to Supabase database:",L.data),alert(`✅ Project requirements saved to database successfully!

Record ID: ${L.data.id}
Project: ${L.data.project_name}
Restaurant: ${L.data.restaurant_name||"N/A"}
Cuisine: ${L.data.cuisine_type||"N/A"}

Our team will contact you soon!`);else{console.error("❌ Error saving to database:",L.error);const k=JSON.parse(localStorage.getItem("project-requirements")||"[]");k.push(I),localStorage.setItem("project-requirements",JSON.stringify(k)),alert(`❌ Database save failed: ${L.error}

Data saved locally as backup. Our team will contact you soon.`)}window.history.replaceState({},document.title,window.location.pathname),U(),e.reset(),s&&(s.innerHTML=`
            <div class="flex flex-col items-center">
              <svg class="w-12 h-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              <p class="text-gray-600 mb-2">Click to upload restaurant logo</p>
              <p class="text-sm text-gray-500">PNG, JPG, SVG up to 10MB</p>
            </div>
          `)}catch(R){console.error("Error saving requirements:",R),alert("Error saving project requirements. Please try again.")}})}function U(){console.log("🔄 Showing browse products section...");const e=document.getElementById("product-customization-form"),o=document.getElementById("order-menu-customization-form"),n=document.getElementById("recent-activity");console.log("Recent activity element found:",n),e&&!e.classList.contains("hidden")&&(console.log("Hiding product form..."),e.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",e.style.opacity="0",e.style.transform="translateY(-10px)",setTimeout(()=>e.classList.add("hidden"),300)),o&&!o.classList.contains("hidden")&&(console.log("Hiding order menu form..."),o.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",o.style.opacity="0",o.style.transform="translateY(-10px)",setTimeout(()=>o.classList.add("hidden"),300)),setTimeout(()=>{n?(console.log("Showing recent activity section..."),n.style.display="block",n.classList.remove("hidden"),n.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",n.style.opacity="0",n.style.transform="translateY(10px)",setTimeout(()=>{n.style.opacity="1",n.style.transform="translateY(0)",console.log("✅ Browse products section is now visible"),console.log("Recent activity display style:",n.style.display),console.log("Recent activity class list:",n.classList.toString())},50)):console.error("❌ Recent activity element not found!")},350)}window.showBrowseProductsSection=U;document.addEventListener("submit",e=>{if(console.log("🚫 FORM SUBMISSION EVENT DETECTED!"),console.log("🚫 Event target:",e.target),console.log("🚫 Event target ID:",e.target.id),console.log("🚫 Event target tagName:",e.target.tagName),console.log("🚫 Global form submission intercepted:",e.target.id),console.log("🚫 Current menuPhotos length:",typeof E<"u"?E.length:"undefined"),!(!e.target||e.target.id!=="order-menu-form")&&e.target.id==="order-menu-form"){e.preventDefault(),e.stopPropagation(),console.log("🔍 Validating order-menu-form submission..."),console.log("🔍 menuPhotos variable:",E),console.log("🔍 menuPhotos type:",typeof E),console.log("🔍 menuPhotos length:",E?E.length:"undefined");const o=document.getElementById("menu-photos-upload"),n=E&&E.length>0||o&&o.files&&o.files.length>0;if(console.log("🔍 menuPhotos array length:",E?E.length:"undefined"),console.log("🔍 menuPhotosInput files length:",o?o.files.length:"undefined"),console.log("🔍 hasMenuPhotos:",n),!n){console.log("❌ Menu photos validation failed - no photos uploaded");const s=document.getElementById("menu-photos-error");s&&(s.classList.remove("hidden"),s.innerHTML='<div class="bg-red-50 border border-red-200 rounded-lg p-3"><p class="text-red-700 font-medium">Please upload at least one menu photo. This field is required for Order Menu System.</p></div>');const t=document.getElementById("validation-errors");t&&(t.classList.remove("hidden"),t.innerHTML='<div class="bg-red-50 border border-red-200 rounded-lg p-4"><h4 class="text-red-800 font-semibold mb-2">Please fix the following errors:</h4><ul class="list-disc list-inside text-red-700 space-y-1"><li>Please upload at least one menu photo. This field is required for Order Menu System.</li></ul></div>');const a=document.getElementById("menu-photos-upload-area");return a&&a.scrollIntoView({behavior:"smooth",block:"center"}),!1}console.log("🔍 Running form field validation...");const r=ae();if(console.log("🔍 Form validation result:",r),!r)return console.log("❌ Form validation failed - required fields missing"),!1;console.log("✅ All validations passed, proceeding with form submission"),K()}});document.addEventListener("click",e=>{!e.target||!(e.target.type==="submit"||e.target.getAttribute("type")==="submit")||e.target.form&&e.target.form.id==="order-menu-form"&&console.log("🚫 Order menu form submit button clicked - letting submit event handle it")});document.addEventListener("DOMContentLoaded",()=>{console.log("🔧 Setting up global event listeners for order menu form buttons");const e=document.getElementById("close-order-menu-form");e?(console.log("✅ Global close button found, adding event listener"),e.addEventListener("click",n=>{console.log("🚀 Global close button clicked!"),n.preventDefault(),n.stopPropagation();const r=document.getElementById("order-menu-customization-form");r&&r.classList.add("hidden"),window.history.replaceState({},document.title,window.location.pathname),H=!0,U(),G()})):console.log("❌ Global close button not found");const o=document.getElementById("cancel-order-menu");o?(console.log("✅ Global cancel button found, adding event listener"),o.addEventListener("click",n=>{console.log("🚀 Global cancel button clicked!"),n.preventDefault(),n.stopPropagation();const r=document.getElementById("order-menu-customization-form");r&&r.classList.add("hidden"),window.history.replaceState({},document.title,window.location.pathname),H=!0,U(),G()})):console.log("❌ Global cancel button not found")});async function O(){console.log("🔄 Attempting to auto-fill user details...");const e=async()=>{const o=window.globalAuthManager||window.simpleAuthManager;if(!o||!o.isUserLoggedIn())return console.log("❌ User not logged in - skipping auto-fill"),!1;const n=o.getCurrentUser();if(console.log("👤 Current user from auth manager:",n),!n||!n.email)return console.log("❌ No valid user data found - skipping auto-fill"),!1;if(!n.id&&!n.user_id)return console.log("❌ User lacks proper authentication ID - skipping auto-fill"),!1;console.log("✅ User is properly authenticated - proceeding with auto-fill"),n&&n.email&&(console.log("📧 Auto-filling email:",n.email),document.querySelectorAll('input[name="email"], input[type="email"]').forEach(t=>{t.value=n.email,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Filled email field:",t)}));const r=n?n.phone||n.phone_number||n?.user_metadata?.phone||n?.user_metadata?.phone_number:null;r&&(console.log("📱 Auto-filling phone:",r),document.querySelectorAll('input[name="phone"], input[type="tel"]').forEach(t=>{t.value=r,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Filled phone field:",t)})),n&&n.full_name&&(console.log("👤 Auto-filling contact person:",n.full_name),document.querySelectorAll('input[name="contactPerson"]').forEach(t=>{t.value=n.full_name,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Filled contact person field:",t)}));try{const{supabase:s}=await j(async()=>{const{supabase:a}=await import("./supabase.B9-RI-CL.js");return{supabase:a}},__vite__mapDeps([0,1,2])),{data:{user:t}}=await s.auth.getUser();if(t){const{data:a}=await s.from("profiles").select("email, phone, phone_number, full_name").eq("id",t.id).single();if(a){a.email&&document.querySelectorAll('input[name="email"], input[type="email"]').forEach(d=>{d.value=a.email,d.dispatchEvent(new Event("input",{bubbles:!0})),d.dispatchEvent(new Event("change",{bubbles:!0}))});const i=a.phone||a.phone_number;i&&document.querySelectorAll('input[name="phone"], input[type="tel"]').forEach(d=>{d.value=i,d.dispatchEvent(new Event("input",{bubbles:!0})),d.dispatchEvent(new Event("change",{bubbles:!0}))}),a.full_name&&document.querySelectorAll('input[name="contactPerson"]').forEach(d=>{d.value=a.full_name,d.dispatchEvent(new Event("input",{bubbles:!0})),d.dispatchEvent(new Event("change",{bubbles:!0}))})}}}catch{}return console.log("✅ Auto-fill completed with auth manager data"),!0};if(!await e()){let o=0;const n=50,r=setInterval(()=>{o++,e().then(s=>{if((s||o>=n)&&(clearInterval(r),o>=n)){console.log("⏰ Auth manager timeout - user appears to be not logged in"),console.log("❌ No authenticated user found - forms will remain empty");return}})},100)}}let H=!1;async function ee(){const e=document.getElementById("activity-content");e&&(e.innerHTML=`
      <div class="text-center py-6">
        <p class="text-gray-800 text-base font-medium">Get started with your first order</p>
        <p class="text-gray-500 text-sm mt-1">Choose a product, submit your requirements, and track it in My Orders.</p>
        <div class="mt-4 flex items-center justify-center gap-3">
          <a href="/products" class="inline-flex items-center px-5 py-2.5 rounded-md bg-primary-600 text-white hover:bg-primary-700 transition-colors">Browse Products</a>
        </div>
      </div>
    `)}function G(){const e=document.getElementById("activity-content"),o=document.getElementById("recent-activity");o&&(o.classList.remove("hidden"),o.style.display="block"),e&&(e.innerHTML=`
      <div class="text-center py-6">
        <p class="text-gray-800 text-base font-medium">Get started with your first order</p>
        <p class="text-gray-500 text-sm mt-1">Choose a product, submit your requirements, and track it in My Orders.</p>
        <div class="mt-4 flex items-center justify-center gap-3">
          <a href="/products" class="inline-flex items-center px-5 py-2.5 rounded-md bg-primary-600 text-white hover:bg-primary-700 transition-colors">Browse Products</a>
        </div>
      </div>
    `)}window.viewOrderDetails=async function(e){console.log("🔄 Loading order details for:",e);try{const{supabase:o}=await j(async()=>{const{supabase:t}=await import("./supabase.B9-RI-CL.js");return{supabase:t}},__vite__mapDeps([0,1,2])),{data:n,error:r}=await o.from("order_customizations").select("*").eq("id",e).single();if(r){console.error("Error loading customization details:",r),alert("Error loading order details: "+r.message);return}const s=`
Order Menu System Details:
=========================

Project Information:
-------------------
Project Name: ${n.project_name||"Not provided"}
Restaurant Name: ${n.restaurant_name||"Not provided"}
Owner Name: ${n.owner_name||"Not provided"}
Contact Person: ${n.contact_person||"Not provided"}

Contact Information:
-------------------
Email: ${n.email||"Not provided"}
Phone: ${n.phone_number||"Not provided"}

Address Information:
------------------
House/Flat Number: ${n.house_flat_number||"Not provided"}
Address: ${n.address_line_1||"Not provided"}
City: ${n.city||"Not provided"}
State: ${n.state||"Not provided"}
Pincode: ${n.pincode||"Not provided"}
Country: ${n.country||"Not provided"}

Additional Requirements:
-----------------------
${n.additional_requirements||"No additional requirements provided"}

Order Details:
-------------
Price: ₹${(n.total_amount||0).toLocaleString("en-IN")}
Submitted: ${new Date(n.created_at).toLocaleString()}
Status: Submitted
      `;alert(s)}catch(o){console.error("Error viewing order details:",o),alert("Error viewing order details: "+o.message)}};window.openImageModal=function(e,o){console.log("Opening image modal for:",o);const n=document.createElement("div");n.className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",n.innerHTML=`
      <div class="relative max-w-4xl max-h-full p-4">
        <button onclick="closeImageModal()" class="absolute top-2 right-2 z-10 bg-white bg-opacity-80 hover:bg-opacity-100 rounded-full p-2 transition-all">
          <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
        <img 
          src="${e}" 
          alt="${o}"
          class="max-w-full max-h-full object-contain rounded-lg shadow-2xl"
          onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDQwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yMDAgMTIwTDI0MCAxNjBIMTYwTDIwMCAxMjBaIiBmaWxsPSIjOUNBM0FGIi8+CjxjaXJjbGUgY3g9IjIwMCIgY3k9IjIwMCIgcj0iMjAiIGZpbGw9IiM5Q0EzQUYiLz4KPHRleHQgeD0iMjAwIiB5PSIyNDAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNiIgZm9udC13ZWlnaHQ9ImJvbGQiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiM2QjcyODAiPkltYWdlIFVuYXZhaWxhYmxlPC90ZXh0Pgo8L3N2Zz4K'"
        />
        <div class="absolute bottom-4 left-4 right-4 bg-black bg-opacity-50 text-white p-3 rounded-lg">
          <p class="text-sm font-medium">${o}</p>
        </div>
      </div>
    `,n.addEventListener("click",function(s){s.target===n&&closeImageModal()});const r=function(s){s.key==="Escape"&&(closeImageModal(),document.removeEventListener("keydown",r))};document.addEventListener("keydown",r),document.body.appendChild(n),window.currentImageModal=n};window.closeImageModal=function(){window.currentImageModal&&(document.body.removeChild(window.currentImageModal),window.currentImageModal=null)};window.testFileUpload=async function(){console.log("🧪 Testing file upload...");const e=document.getElementById("menu-photos-upload");if(console.log("📸 File input element:",e),console.log("📸 Files in input:",e?e.files:"no input"),e&&e.files&&e.files.length>0){const o=e.files[0];console.log("📸 Testing with file:",o.name,o.size,o.type);try{const{supabase:n}=await j(async()=>{const{supabase:i}=await import("./supabase.B9-RI-CL.js");return{supabase:i}},__vite__mapDeps([0,1,2]));console.log("📸 Supabase client loaded");const r=await o.arrayBuffer();console.log("📸 File converted to buffer:",r.byteLength,"bytes");const t=`menu_photos/test_${Date.now()}_${o.name}`;console.log("📸 Upload path:",t);const{error:a}=await n.storage.from("menu-photos").upload(t,r,{upsert:!0,contentType:o.type});if(a)console.error("❌ Upload failed:",a);else{const{data:i}=n.storage.from("menu-photos").getPublicUrl(t);console.log("✅ Upload successful:",i.publicUrl),console.log("🎯 Check your Supabase Storage menu-photos bucket!")}}catch(n){console.error("❌ Test failed:",n)}}else console.log("❌ No files selected")};document.addEventListener("DOMContentLoaded",()=>{console.log("Dashboard DOM loaded - initializing with global auth manager");const e=new URLSearchParams(window.location.search),o=e.has("product")&&e.has("price");window.location.search&&!o&&window.history.replaceState({},document.title,window.location.pathname);const n=new URLSearchParams(window.location.search),r=n.get("product"),s=n.get("price"),t=document.getElementById("recent-activity");if(!r||!s){t&&(t.style.display="block",t.classList.remove("hidden"),console.log("✅ Showing browse products section - no product selected"),ee());const c=document.getElementById("product-customization-form"),m=document.getElementById("order-menu-customization-form");c&&c.classList.add("hidden"),m&&m.classList.add("hidden")}else t&&(t.style.display="none",t.classList.add("hidden"),console.log("✅ Hiding browse products section - product selected"));if(document.body.style.opacity="1",r&&s){console.log("URL parameters detected - showing form for product:",r);const m=[{id:"1",name:"Restaurant Menu System",description:"Digital menu system with QR code integration, online ordering, and real-time updates. Perfect for restaurants looking to modernize their customer experience.",price:25e3,type:"restaurant"},{id:"2",name:"Android TV App",description:"Custom Android TV applications with beautiful UI, content management, and remote control support. Perfect for streaming services and media companies.",price:55e3,type:"non-restaurant"},{id:"3",name:"Streaming Mobile App",description:"Mobile streaming applications for iOS and Android with custom features, user authentication, and content management.",price:35e3,type:"non-restaurant"},{id:"4",name:"Restaurant Website",description:"Professional restaurant website with online ordering, menu display, and customer management features.",price:2e4,type:"restaurant"},{id:"5",name:"Order Menu System",description:"Complete order management system with digital menu integration, real-time order tracking, and payment processing. Perfect for restaurants looking to streamline their ordering process.",price:999,type:"order-menu"}].find(u=>u.id===r);if(m){document.getElementById("selected-product-name").textContent=m.name,document.getElementById("selected-product-price").textContent=`₹${m.price.toLocaleString()}`,document.getElementById("order-menu-product-name").textContent=m.name;const u=document.getElementById("recent-activity"),p=document.getElementById("product-customization-form"),f=document.getElementById("order-menu-customization-form");u&&(u.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",u.style.opacity="0",u.style.transform="translateY(-10px)",setTimeout(()=>{u.classList.add("hidden")},300)),setTimeout(()=>{if(m.type==="order-menu")f&&(f.classList.remove("hidden"),f.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",f.style.opacity="0",f.style.transform="translateY(10px)",setTimeout(()=>{f.style.opacity="1",f.style.transform="translateY(0)"},50));else{p&&(p.classList.remove("hidden"),p.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",p.style.opacity="0",p.style.transform="translateY(10px)",setTimeout(()=>{p.style.opacity="1",p.style.transform="translateY(0)"},50));const v=document.getElementById("cuisine-type-field"),P=document.getElementById("restaurant-name-field");m.type==="restaurant"?(v.classList.remove("hidden"),v.querySelector("select").setAttribute("required","required"),P.classList.remove("hidden"),P.querySelector("input").setAttribute("required","required")):(v.classList.add("hidden"),v.querySelector("select").removeAttribute("required"),P.classList.add("hidden"),P.querySelector("input").removeAttribute("required"))}},300),setTimeout(()=>O(),500)}}me(),ye(),he(),O(),setTimeout(()=>O(),1e3),setTimeout(()=>O(),2e3);const a=new MutationObserver(c=>{c.forEach(m=>{if(m.type==="attributes"&&m.attributeName==="class"){const u=m.target;(u.id==="product-customization-form"||u.id==="order-menu-customization-form")&&(u.classList.contains("hidden")||(console.log("👁️ Form became visible, auto-filling..."),setTimeout(()=>O(),100)))}})}),i=document.getElementById("product-customization-form"),d=document.getElementById("order-menu-customization-form");i&&a.observe(i,{attributes:!0,attributeFilter:["class"]}),d&&a.observe(d,{attributes:!0,attributeFilter:["class"]}),F(),setTimeout(()=>F(),100),setTimeout(()=>F(),500),setTimeout(()=>F(),1e3),setTimeout(()=>F(),2e3),setTimeout(()=>{const c=new URLSearchParams(window.location.search),m=c.get("product"),u=c.get("price"),p=document.getElementById("recent-activity");!m||!u?p&&(p.style.display="block",p.classList.remove("hidden"),console.log("✅ Browse products section confirmed visible - no product selected")):p&&(p.style.display="none",console.log("✅ Browse products section confirmed hidden - product selected"))},1e3)});window.addEventListener("load",()=>{console.log("Window loaded - trying again"),F()});let X=0;const fe=5,ve=setInterval(()=>{X++,console.log(`Attempt ${X} to load user data...`),F(),X>=fe&&(clearInterval(ve),console.log("Max attempts reached"))},2e3);window.addEventListener("user-logged-in",()=>{console.log("User logged in event received in dashboard"),F(),setTimeout(()=>ee(),100)});window.addEventListener("user-logged-out",()=>{console.log("User logged out event received in dashboard"),F(),setTimeout(()=>ee(),100)});console.log("✅ Dashboard script initialized with global auth manager");const W={400001:{city:"Mumbai",state:"Maharashtra"},400002:{city:"Mumbai",state:"Maharashtra"},400003:{city:"Mumbai",state:"Maharashtra"},400004:{city:"Mumbai",state:"Maharashtra"},400005:{city:"Mumbai",state:"Maharashtra"},400006:{city:"Mumbai",state:"Maharashtra"},400007:{city:"Mumbai",state:"Maharashtra"},400008:{city:"Mumbai",state:"Maharashtra"},400009:{city:"Mumbai",state:"Maharashtra"},400010:{city:"Mumbai",state:"Maharashtra"},110001:{city:"New Delhi",state:"Delhi"},110002:{city:"New Delhi",state:"Delhi"},110003:{city:"New Delhi",state:"Delhi"},110004:{city:"New Delhi",state:"Delhi"},110005:{city:"New Delhi",state:"Delhi"},110006:{city:"New Delhi",state:"Delhi"},110007:{city:"New Delhi",state:"Delhi"},110008:{city:"New Delhi",state:"Delhi"},110009:{city:"New Delhi",state:"Delhi"},110010:{city:"New Delhi",state:"Delhi"},560001:{city:"Bangalore",state:"Karnataka"},560002:{city:"Bangalore",state:"Karnataka"},560003:{city:"Bangalore",state:"Karnataka"},560004:{city:"Bangalore",state:"Karnataka"},560005:{city:"Bangalore",state:"Karnataka"},560006:{city:"Bangalore",state:"Karnataka"},560007:{city:"Bangalore",state:"Karnataka"},560008:{city:"Bangalore",state:"Karnataka"},560009:{city:"Bangalore",state:"Karnataka"},560010:{city:"Bangalore",state:"Karnataka"},600001:{city:"Chennai",state:"Tamil Nadu"},600002:{city:"Chennai",state:"Tamil Nadu"},600003:{city:"Chennai",state:"Tamil Nadu"},600004:{city:"Chennai",state:"Tamil Nadu"},600005:{city:"Chennai",state:"Tamil Nadu"},600006:{city:"Chennai",state:"Tamil Nadu"},600007:{city:"Chennai",state:"Tamil Nadu"},600008:{city:"Chennai",state:"Tamil Nadu"},600009:{city:"Chennai",state:"Tamil Nadu"},600010:{city:"Chennai",state:"Tamil Nadu"},700001:{city:"Kolkata",state:"West Bengal"},700002:{city:"Kolkata",state:"West Bengal"},700003:{city:"Kolkata",state:"West Bengal"},700004:{city:"Kolkata",state:"West Bengal"},700005:{city:"Kolkata",state:"West Bengal"},700006:{city:"Kolkata",state:"West Bengal"},700007:{city:"Kolkata",state:"West Bengal"},700008:{city:"Kolkata",state:"West Bengal"},700009:{city:"Kolkata",state:"West Bengal"},700010:{city:"Kolkata",state:"West Bengal"},380001:{city:"Ahmedabad",state:"Gujarat"},380002:{city:"Ahmedabad",state:"Gujarat"},380003:{city:"Ahmedabad",state:"Gujarat"},380004:{city:"Ahmedabad",state:"Gujarat"},380005:{city:"Ahmedabad",state:"Gujarat"},380006:{city:"Ahmedabad",state:"Gujarat"},380007:{city:"Ahmedabad",state:"Gujarat"},380008:{city:"Ahmedabad",state:"Gujarat"},380009:{city:"Ahmedabad",state:"Gujarat"},380010:{city:"Ahmedabad",state:"Gujarat"},411001:{city:"Pune",state:"Maharashtra"},411002:{city:"Pune",state:"Maharashtra"},411003:{city:"Pune",state:"Maharashtra"},411004:{city:"Pune",state:"Maharashtra"},411005:{city:"Pune",state:"Maharashtra"},411006:{city:"Pune",state:"Maharashtra"},411007:{city:"Pune",state:"Maharashtra"},411008:{city:"Pune",state:"Maharashtra"},411009:{city:"Pune",state:"Maharashtra"},411010:{city:"Pune",state:"Maharashtra"},302001:{city:"Jaipur",state:"Rajasthan"},302002:{city:"Jaipur",state:"Rajasthan"},302003:{city:"Jaipur",state:"Rajasthan"},302004:{city:"Jaipur",state:"Rajasthan"},302005:{city:"Jaipur",state:"Rajasthan"},302006:{city:"Jaipur",state:"Rajasthan"},302007:{city:"Jaipur",state:"Rajasthan"},302008:{city:"Jaipur",state:"Rajasthan"},302009:{city:"Jaipur",state:"Rajasthan"},302010:{city:"Jaipur",state:"Rajasthan"},641001:{city:"Coimbatore",state:"Tamil Nadu"},641002:{city:"Coimbatore",state:"Tamil Nadu"},641003:{city:"Coimbatore",state:"Tamil Nadu"},641004:{city:"Coimbatore",state:"Tamil Nadu"},641005:{city:"Coimbatore",state:"Tamil Nadu"},625001:{city:"Madurai",state:"Tamil Nadu"},625002:{city:"Madurai",state:"Tamil Nadu"},625003:{city:"Madurai",state:"Tamil Nadu"},625004:{city:"Madurai",state:"Tamil Nadu"},625005:{city:"Madurai",state:"Tamil Nadu"},570001:{city:"Mysore",state:"Karnataka"},570002:{city:"Mysore",state:"Karnataka"},570003:{city:"Mysore",state:"Karnataka"},570004:{city:"Mysore",state:"Karnataka"},570005:{city:"Mysore",state:"Karnataka"},580001:{city:"Hubli",state:"Karnataka"},580002:{city:"Hubli",state:"Karnataka"},580003:{city:"Hubli",state:"Karnataka"},580004:{city:"Hubli",state:"Karnataka"},580005:{city:"Hubli",state:"Karnataka"},500001:{city:"Hyderabad",state:"Telangana"},500002:{city:"Hyderabad",state:"Telangana"},500003:{city:"Hyderabad",state:"Telangana"},500004:{city:"Hyderabad",state:"Telangana"},500005:{city:"Hyderabad",state:"Telangana"},500006:{city:"Hyderabad",state:"Telangana"},500007:{city:"Hyderabad",state:"Telangana"},500008:{city:"Hyderabad",state:"Telangana"},500009:{city:"Hyderabad",state:"Telangana"},500010:{city:"Hyderabad",state:"Telangana"},110001:{city:"Delhi",state:"Delhi"},110002:{city:"Delhi",state:"Delhi"},110003:{city:"Delhi",state:"Delhi"},110004:{city:"Delhi",state:"Delhi"},110005:{city:"Delhi",state:"Delhi"},110006:{city:"Delhi",state:"Delhi"},110007:{city:"Delhi",state:"Delhi"},110008:{city:"Delhi",state:"Delhi"},110009:{city:"Delhi",state:"Delhi"},110010:{city:"Delhi",state:"Delhi"},560001:{city:"Bangalore",state:"Karnataka"},560002:{city:"Bangalore",state:"Karnataka"},560003:{city:"Bangalore",state:"Karnataka"},560004:{city:"Bangalore",state:"Karnataka"},560005:{city:"Bangalore",state:"Karnataka"},560006:{city:"Bangalore",state:"Karnataka"},560007:{city:"Bangalore",state:"Karnataka"},560008:{city:"Bangalore",state:"Karnataka"},560009:{city:"Bangalore",state:"Karnataka"},560010:{city:"Bangalore",state:"Karnataka"},600001:{city:"Chennai",state:"Tamil Nadu"},600002:{city:"Chennai",state:"Tamil Nadu"},600003:{city:"Chennai",state:"Tamil Nadu"},600004:{city:"Chennai",state:"Tamil Nadu"},600005:{city:"Chennai",state:"Tamil Nadu"},600006:{city:"Chennai",state:"Tamil Nadu"},600007:{city:"Chennai",state:"Tamil Nadu"},600008:{city:"Chennai",state:"Tamil Nadu"},600009:{city:"Chennai",state:"Tamil Nadu"},600010:{city:"Chennai",state:"Tamil Nadu"},700001:{city:"Kolkata",state:"West Bengal"},700002:{city:"Kolkata",state:"West Bengal"},700003:{city:"Kolkata",state:"West Bengal"},700004:{city:"Kolkata",state:"West Bengal"},700005:{city:"Kolkata",state:"West Bengal"},700006:{city:"Kolkata",state:"West Bengal"},700007:{city:"Kolkata",state:"West Bengal"},700008:{city:"Kolkata",state:"West Bengal"},700009:{city:"Kolkata",state:"West Bengal"},700010:{city:"Kolkata",state:"West Bengal"}};function q(){const e=document.getElementById("pincode-input"),o=document.getElementById("city-input"),n=document.getElementById("state-input"),r=document.getElementById("city-suggestions"),s=document.getElementById("state-suggestions");e&&o&&n&&(console.log("Initializing pincode autocomplete..."),e.addEventListener("input",function(){const t=this.value.trim();if(console.log("Pincode entered:",t),t.length===6&&W[t]){console.log("Found pincode data:",W[t]),o.value=W[t].city,n.value=W[t].state;const a=document.getElementById("country-select");a&&(a.value="India")}}),o.addEventListener("input",function(){const t=this.value.toLowerCase();if(t.length>0){const a=V.filter(i=>i.toLowerCase().includes(t));oe(r,a,o)}else D(r)}),n.addEventListener("input",function(){const t=this.value.toLowerCase();if(t.length>0){const a=J.filter(i=>i.toLowerCase().includes(t));oe(s,a,n)}else D(s)}),document.addEventListener("click",function(t){!o.contains(t.target)&&!r.contains(t.target)&&D(r),!n.contains(t.target)&&!s.contains(t.target)&&D(s)}))}document.addEventListener("DOMContentLoaded",function(){q(),setTimeout(q,500),setTimeout(q,1e3),setTimeout(q,2e3)});setTimeout(q,3e3);setTimeout(q,5e3);function be(){console.log("Reinitializing pincode autocomplete..."),q()}window.reinitializePincodeAutocomplete=be;document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("test-save");e&&e.addEventListener("click",async function(){console.log("🧪 Test save button clicked!");const a=document.getElementById("requirements-form");if(a){const i=new FormData(a),d=Object.fromEntries(i);console.log("🧪 Test save - Form data:",d),await we(d)}else console.error("❌ Form not found for test save")});const o=document.getElementById("simple-test");o&&o.addEventListener("click",async function(){console.log("🔵 Simple test button clicked!"),alert("🔵 Simple test button works!");const a={project_name:"Simple Test Project",restaurant_name:"Simple Test Restaurant",owner_name:"Simple Test Owner",contact_person:"Simple Test Contact",email:"test@example.com",phone_number:"1234567890",house_flat_number:"123",address_line_1:"Test Address",city:"Test City",state:"Test State",pincode:"123456",country:"India",restaurant_logo_url:null,menu_photos_urls:[],additional_requirements:"Simple test requirements",base_package_cost:999,gst_amount:180,total_amount:1179,status:"pending",payment_status:"pending"};console.log("🔵 Simple test data:",a);try{const{data:i,error:d}=await window.supabase.from("order_customizations").insert(a).select();d?(console.error("❌ Simple test failed:",d),alert("❌ Simple test failed: "+d.message)):(console.log("✅ Simple test successful!",i),alert("✅ Simple test successful! Data saved to database."))}catch(i){console.error("❌ Simple test error:",i),alert("❌ Simple test error: "+i.message)}});function n(){const a=document.getElementById("requirements-form");return console.log("🔍 Form found:",!!a),console.log("🔍 Form element:",a),a?(console.log("✅ Form found, adding event listener..."),a.addEventListener("submit",async function(i){i.preventDefault(),console.log("🚀 FORCE FORM SUBMISSION TRIGGERED!"),alert("🚀 Form submission detected!");const d=new FormData(a),c=Object.fromEntries(d);console.log("🚀 Form data collected:",c);try{const m={project_name:c.projectName||"Manual Test Project",restaurant_name:c.restaurantName||"Manual Test Restaurant",owner_name:c.ownerName||"Manual Test Owner",contact_person:c.contactPerson||"Manual Test Contact",email:c.email||"manual@test.com",phone_number:c.phone||"1234567890",house_flat_number:c.houseNumber||"123",address_line_1:c.addressLine1||"Manual Test Address",city:c.city||"Manual Test City",state:c.state||"Manual Test State",pincode:c.pincode||"123456",country:c.country||"India",restaurant_logo_url:null,menu_photos_urls:[],additional_requirements:c.additionalRequirements||"Manual test requirements",base_package_cost:999,gst_amount:180,total_amount:1179,status:"pending",payment_status:"pending"};console.log("🚀 Insert data prepared:",m);const{data:u,error:p}=await window.supabase.from("order_customizations").insert(m).select();p?(console.error("❌ Force save failed:",p),alert("❌ Save failed: "+p.message)):(console.log("✅ Force save successful!",u),alert("✅ Data saved successfully to order_customizations table!"))}catch(m){console.error("❌ Force save error:",m),alert("❌ Save error: "+m.message)}}),!0):(console.log("⏳ Form not found yet, will retry..."),!1)}n()||setTimeout(()=>{console.log("🔄 Retrying form setup after 1 second..."),n()||setTimeout(()=>{console.log("🔄 Retrying form setup after 3 seconds..."),n()||setTimeout(()=>{console.log("🔄 Retrying form setup after 5 seconds..."),n()},5e3)},3e3)},1e3),document.addEventListener("submit",function(a){console.log("🌍 Global form submission detected!"),console.log("🌍 Form element:",a.target),console.log("🌍 Form ID:",a.target.id),a.target.id==="requirements-form"&&(console.log("🌍 Requirements form submitted globally!"),alert("🌍 Global form submission detected!"))}),console.log("🔍 Looking for save button...");const r=document.getElementById("order-menu-form");let s=null;if(r&&(console.log("🔍 Order menu form found:",r),s=r.querySelector('button[type="submit"]'),console.log("🔍 Save button in order menu form:",s)),!s){const a=document.querySelectorAll("button");console.log("🔍 All buttons found:",a.length);for(let i of a)if(i.textContent.includes("Save and Make Payment")&&r&&r.contains(i)){s=i,console.log("🔍 Found save button by text in order menu form:",s);break}}if(s){console.log("🔴 Save button found:",s);let a=!1;s.addEventListener("click",async function(i){if(console.log("🔴 Save button clicked (unified flow)!"),i.preventDefault(),!a){a=!0;try{await K();try{document.getElementById("order-menu-form")?.reset()}catch{}try{document.getElementById("customization-form")?.reset()}catch{}}catch(d){console.error("❌ Save button unified flow error:",d)}finally{a=!1}}})}else{console.error("❌ Save button not found!");const a=document.getElementById("save-and-pay");if(a){let i=!1;a.addEventListener("click",async d=>{if(d.preventDefault(),!i){i=!0;try{await K();try{document.getElementById("order-menu-form")?.reset()}catch{}try{document.getElementById("customization-form")?.reset()}catch{}}finally{i=!1}}})}}const t=document.getElementById("direct-save");t&&t.addEventListener("click",async function(){console.log("🔴 Direct save button clicked!");try{await K()}catch(a){console.error("❌ Direct save flow failed:",a),alert("❌ Direct save failed. See console.")}})});function oe(e,o,n){if(o.length===0){D(e);return}e.innerHTML="",o.slice(0,5).forEach(r=>{const s=document.createElement("div");s.className="px-4 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-200",s.textContent=r,s.addEventListener("click",function(){n.value=r,D(e)}),e.appendChild(s)}),e.classList.remove("hidden"),e.style.position="absolute",e.style.zIndex="10",e.style.width=n.offsetWidth+"px",e.style.top=n.offsetTop+n.offsetHeight+"px",e.style.left=n.offsetLeft+"px"}function D(e){e.classList.add("hidden")}async function we(e){try{console.log("🧪 Starting direct save test..."),console.log("🧪 Form data received:",e),console.log("🧪 Form data keys:",Object.keys(e)),console.log("🧪 Form data values:",Object.values(e));const n=(window.globalAuthManager||window.simpleAuthManager)?.getCurrentUser();if(console.log("🧪 Current user:",n),!n){console.error("❌ No user found for direct save test");return}if(!window.supabase){console.error("❌ Supabase not available for direct save test"),alert("❌ Supabase not available! Check console for details.");return}console.log("🧪 Testing Supabase connection...");try{const{data:a,error:i}=await window.supabase.from("order_customizations").select("count").limit(1);if(i){console.error("❌ Supabase connection test failed:",i),alert("❌ Supabase connection failed: "+i.message);return}else console.log("✅ Supabase connection test successful")}catch(a){console.error("❌ Supabase connection error:",a),alert("❌ Supabase connection error: "+a.message);return}const r={project_name:e.projectName||"Test Project",restaurant_name:e.restaurantName||"Test Restaurant",owner_name:e.ownerName||"Test Owner",contact_person:e.contactPerson||"Test Contact",email:e.email||n.email,phone_number:e.phone||"1234567890",house_flat_number:e.houseNumber||"123",address_line_1:e.addressLine1||"Test Address",city:e.city||"Test City",state:e.state||"Test State",pincode:e.pincode||"123456",country:e.country||"India",restaurant_logo_url:null,menu_photos_urls:[],additional_requirements:e.additionalRequirements||"Test requirements",base_package_cost:999,gst_amount:180,total_amount:1179,status:"pending",payment_status:"pending"};console.log("🧪 Insert data prepared:",r);const{data:s,error:t}=await window.supabase.from("order_customizations").insert(r).select();t?(console.error("❌ Direct save test failed:",t),console.error("❌ Error details:",JSON.stringify(t,null,2))):(console.log("✅ Direct save test successful!",s),alert("✅ Data saved successfully to order_customizations table!"))}catch(o){console.error("❌ Direct save test error:",o)}}
