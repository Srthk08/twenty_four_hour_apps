import{c}from"./index.BymsOcZI.js";import"./Toast.astro_astro_type_script_index_0_lang.DNmGtDky.js";import"https://unpkg.com/@supabase/supabase-js@2";import"./preload-helper.CLcXU_4U.js";const i="https://lmrrdcaavwwletcjcpqv.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ",s=c(i,n);async function l(){try{const{data:r,error:o}=await s.auth.getSession();if(o){console.error("Auth callback error:",o);return}if(r.session?.user){const e=r.session.user;if(e.app_metadata.provider==="google"){console.log("Google user authenticated:",e);try{const{data:a,error:t}=await s.rpc("sync_google_user",{p_google_id:e.user_metadata.provider_id,p_email:e.email,p_name:e.user_metadata.full_name,p_picture:e.user_metadata.avatar_url,p_provider_id:e.user_metadata.provider_id});t?console.error("Sync error:",t):console.log("User synced successfully:",a)}catch(a){console.error("Sync error:",a)}}setTimeout(()=>{window.location.href="/dashboard"},2e3)}}catch(r){console.error("Callback error:",r)}}l();s.auth.onAuthStateChange((r,o)=>{r==="SIGNED_IN"&&o?.user&&(console.log("User signed in:",o.user),setTimeout(()=>{window.location.href="/dashboard"},1e3))});
