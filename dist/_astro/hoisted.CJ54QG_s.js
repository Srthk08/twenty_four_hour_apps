const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/supabase.DO6XXPT9.js","_astro/index.BFAZBQoJ.js"])))=>i.map(i=>d[i]);
import{c as de,_ as oe}from"./index.BFAZBQoJ.js";import"./ProductDialog.astro_astro_type_script_index_0_lang.BMBe0S5g.js";import"https://unpkg.com/@supabase/supabase-js@2";import"./AuthGuard.astro_astro_type_script_index_0_lang.DULNhCHQ.js";const ue="https://lmrrdcaavwwletcjcpqv.supabase.co",me="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ",ce=de(ue,me),pe={"restaurant-website":"restaurant-website","streaming-mobile-app":"streaming-mobile-app","android-tv-app":"android-tv-app","restaurant-menu-system":"restaurant-menu-system","order-menu-system":"restaurant-menu-system"};async function ge(e,o){try{if(console.log("💾 Saving customization form to Supabase...",{formData:e,productType:o}),o==="order-menu-system")return await he(e);const s={product_type:pe[o]||o,product_name:e.productName||e.product_name||"Unknown Product",product_price:e.productPrice||e.product_price||"₹0",project_name:e.projectName||e.project_name||"",contact_person:e.contactPerson||e.contact_person||"",app_name:e.appName||e.app_name||"",product_description:e.productDescription||e.product_description||"",restaurant_name:e.restaurantName||e.restaurant_name||null,cuisine_type:e.cuisineType||e.cuisine_type||null,logo_url:e.logoUrl||e.logo_url||null,logo_filename:e.logoFilename||e.logo_filename||null,logo_mime_type:e.logoMimeType||e.logo_mime_type||null,logo_size:e.logoSize||e.logo_size||null,contact_email:e.email||e.contact_email||e.contactEmail||"",contact_phone:e.phone||e.contact_phone||e.contactPhone||"",primary_color:e.primaryColor||e.primary_color||"#3B82F6",secondary_color:e.secondaryColor||e.secondary_color||"#10B981",accent_color:e.accentColor||e.accent_color||"#F59E0B",text_color:e.textColor||e.text_color||"#1F2937",additional_requirements:e.additionalRequirements||e.additional_requirements||"",menu_items:e.menuItems||e.menu_items||[],restaurant_address:e.restaurantAddress||e.restaurant_address||null,owner_name:e.ownerName||e.owner_name||null,status:"pending"};console.log("🧩 Inserting customization form for other products...");const{data:a,error:t}=await ce.from("customization_forms").insert(s).select().single();return t?(console.error("❌ Error inserting customization form:",t),console.error("❌ Error details:",{message:t.message,details:t.details,hint:t.hint,code:t.code}),{success:!1,error:t.message,data:null}):(console.log("✅ Customization form inserted successfully:",a),{success:!0,error:null,data:a})}catch(n){return console.error("❌ Unexpected error saving customization form:",n),{success:!1,error:n.message,data:null}}}async function he(e){try{console.log("💾 Saving OMS customization form to Supabase...",{formData:e});const{data:o,error:n}=await ce.rpc("upsert_oms_customization",{p_user_email:e.email||e.contact_email||e.contactEmail||"",p_project_name:e.projectName||e.project_name||"",p_restaurant_name:e.restaurantName||e.restaurant_name||"Default Restaurant",p_owner_name:e.ownerName||e.owner_name||e.contactPerson||e.contact_person||"",p_restaurant_address:e.restaurantAddress||e.restaurant_address||"Not provided",p_contact_person:e.contactPerson||e.contact_person||"",p_phone_number:e.phone||e.contact_phone||e.contactPhone||"",p_user_id:null,p_logo_url:e.logoUrl||e.logo_url||null,p_logo_filename:e.logoFilename||e.logo_filename||null,p_logo_size:e.logoSize||e.logo_size||null,p_menu_categories:e.menuCategories||e.menu_categories||[],p_menu_items:e.menuItems||e.menu_items||[],p_primary_color:e.primaryColor||e.primary_color||"#3B82F6",p_secondary_color:e.secondaryColor||e.secondary_color||"#10B981",p_accent_color:e.accentColor||e.accent_color||"#F59E0B",p_text_color:e.textColor||e.text_color||"#1F2937",p_additional_requirements:e.additionalRequirements||e.additional_requirements||""});if(n)return console.error("❌ Error inserting OMS customization:",n),console.error("❌ Error details:",{message:n.message,details:n.details,hint:n.hint,code:n.code}),{success:!1,error:n.message,data:null};if(o&&o.length>0){const s=o[0];return console.log("✅ OMS customization result:",s),s.is_duplicate?(console.log("⚠️ Duplicate data detected:",s.message),{success:!0,error:null,data:{id:s.data_id},isUpdate:!1,isDuplicate:!0,message:s.message}):(console.log("✅ OMS customization saved successfully, ID:",s.data_id),{success:!0,error:null,data:{id:s.data_id},isUpdate:!1,isDuplicate:!1,message:s.message})}else return console.error("❌ No data returned from OMS function"),{success:!1,error:"No data returned from OMS function",data:null}}catch(o){return console.error("❌ Unexpected error saving OMS customization form:",o),{success:!1,error:o.message,data:null}}}let k=[];console.log("Dashboard loaded - using global auth manager");async function ye(e){try{console.log("🔍 Fetching user profile from Supabase for user:",e);const{supabase:o}=await oe(async()=>{const{supabase:a}=await import("./supabase.DO6XXPT9.js");return{supabase:a}},__vite__mapDeps([0,1])),{data:n,error:s}=await o.from("profiles").select("*").eq("id",e).single();return s?(console.error("Error fetching user profile:",s),null):(console.log("✅ User profile fetched from Supabase:",n),n)}catch(o){return console.error("Error in fetchUserProfile:",o),null}}async function z(){console.log("🔄 Updating user info...");const e=window.globalAuthManager||window.simpleAuthManager;if(!e||!e.isUserLoggedIn()){console.log("❌ User not logged in - showing generic welcome message");const t=document.getElementById("user-welcome");t&&(t.textContent="Guest",console.log("👋 Welcome message updated to: Guest")),console.log("✅ Dashboard updated for guest user");return}let o=null,n="";const s=e.getCurrentUser();if(s&&s.email&&(o=s,n="auth-manager",console.log("✅ Found authenticated user data:",o.email)),!o){console.log("No auth manager data, checking storage...");const t=[{key:"simple-auth-session",storage:sessionStorage,path:"user"},{key:"simple-auth-user",storage:localStorage,path:null},{key:"simple-auth-session",storage:localStorage,path:"user"}];for(const u of t)try{const p=u.storage.getItem(u.key);if(p){const f=JSON.parse(p);if(o=u.path?f[u.path]:f,o&&o.email){n=u.key,console.log(`✅ Found user data in ${u.key}:`,o.email);break}}}catch(p){console.log(`Error reading ${u.key}:`,p)}}if(!o){console.log("❌ No authenticated user data found");const t=document.getElementById("user-welcome");t&&(t.textContent="Guest",console.log("👋 Welcome message updated to: Guest")),console.log("✅ Dashboard updated for guest user");return}if(o){if(o.user_metadata&&(o.full_name=o.user_metadata.full_name||o.full_name,o.phone=o.user_metadata.phone||o.phone,o.company_name=o.user_metadata.company_name||o.company_name),o.id&&(!o.full_name||o.full_name==="User"||!o.phone||o.phone==="Not set")){console.log("🔄 Incomplete user data, fetching from Supabase...");try{const t=await ye(o.id);t&&(o={...o,...t,email:o.email||t.email},console.log("✅ Enhanced user data with profile:",o))}catch(t){console.log("Error fetching profile data:",t)}}if(o.full_name=o.full_name||o.fullName||"User",o.phone=o.phone||"Not set",o.company_name=o.company_name||o.companyName||"Not set",!o.email){console.log("❌ No email found in authenticated user data");return}console.log("📋 Final normalized user data:",o)}const a=document.getElementById("user-welcome");if(a){const t=o.full_name||o.fullName||o.email?.split("@")[0]||"User";a.textContent=t,console.log("👋 Welcome message updated to:",t)}console.log(`✅ Dashboard updated successfully from ${n}`),setTimeout(()=>{console.log("🔄 Force update welcome message...");const t=document.getElementById("user-welcome");if(t){const u=o.full_name||o.fullName||o.email?.split("@")[0]||"User";t.textContent=u,console.log("Force updated welcome to:",t.textContent)}},100)}function fe(){const e=new URLSearchParams(window.location.search),o=e.get("product"),n=e.get("price");if(console.log("🔍 Checking for product selection:",{productId:o,price:n}),o&&n){console.log("✅ Product selected, showing customization form");const a=[{id:"1",name:"Restaurant Menu System",description:"Digital menu system with QR code integration, online ordering, and real-time updates. Perfect for restaurants looking to modernize their customer experience.",price:25e3,type:"restaurant"},{id:"2",name:"Android TV App",description:"Custom Android TV applications with beautiful UI, content management, and remote control support. Perfect for streaming services and media companies.",price:55e3,type:"non-restaurant"},{id:"3",name:"Streaming Mobile App",description:"Mobile streaming applications for iOS and Android with custom features, user authentication, and content management.",price:35e3,type:"non-restaurant"},{id:"4",name:"Restaurant Website",description:"Professional restaurant website with online ordering, menu display, and customer management features.",price:2e4,type:"restaurant"},{id:"5",name:"Order Menu System",description:"Complete order management system with digital menu integration, real-time order tracking, and payment processing. Perfect for restaurants looking to streamline their ordering process.",price:999,type:"order-menu"}].find(t=>t.id===o);if(a){const t=document.getElementById("product-customization-form"),u=document.getElementById("order-menu-customization-form"),p=document.getElementById("recent-activity");t&&!t.classList.contains("hidden")&&(t.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",t.style.opacity="0",t.style.transform="translateY(-10px)",setTimeout(()=>t.classList.add("hidden"),300)),u&&!u.classList.contains("hidden")&&(u.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",u.style.opacity="0",u.style.transform="translateY(-10px)",setTimeout(()=>u.classList.add("hidden"),300)),p&&!p.classList.contains("hidden")&&(p.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",p.style.opacity="0",p.style.transform="translateY(-10px)",setTimeout(()=>p.classList.add("hidden"),300)),setTimeout(()=>{const f=a.type==="order-menu"?999:parseInt(n);if(a.type==="order-menu"){document.getElementById("order-menu-product-name").textContent=a.name;const i=document.getElementById("order-menu-customization-form");i.classList.remove("hidden"),i.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",i.style.opacity="0",i.style.transform="translateY(10px)",setTimeout(()=>{i.style.opacity="1",i.style.transform="translateY(0)",window.reinitializePincodeAutocomplete&&window.reinitializePincodeAutocomplete()},50)}else{document.getElementById("selected-product-name").textContent=a.name,document.getElementById("selected-product-price").textContent=`₹${f.toLocaleString()}`;const i=document.getElementById("cuisine-type-field"),c=document.getElementById("restaurant-name-field");a.type==="restaurant"?(i.classList.remove("hidden"),i.querySelector("select").required=!0,c.classList.remove("hidden"),c.querySelector("input").required=!0):(i.classList.add("hidden"),i.querySelector("select").required=!1,c.classList.add("hidden"),c.querySelector("input").required=!1);const v=document.getElementById("product-customization-form");v.classList.remove("hidden"),v.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",v.style.opacity="0",v.style.transform="translateY(10px)",setTimeout(()=>{v.style.opacity="1",v.style.transform="translateY(0)"},50)}},350),setTimeout(()=>J(),500)}}}const ae=["Mumbai","Delhi","Bangalore","Hyderabad","Chennai","Kolkata","Pune","Ahmedabad","Jaipur","Surat","Lucknow","Kanpur","Nagpur","Indore","Thane","Bhopal","Visakhapatnam","Pimpri-Chinchwad","Patna","Vadodara","Ghaziabad","Ludhiana","Agra","Nashik","Faridabad","Meerut","Rajkot","Kalyan-Dombivali","Vasai-Virar","Varanasi","Srinagar","Aurangabad","Navi Mumbai","Solapur","Vijayawada","Kolhapur","Amritsar","Noida","Ranchi","Howrah","Coimbatore","Raipur","Jabalpur","Gwalior","Chandigarh","Tiruchirappalli","Mysore","Bhubaneswar","Kochi","Bhavnagar","Salem","Warangal","Guntur","Bhiwandi","Amravati","Nanded","Sangli","Malegaon","Ulhasnagar","Jalgaon","Latur","Ahmadnagar","Dhule","Ichalkaranji","Parbhani","Jalna","Bhusawal","Panvel","Satara","Beed","Yavatmal","Kamptee","Gondia","Barshi","Achalpur","Osmanabad","Nandurbar","Wardha","Udgir","Amalner","Akot","Pandharpur","Shirpur","Parli","Pathri","Sinnar","Shirur","Mangrulpir","Phaltan","Pulgaon","Pimpri","Pachora","Paratwada","Pusad","Purna","Rahuri","Rajura","Ramtek","Ratnagiri","Raver","Risod","Sailu","Sangamner","Sasvad","Satana","Shahpur","Shegaon","Shendurjana","Shirdi","Shrigonda","Shrirampur","Sillod","Soyagaon","Talegaon Dabhade","Talode","Tasgaon","Telhara","Tirora","Tuljapur","Tumsar","Uchgaon","Umarga","Umarkhed","Umred","Uran","Uran Islampur","Vadgaon Kasba","Vaijapur","Vasai","Virar","Vita","Wadgaon Road","Wai","Wani","Warora","Warud","Washim","Yawal","Yevla"],ne=["Andhra Pradesh","Arunachal Pradesh","Assam","Bihar","Chhattisgarh","Goa","Gujarat","Haryana","Himachal Pradesh","Jharkhand","Karnataka","Kerala","Madhya Pradesh","Maharashtra","Manipur","Meghalaya","Mizoram","Nagaland","Odisha","Punjab","Rajasthan","Sikkim","Tamil Nadu","Telangana","Tripura","Uttar Pradesh","Uttarakhand","West Bengal","Andaman and Nicobar Islands","Chandigarh","Dadra and Nagar Haveli and Daman and Diu","Delhi","Jammu and Kashmir","Ladakh","Lakshadweep","Puducherry"];function ve(){const e=document.getElementById("pincode-input"),o=document.getElementById("city-input"),n=document.getElementById("state-input"),s=document.getElementById("phone-input");if(e&&e.addEventListener("input",function(a){a.target.value=a.target.value.replace(/[^0-9]/g,""),a.target.value.length>6&&(a.target.value=a.target.value.slice(0,6));const t=document.getElementById("pincode-error");a.target.value.length>0&&a.target.value.length!==6?t.classList.remove("hidden"):t.classList.add("hidden")}),o){const a=document.getElementById("city-suggestions");o.addEventListener("input",function(t){const u=t.target.value.toLowerCase(),p=ae.filter(i=>i.toLowerCase().includes(u));u.length>0&&p.length>0?(a.innerHTML=p.map(i=>`<div class="px-4 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0" data-value="${i}">${i}</div>`).join(""),a.classList.remove("hidden")):a.classList.add("hidden");const f=document.getElementById("city-error");t.target.value===""||!ae.includes(t.target.value)?f.classList.remove("hidden"):f.classList.add("hidden")}),a.addEventListener("click",function(t){t.target.dataset.value&&(o.value=t.target.dataset.value,a.classList.add("hidden"),document.getElementById("city-error").classList.add("hidden"))}),document.addEventListener("click",function(t){!o.contains(t.target)&&!a.contains(t.target)&&a.classList.add("hidden")})}if(n){const a=document.getElementById("state-suggestions");n.addEventListener("input",function(t){const u=t.target.value.toLowerCase(),p=ne.filter(i=>i.toLowerCase().includes(u));u.length>0&&p.length>0?(a.innerHTML=p.map(i=>`<div class="px-4 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0" data-value="${i}">${i}</div>`).join(""),a.classList.remove("hidden")):a.classList.add("hidden");const f=document.getElementById("state-error");t.target.value===""||!ne.includes(t.target.value)?f.classList.remove("hidden"):f.classList.add("hidden")}),a.addEventListener("click",function(t){t.target.dataset.value&&(n.value=t.target.dataset.value,a.classList.add("hidden"),document.getElementById("state-error").classList.add("hidden"))}),document.addEventListener("click",function(t){!n.contains(t.target)&&!a.contains(t.target)&&a.classList.add("hidden")})}s&&s.addEventListener("input",function(a){let t=a.target.value;t.startsWith("+91")?(t="+91"+t.substring(3).replace(/[^0-9]/g,""),t.length>13&&(t=t.slice(0,13))):(t=t.replace(/[^0-9]/g,""),t.length>10&&(t=t.slice(0,10))),a.target.value=t;const u=document.getElementById("phone-error"),p=t.length===10||t.length===13&&t.startsWith("+91");t.length>0&&!p?u.classList.remove("hidden"):u.classList.add("hidden")})}function be(){const e=document.getElementById("pincode-input"),o=document.getElementById("city-input"),n=document.getElementById("state-input"),s=document.getElementById("phone-input");let a=!0;if(e&&(!e.value||e.value.length!==6||!/^[0-9]{6}$/.test(e.value))&&(document.getElementById("pincode-error").classList.remove("hidden"),a=!1),o&&(!o.value||!ae.includes(o.value))&&(document.getElementById("city-error").classList.remove("hidden"),a=!1),n&&(!n.value||!ne.includes(n.value))&&(document.getElementById("state-error").classList.remove("hidden"),a=!1),s&&(!s.value||!(/^[0-9]{10}$/.test(s.value)||/^\+91[0-9]{10}$/.test(s.value)))&&(document.getElementById("phone-error").classList.remove("hidden"),a=!1),!a){const t=document.getElementById("validation-errors");t&&(t.classList.remove("hidden"),t.textContent="Please fix the validation errors before submitting the form.")}return a}function we(){const e=document.getElementById("order-menu-form");console.log("handleOrderMenuForm called - form found:",e);const o=document.getElementById("close-order-menu-form"),n=document.getElementById("cancel-order-menu"),s=document.getElementById("order-menu-logo-upload"),a=document.getElementById("order-menu-logo-upload-area"),t=document.getElementById("order-menu-logo-preview"),u=document.getElementById("order-menu-logo-preview-img"),p=document.getElementById("order-menu-logo-filename"),f=document.getElementById("order-menu-logo-remove"),i=document.getElementById("menu-photos-upload"),c=document.getElementById("menu-photos-upload-area"),v=document.getElementById("menu-photos-preview"),I=document.getElementById("menu-photos-grid");if(console.log("menuPhotosPreview element found:",v),console.log("menuPhotosGrid element found:",I),console.log("menuPhotosUpload element found:",i),i)console.log("File input element found successfully");else{console.error("CRITICAL: File input element not found! Creating fallback...");const r=document.createElement("input");r.type="file",r.name="menuPhotos",r.accept="image/*",r.multiple=!0,r.className="hidden",r.id="menu-photos-upload";const m=document.getElementById("order-menu-form");m&&(m.appendChild(r),console.log("Fallback file input created and added to form"))}document.getElementById("remove-all-menu-photos"),c&&i&&(c.addEventListener("click",()=>{i.click()}),i.addEventListener("change",r=>{const m=Array.from(r.target.files);if(m.length>0){const h=m.filter(l=>l.size/1048576<=5);if(h.length!==m.length){const l=document.getElementById("file-size-error");l&&(l.classList.remove("hidden"),l.textContent=`Some files were too large. Only files under 5MB are allowed. ${h.length}/${m.length} files uploaded.`)}k=[...k,...h],w(),c.classList.remove("border-red-300","bg-red-50"),c.classList.add("border-gray-300","bg-gray-50"),c.innerHTML=`
            <div class="flex flex-col items-center">
              <svg class="w-16 h-16 text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 13l4 4L19 7"></path>
              </svg>
              <p class="text-green-600 mb-2 font-medium">${h.length} photo(s) uploaded successfully</p>
              <p class="text-sm text-gray-500">Total: ${k.length} photos uploaded</p>
              <button type="button" onclick="document.getElementById('menu-photos-upload').click()" class="mt-4 px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg transition-all transform hover:scale-105 shadow-lg">
                <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                Add More Photos
              </button>
            </div>
          `,i.value=""}}));function w(){if(k.length>0){v.classList.remove("hidden"),I.innerHTML="";const r=document.createElement("div");r.className="col-span-full mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",r.innerHTML=`
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <svg class="w-6 h-6 text-green-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              <div>
                <span class="text-green-800 font-semibold text-lg">${k.length} Photo(s) Uploaded</span>
                <p class="text-sm text-green-600">Menu photos ready for your order system</p>
              </div>
            </div>
            <button type="button" onclick="removeAllMenuPhotos()" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white text-sm font-medium rounded-lg transition-colors">
              <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
              </svg>
              Remove All
            </button>
          </div>
        `,I.appendChild(r),k.forEach((m,h)=>{const l=new FileReader;l.onload=y=>{const L=document.createElement("div");L.className="relative group bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow",L.innerHTML=`
              <div class="relative">
                <img src="${y.target.result}" alt="Menu photo ${h+1}" class="w-full h-32 object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center">
                  <button type="button" class="opacity-0 group-hover:opacity-100 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm hover:bg-red-600 transition-all duration-200 shadow-lg" onclick="removeMenuPhoto(${h})">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                  </button>
                </div>
              </div>
              <div class="p-3">
                <p class="text-sm text-gray-700 font-medium truncate">${m.name}</p>
                <p class="text-xs text-gray-500">${(m.size/1024/1024).toFixed(2)} MB</p>
              </div>
            `,I.appendChild(L)},l.readAsDataURL(m)})}else v.classList.add("hidden")}window.removeMenuPhoto=r=>{console.log("removeMenuPhoto called, index:",r),console.log("Before removal - menuPhotos length:",k.length),k.splice(r,1),console.log("After removal - menuPhotos length:",k.length),w(),k.length===0&&(c.innerHTML=`
          <div class="flex flex-col items-center">
            <svg class="w-16 h-16 text-red-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
            <p class="text-red-600 mb-2 font-medium">Menu photos required!</p>
            <p class="text-sm text-gray-500 mb-2">Please upload at least one menu photo to continue</p>
            <div class="mt-3 flex items-center text-xs text-red-500 font-medium">
              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              This field is mandatory
            </div>
          </div>
        `,c.classList.add("border-red-300","bg-red-50"),c.classList.remove("border-gray-300","bg-gray-50"))},window.removeAllMenuPhotos=()=>{console.log("removeAllMenuPhotos called"),console.log("Before removal - menuPhotos length:",k.length),k=[],console.log("After removal - menuPhotos length:",k.length),w(),i.value="",c.innerHTML=`
        <div class="flex flex-col items-center">
          <svg class="w-16 h-16 text-red-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
          </svg>
          <p class="text-red-600 mb-2 font-medium">Menu photos required!</p>
          <p class="text-sm text-gray-500 mb-2">Please upload at least one menu photo to continue</p>
          <div class="mt-3 flex items-center text-xs text-red-500 font-medium">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            This field is mandatory
          </div>
        </div>
      `,c.classList.add("border-red-300","bg-red-50"),c.classList.remove("border-gray-300","bg-gray-50")};const S=document.getElementById("add-menu-item"),q=document.getElementById("menu-items-container"),b=document.getElementById("oms-category-input"),Y=document.getElementById("oms-add-category-btn"),D=document.getElementById("oms-clear-all-categories-btn"),j=document.getElementById("oms-category-pills"),U=document.getElementById("oms-current-category"),Q=document.getElementById("oms-prev-page"),X=document.getElementById("oms-next-page"),Z=document.getElementById("oms-page-indicator"),M=[];let C=-1;const T=6;let E=1;function x(){j.innerHTML="",M.forEach((r,m)=>{const h=document.createElement("button");h.type="button",h.className=`px-3 py-1 rounded-full text-sm ${m===C?"bg-amber-600 text-white":"bg-gray-100"} flex items-center`;const l=document.createElement("span");l.textContent=r,l.className="mr-2",h.appendChild(l);const y=document.createElement("span");y.textContent="✕",y.className="text-xs opacity-70 hover:opacity-100 ml-1",y.addEventListener("click",L=>{L.stopPropagation();const g=M.splice(m,1)[0];C>=M.length&&(C=M.length-1),q.querySelectorAll(".menu-item-row").forEach(V=>{const A=V.querySelector(".oms-category-field");A&&A.value===g&&(A.value="")}),U.textContent=M[C]||"Uncategorized",x(),B()}),h.appendChild(y),h.addEventListener("click",()=>{C=m,U.textContent=r,x(),B()}),j.appendChild(h)})}D?.addEventListener("click",()=>{M.splice(0,M.length),C=-1,U.textContent="Uncategorized",x(),B(),q.querySelectorAll(".oms-category-field").forEach(r=>r.value="")}),Y?.addEventListener("click",()=>{const r=b.value.trim();r&&(M.includes(r)||(M.push(r),C=M.length-1,U.textContent=r,x(),q.querySelectorAll(".oms-category-field").forEach(m=>{m.value||(m.value=r)}),b.value=""))});function B(){const r=Array.from(q.querySelectorAll(".menu-item-row"));if(r.forEach(l=>l.style.display=""),C>=0){const l=M[C];r.forEach(y=>{const L=y.querySelector(".oms-category-field");L&&L.value&&L.value!==l&&(y.style.display="none")})}const m=r.filter(l=>l.style.display!=="none"),h=Math.max(1,Math.ceil(m.length/T));E=Math.min(E,h),Z.textContent=`Page ${E} / ${h}`,m.forEach((l,y)=>{const L=Math.floor(y/T)+1;l.style.display=L===E?"":"none"})}Q?.addEventListener("click",()=>{E>1&&(E-=1,B())}),X?.addEventListener("click",()=>{E+=1,B()}),s?.addEventListener("change",r=>{const m=r.target.files[0];if(m){const h=m.name,l=(m.size/1024/1024).toFixed(2);a.innerHTML=`
          <div class="flex flex-col items-center">
            <svg class="w-12 h-12 text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <p class="text-green-600 mb-1 font-medium">Logo uploaded successfully</p>
            <p class="text-sm text-gray-500">${h} (${l} MB)</p>
          </div>
        `}});const H=document.querySelectorAll(".menu-style-option");H.forEach(r=>{r.addEventListener("click",()=>{H.forEach(h=>{h.classList.remove("border-primary-500","bg-primary-50"),h.classList.add("border-gray-200")}),r.classList.remove("border-gray-200"),r.classList.add("border-primary-500","bg-primary-50");const m=r.querySelector('input[type="radio"]');m&&(m.checked=!0)})});function R(){const r=e?.querySelectorAll('input[type="color"]'),m=e?.querySelectorAll('input[name$="ColorText"]');r?.forEach((h,l)=>{const y=m?.[l];y&&(h.addEventListener("input",()=>{y.value=h.value}),y.addEventListener("input",()=>{/^#[0-9A-F]{6}$/i.test(y.value)&&(h.value=y.value)}))})}R();let O=1;if(S?.addEventListener("click",()=>{const r=document.createElement("div");if(r.className="menu-item-row grid grid-cols-1 md:grid-cols-4 gap-4 mb-4 p-4 border border-gray-200 rounded-lg",r.innerHTML=`
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Item Name</label>
          <input type="text" name="menuItems[${O}][item_name]" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500" placeholder="e.g., Margherita Pizza" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Price (₹)</label>
          <input type="number" name="menuItems[${O}][price]" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500" placeholder="299" step="0.01" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
          <input type="text" name="menuItems[${O}][item_category]" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 oms-category-field" placeholder="Type or pick from pills" required>
        </div>
        <div class="flex items-end">
          <button type="button" class="remove-menu-item px-3 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 text-sm">
            Remove
          </button>
        </div>
      `,q?.appendChild(r),O++,C>=0){const m=M[C],h=r.querySelector(".oms-category-field");h&&!h.value&&(h.value=m)}B()}),q?.addEventListener("click",r=>{r.target.classList.contains("remove-menu-item")&&(r.target.closest(".menu-item-row").remove(),B())}),B(),o?.addEventListener("click",()=>{F(),window.history.replaceState({},document.title,window.location.pathname)}),n?.addEventListener("click",()=>{F(),window.history.replaceState({},document.title,window.location.pathname)}),console.log("Adding form submission event listener to form:",e),e){let r=function(){const l=document.getElementById("order-menu-logo-upload"),y=document.getElementById("order-menu-logo-upload-area");console.log("Setting up logo upload - elements found:",{logoUpload:!!l,logoUploadArea:!!y}),l&&y?(y.replaceWith(y.cloneNode(!0)),document.getElementById("order-menu-logo-upload-area").addEventListener("click",g=>{console.log("Logo upload area clicked!"),g.preventDefault(),g.stopPropagation(),console.log("Triggering file input click..."),l.click(),console.log("File input click triggered")}),console.log("Logo upload click handler attached successfully")):console.error("Logo upload elements not found!")};e.addEventListener("submit",async l=>{console.log("Form submit event triggered!"),l.preventDefault();const y=window.globalAuthManager||window.simpleAuthManager;if(!y||!y.isUserLoggedIn()){alert("❌ Please log in to submit this form. You must be authenticated to place an order.");return}const L=new FormData(e),g=Object.fromEntries(L);if(console.log("Form submission - menuPhotos length:",k.length),k.length===0){const d=document.getElementById("menu-photos-error");d&&(d.classList.remove("hidden"),d.textContent="Please upload at least one menu photo. This field is required for Order Menu System."),console.log("Form submission blocked - no menu photos");return}if(console.log("Form submission allowed - menu photos present"),!g.phone||g.phone.trim()===""){const d=document.getElementById("phone-validation-error");d&&(d.classList.remove("hidden"),d.textContent="Please enter your phone number. This field is required.");return}if(!g.houseNumber||g.houseNumber.trim()===""){const d=document.getElementById("address-validation-error");d&&(d.classList.remove("hidden"),d.textContent="Please enter house/flat number. This field is required.");return}if(!g.addressLine1||g.addressLine1.trim()===""){const d=document.getElementById("address-validation-error");d&&(d.classList.remove("hidden"),d.textContent="Please enter address line 1. This field is required.");return}if(!g.city||g.city.trim()===""){const d=document.getElementById("address-validation-error");d&&(d.classList.remove("hidden"),d.textContent="Please enter city. This field is required.");return}if(!g.state||g.state.trim()===""){const d=document.getElementById("address-validation-error");d&&(d.classList.remove("hidden"),d.textContent="Please enter state. This field is required.");return}if(!g.pincode||g.pincode.trim()===""){const d=document.getElementById("address-validation-error");d&&(d.classList.remove("hidden"),d.textContent="Please enter pincode. This field is required.");return}if(!g.email||g.email.trim()===""){const d=document.getElementById("email-validation-error");d&&(d.classList.remove("hidden"),d.textContent="Please enter your email address. This field is required.");return}console.log("📝 Order Menu requirements saved:",g),["validation-errors","menu-photos-error","phone-validation-error","address-validation-error","email-validation-error","file-size-error","warning-message","popup-message","error-message"].forEach(d=>{const P=document.getElementById(d);P&&P.classList.add("hidden")});const A={productId:"5",productName:"Order Menu System",productDescription:"Complete order management system with digital menu integration, real-time order tracking, and payment processing. Perfect for restaurants looking to streamline their ordering process.",productPrice:"₹1,179",projectName:g.projectName,restaurantName:g.restaurantName,ownerName:g.ownerName,houseNumber:g.houseNumber,addressLine1:g.addressLine1,city:g.city,state:g.state,pincode:g.pincode,country:g.country,contactPerson:g.contactPerson,email:g.email,phone:g.phone,additionalRequirements:g.additionalRequirements,restaurantLogo:g.restaurantLogo,menuPhotos:k||[],timestamp:new Date().toISOString()};try{console.log("💾 Saving OMS data to Supabase...");const{supabase:d}=await oe(async()=>{const{supabase:P}=await import("./supabase.DO6XXPT9.js");return{supabase:P}},__vite__mapDeps([0,1]));if(d){const{data:P,error:W}=await d.rpc("upsert_oms_customization",{p_user_email:data.email,p_project_name:data.projectName,p_restaurant_name:data.restaurantName,p_owner_name:data.ownerName,p_restaurant_address:`${data.houseNumber}, ${data.addressLine1}, ${data.city}, ${data.state} ${data.pincode}, ${data.country}`,p_contact_person:data.contactPerson,p_phone_number:data.phone,p_house_number:data.houseNumber,p_address_line1:data.addressLine1,p_city:data.city,p_state:data.state,p_pincode:data.pincode,p_country:data.country,p_contact_person:data.contactPerson,p_phone_number:data.phone,p_user_id:null,p_logo_url:null,p_logo_filename:null,p_logo_size:null,p_additional_requirements:data.additionalRequirements||""});if(W){console.error("❌ Error saving to Supabase:",W);const N=JSON.parse(localStorage.getItem("order-menu-requirements")||"[]");N.push(A),localStorage.setItem("order-menu-requirements",JSON.stringify(N));const _=document.getElementById("success-message");_&&(_.classList.remove("hidden"),_.textContent="Order Menu requirements saved locally! Our team will contact you soon.")}else if(P&&P.length>0){const N=P[0];if(N.is_duplicate){let _="";N.duplicate_type==="exact"?_="This exact data has already been submitted. Please check your existing orders or contact support if you need to make changes.":N.duplicate_type==="contact"?_="Data with the same contact person and phone number already exists. The existing record has been updated with your new project information.":N.duplicate_type==="restaurant"?_="A restaurant with this name already exists, but your project name is different. A new record has been created.":_="This data has already been submitted. Please check your existing orders or contact support if you need to make changes.";const ee=document.getElementById("warning-message");ee&&(ee.classList.remove("hidden"),ee.textContent=`⚠️ ${_}`)}else{console.log("✅ OMS data saved to Supabase with ID:",N.data_id);const _=document.getElementById("success-message");if(_&&(_.classList.remove("hidden"),_.textContent="Order Menu requirements saved successfully! Opening payment page..."),window.open("https://payments.pabbly.com/subscribe/68c084369dbcfe4b619b80ce/six-months-inr","_blank"))setTimeout(()=>{window.location.href="/orders?order=success&product=order-menu-system"},2e3);else{const re=document.getElementById("popup-message");re&&(re.classList.remove("hidden"),re.textContent="Please allow popups for this site to proceed with payment, or click the payment link manually.");const ie=document.createElement("div");ie.innerHTML=`
                  <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                              background: white; padding: 20px; border: 2px solid #4CAF50; 
                              border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 9999;">
                    <h3 style="color: #4CAF50; margin-bottom: 15px;">Payment Required</h3>
                    <p style="margin-bottom: 15px;">Please complete your payment to proceed:</p>
                    <a href="https://payments.pabbly.com/subscribe/68c084369dbcfe4b619b80ce/six-months-inr" 
                       target="_blank" style="display: inline-block; padding: 10px 20px; 
                       background: #4CAF50; color: white; text-decoration: none; border-radius: 5px;">
                      Open Payment Page
                    </a>
                    <button onclick="this.parentElement.remove()" style="margin-left: 10px; padding: 10px 15px; 
                            background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer;">
                      Close
                    </button>
                  </div>
                `,document.body.appendChild(ie)}}}else{console.error("❌ No data returned from OMS function");const N=JSON.parse(localStorage.getItem("order-menu-requirements")||"[]");N.push(A),localStorage.setItem("order-menu-requirements",JSON.stringify(N));const _=document.getElementById("success-message");_&&(_.classList.remove("hidden"),_.textContent="Order Menu requirements saved locally! Our team will contact you soon.")}}else{console.error("❌ Supabase not available, saving locally only");const P=JSON.parse(localStorage.getItem("order-menu-requirements")||"[]");P.push(A),localStorage.setItem("order-menu-requirements",JSON.stringify(P));const W=document.getElementById("success-message");W&&(W.classList.remove("hidden"),W.textContent="Order Menu requirements saved locally! Our team will contact you soon.")}window.history.replaceState({},document.title,window.location.pathname),F(),e.reset()}catch(d){console.error("Error saving order menu requirements:",d);const P=document.getElementById("error-message");P&&(P.classList.remove("hidden"),P.textContent="Error saving order menu requirements. Please try again.")}}),console.log("OMS Logo upload elements:",{logoUpload:!!s,logoUploadArea:!!a,logoPreview:!!t,logoPreviewImg:!!u,logoFilename:!!p,logoRemoveBtn:!!f}),r();const m=new MutationObserver(l=>{l.forEach(y=>{if(y.type==="attributes"&&y.attributeName==="class"){const L=document.getElementById("order-menu-customization-form");L&&!L.classList.contains("hidden")&&(console.log("Order menu form is now visible, setting up logo upload..."),r())}})}),h=document.getElementById("order-menu-customization-form");h&&m.observe(h,{attributes:!0,attributeFilter:["class"]}),s&&(s.addEventListener("change",l=>{console.log("OMS Logo upload change event triggered");const y=l.target.files[0];if(y){console.log("File selected:",y.name);const L=new FileReader;L.onload=g=>{console.log("File reader onload triggered"),u.src=g.target.result,p.textContent=y.name,t.classList.remove("hidden"),console.log("Updating logoUploadArea innerHTML"),a.innerHTML=`
              <div class="flex flex-col items-center">
                <svg class="w-12 h-12 text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <p class="text-green-600 mb-1 font-medium">Logo uploaded successfully</p>
                <p class="text-sm text-gray-500">${y.name}</p>
                <button type="button" id="change-logo-btn-oms" class="mt-2 text-sm text-blue-600 hover:text-blue-800 underline" style="display: block !important; visibility: visible !important;">Change Logo</button>
              </div>
            `;const V=document.getElementById("change-logo-btn-oms");V&&V.addEventListener("click",A=>{A.preventDefault(),A.stopPropagation();const d=document.getElementById("order-menu-logo-upload");d?d.click():console.error("order-menu-logo-upload element not found when clicking change logo button")}),console.log("LogoUploadArea innerHTML updated")},L.readAsDataURL(y)}}),f?.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation(),s.value="",t.classList.add("hidden"),a.innerHTML=`
          <div class="flex flex-col items-center">
            <svg class="w-12 h-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
            </svg>
            <p class="text-gray-600 mb-2">Click to upload restaurant logo</p>
            <p class="text-sm text-gray-500">PNG, JPG, SVG up to 10MB</p>
          </div>
        `})),console.log("Setting up Order Menu form event listeners..."),console.log("Close button found:",o),console.log("Cancel button found:",n),document.addEventListener("click",l=>{l.target&&l.target.id==="close-order-menu-form"&&(console.log("Close button clicked via delegation!"),l.preventDefault(),document.getElementById("order-menu-customization-form").classList.add("hidden"),window.history.replaceState({},document.title,window.location.pathname),setTimeout(()=>F(),100)),l.target&&l.target.id==="cancel-order-menu"&&(console.log("Cancel button clicked via delegation!"),l.preventDefault(),document.getElementById("order-menu-customization-form").classList.add("hidden"),window.history.replaceState({},document.title,window.location.pathname),setTimeout(()=>F(),100))})}else console.error("Form not found - cannot add event listener");ve();const K=e?.querySelector('button[type="submit"]');K?(console.log("Adding click listener to submit button:",K),K.addEventListener("click",r=>{if(console.log("Submit button clicked!"),k.length===0){const m=document.getElementById("menu-photos-error");return m&&(m.classList.remove("hidden"),m.textContent="Please upload at least one menu photo. This field is required for Order Menu System."),r.preventDefault(),r.stopPropagation(),!1}if(!be())return r.preventDefault(),r.stopPropagation(),!1;console.log("Menu photos validation passed, allowing submission")})):console.error("Submit button not found")}function Ee(){const e=document.getElementById("customization-form"),o=document.getElementById("close-customization-form"),n=document.getElementById("cancel-customization"),s=document.getElementById("restaurant-logo-upload"),a=document.getElementById("restaurant-logo-upload-area"),t=document.getElementById("restaurant-logo-preview"),u=document.getElementById("restaurant-logo-preview-img"),p=document.getElementById("restaurant-logo-filename"),f=document.getElementById("restaurant-logo-remove");a&&(a.onclick=()=>{const c=document.getElementById("restaurant-logo-upload");c?c.click():console.error("restaurant-logo-upload element not found in initial handler")}),s?.addEventListener("change",c=>{const v=c.target.files[0];if(v){const I=new FileReader;I.onload=w=>{u.src=w.target.result,p.textContent=v.name,t.classList.remove("hidden"),a.innerHTML=`
            <div class="flex flex-col items-center">
              <svg class="w-12 h-12 text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              <p class="text-green-600 mb-1 font-medium">Logo uploaded successfully</p>
              <p class="text-sm text-gray-500">${v.name}</p>
              <button type="button" onclick="const el = document.getElementById('restaurant-logo-upload'); if(el) el.click(); else console.error('restaurant-logo-upload element not found in button onclick');" class="mt-2 text-sm text-blue-600 hover:text-blue-800">Change Logo</button>
            </div>
          `},I.readAsDataURL(v)}}),f?.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),s.value="",t.classList.add("hidden"),a.innerHTML=`
        <div class="flex flex-col items-center">
          <svg class="w-12 h-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
          </svg>
          <p class="text-gray-600 mb-2">Click to upload logo</p>
          <p class="text-sm text-gray-500">PNG, JPG, SVG up to 10MB</p>
        </div>
      `,a.onclick=()=>{const v=document.getElementById("restaurant-logo-upload");v?v.click():console.error("restaurant-logo-upload element not found in reset handler")}});function i(){const c=e?.querySelectorAll('input[type="color"]'),v=e?.querySelectorAll('input[name$="ColorText"]');c?.forEach((I,w)=>{const S=v?.[w];S&&(I.addEventListener("input",()=>{S.value=I.value}),S.addEventListener("input",()=>{/^#[0-9A-F]{6}$/i.test(S.value)&&(I.value=S.value)}))})}i(),o?.addEventListener("click",()=>{F(),window.history.replaceState({},document.title,window.location.pathname)}),n?.addEventListener("click",()=>{F(),window.history.replaceState({},document.title,window.location.pathname)}),e?.addEventListener("submit",async c=>{c.preventDefault();const v=window.globalAuthManager||window.simpleAuthManager;if(!v||!v.isUserLoggedIn()){alert("❌ Please log in to submit this form. You must be authenticated to place an order.");return}const I=new FormData(e),w=Object.fromEntries(I);console.log("📝 Project requirements saved:",w);const S=document.getElementById("selected-product-name").textContent,q=document.getElementById("selected-product-price").textContent,b={productId:new URLSearchParams(window.location.search).get("product")||"1",productName:S,productPrice:q,projectName:w.projectName,appName:w.appName,contactPerson:w.contactPerson,productDescriptionCustom:w.productDescription,email:w.email,phone:w.phone,additionalRequirements:w.additionalRequirements,restaurantLogo:w.restaurantLogo,timestamp:new Date().toISOString()};b.restaurantName=w.restaurantName||b.restaurantName||"",b.cuisineType=w.cuisineType||b.cuisineType||"";try{console.log("💾 Saving project form to database...");const D=(E=>(E||"").toLowerCase())(S);let j="restaurant-website";D.includes("order menu")?j="restaurant-menu-system":D.includes("restaurant website")?j="restaurant-website":D.includes("android tv")?j="android-tv-app":D.includes("streaming")&&(j="streaming-mobile-app");let U=b.logoUrl||null,Q=b.logoFilename||null,X=b.logoMimeType||null,Z=b.logoSize||null;try{const x=e.querySelector('input[name="restaurantLogo"]')?.files?.[0];if(x){const{supabase:B}=await oe(async()=>{const{supabase:r}=await import("./supabase.DO6XXPT9.js");return{supabase:r}},__vite__mapDeps([0,1])),H=x.name.replace(/\s+/g,"_");if(x.size>10*1024*1024)throw new Error("Logo file exceeds 10MB limit");const R=`${Date.now()}_${H}`,O=await x.arrayBuffer(),{error:K}=await B.storage.from("logos").upload(R,O,{upsert:!0,contentType:x.type,cacheControl:"3600"});if(!K){const{data:r}=B.storage.from("logos").getPublicUrl(R);if(U=r?.publicUrl||null,!U){const{data:m,error:h}=await B.storage.from("logos").createSignedUrl(R,31536e3);h||(U=m?.signedUrl||null)}Q=x.name,X=x.type,Z=x.size}}}catch(E){console.warn("Logo upload skipped:",E)}let M=[];if(D.includes("order menu")&&k.length>0)try{const{supabase:E}=await oe(async()=>{const{supabase:x}=await import("./supabase.DO6XXPT9.js");return{supabase:x}},__vite__mapDeps([0,1]));for(let x=0;x<k.length;x++){const B=k[x],H=B.name.replace(/\s+/g,"_"),R=`menu_photos/${Date.now()}_${x}_${H}`,O=await B.arrayBuffer(),{error:K}=await E.storage.from("logos").upload(R,O,{upsert:!0,contentType:B.type,cacheControl:"3600"});if(!K){const{data:r}=E.storage.from("logos").getPublicUrl(R);M.push({url:r?.publicUrl||null,filename:B.name,mimeType:B.type,size:B.size})}}}catch(E){console.warn("Menu photos upload skipped:",E)}const C={productName:S,productPrice:q,projectName:b.projectName,contactPerson:b.contactPerson,appName:b.appName,productDescription:b.productDescriptionCustom,restaurantName:b.restaurantName,cuisineType:b.cuisineType,email:b.email,phone:b.phone,primaryColor:b.primaryColor,secondaryColor:b.secondaryColor,accentColor:b.accentColor,textColor:b.textColor,additionalRequirements:b.additionalRequirements,logoUrl:U,logoFilename:Q,logoMimeType:X,logoSize:Z,menuPhotosUrls:JSON.stringify(M)},T=await ge(C,j);if(T.success)console.log("✅ Project form saved to Supabase database:",T.data),alert(`✅ Project requirements saved to database successfully!

Record ID: ${T.data.id}
Project: ${T.data.project_name}
Restaurant: ${T.data.restaurant_name||"N/A"}
Cuisine: ${T.data.cuisine_type||"N/A"}

Our team will contact you soon!`);else{console.error("❌ Error saving to database:",T.error);const E=JSON.parse(localStorage.getItem("project-requirements")||"[]");E.push(b),localStorage.setItem("project-requirements",JSON.stringify(E)),alert(`❌ Database save failed: ${T.error}

Data saved locally as backup. Our team will contact you soon.`)}window.history.replaceState({},document.title,window.location.pathname),F(),e.reset(),a&&(a.innerHTML=`
            <div class="flex flex-col items-center">
              <svg class="w-12 h-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              <p class="text-gray-600 mb-2">Click to upload restaurant logo</p>
              <p class="text-sm text-gray-500">PNG, JPG, SVG up to 10MB</p>
            </div>
          `)}catch(Y){console.error("Error saving requirements:",Y),alert("Error saving project requirements. Please try again.")}})}function F(){console.log("🔄 Showing browse products section...");const e=document.getElementById("product-customization-form"),o=document.getElementById("order-menu-customization-form"),n=document.getElementById("recent-activity");console.log("Recent activity element found:",n),e&&!e.classList.contains("hidden")&&(console.log("Hiding product form..."),e.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",e.style.opacity="0",e.style.transform="translateY(-10px)",setTimeout(()=>e.classList.add("hidden"),300)),o&&!o.classList.contains("hidden")&&(console.log("Hiding order menu form..."),o.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",o.style.opacity="0",o.style.transform="translateY(-10px)",setTimeout(()=>o.classList.add("hidden"),300)),setTimeout(()=>{n?(console.log("Showing recent activity section..."),n.style.display="block",n.classList.remove("hidden"),n.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",n.style.opacity="0",n.style.transform="translateY(10px)",setTimeout(()=>{n.style.opacity="1",n.style.transform="translateY(0)",console.log("✅ Browse products section is now visible"),console.log("Recent activity display style:",n.style.display),console.log("Recent activity class list:",n.classList.toString())},50)):console.error("❌ Recent activity element not found!")},350)}window.showBrowseProductsSection=F;function J(){console.log("🔄 Attempting to auto-fill user details...");const e=()=>{const o=window.globalAuthManager||window.simpleAuthManager;if(!o||!o.isUserLoggedIn())return console.log("❌ User not logged in - skipping auto-fill"),!1;const n=o.getCurrentUser();return console.log("👤 Current user from auth manager:",n),!n||!n.email?(console.log("❌ No valid user data found - skipping auto-fill"),!1):!n.id&&!n.user_id?(console.log("❌ User lacks proper authentication ID - skipping auto-fill"),!1):(console.log("✅ User is properly authenticated - proceeding with auto-fill"),n&&n.email&&(console.log("📧 Auto-filling email:",n.email),document.querySelectorAll('input[name="email"], input[type="email"]').forEach(a=>{a.value=n.email,a.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Filled email field:",a)})),n&&n.phone&&(console.log("📱 Auto-filling phone:",n.phone),document.querySelectorAll('input[name="phone"], input[type="tel"]').forEach(a=>{a.value=n.phone,a.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Filled phone field:",a)})),n&&n.full_name&&(console.log("👤 Auto-filling contact person:",n.full_name),document.querySelectorAll('input[name="contactPerson"]').forEach(a=>{a.value=n.full_name,a.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Filled contact person field:",a)})),console.log("✅ Auto-fill completed with auth manager data"),!0)};if(!e()){let o=0;const n=50,s=setInterval(()=>{if(o++,(e()||o>=n)&&(clearInterval(s),o>=n)){console.log("⏰ Auth manager timeout - user appears to be not logged in"),console.log("❌ No authenticated user found - forms will remain empty");return}},100)}}document.addEventListener("DOMContentLoaded",()=>{console.log("Dashboard DOM loaded - initializing with global auth manager");const e=new URLSearchParams(window.location.search),o=e.get("product"),n=e.get("price"),s=document.getElementById("recent-activity");if(!o||!n){s&&(s.style.display="block",s.classList.remove("hidden"),console.log("✅ Showing browse products section - no product selected"));const p=document.getElementById("product-customization-form"),f=document.getElementById("order-menu-customization-form");p&&p.classList.add("hidden"),f&&f.classList.add("hidden")}else s&&(s.style.display="none",s.classList.add("hidden"),console.log("✅ Hiding browse products section - product selected"));if(document.body.style.opacity="1",o&&n){console.log("URL parameters detected - showing form for product:",o);const f=[{id:"1",name:"Restaurant Menu System",description:"Digital menu system with QR code integration, online ordering, and real-time updates. Perfect for restaurants looking to modernize their customer experience.",price:25e3,type:"restaurant"},{id:"2",name:"Android TV App",description:"Custom Android TV applications with beautiful UI, content management, and remote control support. Perfect for streaming services and media companies.",price:55e3,type:"non-restaurant"},{id:"3",name:"Streaming Mobile App",description:"Mobile streaming applications for iOS and Android with custom features, user authentication, and content management.",price:35e3,type:"non-restaurant"},{id:"4",name:"Restaurant Website",description:"Professional restaurant website with online ordering, menu display, and customer management features.",price:2e4,type:"restaurant"},{id:"5",name:"Order Menu System",description:"Complete order management system with digital menu integration, real-time order tracking, and payment processing. Perfect for restaurants looking to streamline their ordering process.",price:999,type:"order-menu"}].find(i=>i.id===o);if(f){document.getElementById("selected-product-name").textContent=f.name,document.getElementById("selected-product-price").textContent=`₹${f.price.toLocaleString()}`,document.getElementById("order-menu-product-name").textContent=f.name;const i=document.getElementById("recent-activity"),c=document.getElementById("product-customization-form"),v=document.getElementById("order-menu-customization-form");i&&(i.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",i.style.opacity="0",i.style.transform="translateY(-10px)",setTimeout(()=>{i.classList.add("hidden")},300)),setTimeout(()=>{if(f.type==="order-menu")v&&(v.classList.remove("hidden"),v.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",v.style.opacity="0",v.style.transform="translateY(10px)",setTimeout(()=>{v.style.opacity="1",v.style.transform="translateY(0)"},50));else{c&&(c.classList.remove("hidden"),c.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",c.style.opacity="0",c.style.transform="translateY(10px)",setTimeout(()=>{c.style.opacity="1",c.style.transform="translateY(0)"},50));const I=document.getElementById("cuisine-type-field"),w=document.getElementById("restaurant-name-field");f.type==="restaurant"?(I.classList.remove("hidden"),I.querySelector("select").setAttribute("required","required"),w.classList.remove("hidden"),w.querySelector("input").setAttribute("required","required")):(I.classList.add("hidden"),I.querySelector("select").removeAttribute("required"),w.classList.add("hidden"),w.querySelector("input").removeAttribute("required"))}},300),setTimeout(()=>J(),500)}}fe(),Ee(),we(),J(),setTimeout(()=>J(),1e3),setTimeout(()=>J(),2e3);const a=new MutationObserver(p=>{p.forEach(f=>{if(f.type==="attributes"&&f.attributeName==="class"){const i=f.target;(i.id==="product-customization-form"||i.id==="order-menu-customization-form")&&(i.classList.contains("hidden")||(console.log("👁️ Form became visible, auto-filling..."),setTimeout(()=>J(),100)))}})}),t=document.getElementById("product-customization-form"),u=document.getElementById("order-menu-customization-form");t&&a.observe(t,{attributes:!0,attributeFilter:["class"]}),u&&a.observe(u,{attributes:!0,attributeFilter:["class"]}),z(),setTimeout(()=>z(),100),setTimeout(()=>z(),500),setTimeout(()=>z(),1e3),setTimeout(()=>z(),2e3),setTimeout(()=>{const p=new URLSearchParams(window.location.search),f=p.get("product"),i=p.get("price"),c=document.getElementById("recent-activity");!f||!i?c&&(c.style.display="block",c.classList.remove("hidden"),console.log("✅ Browse products section confirmed visible - no product selected")):c&&(c.style.display="none",console.log("✅ Browse products section confirmed hidden - product selected"))},1e3)});window.addEventListener("load",()=>{console.log("Window loaded - trying again"),z()});let se=0;const xe=5,Le=setInterval(()=>{se++,console.log(`Attempt ${se} to load user data...`),z(),se>=xe&&(clearInterval(Le),console.log("Max attempts reached"))},2e3);window.addEventListener("user-logged-in",()=>{console.log("User logged in event received in dashboard"),z()});window.addEventListener("user-logged-out",()=>{console.log("User logged out event received in dashboard"),z()});console.log("✅ Dashboard script initialized with global auth manager");const te={400001:{city:"Mumbai",state:"Maharashtra"},400002:{city:"Mumbai",state:"Maharashtra"},400003:{city:"Mumbai",state:"Maharashtra"},400004:{city:"Mumbai",state:"Maharashtra"},400005:{city:"Mumbai",state:"Maharashtra"},400006:{city:"Mumbai",state:"Maharashtra"},400007:{city:"Mumbai",state:"Maharashtra"},400008:{city:"Mumbai",state:"Maharashtra"},400009:{city:"Mumbai",state:"Maharashtra"},400010:{city:"Mumbai",state:"Maharashtra"},110001:{city:"New Delhi",state:"Delhi"},110002:{city:"New Delhi",state:"Delhi"},110003:{city:"New Delhi",state:"Delhi"},110004:{city:"New Delhi",state:"Delhi"},110005:{city:"New Delhi",state:"Delhi"},110006:{city:"New Delhi",state:"Delhi"},110007:{city:"New Delhi",state:"Delhi"},110008:{city:"New Delhi",state:"Delhi"},110009:{city:"New Delhi",state:"Delhi"},110010:{city:"New Delhi",state:"Delhi"},560001:{city:"Bangalore",state:"Karnataka"},560002:{city:"Bangalore",state:"Karnataka"},560003:{city:"Bangalore",state:"Karnataka"},560004:{city:"Bangalore",state:"Karnataka"},560005:{city:"Bangalore",state:"Karnataka"},560006:{city:"Bangalore",state:"Karnataka"},560007:{city:"Bangalore",state:"Karnataka"},560008:{city:"Bangalore",state:"Karnataka"},560009:{city:"Bangalore",state:"Karnataka"},560010:{city:"Bangalore",state:"Karnataka"},600001:{city:"Chennai",state:"Tamil Nadu"},600002:{city:"Chennai",state:"Tamil Nadu"},600003:{city:"Chennai",state:"Tamil Nadu"},600004:{city:"Chennai",state:"Tamil Nadu"},600005:{city:"Chennai",state:"Tamil Nadu"},600006:{city:"Chennai",state:"Tamil Nadu"},600007:{city:"Chennai",state:"Tamil Nadu"},600008:{city:"Chennai",state:"Tamil Nadu"},600009:{city:"Chennai",state:"Tamil Nadu"},600010:{city:"Chennai",state:"Tamil Nadu"},700001:{city:"Kolkata",state:"West Bengal"},700002:{city:"Kolkata",state:"West Bengal"},700003:{city:"Kolkata",state:"West Bengal"},700004:{city:"Kolkata",state:"West Bengal"},700005:{city:"Kolkata",state:"West Bengal"},700006:{city:"Kolkata",state:"West Bengal"},700007:{city:"Kolkata",state:"West Bengal"},700008:{city:"Kolkata",state:"West Bengal"},700009:{city:"Kolkata",state:"West Bengal"},700010:{city:"Kolkata",state:"West Bengal"},380001:{city:"Ahmedabad",state:"Gujarat"},380002:{city:"Ahmedabad",state:"Gujarat"},380003:{city:"Ahmedabad",state:"Gujarat"},380004:{city:"Ahmedabad",state:"Gujarat"},380005:{city:"Ahmedabad",state:"Gujarat"},380006:{city:"Ahmedabad",state:"Gujarat"},380007:{city:"Ahmedabad",state:"Gujarat"},380008:{city:"Ahmedabad",state:"Gujarat"},380009:{city:"Ahmedabad",state:"Gujarat"},380010:{city:"Ahmedabad",state:"Gujarat"},411001:{city:"Pune",state:"Maharashtra"},411002:{city:"Pune",state:"Maharashtra"},411003:{city:"Pune",state:"Maharashtra"},411004:{city:"Pune",state:"Maharashtra"},411005:{city:"Pune",state:"Maharashtra"},411006:{city:"Pune",state:"Maharashtra"},411007:{city:"Pune",state:"Maharashtra"},411008:{city:"Pune",state:"Maharashtra"},411009:{city:"Pune",state:"Maharashtra"},411010:{city:"Pune",state:"Maharashtra"},302001:{city:"Jaipur",state:"Rajasthan"},302002:{city:"Jaipur",state:"Rajasthan"},302003:{city:"Jaipur",state:"Rajasthan"},302004:{city:"Jaipur",state:"Rajasthan"},302005:{city:"Jaipur",state:"Rajasthan"},302006:{city:"Jaipur",state:"Rajasthan"},302007:{city:"Jaipur",state:"Rajasthan"},302008:{city:"Jaipur",state:"Rajasthan"},302009:{city:"Jaipur",state:"Rajasthan"},302010:{city:"Jaipur",state:"Rajasthan"},641001:{city:"Coimbatore",state:"Tamil Nadu"},641002:{city:"Coimbatore",state:"Tamil Nadu"},641003:{city:"Coimbatore",state:"Tamil Nadu"},641004:{city:"Coimbatore",state:"Tamil Nadu"},641005:{city:"Coimbatore",state:"Tamil Nadu"},625001:{city:"Madurai",state:"Tamil Nadu"},625002:{city:"Madurai",state:"Tamil Nadu"},625003:{city:"Madurai",state:"Tamil Nadu"},625004:{city:"Madurai",state:"Tamil Nadu"},625005:{city:"Madurai",state:"Tamil Nadu"},570001:{city:"Mysore",state:"Karnataka"},570002:{city:"Mysore",state:"Karnataka"},570003:{city:"Mysore",state:"Karnataka"},570004:{city:"Mysore",state:"Karnataka"},570005:{city:"Mysore",state:"Karnataka"},580001:{city:"Hubli",state:"Karnataka"},580002:{city:"Hubli",state:"Karnataka"},580003:{city:"Hubli",state:"Karnataka"},580004:{city:"Hubli",state:"Karnataka"},580005:{city:"Hubli",state:"Karnataka"},500001:{city:"Hyderabad",state:"Telangana"},500002:{city:"Hyderabad",state:"Telangana"},500003:{city:"Hyderabad",state:"Telangana"},500004:{city:"Hyderabad",state:"Telangana"},500005:{city:"Hyderabad",state:"Telangana"},500006:{city:"Hyderabad",state:"Telangana"},500007:{city:"Hyderabad",state:"Telangana"},500008:{city:"Hyderabad",state:"Telangana"},500009:{city:"Hyderabad",state:"Telangana"},500010:{city:"Hyderabad",state:"Telangana"},110001:{city:"Delhi",state:"Delhi"},110002:{city:"Delhi",state:"Delhi"},110003:{city:"Delhi",state:"Delhi"},110004:{city:"Delhi",state:"Delhi"},110005:{city:"Delhi",state:"Delhi"},110006:{city:"Delhi",state:"Delhi"},110007:{city:"Delhi",state:"Delhi"},110008:{city:"Delhi",state:"Delhi"},110009:{city:"Delhi",state:"Delhi"},110010:{city:"Delhi",state:"Delhi"},560001:{city:"Bangalore",state:"Karnataka"},560002:{city:"Bangalore",state:"Karnataka"},560003:{city:"Bangalore",state:"Karnataka"},560004:{city:"Bangalore",state:"Karnataka"},560005:{city:"Bangalore",state:"Karnataka"},560006:{city:"Bangalore",state:"Karnataka"},560007:{city:"Bangalore",state:"Karnataka"},560008:{city:"Bangalore",state:"Karnataka"},560009:{city:"Bangalore",state:"Karnataka"},560010:{city:"Bangalore",state:"Karnataka"},600001:{city:"Chennai",state:"Tamil Nadu"},600002:{city:"Chennai",state:"Tamil Nadu"},600003:{city:"Chennai",state:"Tamil Nadu"},600004:{city:"Chennai",state:"Tamil Nadu"},600005:{city:"Chennai",state:"Tamil Nadu"},600006:{city:"Chennai",state:"Tamil Nadu"},600007:{city:"Chennai",state:"Tamil Nadu"},600008:{city:"Chennai",state:"Tamil Nadu"},600009:{city:"Chennai",state:"Tamil Nadu"},600010:{city:"Chennai",state:"Tamil Nadu"},700001:{city:"Kolkata",state:"West Bengal"},700002:{city:"Kolkata",state:"West Bengal"},700003:{city:"Kolkata",state:"West Bengal"},700004:{city:"Kolkata",state:"West Bengal"},700005:{city:"Kolkata",state:"West Bengal"},700006:{city:"Kolkata",state:"West Bengal"},700007:{city:"Kolkata",state:"West Bengal"},700008:{city:"Kolkata",state:"West Bengal"},700009:{city:"Kolkata",state:"West Bengal"},700010:{city:"Kolkata",state:"West Bengal"}};function $(){const e=document.getElementById("pincode-input"),o=document.getElementById("city-input"),n=document.getElementById("state-input"),s=document.getElementById("city-suggestions"),a=document.getElementById("state-suggestions");e&&o&&n&&(console.log("Initializing pincode autocomplete..."),e.addEventListener("input",function(){const t=this.value.trim();if(console.log("Pincode entered:",t),t.length===6&&te[t]){console.log("Found pincode data:",te[t]),o.value=te[t].city,n.value=te[t].state;const u=document.getElementById("country-select");u&&(u.value="India")}}),o.addEventListener("input",function(){const t=this.value.toLowerCase();if(t.length>0){const u=ae.filter(p=>p.toLowerCase().includes(t));le(s,u,o)}else G(s)}),n.addEventListener("input",function(){const t=this.value.toLowerCase();if(t.length>0){const u=ne.filter(p=>p.toLowerCase().includes(t));le(a,u,n)}else G(a)}),document.addEventListener("click",function(t){!o.contains(t.target)&&!s.contains(t.target)&&G(s),!n.contains(t.target)&&!a.contains(t.target)&&G(a)}))}document.addEventListener("DOMContentLoaded",function(){$(),setTimeout($,500),setTimeout($,1e3),setTimeout($,2e3)});setTimeout($,3e3);setTimeout($,5e3);function ke(){console.log("Reinitializing pincode autocomplete..."),$()}window.reinitializePincodeAutocomplete=ke;function le(e,o,n){if(o.length===0){G(e);return}e.innerHTML="",o.slice(0,5).forEach(s=>{const a=document.createElement("div");a.className="px-4 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-200",a.textContent=s,a.addEventListener("click",function(){n.value=s,G(e)}),e.appendChild(a)}),e.classList.remove("hidden"),e.style.position="absolute",e.style.zIndex="10",e.style.width=n.offsetWidth+"px",e.style.top=n.offsetTop+n.offsetHeight+"px",e.style.left=n.offsetLeft+"px"}function G(e){e.classList.add("hidden")}
