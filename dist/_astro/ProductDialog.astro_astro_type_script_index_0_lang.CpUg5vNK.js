class A{constructor(){this.isAuthenticated=!1,this.currentUser=null,this.isNavigating=!1,this.init()}init(){this.checkExistingSession(),window.addEventListener("user-logged-in",t=>{this.handleLogin(t.detail)}),window.addEventListener("user-logged-out",()=>{this.handleLogout()}),window.globalAuthManager=this,window.simpleAuthManager=this,console.log("âœ… Global Auth Manager initialized")}checkExistingSession(){try{const t=sessionStorage.getItem("simple-auth-session");if(t){const n=JSON.parse(t);if(n.user&&n.access_token){this.isAuthenticated=!0,this.currentUser=n.user,console.log("âœ… Existing session found:",this.currentUser.email),this.updateGlobalUI();return}}const o=localStorage.getItem("simple-auth-user");if(o){const n=JSON.parse(o);if(n&&n.email){this.isAuthenticated=!0,this.currentUser=n,console.log("âœ… Existing user found in localStorage:",this.currentUser.email),this.updateGlobalUI();return}}console.log("â„¹ï¸ No existing session found")}catch(t){console.error("Error checking existing session:",t)}}handleLogin(t){this.isAuthenticated=!0,this.currentUser=t;const o={user:t,access_token:"simple-token-"+Date.now(),timestamp:Date.now()};sessionStorage.setItem("simple-auth-session",JSON.stringify(o)),localStorage.setItem("simple-auth-user",JSON.stringify(t)),console.log("âœ… User logged in globally:",t.email),this.updateGlobalUI()}handleLogout(){this.isAuthenticated=!1,this.currentUser=null,sessionStorage.removeItem("simple-auth-session"),localStorage.removeItem("simple-auth-user"),sessionStorage.removeItem("has-visited-cart"),console.log("âœ… User logged out globally"),this.updateGlobalUI()}updateGlobalUI(){this.updateHeader(),this.updateDashboard(),this.updateOtherComponents()}updateHeader(){const t=document.getElementById("auth-buttons"),o=document.getElementById("user-menu"),n=document.getElementById("mobile-auth-buttons"),i=document.getElementById("mobile-user-menu"),a=document.getElementById("admin-panel-link"),s=document.getElementById("mobile-admin-panel-link");if(t&&t.classList.remove("hidden"),o&&o.classList.add("hidden"),n&&n.classList.remove("hidden"),i&&i.classList.add("hidden"),a&&a.classList.add("hidden"),s&&s.classList.add("hidden"),this.isAuthenticated&&this.currentUser){t&&t.classList.add("hidden"),o&&o.classList.remove("hidden"),n&&n.classList.add("hidden"),i&&i.classList.remove("hidden");const r=this.currentUser.role==="admin"||this.currentUser.role==="developer"||this.currentUser.role==="support";a&&r&&a.classList.remove("hidden"),s&&r&&s.classList.remove("hidden"),this.updateHeaderUserInfo()}}updateHeaderUserInfo(){if(!this.isAuthenticated||!this.currentUser||!this.currentUser.email){console.log("âŒ User not authenticated - clearing header info"),this.clearHeaderUserInfo();return}const t=document.getElementById("user-email"),o=document.getElementById("user-name"),n=document.getElementById("user-avatar"),i=document.getElementById("mobile-user-email");t&&(t.textContent=this.currentUser.email||""),o&&(o.textContent=this.currentUser.full_name||this.currentUser.email?.split("@")[0]||"User"),n&&(n.textContent=(this.currentUser.full_name||this.currentUser.email||"U").charAt(0).toUpperCase()),i&&(i.textContent=this.currentUser.email||"")}clearHeaderUserInfo(){const t=document.getElementById("user-email"),o=document.getElementById("user-name"),n=document.getElementById("user-avatar"),i=document.getElementById("mobile-user-email");t&&(t.textContent=""),o&&(o.textContent="Guest"),n&&(n.textContent="G"),i&&(i.textContent="")}updateDashboard(){const t=document.getElementById("user-welcome"),o=document.getElementById("user-full-name"),n=document.getElementById("user-email"),i=document.getElementById("user-phone"),a=document.getElementById("user-company");this.isAuthenticated&&this.currentUser&&this.currentUser.email?(t&&(t.textContent=this.currentUser.full_name||this.currentUser.email?.split("@")[0]||"User"),o&&(o.textContent=this.currentUser.full_name||"Not set"),n&&(n.textContent=this.currentUser.email||"Not set"),i&&(i.textContent=this.currentUser.phone||"Not set"),a&&(a.textContent=this.currentUser.company_name||"Not set")):(t&&(t.textContent="Guest"),o&&(o.textContent="Not logged in"),n&&(n.textContent="Not logged in"),i&&(i.textContent="Not logged in"),a&&(a.textContent="Not logged in"))}updateOtherComponents(){}getCurrentUser(){return this.currentUser}isUserLoggedIn(){return this.isAuthenticated}logout(){this.handleLogout(),window.location.href="/"}requireAuth(t="/login"){return this.isAuthenticated?!0:(console.log("ðŸ”’ Authentication required, redirecting to:",t),window.location.href=t,!1)}updateProfile(t){if(this.currentUser){this.currentUser={...this.currentUser,...t};const o=sessionStorage.getItem("simple-auth-session");if(o){const n=JSON.parse(o);n.user=this.currentUser,sessionStorage.setItem("simple-auth-session",JSON.stringify(n))}localStorage.setItem("simple-auth-user",JSON.stringify(this.currentUser)),console.log("âœ… Profile updated in global auth manager:",this.currentUser),this.updateGlobalUI()}}}window.hideUserNavbar=function(){if(window.location.pathname.startsWith("/admin")||window.location.pathname.startsWith("/menu-operator")){const e=document.querySelector("header:not(.menu-operator-header)");e&&(e.classList.add("admin-hidden"),console.log("âœ… User navbar hidden for admin/menu operator panel"))}};window.showUserNavbar=function(){if(!window.location.pathname.startsWith("/admin")&&!window.location.pathname.startsWith("/menu-operator")){const e=document.querySelector("header:not(.menu-operator-header)");e&&(e.classList.remove("admin-hidden"),e.removeAttribute("style"),console.log("âœ… User navbar shown"))}};function C(){const e=window.location.pathname;e.startsWith("/admin")?(document.body.classList.add("admin-panel-active"),window.hideUserNavbar()):e.startsWith("/menu-operator")?(document.body.classList.add("menu-operator-panel-active"),document.documentElement.classList.add("menu-operator-panel-active"),window.hideUserNavbar()):(document.body.classList.remove("admin-panel-active"),document.body.classList.remove("menu-operator-panel-active"),document.documentElement.classList.remove("admin-panel-active"),document.documentElement.classList.remove("menu-operator-panel-active"),window.showUserNavbar())}function I(){const e=window.location.pathname;!e.startsWith("/admin")&&!e.startsWith("/menu-operator")&&(document.documentElement.classList.remove("admin-panel-active"),document.documentElement.classList.remove("menu-operator-panel-active"),document.body.classList.remove("admin-panel-active"),document.body.classList.remove("menu-operator-panel-active"))}document.addEventListener("DOMContentLoaded",()=>{new A,C(),I()});window.addEventListener("popstate",I);window.addEventListener("beforeunload",I);document.addEventListener("click",function(e){const t=e.target.closest("a[href]");t&&t.href.includes("#")});window.addEventListener("load",function(){});function k(){const e=window.location.pathname;if(!e.startsWith("/admin")&&!e.startsWith("/menu-operator")){const t=document.querySelector("header:not(.menu-operator-header)");t&&(t.style.display="block",t.style.visibility="visible",t.style.opacity="1",t.style.height="auto",t.style.maxHeight="none",t.style.overflow="visible",t.style.position="static",t.style.top="auto",t.style.left="auto",t.style.zIndex="50",t.style.pointerEvents="auto",t.style.transform="none",t.style.transition="none",t.style.animation="none")}}k();document.addEventListener("DOMContentLoaded",k);window.utils={formatCurrency:(e,t="INR")=>new Intl.NumberFormat("en-IN",{style:"currency",currency:t}).format(e),formatDate:(e,t={})=>{const o={year:"numeric",month:"long",day:"numeric",...t};return new Intl.DateTimeFormat("en-IN",o).format(new Date(e))},debounce:(e,t)=>{let o;return function(...i){const a=()=>{clearTimeout(o),e(...i)};clearTimeout(o),o=setTimeout(a,t)}},throttle:(e,t)=>{let o;return function(){const n=arguments,i=this;o||(e.apply(i,n),o=!0,setTimeout(()=>o=!1,t))}},copyToClipboard:async e=>{try{return await navigator.clipboard.writeText(e),!0}catch{const o=document.createElement("textarea");o.value=e,document.body.appendChild(o),o.focus(),o.select();try{return document.execCommand("copy"),document.body.removeChild(o),!0}catch{return document.body.removeChild(o),!1}}},generateId:()=>Math.random().toString(36).substr(2,9),isValidEmail:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),isValidPhone:e=>/^(\+91[\-\s]?)?[789]\d{9}$/.test(e),scrollToElement:(e,t=0)=>{const o=document.getElementById(e);if(o){const i=o.getBoundingClientRect().top+window.pageYOffset-t;window.scrollTo({top:i,behavior:"smooth"})}},showLoading:e=>{e&&(e.disabled=!0,e.dataset.originalText=e.textContent,e.innerHTML=`
              <svg class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Loading...
            `)},hideLoading:e=>{e&&e.dataset.originalText&&(e.disabled=!1,e.textContent=e.dataset.originalText,delete e.dataset.originalText)}};document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll('form[data-auto-loading="true"]').forEach(o=>{o.addEventListener("submit",n=>{const i=o.querySelector('button[type="submit"]');i&&window.utils.showLoading(i)})}),document.querySelectorAll('a[href^="#"]').forEach(o=>{o.addEventListener("click",function(n){n.preventDefault();const i=this.getAttribute("href").substring(1);window.utils.scrollToElement(i,80)})});const e={threshold:.1,rootMargin:"0px 0px -50px 0px"},t=new IntersectionObserver(o=>{o.forEach(n=>{n.isIntersecting&&n.target.classList.add("animate-fade-in")})},e);document.querySelectorAll(".animate-on-scroll").forEach(o=>{t.observe(o)})});document.addEventListener("visibilitychange",()=>{document.hidden?document.title="ðŸ‘‹ Come back soon! - DevExpress":document.title=document.title.replace("ðŸ‘‹ Come back soon! - ","")});window.addEventListener("online",()=>{typeof window.showToast=="function"&&window.showToast("You are back online!","success")});window.addEventListener("offline",()=>{typeof window.showToast=="function"&&window.showToast("You are currently offline. Some features may not work.","warning")});typeof emailjs<"u"?(emailjs.init("YOUR_USER_ID"),console.log("EmailJS initialized successfully")):console.log("EmailJS not available");typeof tailwind<"u"&&(tailwind.config={theme:{extend:{colors:{primary:{50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a",950:"#172554"},secondary:{50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7c3aed",800:"#6b21a8",900:"#581c87",950:"#3b0764"},accent:{50:"#fefce8",100:"#fef9c3",200:"#fef08a",300:"#fde047",400:"#facc15",500:"#eab308",600:"#ca8a04",700:"#a16207",800:"#854d0e",900:"#713f12",950:"#422006"}},fontFamily:{sans:["Inter","system-ui","sans-serif"]},animation:{"fade-in":"fadeIn 0.5s ease-in-out","slide-up":"slideUp 0.3s ease-out","bounce-in":"bounceIn 0.6s ease-out"},keyframes:{fadeIn:{"0%":{opacity:"0"},"100%":{opacity:"1"}},slideUp:{"0%":{transform:"translateY(10px)",opacity:"0"},"100%":{transform:"translateY(0)",opacity:"1"}},bounceIn:{"0%":{transform:"scale(0.3)",opacity:"0"},"50%":{transform:"scale(1.05)"},"70%":{transform:"scale(0.9)"},"100%":{transform:"scale(1)",opacity:"1"}}}}}});const O="https://lmrrdcaavwwletcjcpqv.supabase.co",P="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ";function x(){typeof supabase<"u"?(window.supabase=supabase.createClient(O,P),console.log("âœ… Supabase client initialized globally")):(console.log("â³ Supabase library not loaded yet, retrying..."),setTimeout(x,100))}x();function U(){document.querySelectorAll(".text-white:not(header .text-white):not(section .text-white)").forEach(n=>{n.style.setProperty("--tw-text-opacity","1","important"),n.style.setProperty("color","rgb(21 17 17)","important")}),document.querySelectorAll("header .text-white").forEach(n=>{n.style.setProperty("--tw-text-opacity","1","important"),n.style.setProperty("color","white","important")}),document.querySelectorAll("section .text-white").forEach(n=>{n.style.setProperty("--tw-text-opacity","1","important"),n.style.setProperty("color","white","important")})}document.addEventListener("DOMContentLoaded",U);const T=new MutationObserver(U);T.observe(document.body,{childList:!0,subtree:!0});(function(){const e=window.location.pathname;if(e.startsWith("/admin")){let t=function(){const o=document.querySelector("header:not(.menu-operator-header)");o&&(o.style.display="none",o.style.visibility="hidden",o.style.opacity="0",o.style.height="0",o.style.maxHeight="0",o.style.overflow="hidden",o.style.position="absolute",o.style.top="-9999px",o.style.left="-9999px",o.style.zIndex="-9999",o.style.pointerEvents="none",o.style.transform="translateY(-100vh)",o.style.transition="none",o.style.animation="none")};document.documentElement.classList.add("admin-panel-active"),document.body.classList.add("admin-panel-active"),t(),document.readyState==="loading"&&document.addEventListener("DOMContentLoaded",t),setTimeout(t,0),setTimeout(t,10),setTimeout(t,50)}else if(e.startsWith("/menu-operator")){let t=function(){const o=document.querySelector("header:not(.menu-operator-header)");o&&(o.style.display="none",o.style.visibility="hidden",o.style.opacity="0",o.style.height="0",o.style.maxHeight="0",o.style.overflow="hidden",o.style.position="absolute",o.style.top="-9999px",o.style.left="-9999px",o.style.zIndex="-9999",o.style.pointerEvents="none",o.style.transform="translateY(-100vh)",o.style.transition="none",o.style.animation="none")};document.documentElement.classList.add("menu-operator-panel-active"),document.body.classList.add("menu-operator-panel-active"),t(),document.readyState==="loading"&&document.addEventListener("DOMContentLoaded",t),setTimeout(t,0),setTimeout(t,10),setTimeout(t,50)}else document.documentElement.classList.remove("admin-panel-active"),document.documentElement.classList.remove("menu-operator-panel-active"),document.body.classList.remove("admin-panel-active"),document.body.classList.remove("menu-operator-panel-active")})();(function(){let e=!1;function t(){if(e)return;e=!0,document.querySelectorAll('link[rel*="icon"], link[rel*="shortcut"], link[rel*="apple-touch"]').forEach(d=>d.remove());const a=document.createElement("link");a.rel="icon",a.type="image/svg+xml",a.href="/favicon.svg",document.head.appendChild(a);const s=document.createElement("link");s.rel="shortcut icon",s.href="/favicon.svg",document.head.appendChild(s);const r=document.createElement("link");r.rel="apple-touch-icon",r.href="/favicon.svg",document.head.appendChild(r);const l=new Image;l.onload=function(){console.log("âœ… Favicon loaded successfully"),e=!1},l.src="/favicon.svg";try{document.querySelector('link[rel="icon"]').href="/favicon.svg"}catch{}}t(),window.addEventListener("load",t),document.addEventListener("DOMContentLoaded",t),window.addEventListener("beforeunload",function(){t()}),document.addEventListener("visibilitychange",function(){document.hidden||t()}),window.addEventListener("focus",t),window.addEventListener("popstate",t),document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll('link[rel="icon"][href*="data:"]').forEach(s=>s.remove()),document.querySelector('link[rel="icon"][href="/favicon.svg"]')||t()}),setInterval(function(){const i=document.querySelector('link[rel="icon"]');(!i||!i.href.includes("/favicon.svg"))&&(console.log("ðŸ”„ Favicon lost, forcing reload..."),t())},100),document.addEventListener("click",function(i){const a=i.target.closest("a[href]");a&&!a.href.includes("#")&&(t(),setTimeout(function(){const s=document.createElement("link");s.rel="icon",s.type="image/svg+xml",s.href="/favicon.svg",document.head.appendChild(s)},10))});const o=history.pushState,n=history.replaceState;history.pushState=function(){return t(),o.apply(history,arguments)},history.replaceState=function(){return t(),n.apply(history,arguments)},console.log("âœ… Favicon management system active - hand icon prevented during navigation")})();"serviceWorker"in navigator&&navigator.serviceWorker.register("/favicon-sw.js").then(function(e){console.log("âœ… Favicon Service Worker registered:",e.scope)}).catch(function(e){console.log("âŒ Favicon Service Worker registration failed:",e)});(function(){try{const e=sessionStorage.getItem("simple-auth-session");let t=!1,o=null;if(e)try{const i=JSON.parse(e);i.user&&i.access_token&&i.user.email?(t=!0,o=i.user,console.log("âœ… Valid authenticated session found")):console.log("âŒ Invalid session data - missing user or token")}catch{console.log("âŒ Invalid session data format")}const n=document.createElement("style");t&&o?(n.textContent=`
          #auth-buttons, #mobile-auth-buttons { display: none !important; }
          #user-menu, #mobile-user-menu { display: flex !important; }
          #auth-loading, #mobile-auth-loading { display: none !important; }
          #user-email, #user-name, #user-avatar, #mobile-user-email { opacity: 1 !important; }
        `,setTimeout(()=>{const i=document.getElementById("user-email"),a=document.getElementById("user-name"),s=document.getElementById("user-avatar"),r=document.getElementById("mobile-user-email");i&&(i.textContent=o.email||""),a&&(a.textContent=o.full_name||o.email?.split("@")[0]||"User"),s&&(s.textContent=(o.full_name||o.email||"U").charAt(0).toUpperCase()),r&&(r.textContent=o.email||"")},0),console.log("âœ… User authenticated - showing user menu with valid data")):(n.textContent=`
          #auth-buttons, #mobile-auth-buttons { display: flex !important; }
          #user-menu, #mobile-user-menu { display: none !important; }
          #auth-loading, #mobile-auth-loading { display: none !important; }
        `,console.log("âœ… User not authenticated - showing auth buttons")),document.head.appendChild(n)}catch(e){console.error("Error setting initial navbar state:",e);const t=document.createElement("style");t.textContent=`
        #auth-buttons, #mobile-auth-buttons { display: flex !important; }
        #user-menu, #mobile-user-menu { display: none !important; }
        #auth-loading, #mobile-auth-loading { display: none !important; }
      `,document.head.appendChild(t)}})();let y=!1,b=!1;async function S(){try{console.log("Header update using global auth manager");const e=window.globalAuthManager||window.simpleAuthManager;if(!e){console.log("Global auth manager not available yet, using fallback logic"),L();return}e.updateHeader(),console.log("âœ… Header updated using global auth manager")}catch(e){console.error("Error in updateHeader:",e),L()}}function L(){console.log("Using fallback authentication logic");try{const e=sessionStorage.getItem("simple-auth-session"),t=e&&JSON.parse(e).user;let o=null;t&&(o=JSON.parse(e).user);const n=document.getElementById("auth-buttons"),i=document.getElementById("user-menu"),a=document.getElementById("mobile-auth-buttons"),s=document.getElementById("mobile-user-menu");t&&o?(n&&(n.style.display="none",n.classList.add("hidden")),i&&(i.style.display="flex",i.classList.remove("hidden")),a&&(a.style.display="none",a.classList.add("hidden")),s&&(s.style.display="block",s.classList.remove("hidden")),D(o),console.log("âœ… User logged in - showing user menu")):(n&&(n.style.display="flex",n.classList.remove("hidden")),i&&(i.style.display="none",i.classList.add("hidden")),a&&(a.style.display="block",a.classList.remove("hidden")),s&&(s.style.display="none",s.classList.add("hidden")),console.log("âœ… User not logged in - showing auth buttons")),console.log("âœ… Header updated using fallback logic")}catch(e){console.error("Error in fallback update:",e);const t=document.getElementById("auth-buttons"),o=document.getElementById("user-menu"),n=document.getElementById("mobile-auth-buttons"),i=document.getElementById("mobile-user-menu");t&&(t.style.display="flex",t.classList.remove("hidden")),o&&(o.style.display="none",o.classList.add("hidden")),n&&(n.style.display="block",n.classList.remove("hidden")),i&&(i.style.display="none",i.classList.add("hidden"))}}function D(e){if(!e||!e.email){console.log("âŒ No valid user data - clearing UI"),v();return}const t=document.getElementById("user-email"),o=document.getElementById("user-name"),n=document.getElementById("user-avatar"),i=document.getElementById("mobile-user-email");t&&(t.textContent=e.email||""),o&&(o.textContent=e.full_name||e.email?.split("@")[0]||"User"),n&&(n.textContent=(e.full_name||e.email||"U").charAt(0).toUpperCase()),i&&(i.textContent=e.email||""),f(e)}function v(){const e=document.getElementById("user-email"),t=document.getElementById("user-name"),o=document.getElementById("user-avatar"),n=document.getElementById("mobile-user-email");e&&(e.textContent=""),t&&(t.textContent="Guest"),o&&(o.textContent="G"),n&&(n.textContent="")}function f(e){if(!e||!e.email){console.log("âŒ No valid user data - hiding role-based links"),F();return}if(!e.role||e.role==="user"){console.log("âš ï¸ Role not available in session, attempting to fetch from Supabase..."),N(e);return}window.currentUserRole=e.role,console.log("ðŸ”’ Stored user role globally:",window.currentUserRole);const t=document.getElementById("menu-operator-link"),o=document.getElementById("mobile-menu-operator-link"),n=document.getElementById("admin-panel-link"),i=document.getElementById("mobile-admin-panel-link"),a=document.getElementById("profile-link"),s=document.getElementById("mobile-profile-link"),r=document.getElementById("dashboard-link"),l=document.getElementById("mobile-dashboard-link"),d=document.querySelector('#user-dropdown a[href="/orders"]'),u=document.querySelector('#mobile-user-menu a[href="/orders"]');console.log("ðŸ” Checking user role:",e.role,"for user:",e.email),e.role==="menu_operator"||e.role==="menu operator"?(t&&(t.classList.remove("hidden"),t.style.display="block"),o&&(o.classList.remove("hidden"),o.style.display="block"),r&&(r.classList.add("hidden"),r.style.display="none"),l&&(l.classList.add("hidden"),l.style.display="none"),d&&(d.classList.add("hidden"),d.style.display="none"),u&&(u.classList.add("hidden"),u.style.display="none"),a&&(a.href="/menu-operator/profile",a.setAttribute("href","/menu-operator/profile")),s&&(s.href="/menu-operator/profile",s.setAttribute("href","/menu-operator/profile"))):(t&&(t.classList.add("hidden"),t.style.display="none"),o&&(o.classList.add("hidden"),o.style.display="none"),r&&(r.classList.remove("hidden"),r.style.display="flex"),l&&(l.classList.remove("hidden"),l.style.display="flex"),d&&(d.classList.remove("hidden"),d.style.display="flex"),u&&(u.classList.remove("hidden"),u.style.display="flex"),a&&(a.href="/profile"),s&&(s.href="/profile")),e.role==="admin"||e.role==="administrator"?(n&&(n.classList.remove("hidden"),n.style.display="block"),i&&(i.classList.remove("hidden"),i.style.display="block")):(n&&(n.classList.add("hidden"),n.style.display="none"),i&&(i.classList.add("hidden"),i.style.display="none"))}async function N(e){try{if(typeof window.supabase>"u"){console.log("âŒ Supabase not available, using fallback role"),p(e);return}const t=window.supabase,{data:o,error:n}=await t.from("profiles").select("role").eq("id",e.id).single();if(n){console.log("âŒ Error fetching role from Supabase:",n),p(e);return}if(o&&o.role){console.log("âœ… Role fetched from Supabase:",o.role),e.role=o.role;const i=sessionStorage.getItem("simple-auth-session");if(i){const a=JSON.parse(i);a.user.role=o.role,sessionStorage.setItem("simple-auth-session",JSON.stringify(a))}f(e)}else console.log("âš ï¸ No role found in profile, using fallback"),p(e)}catch(t){console.error("âŒ Error fetching role from Supabase:",t),p(e)}}function p(e){console.log("ðŸ”„ Using fallback role-based link update"),e.role=e.role||"customer",f(e)}function m(){const e=document.getElementById("profile-link"),t=document.getElementById("mobile-profile-link");!e||!t||(window.currentUserRole?(console.log("ðŸ”’ Maintaining profile links with stored role:",window.currentUserRole),window.currentUserRole==="menu_operator"||window.currentUserRole==="menu operator"?(e.href!=="/menu-operator/profile"&&(e.href="/menu-operator/profile",e.setAttribute("href","/menu-operator/profile"),console.log("ðŸ”§ Fixed desktop profile link to menu operator profile")),t.href!=="/menu-operator/profile"&&(t.href="/menu-operator/profile",t.setAttribute("href","/menu-operator/profile"),console.log("ðŸ”§ Fixed mobile profile link to menu operator profile"))):(e.href!=="/profile"&&(e.href="/profile",e.setAttribute("href","/profile"),console.log("ðŸ”§ Fixed desktop profile link to regular profile")),t.href!=="/profile"&&(t.href="/profile",t.setAttribute("href","/profile"),console.log("ðŸ”§ Fixed mobile profile link to regular profile")))):window.location.pathname.includes("/menu-operator")&&(e.href!=="/menu-operator/profile"&&(e.href="/menu-operator/profile",e.setAttribute("href","/menu-operator/profile"),console.log("ðŸ”§ Fixed profile link based on current page context")),t.href!=="/menu-operator/profile"&&(t.href="/menu-operator/profile",t.setAttribute("href","/menu-operator/profile"),console.log("ðŸ”§ Fixed mobile profile link based on current page context"))))}function F(){const e=document.getElementById("menu-operator-link"),t=document.getElementById("mobile-menu-operator-link"),o=document.getElementById("admin-panel-link"),n=document.getElementById("mobile-admin-panel-link");e&&(e.classList.add("hidden"),e.style.display="none"),t&&(t.classList.add("hidden"),t.style.display="none"),o&&(o.classList.add("hidden"),o.style.display="none"),n&&(n.classList.add("hidden"),n.style.display="none")}function g(){console.log("Setting initial UI state - checking auth state"),q()?(H(),console.log("âœ… User authenticated - showing user menu")):(R(),console.log("âœ… User not authenticated - showing auth buttons"))}function q(){try{const e=sessionStorage.getItem("simple-auth-session");return e&&JSON.parse(e).user}catch(e){return console.error("Error checking auth state:",e),!1}}function H(){const e=document.getElementById("auth-buttons"),t=document.getElementById("user-menu"),o=document.getElementById("mobile-auth-buttons"),n=document.getElementById("mobile-user-menu"),i=document.createElement("style");i.textContent=`
            #auth-buttons, #mobile-auth-buttons { display: none !important; }
            #user-menu { display: flex !important; }
            #mobile-user-menu { display: block !important; }
          `,document.head.appendChild(i),e&&(e.style.display="none !important",e.classList.add("hidden")),t&&(t.style.display="flex !important",t.classList.remove("hidden")),o&&(o.style.display="none !important",o.classList.add("hidden")),n&&(n.style.display="block !important",n.classList.remove("hidden")),J(),console.log("âœ… User menu shown, auth buttons hidden")}function R(){const e=document.getElementById("auth-buttons"),t=document.getElementById("user-menu"),o=document.getElementById("mobile-auth-buttons"),n=document.getElementById("mobile-user-menu"),i=document.createElement("style");i.textContent=`
            #auth-buttons { display: flex !important; opacity: 1 !important; transition: none !important; visibility: visible !important; }
            #mobile-auth-buttons { display: block !important; opacity: 1 !important; transition: none !important; visibility: visible !important; }
            #auth-buttons a, #mobile-auth-buttons a { opacity: 1 !important; transition: none !important; visibility: visible !important; }
            #user-menu, #mobile-user-menu { display: none !important; }
          `,document.head.appendChild(i),e&&(e.style.display="flex !important",e.style.opacity="1 !important",e.style.transition="none !important",e.style.visibility="visible !important",e.classList.remove("hidden"),e.querySelectorAll("a").forEach(s=>{s.style.opacity="1 !important",s.style.transition="none !important",s.style.visibility="visible !important"})),t&&(t.style.display="none !important",t.classList.add("hidden")),o&&(o.style.display="block !important",o.style.opacity="1 !important",o.style.transition="none !important",o.style.visibility="visible !important",o.classList.remove("hidden"),o.querySelectorAll("a").forEach(s=>{s.style.opacity="1 !important",s.style.transition="none !important",s.style.visibility="visible !important"})),n&&(n.style.display="none !important",n.classList.add("hidden")),console.log("âœ… Auth buttons shown, user menu hidden")}function J(){try{const e=sessionStorage.getItem("simple-auth-session");if(e){const t=JSON.parse(e),o=t.user;if(o&&t.access_token&&o.email){const n=document.getElementById("user-email"),i=document.getElementById("user-name"),a=document.getElementById("user-avatar"),s=document.getElementById("mobile-user-email");n&&(n.textContent=o.email||"",n.style.opacity="1"),i&&(i.textContent=o.full_name||o.email?.split("@")[0]||"User",i.style.opacity="1"),a&&(a.textContent=(o.full_name||o.email||"U").charAt(0).toUpperCase(),a.style.opacity="1"),s&&(s.textContent=o.email||"",s.style.opacity="1"),console.log("ðŸ” User data in updateUserInfoFromSession:",{email:o.email,role:o.role,full_name:o.full_name,id:o.id}),console.log("ðŸ” Full session data:",JSON.stringify(t,null,2)),f(o)}else console.log("âŒ Invalid session - clearing user info"),v()}else console.log("âŒ No session data - clearing user info"),v()}catch(e){console.error("Error updating user info:",e),v()}}function W(){const e=document.getElementById("user-menu-button"),t=document.getElementById("user-dropdown"),o=document.getElementById("user-menu-arrow");e&&t&&o&&(e.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),z()}),document.addEventListener("click",n=>{!e.contains(n.target)&&!t.contains(n.target)&&B()}))}function z(){const e=document.getElementById("user-dropdown"),t=document.getElementById("user-menu-arrow");e&&t&&(y=!y,y?(e.classList.remove("hidden"),t.style.transform="rotate(180deg)"):(e.classList.add("hidden"),t.style.transform="rotate(0deg)"))}function B(){const e=document.getElementById("user-dropdown"),t=document.getElementById("user-menu-arrow");e&&t&&(e.classList.add("hidden"),t.style.transform="rotate(0deg)",y=!1)}window.signOut=async function(){try{console.log("Sign out clicked - using global auth manager");const e=window.globalAuthManager||window.simpleAuthManager;e?e.logout():window.location.href="/"}catch(e){console.error("Sign out error:",e),window.location.href="/"}};function _(){const e=document.getElementById("mobile-menu-button"),t=document.getElementById("mobile-menu"),o=document.getElementById("mobile-menu-icon");e&&t&&o&&(e.addEventListener("click",()=>{G()}),document.addEventListener("click",i=>{!e.contains(i.target)&&!t.contains(i.target)&&w()}),document.addEventListener("keydown",i=>{i.key==="Escape"&&!t.classList.contains("hidden")&&w()}),t.querySelectorAll("a, button").forEach(i=>{i.addEventListener("click",()=>{setTimeout(()=>{w()},100)})}))}function G(){const e=document.getElementById("mobile-menu"),t=document.getElementById("mobile-menu-icon");e&&t&&(b=!b,b?(e.classList.remove("hidden"),t.style.transform="rotate(90deg)",t.innerHTML=`
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        `):(e.classList.add("hidden"),t.style.transform="rotate(0deg)",t.innerHTML=`
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        `))}function w(){const e=document.getElementById("mobile-menu"),t=document.getElementById("mobile-menu-icon");e&&t&&(e.classList.add("hidden"),t.style.transform="rotate(0deg)",t.innerHTML=`
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
      `,b=!1)}function E(){const e=document.getElementById("dashboard-link"),t=document.getElementById("mobile-dashboard-link");function o(n){if(n){const i=new URLSearchParams(window.location.search),a=i.get("product"),s=i.get("price");a&&s?(n.href=`/dashboard?product=${a}&price=${s}`,console.log("ðŸ”— Dashboard link updated with parameters:",n.href)):n.href="/dashboard"}}o(e),o(t),e&&e.addEventListener("click",n=>{if(n.preventDefault(),window.location.pathname==="/dashboard"){window.scrollTo({top:0,behavior:"smooth"});return}const i=new URLSearchParams(window.location.search),a=i.get("product"),s=i.get("price");setTimeout(()=>{a&&s?window.location.href=`/dashboard?product=${a}&price=${s}`:window.location.href="/dashboard"},150)}),t&&t.addEventListener("click",n=>{if(n.preventDefault(),window.location.pathname==="/dashboard"){window.scrollTo({top:0,behavior:"smooth"});return}const i=new URLSearchParams(window.location.search),a=i.get("product"),s=i.get("price");setTimeout(()=>{a&&s?window.location.href=`/dashboard?product=${a}&price=${s}`:window.location.href="/dashboard"},150)})}function $(){const e=document.getElementById("profile-link"),t=document.getElementById("mobile-profile-link");e&&e.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),B();const n=e.getAttribute("href")||"/profile";window.location.href=n}),t&&t.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),w();const n=t.getAttribute("href")||"/profile";window.location.href=n})}document.addEventListener("DOMContentLoaded",()=>{console.log("Header initializing with fallback support"),g(),W(),_(),E(),$(),setTimeout(()=>{console.log("ðŸ”„ Force refreshing role-based links...");const t=sessionStorage.getItem("simple-auth-session");if(t)try{const o=JSON.parse(t);o.user&&o.user.email&&(console.log("ðŸ”„ Refreshing links for user:",o.user.email,"with role:",o.user.role),f(o.user))}catch(o){console.log("âš ï¸ Error refreshing role-based links:",o)}},1e3),setTimeout(()=>{console.log("ðŸš¨ IMMEDIATE PROFILE LINK FIX...");const t=sessionStorage.getItem("simple-auth-session");if(t)try{const o=JSON.parse(t);if(o.user&&o.user.email){console.log("ðŸš¨ Immediate fix for user:",o.user.email,"role:",o.user.role);const n=document.getElementById("profile-link"),i=document.getElementById("mobile-profile-link"),a=window.location.pathname.includes("/menu-operator"),s=o.user.role==="menu_operator"||o.user.role==="menu operator";console.log("ðŸ” Context check:",{isOnMenuOperatorPage:a,hasMenuOperatorRole:s,currentPath:window.location.pathname,userRole:o.user.role}),s||a?(n&&(n.href="/menu-operator/profile",n.setAttribute("href","/menu-operator/profile"),console.log("âœ… Updated desktop profile link to menu operator profile")),i&&(i.href="/menu-operator/profile",i.setAttribute("href","/menu-operator/profile"),console.log("âœ… Updated mobile profile link to menu operator profile"))):(n&&(n.href="/profile",n.setAttribute("href","/profile"),console.log("âœ… Updated desktop profile link to regular profile")),i&&(i.href="/profile",i.setAttribute("href","/profile"),console.log("âœ… Updated mobile profile link to regular profile"))),m()}}catch(o){console.log("âš ï¸ Error in immediate profile link fix:",o)}},100);const e=()=>{const t=window.globalAuthManager||window.simpleAuthManager;t?(console.log("Global auth manager found, updating header"),t.updateHeader()):setTimeout(e,200)};setTimeout(e,100),window.addEventListener("popstate",()=>{console.log("Navigation detected - updating header state"),g(),E(),m()}),document.addEventListener("visibilitychange",()=>{document.hidden||(console.log("Page visible - updating header state"),g(),E(),m())}),window.addEventListener("focus",()=>{console.log("Window focused - updating header state"),g(),m()}),setInterval(()=>{m()},2e3),console.log("âœ… Header initialized with fallback support")});window.addEventListener("load",()=>{console.log("Window loaded, ensuring header is properly initialized"),L()});window.addEventListener("user-logged-in",()=>{console.log("User logged in event received in header"),S()});window.addEventListener("user-logged-out",()=>{console.log("User logged out event received in header"),S()});document.addEventListener("DOMContentLoaded",function(){function e(){const s=document.querySelector(".footer");s&&(s.querySelectorAll("*").forEach(c=>{c.style.setProperty("color","#ffffff","important"),c.style.setProperty("fill","#ffffff","important"),c.style.setProperty("stroke","#ffffff","important")}),s.querySelectorAll("svg, svg *").forEach(c=>{c.style.setProperty("fill","#ffffff","important"),c.style.setProperty("color","#ffffff","important"),c.style.setProperty("stroke","#ffffff","important"),c.setAttribute("fill","#ffffff")}),s.querySelectorAll("a").forEach(c=>{c.style.setProperty("color","#ffffff","important")}),s.querySelectorAll("p, h1, h2, h3, h4, h5, h6, span, div, li, ul, ol").forEach(c=>{c.style.setProperty("color","#ffffff","important")}))}e(),setTimeout(e,100),setTimeout(e,500),setTimeout(e,1e3);const t=new MutationObserver(function(s){s.forEach(function(r){(r.type==="childList"||r.type==="attributes")&&e()})}),o=document.querySelector(".footer");o&&t.observe(o,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"]});function n(){document.querySelectorAll(".footer-product-link").forEach(r=>{r.addEventListener("click",function(l){l.preventDefault();const d=this.getAttribute("data-product-slug");if(i()){window.location.href=`/products/${d}`;return}const c=window.globalAuthManager||window.simpleAuthManager;if(!(c&&c.isUserLoggedIn())){console.log("âŒ User not logged in - authentication required, redirecting to login");const M=`/login?redirect=/products/${d}`;window.location.href=M;return}if(d==="order-menu-system"){console.log("Order Menu System - allowing access for logged-in user"),window.location.href=`/products/${d}`;return}window.showProductDialog?window.showProductDialog():window.location.href="/contact"})})}function i(){try{if(window.simpleAuthManager&&window.simpleAuthManager.isUserLoggedIn()){const r=window.simpleAuthManager.getCurrentUser();if(r&&r.role==="admin")return!0}const s=sessionStorage.getItem("simple-auth-session");if(s){const r=JSON.parse(s);if(r.user&&r.user.role==="admin")return!0}return!1}catch(s){return console.error("Error checking admin status:",s),!1}}n();const a=new MutationObserver(function(s){s.forEach(function(r){r.type==="childList"&&n()})});o&&a.observe(o,{childList:!0,subtree:!0})});class Y{constructor(){this.container=document.getElementById("toast-container"),this.toasts=[],this.maxToasts=5}show(t,o="info",n=5e3){const i=this.createToast(t,o);if(this.container?.appendChild(i),this.toasts.push(i),this.toasts.length>this.maxToasts){const a=this.toasts.shift();a&&a.remove()}return setTimeout(()=>{i.classList.add("translate-x-0","opacity-100")},100),n>0&&setTimeout(()=>{this.remove(i)},n),i}createToast(t,o){const n=document.createElement("div");n.className="transform translate-x-full opacity-0 transition-all duration-300 ease-out max-w-sm w-full bg-white rounded-lg shadow-lg border-l-4 p-4";const i={success:"border-green-500",error:"border-red-500",warning:"border-yellow-500",info:"border-blue-500"};n.classList.add(i[o]||i.info);const a={success:`<svg class="w-5 h-5 text-green-500" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
        </svg>`,error:`<svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
        </svg>`,warning:`<svg class="w-5 h-5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
        </svg>`,info:`<svg class="w-5 h-5 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
        </svg>`},s={success:"text-green-800",error:"text-red-800",warning:"text-yellow-800",info:"text-blue-800"};return n.innerHTML=`
        <div class="flex items-start">
          <div class="flex-shrink-0">
            ${a[o]||a.info}
          </div>
          <div class="ml-3 flex-1">
            <p class="text-sm font-medium ${s[o]||s.info}">
              ${t}
            </p>
          </div>
          <div class="ml-4 flex-shrink-0 flex">
            <button class="inline-flex text-gray-400 hover:text-gray-600 focus:outline-none focus:text-gray-600 transition-colors" onclick="this.closest('[id^=toast-]').remove()">
              <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
              </svg>
            </button>
          </div>
        </div>
      `,n.id=`toast-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n}remove(t){t&&t.parentNode&&(t.classList.remove("translate-x-0","opacity-100"),t.classList.add("translate-x-full","opacity-0"),setTimeout(()=>{if(t.parentNode){t.remove();const o=this.toasts.indexOf(t);o>-1&&this.toasts.splice(o,1)}},300))}clear(){this.toasts.forEach(t=>{this.remove(t)})}}const h=new Y;window.showToast=function(e,t="info",o=5e3){return h.show(e,t,o)};window.clearToasts=function(){h.clear()};window.removeToast=function(e){h.remove(e)};window.addEventListener("beforeunload",()=>{h.clear()});document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.shiftKey&&e.key==="T"&&(e.preventDefault(),h.clear())});(function(){const e=window.location.pathname;(e.split("/").pop()==="order-menu-system"||e.includes("/order-menu-system"))&&(window.showProductDialog=function(){console.log("ProductDialog: OMS page detected, blocking dialog (immediate check)");const n=document.getElementById("product-dialog");n&&n.classList.add("hidden")})})();document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("product-dialog"),t=document.getElementById("dialog-content"),o=document.getElementById("close-dialog"),n=document.getElementById("close-dialog-btn");function i(){const l=window.location.pathname;return l.split("/").pop()==="order-menu-system"||l.includes("/order-menu-system")}function a(){if(i()){console.log("ProductDialog: OMS page detected, blocking dialog display"),e&&e.classList.add("hidden");return}document.body.style.overflow="hidden",e.classList.remove("hidden"),setTimeout(()=>{t.classList.remove("scale-95","opacity-0"),t.classList.add("scale-100","opacity-100")},10)}function s(){t.classList.remove("scale-100","opacity-100"),t.classList.add("scale-95","opacity-0"),setTimeout(()=>{e.classList.add("hidden"),document.body.style.overflow=""},300)}o.addEventListener("click",s),n.addEventListener("click",s),e.addEventListener("click",function(l){l.target===e&&s()}),document.addEventListener("keydown",function(l){l.key==="Escape"&&!e.classList.contains("hidden")&&s()}),window.showProductDialog=a,i()&&(console.log("ProductDialog: OMS page detected on load, hiding dialog"),e&&e.classList.add("hidden"));let r=window.location.pathname;setInterval(()=>{window.location.pathname!==r&&(r=window.location.pathname,i()&&e&&!e.classList.contains("hidden")&&(console.log("ProductDialog: OMS page detected after navigation, hiding dialog"),e.classList.add("hidden"),document.body.style.overflow=""))},500)});
