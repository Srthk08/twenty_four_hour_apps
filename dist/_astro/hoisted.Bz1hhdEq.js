import{_ as U}from"./index.BFAZBQoJ.js";import{supabase as _}from"./supabase.DO6XXPT9.js";import"./Toast.astro_astro_type_script_index_0_lang.C2kRdsNU.js";import"https://unpkg.com/@supabase/supabase-js@2";class T{constructor(){this.orders=[],this.supportTickets=[],this.payments=[],this.users=[],this.loadFromStorage(),this.syncWithSimpleAuth()}static getInstance(){return T.instance||(T.instance=new T),T.instance}loadFromStorage(){try{const e=localStorage.getItem("shared-orders"),t=localStorage.getItem("shared-tickets"),r=localStorage.getItem("shared-payments"),o=localStorage.getItem("shared-users");e&&(this.orders=JSON.parse(e)),t&&(this.supportTickets=JSON.parse(t)),r&&(this.payments=JSON.parse(r)),o&&(this.users=JSON.parse(o))}catch(e){console.error("Error loading shared data:",e)}}saveToStorage(){try{localStorage.setItem("shared-orders",JSON.stringify(this.orders)),localStorage.setItem("shared-tickets",JSON.stringify(this.supportTickets)),localStorage.setItem("shared-payments",JSON.stringify(this.payments)),localStorage.setItem("shared-users",JSON.stringify(this.users))}catch(e){console.error("Error saving shared data:",e)}}syncWithSimpleAuth(){try{const e=localStorage.getItem("simple-auth-users");e&&(JSON.parse(e).forEach(r=>{if(!this.users.find(n=>n.email===r.email)){const n={id:r.id||`user-${Date.now()}`,email:r.email,fullName:r.fullName||"User",phone:r.phone,companyName:r.companyName,role:"customer",status:"active",avatarUrl:r.avatarUrl,lastLoginAt:r.lastLoginAt,loginCount:r.loginCount||1,createdAt:r.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()};this.users.push(n)}}),this.saveToStorage())}catch(e){console.error("Error syncing with simple-auth:",e)}}createOrder(e){const t={...e,id:`order-${Date.now()}`,orderNumber:`ORD-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),timeline:[{id:`timeline-${Date.now()}`,status:e.status,message:"Order created",timestamp:new Date().toISOString(),updatedBy:"system"}]};return this.orders.push(t),this.saveToStorage(),t}updateOrderStatus(e,t,r){const o=this.orders.find(n=>n.id===e);return o?(o.status=t,o.updatedAt=new Date().toISOString(),o.timeline.push({id:`timeline-${Date.now()}`,status:t,message:r,timestamp:new Date().toISOString(),updatedBy:"admin"}),this.saveToStorage(),!0):!1}getOrders(){return[...this.orders]}getOrdersByStatus(e){return this.orders.filter(t=>t.status===e)}getOrdersByUser(e){return this.orders.filter(t=>t.userId===e)}createSupportTicket(e){const t={...e,id:`ticket-${Date.now()}`,ticketNumber:`TKT-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return this.supportTickets.push(t),this.saveToStorage(),t}updateTicketStatus(e,t,r){const o=this.supportTickets.find(n=>n.id===e);return o?(o.status=t,o.updatedAt=new Date().toISOString(),r&&(o.lastResponseAt=new Date().toISOString()),this.saveToStorage(),!0):!1}updateTicket(e,t){const r=this.supportTickets.find(o=>o.id===e);return r?(t.status&&(r.status=t.status),t.adminReply&&(r.adminReplies||(r.adminReplies=[]),r.adminReplies.push(t.adminReply),r.lastResponseAt=new Date().toISOString(),this.sendTicketUpdateNotification(r,t.adminReply,t.status)),r.updatedAt=new Date().toISOString(),this.saveToStorage(),!0):!1}sendTicketUpdateNotification(e,t,r){try{const o={to:e.customerEmail,subject:`Update on Your Support Ticket #${e.ticketNumber}`,message:this.createNotificationMessage(e,t,r),timestamp:new Date().toISOString(),ticketId:e.id,status:r||e.status};this.storeNotification(o),this.showBrowserNotification(e,t,r),this.sendRealEmailNotification(e,t,r),console.log(`Notification sent to ${e.customerEmail} for ticket #${e.ticketNumber}`)}catch(o){console.error("Error sending notification:",o)}}async sendRealEmailNotification(e,t,r){try{const{sendEmail:o,emailTemplates:n}=await U(async()=>{const{sendEmail:c,emailTemplates:u}=await import("./email-config.Bt3IG4FW.js");return{sendEmail:c,emailTemplates:u}},[]),a=n.supportTicketUpdate;let l=a.subject,i=a.body;const s={"{{ticketNumber}}":e.ticketNumber,"{{customerName}}":e.customerName,"{{subject}}":e.subject,"{{status}}":r||e.status,"{{adminReply}}":t.message,"{{replyDate}}":new Date(t.timestamp).toLocaleString(),"{{adminName}}":t.adminName};Object.entries(s).forEach(([c,u])=>{l=l.replace(c,u),i=i.replace(c,u)});const d=await o(e.customerEmail,l,i);console.log(d?"Real email sent successfully via configured email service":"Email service not configured, falling back to localStorage notifications")}catch(o){console.error("Error sending real email:",o)}}createNotificationMessage(e,t,r){let o=`Hello ${e.customerName},

`;return r&&r!==e.status&&(o+=`Your support ticket #${e.ticketNumber} status has been updated to: ${r.replace("_"," ").toUpperCase()}

`),o+=`Admin Reply:
${t.message}

`,o+=`Ticket Details:
`,o+=`Subject: ${e.subject}
`,o+=`Priority: ${e.priority}
`,o+=`Status: ${r||e.status}

`,o+=`You can view the full details and reply in your support dashboard.

`,o+=`Best regards,
DevExpress Support Team`,o}storeNotification(e){try{const t=JSON.parse(localStorage.getItem("user-notifications")||"[]");t.unshift(e),t.length>50&&t.splice(50),localStorage.setItem("user-notifications",JSON.stringify(t))}catch(t){console.error("Error storing notification:",t)}}showBrowserNotification(e,t,r){if("Notification"in window&&Notification.permission==="granted"){const o=`Ticket #${e.ticketNumber} Updated`,n=`Admin replied: ${t.message.substring(0,100)}${t.message.length>100?"...":""}`;new Notification(o,{body:n,icon:"/favicon.ico",tag:e.id})}}getUserNotifications(e){try{return JSON.parse(localStorage.getItem("user-notifications")||"[]").filter(r=>r.to===e)}catch(t){return console.error("Error getting notifications:",t),[]}}markNotificationAsRead(e){try{const t=JSON.parse(localStorage.getItem("user-notifications")||"[]"),r=t.find(o=>o.timestamp===e);r&&(r.read=!0,localStorage.setItem("user-notifications",JSON.stringify(t)))}catch(t){console.error("Error marking notification as read:",t)}}getTicketsByUser(e){return this.supportTickets.filter(t=>t.customerEmail===e)}getSupportTickets(){return[...this.supportTickets]}getTicketsByStatus(e){return this.supportTickets.filter(t=>t.status===e)}createPayment(e){const t={...e,id:`payment-${Date.now()}`,createdAt:new Date().toISOString()};return this.payments.push(t),this.saveToStorage(),t}updatePaymentStatus(e,t){const r=this.payments.find(o=>o.id===e);return r?(r.status=t,this.saveToStorage(),!0):!1}getPayments(){return[...this.payments]}getPaymentsByStatus(e){return this.payments.filter(t=>t.status===e)}createUser(e){const t={...e,id:`user-${Date.now()}`,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return this.users.push(t),this.saveToStorage(),t}updateUser(e,t){const r=this.users.find(o=>o.id===e);return r?(Object.assign(r,t),r.updatedAt=new Date().toISOString(),this.saveToStorage(),!0):!1}getUsers(){return[...this.users]}getUserById(e){return this.users.find(t=>t.id===e)}getUserByEmail(e){return this.users.find(t=>t.email===e)}deleteUser(e){const t=this.users.findIndex(r=>r.id===e);return t!==-1?(this.users.splice(t,1),this.saveToStorage(),!0):!1}getStats(){const e=new Date,t=new Date(e.getTime()-7*24*60*60*1e3),r=new Date(e.getTime()-30*24*60*60*1e3);return{totalUsers:this.users.length,activeUsers:this.users.filter(o=>o.status==="active").length,totalOrders:this.orders.length,pendingOrders:this.orders.filter(o=>o.status==="pending").length,cartOrders:this.orders.filter(o=>o.status==="cart").length,completedOrders:this.orders.filter(o=>o.status==="completed").length,totalRevenue:this.payments.filter(o=>o.status==="completed").reduce((o,n)=>o+n.amount,0),monthlyRevenue:this.payments.filter(o=>o.status==="completed"&&new Date(o.createdAt)>=r).reduce((o,n)=>o+n.amount,0),weeklyRevenue:this.payments.filter(o=>o.status==="completed"&&new Date(o.createdAt)>=t).reduce((o,n)=>o+n.amount,0),openTickets:this.supportTickets.filter(o=>o.status==="open").length,highPriorityTickets:this.supportTickets.filter(o=>o.priority==="high"||o.priority==="urgent").length,pendingPayments:this.payments.filter(o=>o.status==="pending").length}}clearAllData(){this.orders=[],this.supportTickets=[],this.payments=[],this.users=[],this.saveToStorage()}exportOrdersToCSV(){if(this.orders.length===0)return"No orders to export";const e=["Order ID","Customer","Service","Status","Payment Status","Amount","Date"],t=this.orders.map(r=>[r.orderNumber,r.customerName,r.serviceName,r.status,r.paymentStatus,r.amount,new Date(r.createdAt).toLocaleDateString()]);return[e,...t].map(r=>r.join(",")).join(`
`)}}const P=T.getInstance();console.log("üöÄ Cart page script loaded");document.addEventListener("DOMContentLoaded",()=>{console.log("üöÄ DOM Content Loaded - Cart page initialization starting..."),["empty-cart","cart-items","cart-actions","project-requirements","cart-content"].forEach(e=>{const t=document.getElementById(e);console.log(`üîç Element ${e}:`,!!t)});try{console.log("üîç Creating Cart instance...");const e=window.globalAuthManager||window.simpleAuthManager;if(console.log("üîç Auth manager available:",!!e),e){const a=e.getCurrentUser();console.log("üîç Current user:",a?`${a.email} (${a.full_name||"No name"})`:"Not logged in")}const t=new R;console.log("‚úÖ Cart created, items count:",t.items.length),console.log("‚úÖ Cart initialized with",t.items.length,"items");const r=document.getElementById("cart-content");r&&(r.style.display="block",r.style.visibility="visible",console.log("‚úÖ Forced cart content to be visible")),document.getElementById("submit-requirements")?.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),t.submitRequirements()}),document.getElementById("requirements-form")?.addEventListener("submit",a=>(a.preventDefault(),a.stopPropagation(),!1))}catch(e){console.error("‚ùå Error initializing cart:",e),alert("Error initializing cart: "+e.message)}});class R{constructor(){this.items=[],this.requirements={},this.currentSharedOrderId=null,this.isSubmitting=!1,this.debouncedSaveToSupabase=this.debounce(this.saveCartToSupabase.bind(this),1e3),this.init().catch(e=>{console.error("‚ùå Error initializing cart:",e)})}async init(){console.log("üöÄ Cart initialization started"),this.items=[],this.requirements={};const t=(window.globalAuthManager||window.simpleAuthManager)?.getCurrentUser();t?console.log("üë§ User authenticated:",t.email,"- loading user cart"):(console.log("üë§ No authenticated user - checking localStorage"),this.checkAndClearNewUserCart()),await this.loadCart(),console.log("üì¶ Cart loaded, items count:",this.items.length),this.items.length>0&&t&&(window.validateCartOwnership()||(console.log("üîÑ Cart ownership validation failed, clearing cart..."),this.items=[],this.requirements={},localStorage.removeItem("cart-items"),localStorage.removeItem("cart-requirements"),localStorage.removeItem("user-cart-data"),console.log("üì¶ Cart cleared after validation, items count:",this.items.length))),this.checkUrlParams(),this.populateFormFields(),console.log("üìù Form fields populated"),this.renderCart(),console.log("üé® Cart rendered"),this.bindEvents(),console.log("üîó Events bound, initialization complete")}checkAndClearNewUserCart(){if(console.log("üîç Checking if this is a new user session..."),sessionStorage.getItem("has-visited-cart"))console.log("üë§ Returning user session - keeping existing cart data");else{console.log("üÜï New user session detected - checking if cart should be cleared");const t=localStorage.getItem("cart-items");if(t)try{const r=JSON.parse(t);if(Array.isArray(r)&&r.length>0){console.log("üë§ Returning user with existing cart data - keeping cart"),sessionStorage.setItem("has-visited-cart","true");return}}catch{console.log("üîÑ Invalid cart data found - clearing it")}console.log("üÜï Truly new user - clearing any existing cart data"),localStorage.removeItem("cart-items"),localStorage.removeItem("cart-requirements"),localStorage.removeItem("user-cart-data"),localStorage.removeItem("cart-customizations"),sessionStorage.setItem("has-visited-cart","true"),console.log("‚úÖ Cart cleared for new user session")}}checkUrlParams(){console.log("üîç Checking URL parameters...");const e=new URLSearchParams(window.location.search),t=e.get("product"),r=e.get("price");console.log("üì¶ URL parameters found:",{product:t,price:r}),t&&r?(console.log("‚úÖ Product and price found, adding to cart..."),this.addProductFromUrl(t,parseInt(r)),window.history.replaceState({},document.title,window.location.pathname),console.log("‚úÖ URL parameters cleared")):console.log("‚ùå No product or price found in URL parameters")}addProductFromUrl(e,t){console.log("üõí Adding product from URL:",{productId:e,price:t}),this.items=[];const r={1:"Restaurant Menu System",2:"Android TV App",3:"Streaming Mobile App",4:"Restaurant Website","restaurant-menu":"Restaurant Menu System","android-tv":"Android TV App","mobile-streaming":"Mobile Streaming App","restaurant-menu-system":"Restaurant Menu System","android-tv-app":"Android TV App","streaming-mobile-app":"Streaming Mobile App","restaurant-website":"Restaurant Website"},o={1:"Digital menu system with QR code ordering, real-time updates, and analytics dashboard.",2:"Custom Android TV application with streaming capabilities and smart remote support.",3:"Cross-platform mobile app for video streaming with offline download support.",4:"Professional restaurant website with online ordering and reservation system.","restaurant-menu":"Digital menu system with QR code ordering, real-time updates, and analytics dashboard.","android-tv":"Custom Android TV application with streaming capabilities and smart remote support.","mobile-streaming":"Cross-platform mobile app for video streaming with offline download support.","restaurant-menu-system":"Digital menu system with QR code ordering, real-time updates, and analytics dashboard.","android-tv-app":"Custom Android TV application with streaming capabilities and smart remote support.","streaming-mobile-app":"Cross-platform mobile app for video streaming with offline download support.","restaurant-website":"Professional restaurant website with online ordering and reservation system."},n={id:e,name:r[e]||"Custom Product",description:o[e]||"Professional digital solution",price:t,quantity:1,customName:"",logo:null,color:"#3B82F6",features:[]};console.log("üì¶ Created cart item:",n),this.items.push(n),this.saveCart(),console.log("‚úÖ Product added to cart, items count:",this.items.length)}async loadCart(){this.items=[],this.requirements={};const t=(window.globalAuthManager||window.simpleAuthManager)?.getCurrentUser();if(console.log("üë§ Loading cart for user:",t?t.email:"anonymous"),t&&_)try{console.log("üîÑ Loading cart from Supabase for user:",t.email);const{data:o,error:n}=await _.from("cart_customizations").select("*").eq("user_email",t.email).eq("cart_status","active").order("created_at",{ascending:!1});if(n){console.error("‚ùå Error loading cart from Supabase:",n),this.items=[],this.clearUserCartFromLocalStorage(t.email);return}else if(o&&o.length>0){if(console.log("‚úÖ Loaded cart from Supabase:",o),console.log("üìä Cart data details:",{count:o.length,firstItem:o[0],basePrice:o[0]?.base_price,productName:o[0]?.product_name}),this.items=o.map(a=>({id:a.product_id,name:a.product_name,description:a.product_description,price:a.base_price,quantity:1,customName:a.custom_name||"",restaurantName:a.restaurant_name_customization||"",color:a.selected_color||"#3B82F6",features:a.selected_features||[],projectName:a.project_name||"",contactPerson:a.contact_person||"",cuisineType:a.cuisine_type||"",appName:a.app_name||"",productDescription:a.product_description_custom||"",email:a.contact_email||t.email,phone:a.contact_phone||"",primaryColor:a.primary_color||"#3B82F6",secondaryColor:a.secondary_color||"#A5CF6",accentColor:a.accent_color||"#F59E0B",textColor:a.text_color||"#1F2937",additionalRequirements:a.additional_requirements||""})),console.log("üîÑ Mapped cart items:",this.items),console.log("üí∞ First item price:",this.items[0]?.price),this.items.length>0){const a=this.items[0];this.requirements={projectName:a.projectName,contactPerson:a.contactPerson,restaurantName:a.restaurantName,cuisineType:a.cuisineType,appName:a.appName,productDescription:a.productDescription,email:a.email,phone:a.phone,primaryColor:a.primaryColor,secondaryColor:a.secondaryColor,accentColor:a.accentColor,textColor:a.textColor,additionalRequirements:a.additionalRequirements}}console.log("‚úÖ Cart loaded from Supabase with",this.items.length,"items");return}else{console.log("üîÑ No cart data found in Supabase for user:",t.email,"- starting with empty cart"),this.items=[],this.clearUserCartFromLocalStorage(t.email);return}}catch(o){console.error("‚ùå Error loading cart from Supabase:",o),this.items=[],this.clearUserCartFromLocalStorage(t.email);return}console.log("üîÑ Loading cart from localStorage for anonymous user");const r=localStorage.getItem("cart-items");if(r)try{const o=JSON.parse(r);Array.isArray(o)&&o.length>0?(this.items=o,console.log("‚úÖ Cart loaded from localStorage with",this.items.length,"items")):(this.items=[],console.log("üîÑ Invalid cart data in localStorage, starting with empty cart"))}catch(o){console.error("‚ùå Error parsing localStorage cart data:",o),this.items=[],localStorage.removeItem("cart-items")}else this.items=[],console.log("üîÑ No cart data in localStorage, starting with empty cart")}saveCart(){localStorage.setItem("cart-items",JSON.stringify(this.items)),console.log("üíæ Cart saved to localStorage, items count:",this.items.length),(window.globalAuthManager||window.simpleAuthManager)?.getCurrentUser()&&(console.log("üíæ Cart data will also be saved to Supabase for authenticated user"),this.debouncedSaveToSupabase())}clearUserCartFromLocalStorage(e){console.log("üßπ Clearing localStorage cart data for user:",e);const t=localStorage.getItem("cart-items");if(t)try{const r=JSON.parse(t);if(e){console.log("üßπ Clearing localStorage cart data for authenticated user"),localStorage.removeItem("cart-items"),this.items=[];return}r.length>0&&r[0].email&&r[0].email!==e&&(console.log("üßπ Clearing localStorage cart data from different user"),localStorage.removeItem("cart-items"),this.items=[])}catch(r){console.error("‚ùå Error checking localStorage cart data:",r),localStorage.removeItem("cart-items"),this.items=[]}localStorage.removeItem("cart-requirements"),localStorage.removeItem("user-cart-data"),this.items=[],this.requirements={}}populateFormFields(){if(this.items.length===0)return;const e=this.items[0];console.log("üîÑ Populating form fields with loaded data:",e);const t=document.getElementById("projectName");t&&e.projectName&&(t.value=e.projectName);const r=document.getElementById("contactPerson");r&&e.contactPerson&&(r.value=e.contactPerson);const o=document.getElementById("restaurantName");o&&e.restaurantName&&(o.value=e.restaurantName);const n=document.getElementById("cuisineType");n&&e.cuisineType&&(n.value=e.cuisineType);const a=document.getElementById("appName");a&&e.appName&&(a.value=e.appName);const l=document.getElementById("productDescription");l&&e.productDescription&&(l.value=e.productDescription);const i=document.getElementById("email");i&&e.email&&(i.value=e.email);const s=document.getElementById("phone");s&&e.phone&&(s.value=e.phone);const d=document.querySelector('input[name="primaryColor"]');d&&e.primaryColor&&(d.value=e.primaryColor);const c=document.querySelector('input[name="secondaryColor"]');c&&e.secondaryColor&&(c.value=e.secondaryColor);const u=document.querySelector('input[name="accentColor"]');u&&e.accentColor&&(u.value=e.accentColor);const m=document.querySelector('input[name="textColor"]');m&&e.textColor&&(m.value=e.textColor);const g=document.getElementById("additionalRequirements");g&&e.additionalRequirements&&(g.value=e.additionalRequirements),e.features&&Array.isArray(e.features)&&e.features.forEach(h=>{const p=document.querySelector(`input[data-feature="${h}"]`);p&&(p.checked=!0)}),this.requirements={projectName:e.projectName||"",contactPerson:e.contactPerson||"",restaurantName:e.restaurantName||"",cuisineType:e.cuisineType||"",appName:e.appName||"",productDescription:e.productDescription||"",email:e.email||"",phone:e.phone||"",primaryColor:e.primaryColor||"#3B82F6",secondaryColor:e.secondaryColor||"#A5CF6",accentColor:e.accentColor||"#F59E0B",textColor:e.textColor||"#1F2937",additionalRequirements:e.additionalRequirements||""},console.log("‚úÖ Form fields populated successfully")}addItem(e){this.items.length>0&&(this.items=[]),this.items.push({...e,quantity:1,customName:"",logo:null,color:"#3B82F6",features:[]}),this.saveCart(),this.renderCart()}removeItem(e){this.items=this.items.filter(t=>t.id!==e),this.saveCart(),this.renderCart()}updateItem(e,t){const r=this.items.find(o=>o.id===e);r&&(Object.assign(r,t),this.saveCart(),this.renderCart())}renderCart(){console.log("üé® renderCart called with items:",this.items.length);const e=document.getElementById("empty-cart"),t=document.getElementById("cart-items"),r=document.getElementById("cart-actions"),o=document.getElementById("project-requirements"),n=document.getElementById("cart-content");console.log("üîç DOM elements found:",{emptyCart:!!e,cartItems:!!t,cartActions:!!r,projectRequirements:!!o,cartContent:!!n}),this.items.length===0?(console.log("üì≠ Showing empty cart"),e?.classList.remove("hidden"),t?.classList.add("hidden"),r?.classList.add("hidden"),o?.classList.add("hidden")):(console.log("üì¶ Showing cart with items"),e?.classList.add("hidden"),t?.classList.remove("hidden"),r?.classList.remove("hidden"),o?.classList.add("hidden")),this.renderCartItems(),this.updateSummary()}renderCartItems(){const e=document.getElementById("cart-items");e&&(e.innerHTML="",this.items.forEach(t=>{const r=this.createCartItemElement(t);e.appendChild(r)}))}createCartItemElement(e){const t=document.getElementById("cart-item-template");if(!t)return document.createElement("div");const r=t.cloneNode(!0);r.classList.remove("hidden"),r.id=`cart-item-${e.id}`,r.querySelector(".product-name").textContent=e.name,r.querySelector(".product-description").textContent=e.description,r.querySelector(".product-price").textContent=`‚Çπ${e.price}`;const o=r.querySelector(".product-type-text"),n=r.querySelector(".product-type-badge");e.id==="restaurant-menu"||e.id==="restaurant-menu-system"||e.id==="restaurant-website"||e.id==="1"||e.id==="4"?(o.textContent="Restaurant Solution",n.className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium product-type-badge bg-green-100 text-green-800"):e.id==="order-menu-system"||e.id==="5"?(o.textContent="Order Menu System",n.className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium product-type-badge bg-blue-100 text-blue-800"):e.id==="android-tv"||e.id==="android-tv-app"||e.id==="2"?(o.textContent="Android TV App",n.className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium product-type-badge bg-purple-100 text-purple-800"):e.id==="mobile-streaming"||e.id==="streaming-mobile-app"||e.id==="3"?(o.textContent="Mobile Streaming App",n.className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium product-type-badge bg-orange-100 text-orange-800"):(o.textContent="Custom Product",n.className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium product-type-badge bg-gray-100 text-gray-800");const a=r.querySelector("#restaurant-name-customization");e.id==="restaurant-menu"||e.id==="restaurant-menu-system"||e.id==="restaurant-website"||e.id==="1"||e.id==="4"?a?.classList.remove("hidden"):a?.classList.add("hidden");const l=r.querySelector(".product-name-input");l&&e.customName&&(l.value=e.customName);const i=r.querySelector(".restaurant-name-input");return i&&e.restaurantName&&(i.value=e.restaurantName),r.querySelectorAll(".color-option").forEach(c=>{c.dataset.color===e.color&&c.classList.add("border-2","border-gray-900")}),r.querySelectorAll(".feature-checkbox").forEach(c=>{e.features.includes(c.dataset.feature)&&(c.checked=!0)}),this.bindItemEvents(r,e),r}bindItemEvents(e,t){e.querySelector(".product-name-input")?.addEventListener("input",d=>{this.updateItem(t.id,{customName:d.target.value})}),e.querySelector(".restaurant-name-input")?.addEventListener("input",d=>{this.updateItem(t.id,{restaurantName:d.target.value})});const n=e.querySelector(".logo-upload"),a=e.querySelector(".logo-upload-btn"),l=e.querySelector(".logo-preview");a.addEventListener("click",()=>n.click()),n.addEventListener("change",d=>{const c=d.target.files[0];if(c){const u=new FileReader;u.onload=m=>{l.innerHTML=`<img src="${m.target.result}" class="w-full h-full object-cover rounded-lg">`,this.updateItem(t.id,{logo:m.target.result})},u.readAsDataURL(c)}});const i=e.querySelectorAll(".color-option");i.forEach(d=>{d.addEventListener("click",()=>{i.forEach(c=>c.classList.remove("border-2","border-gray-900")),d.classList.add("border-2","border-gray-900"),this.updateItem(t.id,{color:d.dataset.color})})});const s=e.querySelectorAll(".feature-checkbox");s.forEach(d=>{d.addEventListener("change",()=>{const c=Array.from(s).filter(u=>u.checked).map(u=>u.dataset.feature);this.updateItem(t.id,{features:c})})})}updateSummary(){console.log("üí∞ updateSummary called with items:",this.items);const e=this.items.reduce((d,c)=>d+c.price*c.quantity,0),t=this.items.reduce((d,c)=>d+c.features.length*500,0),r=Math.round((e+t)*.18),o=e+t+r;console.log("üí∞ Amount calculation:",{subtotal:e,featuresTotal:t,tax:r,total:o,itemsCount:this.items.length});const n=document.getElementById("subtotal"),a=document.getElementById("features-total"),l=document.getElementById("tax"),i=document.getElementById("total"),s=document.getElementById("final-amount");console.log("üí∞ Summary elements found:",{subtotalElement:!!n,featuresTotalElement:!!a,taxElement:!!l,totalElement:!!i,finalAmountElement:!!s}),n&&(n.textContent=`‚Çπ${e.toLocaleString()}`,console.log("‚úÖ Updated subtotal:",n.textContent)),a&&(a.textContent=`‚Çπ${t.toLocaleString()}`,console.log("‚úÖ Updated features total:",a.textContent)),l&&(l.textContent=`‚Çπ${r.toLocaleString()}`,console.log("‚úÖ Updated tax:",l.textContent)),i&&(i.textContent=`‚Çπ${o.toLocaleString()}`,console.log("‚úÖ Updated total:",i.textContent)),s&&(s.textContent=o.toLocaleString(),console.log("‚úÖ Updated final amount:",s.textContent))}bindEvents(){document.getElementById("delete-selected")?.addEventListener("click",()=>{this.deleteSelectedProject()}),document.getElementById("proceed-to-requirements")?.addEventListener("click",()=>{this.showProjectRequirements()}),document.getElementById("back-to-cart")?.addEventListener("click",()=>{this.backToCart()}),document.getElementById("back-to-requirements")?.addEventListener("click",()=>{this.backToRequirements()}),document.getElementById("final-payment")?.addEventListener("click",()=>{this.processFinalPayment()}),document.querySelectorAll('input[name="paymentMethod"]').forEach(e=>{e.addEventListener("change",t=>{this.switchPaymentMethod(t.target.value)})})}continueShopping(){this.items=[],this.saveCart(),window.location.href="/products"}deleteSelectedProject(){confirm("Are you sure you want to delete this project? You will be redirected to products page.")&&(this.items=[],this.saveCart(),window.location.href="/products")}async showProjectRequirements(){const e=document.getElementById("cart-actions"),t=document.getElementById("project-requirements");e&&e.classList.add("hidden"),t&&t.classList.remove("hidden"),this.prefillRequirementsForm(),this.showProjectTypeFields(),t?.scrollIntoView({behavior:"smooth"})}async submitRequirements(){console.log("üöÄ submitRequirements function called!");const e=document.getElementById("submit-requirements"),t=e.innerHTML;if(this.isSubmitting||e.disabled){console.log("‚ùå Form already being submitted, ignoring duplicate call");return}this.isSubmitting=!0;try{console.log("üöÄ Starting submitRequirements...");const r=document.getElementById("requirements-form"),o=this.items[0]&&(this.items[0].id==="order-menu-system"||this.items[0].id==="5");if(o){const s=["projectName","contactPerson","orderMenuRestaurantName","orderMenuOwnerName","orderMenuAddress","email","phone"];let d=!0;for(const c of s){const u=r.querySelector(`[name="${c}"]`);if(u&&!u.value.trim()){u.focus(),u.reportValidity(),d=!1;break}}if(!d){console.log("‚ùå Order Menu System form validation failed");return}}else{const s=r.querySelectorAll("#order-menu-fields [required], #restaurant-fields [required], #restaurant-cuisine-fields [required]"),d=[];if(s.forEach((c,u)=>{d[u]=c.required,c.required=!1}),!r.checkValidity()){console.log("‚ùå Form validation failed"),r.reportValidity(),s.forEach((c,u)=>{c.required=d[u]});return}s.forEach((c,u)=>{c.required=d[u]})}console.log("‚úÖ Form validation passed"),e.innerHTML=`
          <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Saving & Processing...
        `,e.disabled=!0;const n=this.items[0];if(o){const s=this.collectMenuItems();console.log("üçΩÔ∏è Collected menu items for Order Menu System:",s),this.requirements={restaurantName:r.querySelector('[name="orderMenuRestaurantName"]')?.value||"",ownerName:r.querySelector('[name="orderMenuOwnerName"]')?.value||"",restaurantAddress:r.querySelector('[name="orderMenuAddress"]')?.value||"",email:r.querySelector('[name="email"]')?.value||"",phone:r.querySelector('[name="phone"]')?.value||"",additionalRequirements:r.querySelector('[name="additionalRequirements"]')?.value||"",menuItems:s,primaryColor:r.querySelector('[name="primaryColor"]')?.value||"#3B82F6",secondaryColor:r.querySelector('[name="secondaryColor"]')?.value||"#000000",accentColor:r.querySelector('[name="accentColor"]')?.value||"#F59E0B",textColor:r.querySelector('[name="textColor"]')?.value||"#1F2937",restaurantLogo:this.orderMenuLogoFile||null}}else this.requirements={projectName:r.querySelector('[name="projectName"]')?.value||"",contactPerson:r.querySelector('[name="contactPerson"]')?.value||"",restaurantName:r.querySelector('[name="restaurantName"]')?.value||"",cuisineType:r.querySelector('[name="cuisineType"]')?.value||"",appName:r.querySelector('[name="appName"]')?.value||"",productDescription:r.querySelector('[name="productDescription"]')?.value||"",email:r.querySelector('[name="email"]')?.value||"",phone:r.querySelector('[name="phone"]')?.value||"",additionalRequirements:r.querySelector('[name="additionalRequirements"]')?.value||""};console.log("üìù Collected form data:",this.requirements);let a=null;try{console.log("üîç Attempting to save to Supabase..."),a=await Promise.race([this.saveCartToSupabase(),new Promise((s,d)=>setTimeout(()=>d(new Error("Database timeout")),1e4))])}catch(s){console.warn("‚ö†Ô∏è Database save failed, but continuing:",s)}a?(console.log("‚úÖ Cart data saved successfully:",a),this.items.length>0&&(this.items[0].savedData=a,this.saveCart())):console.log("‚ö†Ô∏è No database save, but continuing with local data"),e.innerHTML=`
          <svg class="w-4 h-4 text-white inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          Success! Redirecting...
        `,this.updateOrderReview();const l=document.getElementById("project-requirements"),i=document.getElementById("payment-section");if(console.log("üîÑ Showing payment page directly..."),console.log("üîç Project requirements element:",!!l),console.log("üîç Payment section element:",!!i),i&&(console.log("üîç Payment section parent:",i.parentElement),console.log("üîç Payment section offsetHeight:",i.offsetHeight),console.log("üîç Payment section offsetWidth:",i.offsetWidth),console.log("üîç Payment section computed style display:",window.getComputedStyle(i).display)),l&&(l.classList.add("hidden"),l.style.display="none",console.log("‚úÖ Hidden project requirements")),i){i.classList.remove("hidden"),i.style.setProperty("display","block","important"),i.style.setProperty("visibility","visible","important"),i.style.setProperty("opacity","1","important"),i.style.setProperty("position","relative","important"),i.style.setProperty("z-index","999","important"),i.style.setProperty("height","auto","important"),i.style.setProperty("width","100%","important"),i.style.setProperty("background-color","#ffffff","important"),console.log("‚úÖ Showed payment section with forced visibility");const s=document.getElementById("payment-loading"),d=document.getElementById("payment-content");s&&(s.classList.remove("hidden"),s.style.display="block"),d&&(d.style.display="none"),this.updatePaymentSummary(),setTimeout(()=>{s&&(s.classList.add("hidden"),s.style.display="none"),d&&(d.style.display="block"),i.scrollIntoView({behavior:"smooth"}),console.log("‚úÖ Scrolled to payment page")},500)}else console.error("‚ùå Payment section element not found!"),alert("Error: Payment page not found. Please refresh the page and try again.");setTimeout(()=>{e.innerHTML=t,e.disabled=!1,this.isSubmitting=!1},2e3)}catch(r){console.error("‚ùå Error in submitRequirements:",r),e.innerHTML=`
          <svg class="w-4 h-4 text-white inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
          Error
        `,alert("Warning: Could not save to database, but you can still proceed with your order. Please contact support if this persists."),this.updateOrderReview();const o=document.getElementById("project-requirements"),n=document.getElementById("payment-section");if(o&&(o.classList.add("hidden"),o.style.display="none"),n){n.classList.remove("hidden"),n.style.setProperty("display","block","important"),n.style.setProperty("visibility","visible","important"),n.style.setProperty("opacity","1","important"),n.style.setProperty("position","relative","important"),n.style.setProperty("z-index","999","important"),n.style.setProperty("height","auto","important"),n.style.setProperty("width","100%","important"),n.style.setProperty("background-color","#ffffff","important");const a=document.getElementById("payment-loading"),l=document.getElementById("payment-content");a&&(a.classList.remove("hidden"),a.style.display="block"),l&&(l.style.display="none"),this.updatePaymentSummary(),setTimeout(()=>{a&&(a.classList.add("hidden"),a.style.display="none"),l&&(l.style.display="block"),n.scrollIntoView({behavior:"smooth"})},500)}setTimeout(()=>{e.innerHTML=t,e.disabled=!1,this.isSubmitting=!1},3e3)}}showProjectTypeFields(){if(this.items.length===0)return;const e=this.items[0];console.log("üîç Debug - Product ID:",e.id);const t=document.getElementById("app-name-fields"),r=document.getElementById("product-description-fields"),o=document.getElementById("restaurant-fields"),n=document.getElementById("restaurant-cuisine-fields");console.log("üîç Debug - Field elements found:",{appNameFields:!!t,productDescriptionFields:!!r,restaurantFields:!!o,restaurantCuisineFields:!!n});const a=document.getElementById("upload-label"),l=document.getElementById("upload-text"),i=document.getElementById("photos-label"),s=document.getElementById("photos-text");if(t?.classList.add("hidden"),r?.classList.add("hidden"),o?.classList.add("hidden"),n?.classList.add("hidden"),e.id==="restaurant-menu"||e.id==="restaurant-menu-system"||e.id==="restaurant-website"||e.id==="1"||e.id==="4"){console.log("üçï Showing restaurant fields for restaurant product:",e.id),o&&(o.classList.remove("hidden"),o.style.display="block"),n&&(n.classList.remove("hidden"),n.style.display="block"),console.log("üîç Debug - Restaurant fields visibility:",{restaurantFieldsHidden:o?.classList.contains("hidden"),restaurantCuisineFieldsHidden:n?.classList.contains("hidden"),restaurantFieldsDisplay:o?.style.display,restaurantCuisineFieldsDisplay:n?.style.display});const c=document.querySelector('input[name="restaurantName"]'),u=document.querySelector('select[name="cuisineType"]');c&&(c.required=!0),u&&(u.required=!0);const m=document.getElementById("logo-upload-section"),g=document.getElementById("photos-upload-section");m&&(m.classList.remove("hidden"),m.style.display="block"),g&&(g.classList.remove("hidden"),g.style.display="block");const h=document.querySelector('input[name="projectName"]'),p=document.querySelector('input[name="contactPerson"]'),v=document.querySelector('input[name="appName"]'),y=document.querySelector('textarea[name="productDescription"]');h&&(h.closest("div").classList.remove("hidden"),h.required=!0),p&&(p.closest("div").classList.remove("hidden"),p.required=!0),v&&(v.closest("div").classList.remove("hidden"),v.required=!0),y&&(y.closest("div").classList.remove("hidden"),y.required=!0),a&&(a.textContent="Restaurant Logo"),l&&(l.textContent="Upload logo or drag and drop"),i&&(i.textContent="Menu Photos (Optional)"),s&&(s.textContent="Upload menu photos or drag and drop")}else if(e.id==="order-menu-system"||e.id==="5"){console.log("üçΩÔ∏è Showing Order Menu System fields for product:",e.id);const c=document.getElementById("order-menu-fields");c&&(c.classList.remove("hidden"),c.style.display="block"),f&&(f.classList.add("hidden"),f.style.display="none"),b&&(b.classList.add("hidden"),b.style.display="none");const u=document.querySelector('input[name="orderMenuRestaurantName"]'),m=document.querySelector('input[name="orderMenuOwnerName"]'),g=document.querySelector('textarea[name="orderMenuAddress"]');u&&(u.required=!0),m&&(m.required=!0),g&&(g.required=!0);const h=document.querySelector('input[name="projectName"]'),p=document.querySelector('input[name="contactPerson"]'),v=document.querySelector('input[name="appName"]'),y=document.querySelector('textarea[name="productDescription"]');h&&(h.required=!0),p&&(p.required=!0),v&&(v.closest("div").classList.add("hidden"),v.required=!1),y&&(y.closest("div").classList.add("hidden"),y.required=!1),document.querySelectorAll(".non-order-menu-fields").forEach(I=>{I.classList.add("hidden"),I.style.display="none"});const f=document.getElementById("restaurant-fields"),b=document.getElementById("restaurant-cuisine-fields");f&&f.classList.add("hidden"),b&&b.classList.add("hidden"),document.querySelectorAll(".non-order-menu-fields").forEach(I=>{I.classList.remove("hidden"),I.style.display="block"}),this.setupOrderMenuLogoUpload()}else{console.log("üì± Showing non-restaurant fields for product:",e.id);const c=document.getElementById("order-menu-fields");c&&(c.classList.add("hidden"),c.style.display="none",console.log("üö´ Order Menu System fields hidden for non-Order Menu System product")),document.querySelectorAll("#order-menu-fields [required]").forEach(y=>{y.required=!1}),n&&(n.classList.add("hidden"),n.style.display="none",console.log("üö´ Cuisine type field hidden for non-restaurant product")),document.querySelectorAll(".non-order-menu-fields").forEach(y=>{y.classList.remove("hidden"),y.style.display="block"});const g=document.querySelector('input[name="projectName"]'),h=document.querySelector('input[name="contactPerson"]'),p=document.querySelector('input[name="appName"]'),v=document.querySelector('textarea[name="productDescription"]');g&&(g.closest("div").classList.remove("hidden"),g.required=!0),h&&(h.closest("div").classList.remove("hidden"),h.required=!0),p&&(p.closest("div").classList.remove("hidden"),p.required=!0),v&&(v.closest("div").classList.remove("hidden"),v.required=!0),e.id==="android-tv"||e.id==="android-tv-app"?(console.log("üì∫ Showing TV app fields"),a&&(a.textContent="App Icon"),l&&(l.textContent="Upload app icon or drag and drop"),i&&(i.textContent="App Screenshots (Optional)"),s&&(s.textContent="Upload app screenshots or drag and drop")):e.id==="mobile-streaming"||e.id==="streaming-mobile-app"?(console.log("üì± Showing mobile app fields"),a&&(a.textContent="App Icon"),l&&(l.textContent="Upload app icon or drag and drop"),i&&(i.textContent="App Screenshots (Optional)"),s&&(s.textContent="Upload app screenshots or drag and drop")):(a&&(a.textContent="App Icon"),l&&(l.textContent="Upload app icon or drag and drop"),i&&(i.textContent="App Screenshots (Optional)"),s&&(s.textContent="Upload app screenshots or drag and drop"))}const d=document.querySelector('input[name="appName"]');d&&(d.required=!0)}prefillRequirementsForm(){const t=(window.globalAuthManager||window.simpleAuthManager)?.getCurrentUser();if(!t)return;const r=document.querySelector('input[name="email"]'),o=document.querySelector('input[name="phone"]');r&&(r.value=t.email||""),o&&(o.value=t.phone||""),this.setupFileUploads()}setupFileUploads(){const e=document.getElementById("logo-upload");e&&e.addEventListener("change",r=>{const o=r.target.files[0];o&&(this.showUploadSuccess("logo-upload",o.name),this.items.length>0&&(this.items[0].logo=o,console.log("Logo stored:",o.name)))});const t=document.getElementById("menu-upload");t&&t.addEventListener("change",r=>{const o=Array.from(r.target.files);o.length>0&&(this.showUploadSuccess("photos-upload",`${o.length} files selected`),this.items.length>0&&(this.items[0].photos=o,console.log("Photos stored:",o.map(n=>n.name))))}),this.setupDragAndDrop()}setupFormChangeListeners(){console.log("üö´ Auto-save disabled to prevent duplicate entries")}setupDragAndDrop(){const e=document.querySelector("#logo-upload-section .border-dashed"),t=document.querySelector("#photos-upload-section .border-dashed");e&&(e.addEventListener("dragover",r=>{r.preventDefault(),e.classList.add("border-primary-400","bg-primary-50")}),e.addEventListener("dragleave",r=>{r.preventDefault(),e.classList.remove("border-primary-400","bg-primary-50")}),e.addEventListener("drop",r=>{r.preventDefault(),e.classList.remove("border-primary-400","bg-primary-50");const o=Array.from(r.dataTransfer.files);if(o.length>0){const n=o[0];document.getElementById("logo-upload").files=r.dataTransfer.files,this.showUploadSuccess("logo-upload",n.name),this.items.length>0&&(this.items[0].logo=n)}})),t&&(t.addEventListener("dragover",r=>{r.preventDefault(),t.classList.add("border-primary-400","bg-primary-50")}),t.addEventListener("dragleave",r=>{r.preventDefault(),t.classList.remove("border-primary-400","bg-primary-50")}),t.addEventListener("drop",r=>{r.preventDefault(),t.classList.remove("border-primary-400","bg-primary-50");const o=Array.from(r.dataTransfer.files);o.length>0&&(document.getElementById("menu-upload").files=r.dataTransfer.files,this.showUploadSuccess("photos-upload",`${o.length} files selected`),this.items.length>0&&(this.items[0].photos=o))}))}showUploadSuccess(e,t){const r=document.getElementById(e==="logo-upload"?"upload-status":"photos-status");r&&(r.textContent=`‚úì ${t}`,r.className="mt-3 text-sm font-medium text-green-600",r.classList.remove("hidden"),setTimeout(()=>{r.classList.add("hidden")},3e3))}setupOrderMenuLogoUpload(){const e=document.getElementById("order-menu-logo-upload"),t=document.getElementById("order-menu-logo-status");e&&e.addEventListener("change",r=>{const o=r.target.files[0];if(o){if(!o.type.startsWith("image/")){t.textContent="Please select an image file",t.className="mt-3 text-sm font-medium text-red-500",t.classList.remove("hidden");return}if(o.size>10*1024*1024){t.textContent="File size must be less than 10MB",t.className="mt-3 text-sm font-medium text-red-500",t.classList.remove("hidden");return}t.textContent=`Selected: ${o.name}`,t.className="mt-3 text-sm font-medium text-green-500",t.classList.remove("hidden"),this.orderMenuLogoFile=o}})}collectMenuItems(){const e=[],t=document.querySelectorAll(".menu-item");return console.log("üçΩÔ∏è Collecting menu items from",t.length,"elements"),t.forEach((r,o)=>{const n=r.querySelector('input[name="menuItemName[]"]')?.value?.trim(),a=r.querySelector('input[name="menuItemPrice[]"]')?.value?.trim(),l=r.querySelector('input[name="menuItemQuantity[]"]')?.value?.trim();console.log(`üçΩÔ∏è Item ${o+1}:`,{itemName:n,price:a,quantity:l}),n&&a&&l?e.push({item_name:n,price:parseFloat(a)||0,quantity_available:parseInt(l)||0,item_description:"",item_category:"General",is_available:!0}):console.log(`‚ö†Ô∏è Skipping item ${o+1} - missing required fields`)}),console.log("üçΩÔ∏è Collected menu items:",e),e}updateMenuItemsReview(){const e=document.getElementById("review-menu-items");e&&(this.requirements.menuItems&&this.requirements.menuItems.length>0?e.innerHTML=this.requirements.menuItems.map((t,r)=>`
          <div class="flex justify-between items-center py-3 border-b border-gray-200 ${r===this.requirements.menuItems.length-1?"border-b-0":""}">
            <div class="flex-1">
              <div class="font-medium text-gray-900">${t.item_name}</div>
              <div class="text-sm text-gray-500">Quantity Available: ${t.quantity_available}</div>
            </div>
            <div class="text-right">
              <div class="font-semibold text-lg text-gray-900">‚Çπ${t.price.toFixed(2)}</div>
            </div>
          </div>
        `).join(""):e.innerHTML='<p class="text-gray-500 text-center py-4">No menu items added</p>')}backToCart(){const e=document.getElementById("project-requirements"),t=document.getElementById("cart-actions");e&&e.classList.add("hidden"),t&&t.classList.remove("hidden"),t?.scrollIntoView({behavior:"smooth"})}async saveCartToSupabase(){try{console.log("üîç Starting saveCartToSupabase...");const e=window.globalAuthManager||window.simpleAuthManager;console.log("üîç Auth manager found:",!!e);const t=e?.getCurrentUser();if(console.log("üîç Current user:",t),!t||this.items.length===0)return console.log("‚ùå No user or items found for Supabase save"),console.log("‚ùå User:",t),console.log("‚ùå Items length:",this.items.length),null;const r=this.items[0];if(console.log("üîç Debug - Item being saved:",r),console.log("üîç Debug - Current user:",t),!_)return console.error("‚ùå Supabase client not available"),null;const o=document.getElementById("requirements-form");let n={};const a=r&&(r.id==="order-menu-system"||r.id==="5");o&&(a?(n={projectName:o.querySelector('[name="projectName"]')?.value||"",contactPerson:o.querySelector('[name="contactPerson"]')?.value||"",restaurantName:o.querySelector('[name="orderMenuRestaurantName"]')?.value||"",ownerName:o.querySelector('[name="orderMenuOwnerName"]')?.value||"",restaurantAddress:o.querySelector('[name="orderMenuAddress"]')?.value||"",email:o.querySelector('[name="email"]')?.value||"",phone:o.querySelector('[name="phone"]')?.value||"",menuItems:this.collectMenuItems(),additionalRequirements:o.querySelector('[name="additionalRequirements"]')?.value||""},console.log("üçΩÔ∏è Form data collected for Order Menu System:",n)):n={projectName:o.querySelector('[name="projectName"]')?.value||"",contactPerson:o.querySelector('[name="contactPerson"]')?.value||"",restaurantName:o.querySelector('[name="restaurantName"]')?.value||"",cuisineType:o.querySelector('[name="cuisineType"]')?.value||o.querySelector('[name="emergencyCuisineType"]')?.value||"",appName:o.querySelector('[name="appName"]')?.value||"",email:o.querySelector('[name="email"]')?.value||"",phone:o.querySelector('[name="phone"]')?.value||"",additionalRequirements:o.querySelector('[name="additionalRequirements"]')?.value||""});const l=document.querySelector('input[name="primaryColor"]')?.value||"#3B82F6",i=document.querySelector('input[name="secondaryColor"]')?.value||"#A5CF6",s=document.querySelector('input[name="accentColor"]')?.value||"#F59E0B",d=document.querySelector('input[name="textColor"]')?.value||"#1F2937",c=r.price,u=r.features.reduce((w,L)=>w+({responsive:500,seo:300,analytics:200}[L]||0),0),m=c+u,g=Math.round(m*.18),h=m+g,p=document.querySelector('input[name="restaurantLogo"]')?.files?.[0],v=document.querySelector('input[name="menuPhotos"]')?.files;let y="",x="",f=0,b="",E="",I=[],C=[],q=[],O=[],M=[];p&&(console.log("üì∏ Processing restaurant logo upload:",p.name),x=p.name,f=p.size,b=p.type,y=`pending_upload_${Date.now()}_${p.name}`,E=`hash_${p.name}_${p.size}_${Date.now()}`),v&&v.length>0&&(console.log("üì∏ Processing menu photos upload:",v.length,"files"),Array.from(v).forEach(w=>{C.push(w.name),q.push(w.size),O.push(w.type),I.push(`pending_upload_${Date.now()}_${w.name}`),M.push(`hash_${w.name}_${w.size}_${Date.now()}`)}));let A;if(a?A={user_email:t.email,user_id:t.id||null,product_id:"order-menu-system",product_name:"Order Menu System",base_price:r.price,total_amount:h,project_name:n.projectName||"",contact_person:n.contactPerson||"",restaurant_name:n.restaurantName||"",owner_name:n.ownerName||"",app_icon_url:null,app_icon_filename:null,app_icon_size:null,app_icon_type:null,restaurant_address:n.restaurantAddress||"",restaurant_logo_url:y,restaurant_logo_filename:x,restaurant_logo_size:f,restaurant_logo_type:b,contact_email:n.email||t.email,contact_phone:n.phone||t.phone||"",app_screenshots:[],primary_color:l,secondary_color:i,accent_color:s,text_color:d,additional_requirements:n.additionalRequirements||"",menu_items:n.menuItems?n.menuItems.map(w=>({item_name:w.item_name,price:parseFloat(w.price)||0,quantity_available:parseInt(w.quantity_available)||0,item_description:w.item_description||"",item_category:w.item_category||"General",is_available:!0,created_at:new Date().toISOString()})):[],menu_items_count:n.menuItems?n.menuItems.length:0,cart_status:"pending"}:A={user_email:t.email,user_id:t.id||null,product_id:r.id,product_name:r.name,product_description:r.description,base_price:r.price,total_amount:h,custom_name:r.customName||"",restaurant_name_customization:r.restaurantName||"",selected_color:r.color||"#3B82F6",selected_features:r.features||[],project_name:n.projectName||"",contact_person:n.contactPerson||"",restaurant_name:n.restaurantName||"",cuisine_type:n.cuisineType||"",app_name:n.appName||"",product_description_custom:n.productDescription||"",contact_email:n.email||t.email,contact_phone:n.phone||t.phone||"",primary_color:l,secondary_color:i,accent_color:s,text_color:d,restaurant_logo_url:y,restaurant_logo_filename:x,restaurant_logo_size:f,restaurant_logo_type:b,restaurant_logo_hash:E,menu_photos_urls:I,menu_photos_filenames:C,menu_photos_sizes:q,menu_photos_types:O,menu_photos_hashes:M,additional_requirements:n.additionalRequirements||"",cart_status:"pending",is_checkout_initiated:!1},console.log("üîç Debug - Cart data being sent to Supabase:",A),a){console.log("üçΩÔ∏è Saving Order Menu System data to dedicated tables...");const{data:w,error:L}=await _.from("order_menu_system_customizations").insert(A).select().single();return L?(console.error("‚ùå Error saving Order Menu System customization:",L),null):(console.log("‚úÖ Order Menu System customization saved:",w),console.log("‚úÖ Menu items included in customization:",n.menuItems?n.menuItems.length:0,"items"),w)}else{console.log("üîç Testing Supabase connection for standard cart...");const{data:w,error:L}=await _.from("cart_customizations").select("*").limit(1);if(L)return console.error("‚ùå Supabase connection test failed:",L),null;console.log("‚úÖ Supabase connection test successful"),console.log("üöÄ Attempting to save to Supabase using simple upsert function...");const{data:F,error:D}=await _.rpc("upsert_cart_customization",{p_user_email:t.email,p_user_id:t.id||null,p_product_id:r.id,p_product_name:r.name,p_product_description:r.description,p_base_price:r.price,p_total_amount:h,p_project_name:n.projectName||"",p_app_name:n.appName||"",p_contact_person:n.contactPerson||"",p_product_description_custom:n.productDescription||"",p_restaurant_name:n.restaurantName||"",p_cuisine_type:n.cuisineType||"",p_contact_email:n.email||t.email,p_contact_phone:n.phone||t.phone||"",p_restaurant_logo_url:y,p_restaurant_logo_filename:x,p_restaurant_logo_size:f,p_restaurant_logo_type:b,p_restaurant_logo_hash:E,p_menu_photos_urls:I,p_menu_photos_filenames:C,p_menu_photos_sizes:q,p_menu_photos_types:O,p_menu_photos_hashes:M,p_primary_color:l,p_secondary_color:i,p_accent_color:s,p_text_color:d,p_additional_requirements:n.additionalRequirements||""});if(D){console.error("‚ùå Upsert function failed, trying direct upsert:",D);let{data:B,error:N}=await _.from("cart_customizations").upsert([A],{onConflict:"user_email,product_id"}).select();if(N){console.warn("‚ö†Ô∏è Direct upsert failed, trying insert as fallback:",N);const k=await _.from("cart_customizations").insert([A]).select();k.error?(console.error("‚ùå Insert also failed:",k.error),N=k.error):(console.log("‚úÖ Insert successful as fallback"),B=k.data,N=null)}return N?(console.error("‚ùå All save methods failed:",N),null):(console.log("‚úÖ Cart saved successfully via fallback method"),B[0])}else{console.log("‚úÖ Cart saved successfully via upsert function"),console.log("üîç Upsert result:",F);const{data:B,error:N}=await _.from("cart_customizations").select("*").eq("id",F).single();return N?(console.error("‚ùå Failed to fetch saved cart:",N),null):B}}}catch(e){return console.error("‚ùå Error in saveCartToSupabase:",e),console.error("‚ùå Error stack:",e.stack),null}}async markOrderAsCompleted(e){try{console.log("üí≥ Marking order as completed:",e);const r=(window.globalAuthManager||window.simpleAuthManager)?.getCurrentUser();if(!r)return console.error("‚ùå No user found for order completion"),!1;const o=window.supabase?.createClient("https://lmrrdcaavwwletcjcpqv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ"),{data:n,error:a}=await o.from("cart_customizations").update({cart_status:"completed",updated_at:new Date().toISOString()}).eq("id",e).eq("user_email",r.email);return a?(console.error("‚ùå Error marking order as completed:",a),!1):(console.log("‚úÖ Order marked as completed successfully"),!0)}catch(t){return console.error("‚ùå Error in markOrderAsCompleted:",t),!1}}async cancelOrder(e){try{console.log("‚ùå Cancelling order:",e);const r=(window.globalAuthManager||window.simpleAuthManager)?.getCurrentUser();if(!r)return console.error("‚ùå No user found for order cancellation"),!1;const o=window.supabase?.createClient("https://lmrrdcaavwwletcjcpqv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ"),{data:n,error:a}=await o.from("cart_customizations").update({cart_status:"cancelled",updated_at:new Date().toISOString()}).eq("id",e).eq("user_email",r.email);return a?(console.error("‚ùå Error cancelling order:",a),!1):(console.log("‚úÖ Order cancelled successfully"),!0)}catch(t){return console.error("‚ùå Error in cancelOrder:",t),!1}}calculateTotal(){const e=this.items.reduce((o,n)=>o+n.price*n.quantity,0),t=this.items.reduce((o,n)=>{const a={responsive:500,seo:300,analytics:200};return o+n.features.reduce((l,i)=>l+(a[i]||0),0)},0),r=(e+t)*.18;return Math.round(e+t+r)}declineOrder(){confirm("Are you sure you want to decline this order? You will be redirected to products page.")&&(this.items=[],this.saveCart(),window.location.href="/products")}deleteItem(){confirm("Are you sure you want to delete this item? You will be redirected to products page.")&&(this.items=[],this.saveCart(),window.location.href="/products")}switchPaymentMethod(e){const t=document.getElementById("card-details"),r=document.getElementById("upi-details"),o=document.getElementById("netbanking-details");switch(t?.classList.add("hidden"),r?.classList.add("hidden"),o?.classList.add("hidden"),e){case"card":t?.classList.remove("hidden");break;case"upi":r?.classList.remove("hidden");break;case"netbanking":o?.classList.remove("hidden");break}}updateOrderReview(){console.log("üîÑ Updating order review with data:",this.requirements);try{const e=this.items[0];if(e&&(e.id==="order-menu-system"||e.id==="5")){const f=document.getElementById("review-order-menu-info");f&&f.classList.remove("hidden");const b=document.getElementById("review-restaurant-name"),E=document.getElementById("review-owner-name"),I=document.getElementById("review-restaurant-address"),C=document.getElementById("review-contact-email"),q=document.getElementById("review-contact-phone");b&&(b.textContent=this.requirements.restaurantName||"-"),E&&(E.textContent=this.requirements.ownerName||"-"),I&&(I.textContent=this.requirements.restaurantAddress||"-"),C&&(C.textContent=this.requirements.email||"-"),q&&(q.textContent=this.requirements.phone||"-"),this.updateMenuItemsReview()}else{const f=document.getElementById("review-order-menu-info");f&&f.classList.add("hidden");const b=document.getElementById("review-project-name"),E=document.getElementById("review-contact-person"),I=document.getElementById("review-app-name");b&&(b.textContent=this.requirements.projectName||"-"),E&&(E.textContent=this.requirements.contactPerson||"-"),I&&(I.textContent=this.requirements.appName||"-");const C=document.getElementById("review-restaurant-info"),q=document.getElementById("review-cuisine-info"),O=document.getElementById("review-restaurant-name"),M=document.getElementById("review-cuisine-type");e&&(e.id==="restaurant-menu"||e.id==="restaurant-menu-system"||e.id==="restaurant-website"||e.id==="1"||e.id==="4")?(C&&C.classList.remove("hidden"),q&&q.classList.remove("hidden"),O&&(O.textContent=this.requirements.restaurantName||"-"),M&&(M.textContent=this.requirements.cuisineType||"-")):(C&&C.classList.add("hidden"),q&&q.classList.add("hidden"))}const r=document.querySelector('input[name="primaryColor"]')?.value||"#3B82F6",o=document.querySelector('input[name="secondaryColor"]')?.value||"#A5CF6",n=document.querySelector('input[name="accentColor"]')?.value||"#F59E0B",a=document.querySelector('input[name="textColor"]')?.value||"#1F2937",l=document.getElementById("review-primary-color"),i=document.getElementById("review-secondary-color"),s=document.getElementById("review-accent-color"),d=document.getElementById("review-text-color");l&&(l.style.backgroundColor=r),i&&(i.style.backgroundColor=o),s&&(s.style.backgroundColor=n),d&&(d.style.backgroundColor=a);const c=document.getElementById("logo-upload")?.files[0],u=document.getElementById("menu-upload")?.files,m=document.getElementById("review-logo-status"),g=document.getElementById("review-photos-status");m&&(m.textContent=c?`‚úì ${c.name}`:"Not uploaded"),g&&(g.textContent=u&&u.length>0?`‚úì ${u.length} photos selected`:"Not uploaded");const h=document.getElementById("review-total");if(h){const f=this.calculateTotal();h.textContent=`‚Çπ${f.toLocaleString()}`}const p=document.getElementById("final-amount");if(p){const f=this.calculateTotal();p.textContent=f.toLocaleString()}const v=document.getElementById("review-email"),y=document.getElementById("review-phone");v&&(v.textContent=this.requirements.email||"-"),y&&(y.textContent=this.requirements.phone||"-");const x=document.getElementById("review-additional-requirements");x&&(x.textContent=this.requirements.additionalRequirements||"No additional requirements specified"),console.log("‚úÖ Order review updated successfully")}catch(e){console.error("‚ùå Error updating order review:",e)}}backToRequirements(){const e=document.getElementById("order-review"),t=document.getElementById("project-requirements");e&&e.classList.add("hidden"),t&&t.classList.remove("hidden"),t?.scrollIntoView({behavior:"smooth"})}async proceedToPayment(){await this.createOrder(),this.showPaymentSection()}showPaymentSection(){const e=document.getElementById("project-requirements"),t=document.getElementById("payment-section");e&&e.classList.add("hidden"),t&&t.classList.remove("hidden"),this.updatePaymentSummary(),t?.scrollIntoView({behavior:"smooth"})}updatePaymentSummary(){try{console.log("üîÑ Updating payment summary..."),console.log("üìù Requirements data:",this.requirements);const e=document.getElementById("payment-project-name"),t=document.getElementById("payment-contact-person"),r=document.getElementById("payment-app-name"),o=document.getElementById("payment-email"),n=document.getElementById("payment-phone"),a=document.getElementById("payment-total-amount");if(console.log("üîç Payment elements found:",{projectNameEl:!!e,contactPersonEl:!!t,appNameEl:!!r,emailEl:!!o,phoneEl:!!n,totalAmountEl:!!a}),e&&(e.textContent=this.requirements.projectName||"-",console.log("‚úÖ Updated project name:",this.requirements.projectName)),t&&(t.textContent=this.requirements.contactPerson||"-",console.log("‚úÖ Updated contact person:",this.requirements.contactPerson)),r&&(r.textContent=this.requirements.appName||"-",console.log("‚úÖ Updated app name:",this.requirements.appName)),o&&(o.textContent=this.requirements.email||"-",console.log("‚úÖ Updated email:",this.requirements.email)),n&&(n.textContent=this.requirements.phone||"-",console.log("‚úÖ Updated phone:",this.requirements.phone)),a){const i=this.calculateTotal();a.textContent=i.toLocaleString(),console.log("‚úÖ Updated total amount:",i)}const l=document.getElementById("final-amount");if(l){const i=this.calculateTotal();l.textContent=i.toLocaleString(),console.log("‚úÖ Updated final payment amount:",i)}console.log("‚úÖ Payment summary updated successfully")}catch(e){console.error("‚ùå Error updating payment summary:",e)}}processFinalPayment(){const e=document.querySelector('input[name="paymentMethod"]:checked')?.value;if(!e){alert("Please select a payment method");return}let t=!0,r="";switch(e){case"card":const o=document.querySelector('input[name="cardNumber"]').value,n=document.querySelector('input[name="cardholderName"]').value,a=document.querySelector('input[name="expiryDate"]').value,l=document.querySelector('input[name="cvv"]').value;(!o||!n||!a||!l)&&(t=!1,r="Please fill in all card details");break;case"upi":document.querySelector('input[name="upiId"]').value||(t=!1,r="Please enter your UPI ID");break;case"netbanking":document.querySelector('select[name="bank"]').value||(t=!1,r="Please select your bank");break}if(!t){alert(r);return}this.simulatePayment()}simulatePayment(){const e=document.getElementById("final-payment");e.innerHTML,e.innerHTML=`
        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Processing Payment...
      `,e.disabled=!0,setTimeout(()=>{this.saveOrderToHistory(),this.updateOrderStatusToConfirmed(),this.items=[],this.saveCart(),e.innerHTML=`
          <svg class="w-5 h-5 text-white inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          Payment Successful!
        `,setTimeout(()=>{window.location.href="/orders?order=success"},2e3)},3e3)}saveOrderToHistory(){if(this.items.length===0)return;const t=(window.globalAuthManager||window.simpleAuthManager)?.getCurrentUser();if(!t)return;const r=this.items[0],o=this.calculateTotal(),n=document.querySelector('input[name="primaryColor"]')?.value||"#3B82F6",a=document.querySelector('input[name="secondaryColor"]')?.value||"#A5CF6",l=document.querySelector('input[name="accentColor"]')?.value||"#F59E0B",i=document.querySelector('input[name="textColor"]')?.value||"#1F2937",s={userId:t.email,customerName:t.fullName||"User",customerEmail:t.email,serviceName:r.name,serviceType:"web_development",status:"cart",paymentStatus:"pending",amount:o,currency:"INR",requirements:{primaryColor:n,secondaryColor:a,accentColor:l,textColor:i,customName:r.customName||"",logo:r.logo||null,features:r.features||[],description:r.description}};try{const m=P.createOrder(s);console.log("Order saved to shared store:",m),this.currentSharedOrderId=m.id;const g=P.getOrders();console.log("All orders in shared store after creation:",g),console.log("Current shared order ID:",this.currentSharedOrderId)}catch(m){console.error("Error saving to shared store:",m)}const d={orderId:`ORD-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,userId:t.email,projectName:r.name,description:r.description,total:o,orderDate:new Date().toISOString(),requirements:{...this.requirements,primaryColor:n,secondaryColor:a,accentColor:l,textColor:i},features:r.features||[],logo:r.logo||null,color:r.color||"#3B82F6",customName:r.customName||""};let c=[];const u=localStorage.getItem("user-orders");u&&(c=JSON.parse(u)),c.push(d),localStorage.setItem("user-orders",JSON.stringify(c)),console.log("Order saved to user orders:",d)}async createOrder(){if(this.items.length===0)return;const t=(window.globalAuthManager||window.simpleAuthManager)?.getCurrentUser();if(!t)return;const r=this.items[0],o=this.calculateTotal(),n=document.querySelector('input[name="primaryColor"]')?.value||"#3B82F6",a=document.querySelector('input[name="secondaryColor"]')?.value||"#A5CF6",l=document.querySelector('input[name="accentColor"]')?.value||"#F59E0B",i=document.querySelector('input[name="textColor"]')?.value||"#1F2937",s=document.getElementById("requirements-form");let d={};const c=r&&(r.id==="order-menu-system"||r.id==="5");s&&(c?d={projectName:s.querySelector('[name="projectName"]')?.value||"",contactPerson:s.querySelector('[name="contactPerson"]')?.value||"",restaurantName:s.querySelector('[name="orderMenuRestaurantName"]')?.value||"",ownerName:s.querySelector('[name="orderMenuOwnerName"]')?.value||"",restaurantAddress:s.querySelector('[name="orderMenuAddress"]')?.value||"",email:s.querySelector('[name="email"]')?.value||"",phone:s.querySelector('[name="phone"]')?.value||"",menuItems:this.collectMenuItems(),additionalRequirements:s.querySelector('[name="additionalRequirements"]')?.value||""}:d={projectName:s.querySelector('[name="projectName"]')?.value||"",contactPerson:s.querySelector('[name="contactPerson"]')?.value||"",restaurantName:s.querySelector('[name="restaurantName"]')?.value||"",cuisineType:s.querySelector('[name="cuisineType"]')?.value||"",appName:s.querySelector('[name="appName"]')?.value||"",productDescription:s.querySelector('[name="productDescription"]')?.value||"",email:s.querySelector('[name="email"]')?.value||"",phone:s.querySelector('[name="phone"]')?.value||"",additionalRequirements:s.querySelector('[name="additionalRequirements"]')?.value||""});try{const u=await this.saveCartToSupabase();u?(console.log("‚úÖ Cart customization saved to Supabase:",u),this.currentSharedOrderId=u.id):console.error("‚ùå Failed to save cart data to Supabase");const m={userId:t.email,customerName:t.fullName||"User",customerEmail:t.email,serviceName:r.name,serviceType:c?"order_menu_system":"web_development",status:"pending",paymentStatus:"pending",amount:o,currency:"INR",requirements:{...d,primaryColor:n,secondaryColor:a,accentColor:l,textColor:i,customName:r.customName||"",logo:r.logo||null,features:r.features||[],description:r.description}},g=P.createOrder(m);console.log("Order created in shared store:",g);const h=P.getOrders();console.log("All orders in shared store after creation:",h),console.log("Current shared order ID:",this.currentSharedOrderId)}catch(u){console.error("Error creating order:",u)}}updateOrderStatusToPending(){if(this.currentSharedOrderId)try{P.updateOrderStatus(this.currentSharedOrderId,"pending","Payment initiated"),console.log("Order status updated to pending")}catch(e){console.error("Error updating order status:",e)}}updateOrderStatusToConfirmed(){if(this.currentSharedOrderId)try{P.updateOrderStatus(this.currentSharedOrderId,"confirmed","Payment successful - Order confirmed"),console.log("Order status updated to confirmed")}catch(e){console.error("Error updating order status:",e)}}debounce(e,t){let r;return function(...n){const a=()=>{clearTimeout(r),e(...n)};clearTimeout(r),r=setTimeout(a,t)}}}function j(){document.getElementById("menu-items-container").insertAdjacentHTML("beforeend",`
      <div class="menu-item border border-gray-300 rounded-lg p-4 mb-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium text-white mb-2">Item Name</label>
            <input type="text" name="menuItemName[]" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500" placeholder="e.g., Margherita Pizza">
          </div>
          <div>
            <label class="block text-sm font-medium text-white mb-2">Price (‚Çπ)</label>
            <input type="number" name="menuItemPrice[]" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500" placeholder="299">
          </div>
          <div>
            <label class="block text-sm font-medium text-white mb-2">Quantity Available</label>
            <input type="number" name="menuItemQuantity[]" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500" placeholder="50">
          </div>
        </div>
        <button type="button" onclick="removeMenuItem(this)" class="mt-2 text-red-500 hover:text-red-700 text-sm font-medium">Remove Item</button>
      </div>
    `)}function $(S){S.closest(".menu-item").remove()}window.addMenuItem=j;window.removeMenuItem=$;window.markOrderAsCompleted=async function(S){return window.cart?await window.cart.markOrderAsCompleted(S):(console.error("‚ùå Cart not initialized"),!1)};window.cancelOrder=async function(S){return window.cart?await window.cart.cancelOrder(S):(console.error("‚ùå Cart not initialized"),!1)};window.handlePaymentSuccess=async function(S){console.log("üí≥ Payment successful for order:",S);const e=await window.markOrderAsCompleted(S);alert(e?"‚úÖ Payment successful! Your order has been completed.":"‚ùå Error updating order status. Please contact support.")};window.handlePaymentFailure=async function(S){console.log("‚ùå Payment failed for order:",S),alert("‚ùå Payment failed. Please try again or contact support.")};window.handleOrderCancellation=async function(S){console.log("‚ùå Order cancelled:",S);const e=await window.cancelOrder(S);alert(e?"‚ùå Order has been cancelled.":"‚ùå Error cancelling order. Please contact support.")};window.clearCartForNewUser=function(){console.log("üßπ Clearing cart for new user"),window.cart&&(window.cart.items=[],window.cart.requirements={},localStorage.removeItem("cart-items"),localStorage.removeItem("cart-requirements"),localStorage.removeItem("user-cart-data"),console.log("‚úÖ Cart cleared for new user"))};window.clearCartOnUserChange=function(){console.log("üßπ Clearing cart due to user change"),window.cart&&(window.cart.items=[],window.cart.requirements={},localStorage.removeItem("cart-items"),localStorage.removeItem("cart-requirements"),localStorage.removeItem("user-cart-data"),console.log("‚úÖ Cart cleared due to user change"))};window.debugCartState=function(){console.log("üîç Cart Debug State:"),console.log("- Cart instance:",!!window.cart),console.log("- Cart items count:",window.cart?window.cart.items.length:0),console.log("- Cart items:",window.cart?window.cart.items:[]),console.log("- localStorage cart-items:",localStorage.getItem("cart-items")),console.log("- localStorage cart-requirements:",localStorage.getItem("cart-requirements")),console.log("- localStorage user-cart-data:",localStorage.getItem("user-cart-data"));const e=(window.globalAuthManager||window.simpleAuthManager)?.getCurrentUser();if(console.log("- Current user:",e?e.email:"Not logged in"),window.cart&&window.cart.items.length>0){const t=window.cart.items[0];console.log("- First item email:",t.email),console.log("- First item name:",t.name)}};window.validateCartOwnership=function(){const e=(window.globalAuthManager||window.simpleAuthManager)?.getCurrentUser();if(!e)return!0;if(window.cart&&window.cart.items.length>0){const t=window.cart.items[0];if(t.email&&t.email!==e.email)return console.log("‚ö†Ô∏è Cart belongs to different user, clearing..."),window.clearCartForNewUser(),!1}return!0};
