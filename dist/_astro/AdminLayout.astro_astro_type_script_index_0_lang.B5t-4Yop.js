const l="https://lmrrdcaavwwletcjcpqv.supabase.co",u="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ";let t=null;function r(){return new Promise(e=>{window.supabase&&window.supabase.auth&&typeof window.supabase.auth.getUser=="function"?(t=window.supabase,e(t)):window.supabase&&typeof window.supabase.createClient=="function"?(t=window.supabase.createClient(l,u),e(t)):setTimeout(()=>r().then(e),100)})}async function s(){try{console.log("üîí AdminGuard: Checking admin access..."),t||await r();const{data:{user:e},error:n}=await t.auth.getUser();if(n){console.error("‚ùå AdminGuard: Error getting user:",n),a("Authentication error. Please login again.");return}if(!e){console.log("‚ùå AdminGuard: No user logged in"),a("Please login to access admin panel");return}console.log("‚úÖ AdminGuard: User found:",e.email);const{data:i,error:o}=await t.from("profiles").select("role").eq("id",e.id).single();if(o){console.error("‚ùå AdminGuard: Error getting profile:",o),a("Error checking user permissions");return}if(i.role!=="admin"){console.log("‚ùå AdminGuard: User does not have admin role. Role:",i.role),a("Access denied. Admin privileges required.");return}console.log("‚úÖ AdminGuard: Admin access granted for user:",e.email),d()}catch(e){console.error("‚ùå AdminGuard: Error checking admin access:",e),a("Error checking admin access. Please try again.")}}function a(e){const n=document.getElementById("admin-guard");n&&(n.innerHTML=`
          <div class="text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
              <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
              </svg>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">Access Denied</h3>
            <p class="text-gray-600 mb-6">${e}</p>
            <div class="space-x-3">
              <a href="/login" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                Go to Login
              </a>
              <a href="/" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                Back to Home
              </a>
            </div>
          </div>
        `)}function d(){const e=document.getElementById("admin-guard");if(e){e.style.display="none",e.style.visibility="hidden",e.style.opacity="0",e.style.height="0",e.style.overflow="hidden";const n=document.getElementById("admin-layout");n&&(n.classList.remove("hidden"),n.style.display="block",n.style.visibility="visible",n.style.opacity="1",m()),window.dispatchEvent(new CustomEvent("admin-access-granted"))}}async function m(){try{t||await r();const{data:{user:e}}=await t.auth.getUser();if(e){const{data:n}=await t.from("profiles").select("full_name").eq("id",e.id).single(),i=document.getElementById("admin-name");i&&(i.textContent=n?.full_name||e.user_metadata?.full_name||e.email||"Admin");const o=document.getElementById("admin-avatar");if(o){const c=n?.full_name||e.user_metadata?.full_name||e.email||"A";o.textContent=c.charAt(0).toUpperCase()}}}catch(e){console.warn("Could not update admin info:",e)}}async function g(){try{console.log("Admin signing out..."),t||await r(),await t.auth.signOut(),sessionStorage.clear(),localStorage.removeItem("supabase-auth-session"),window.location.href="/"}catch(e){console.error("Error during admin sign out:",e),window.location.href="/"}}window.handleAdminSignOut=g;document.addEventListener("DOMContentLoaded",s);window.addEventListener("auth-state-changed",s);document.readyState==="loading"?document.addEventListener("DOMContentLoaded",s):s();setTimeout(()=>{const e=document.getElementById("admin-guard");e&&e.style.display!=="none"&&(console.warn("‚ö†Ô∏è Admin access check timed out, showing content anyway"),d())},1e4);console.log("AdminLayout loaded successfully");
