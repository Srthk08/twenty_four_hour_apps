import{c as v}from"./index.BFAZBQoJ.js";import"./ProductDialog.astro_astro_type_script_index_0_lang.BMBe0S5g.js";import"https://unpkg.com/@supabase/supabase-js@2";import"./MenuOperatorGuard.astro_astro_type_script_index_0_lang.BiNjOZly.js";const x=void 0,E=void 0,d=v(x,E);console.log("üîß Supabase configuration:");console.log("- URL:",x);console.log("- Key:","Missing");let f=null;async function S(){console.log("üß™ Testing Supabase connection...");try{console.log("‚úÖ Supabase client created successfully");const t={user_email:"test@example.com",project_name:"Test Project",owner_name:"Test Owner",restaurant_name:"Test Restaurant",restaurant_address:"123 Test St",phone_number:"+1-555-TEST",logo_url:"https://via.placeholder.com/100x100/FF0000/FFFFFF?text=TEST",status:"pending"};console.log("üìù Attempting to insert test data...",t);const{data:o,error:e}=await d.from("oms_customizations").insert(t).select();return e?(console.error("‚ùå Error inserting test data:",e),console.error("‚ùå Error details:",e.message),console.error("‚ùå Error code:",e.code),console.error("‚ùå Error hint:",e.hint),!1):(console.log("‚úÖ Test data inserted successfully:",o),await d.from("oms_customizations").delete().eq("user_email","test@example.com"),console.log("‚úÖ Test data cleaned up"),!0)}catch(t){return console.error("‚ùå Exception during Supabase test:",t),!1}}document.addEventListener("DOMContentLoaded",async()=>{if(console.log("üìÑ DOM Content Loaded - Starting dashboard initialization"),await S()){console.log("‚úÖ Supabase is working! Proceeding with data loading..."),setTimeout(()=>{console.log("‚è∞ Timeout 1 - Force loading demo data"),i()},100),setTimeout(()=>{console.log("‚è∞ Timeout 2 - Force loading demo data again"),i()},500),setTimeout(()=>{console.log("‚è∞ Timeout 3 - Final attempt to load demo data"),i()},1e3);try{await D(),await C(),M()}catch(o){console.error("‚ùå Error in dashboard initialization:",o),i()}}else console.error("‚ùå Supabase is not working! Check your configuration."),i()});console.log("üöÄ Script loaded - attempting immediate demo data load");setTimeout(()=>{console.log("‚ö° Immediate demo data load attempt"),i()},50);setTimeout(()=>{console.log("üß™ Testing DOM elements...");const t=document.getElementById("total-oms-forms");t?(console.log("‚úÖ Found total-oms-forms element, setting test value"),t.textContent="TEST"):console.log("‚ùå total-oms-forms element not found")},200);async function D(){try{if(typeof window.supabase>"u"){console.error("Supabase client not available");return}const t=window.supabase,{data:{user:o},error:e}=await t.auth.getUser();if(e||!o){console.error("Error getting user:",e),window.location.href="/login";return}f=o,console.log("üîç Loading profile for user:",o.email);const{data:s,error:a}=await t.from("profiles").select("*").eq("id",o.id).eq("role","menu_operator").single();if(a){console.error("Error loading profile:",a);const{data:n,error:r}=await t.from("profiles").select("*").eq("id",o.id).single();if(r){console.error("Error loading fallback profile:",r),window.location.href="/login";return}if(console.log("üîç Fallback profile loaded:",n),console.log("üîç Role value from database:",JSON.stringify(n.role)),!n.role||n.role.toLowerCase().trim()!=="menu_operator"){console.log("User does not have menu_operator role. Role:",n.role),n.role==="admin"?window.location.href="/admin":window.location.href="/dashboard";return}console.log("‚úÖ User has menu_operator role, proceeding...");return}if(console.log("üîç Profile loaded:",s),console.log("üîç Role value from database:",JSON.stringify(s.role)),!s.role||s.role.toLowerCase().trim()!=="menu_operator"){console.log("User does not have menu_operator role. Role:",s.role),s.role==="admin"?window.location.href="/admin":window.location.href="/dashboard";return}console.log("‚úÖ User has menu_operator role, proceeding...")}catch(t){console.error("Error loading user profile:",t)}}async function C(){console.log("üöÄ Loading dashboard data..."),i();try{await Promise.all([F(),_(),b()])}catch(t){console.error("Error loading dashboard data:",t)}}function i(){console.log("üé≠ Loading demo data immediately...");try{const t=document.getElementById("total-oms-forms"),o=document.getElementById("total-menu-photos"),e=document.getElementById("total-processed"),s=document.getElementById("total-pending"),a=document.getElementById("oms-forms-table-body"),n=document.getElementById("photos-table-body");if(console.log("üîç DOM Elements check:"),console.log("- total-oms-forms:",t),console.log("- total-menu-photos:",o),console.log("- total-processed:",e),console.log("- total-pending:",s),console.log("- oms-forms-table-body:",a),console.log("- photos-table-body:",n),!t||!o||!e||!s){console.error("‚ùå Required DOM elements not found!");return}console.log("üìã Loading demo OMS forms...");const r=p();console.log("üìã Demo forms:",r),a?(m(r),console.log("‚úÖ OMS forms displayed")):console.error("‚ùå OMS table body not found"),t.textContent=r.length,console.log("‚úÖ OMS forms count updated:",r.length),console.log("üì∏ Loading demo menu photos...");const l=h();console.log("üì∏ Demo photos:",l),n?(u(l),console.log("‚úÖ Menu photos displayed")):console.error("‚ùå Photos table body not found"),o.textContent=l.length,console.log("‚úÖ Menu photos count updated:",l.length);const c=l.filter(g=>g.conversion_status==="completed").length,w=l.filter(g=>g.conversion_status==="processing"||g.conversion_status==="pending").length;e.textContent=c,s.textContent=w,console.log("‚úÖ Demo data loaded successfully!"),console.log(`üìä Stats: ${r.length} OMS forms, ${l.length} photos, ${c} processed, ${w} pending`);const y=document.getElementById("last-updated");y&&(y.textContent="Just now",console.log("‚úÖ Last updated text updated"))}catch(t){console.error("‚ùå Error loading demo data:",t)}}async function F(){try{const{data:t,error:o}=await d.from("oms_customizations").select("*").order("created_at",{ascending:!1}).limit(50);if(o){console.error("Error loading OMS forms:",o);const e=p();m(e),document.getElementById("total-oms-forms").textContent=e.length;return}if(!t||t.length===0){const e=p();m(e),document.getElementById("total-oms-forms").textContent=e.length}else m(t),document.getElementById("total-oms-forms").textContent=t.length}catch(t){console.error("Error loading OMS forms:",t);const o=p();m(o),document.getElementById("total-oms-forms").textContent=o.length}}function p(){return[{id:"demo-1",project_name:"Bella Vista Restaurant",owner_name:"Maria Rodriguez",restaurant_name:"Bella Vista",restaurant_address:"123 Main Street, New York, NY",user_email:"maria@bellavista.com",phone_number:"+1 (555) 123-4567",logo_url:"https://via.placeholder.com/32x32/4F46E5/FFFFFF?text=BV",created_at:new Date(Date.now()-2*24*60*60*1e3).toISOString(),status:"pending"},{id:"demo-2",project_name:"Golden Dragon Chinese",owner_name:"David Chen",restaurant_name:"Golden Dragon",restaurant_address:"456 Oak Avenue, Los Angeles, CA",user_email:"david@goldendragon.com",phone_number:"+1 (555) 987-6543",logo_url:"https://via.placeholder.com/32x32/DC2626/FFFFFF?text=GD",created_at:new Date(Date.now()-5*24*60*60*1e3).toISOString(),status:"processed"},{id:"demo-3",project_name:"Caf√© Del Sol",owner_name:"Sophie Martin",restaurant_name:"Caf√© Del Sol",restaurant_address:"789 Pine Street, Miami, FL",user_email:"sophie@cafedelsol.com",phone_number:"+1 (555) 456-7890",logo_url:"https://via.placeholder.com/32x32/059669/FFFFFF?text=CD",created_at:new Date(Date.now()-7*24*60*60*1e3).toISOString(),status:"pending"},{id:"demo-4",project_name:"Pizza Palace",owner_name:"Tony Romano",restaurant_name:"Pizza Palace",restaurant_address:"321 Elm Street, Chicago, IL",user_email:"tony@pizzapalace.com",phone_number:"+1 (555) 321-9876",logo_url:"https://via.placeholder.com/32x32/7C3AED/FFFFFF?text=PP",created_at:new Date(Date.now()-10*24*60*60*1e3).toISOString(),status:"processed"},{id:"demo-5",project_name:"Sushi Master",owner_name:"Yuki Tanaka",restaurant_name:"Sushi Master",restaurant_address:"654 Maple Drive, Seattle, WA",user_email:"yuki@sushimaster.com",phone_number:"+1 (555) 654-3210",logo_url:"https://via.placeholder.com/32x32/EA580C/FFFFFF?text=SM",created_at:new Date(Date.now()-12*24*60*60*1e3).toISOString(),status:"pending"}]}function m(t){const o=document.getElementById("oms-forms-table-body");if(!t||t.length===0){o.innerHTML='<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">No OMS forms submitted yet</td></tr>';return}o.innerHTML=t.map(e=>`
        <tr class="hover:bg-gray-50">
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm font-medium text-gray-900">${e.project_name||"Unnamed Project"}</div>
            <div class="text-sm text-gray-500">${e.owner_name||"No owner"}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-900">${e.restaurant_name||"Not specified"}</div>
            <div class="text-sm text-gray-500">${e.restaurant_address||"No address"}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-900">${e.user_email||"No email"}</div>
            <div class="text-sm text-gray-500">${e.phone_number||"No phone"}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            ${e.logo_url?`<img src="${e.logo_url}" alt="Logo" class="w-8 h-8 rounded object-cover">`:'<span class="text-gray-400">No logo</span>'}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            ${new Date(e.created_at).toLocaleDateString()}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <button class="text-blue-600 hover:text-blue-900 mr-3" onclick="viewOMSForm('${e.id}')">View</button>
            <button class="text-green-600 hover:text-green-900" onclick="processOMSForm('${e.id}')">Process</button>
          </td>
        </tr>
      `).join("")}async function _(){try{const{data:t,error:o}=await d.from("menu_photos").select("*").eq("user_id",f.id).order("created_at",{ascending:!1}).limit(50);if(o){console.error("Error loading photos:",o);const e=h();u(e),document.getElementById("total-menu-photos").textContent=e.length;const s=e.filter(n=>n.conversion_status==="completed").length,a=e.filter(n=>n.conversion_status==="processing"||n.conversion_status==="pending").length;document.getElementById("total-processed").textContent=s,document.getElementById("total-pending").textContent=a;return}if(!t||t.length===0){const e=h();u(e),document.getElementById("total-menu-photos").textContent=e.length;const s=e.filter(n=>n.conversion_status==="completed").length,a=e.filter(n=>n.conversion_status==="processing"||n.conversion_status==="pending").length;document.getElementById("total-processed").textContent=s,document.getElementById("total-pending").textContent=a}else{u(t),document.getElementById("total-menu-photos").textContent=t.length;const e=t.filter(a=>a.conversion_status==="completed").length,s=t.filter(a=>a.conversion_status==="processing"||a.conversion_status==="pending").length;document.getElementById("total-processed").textContent=e,document.getElementById("total-pending").textContent=s}}catch(t){console.error("Error loading photos:",t);const o=h();u(o),document.getElementById("total-menu-photos").textContent=o.length;const e=o.filter(a=>a.status==="processed").length,s=o.filter(a=>a.status==="pending").length;document.getElementById("total-processed").textContent=e,document.getElementById("total-pending").textContent=s}}function h(){return[{id:"photo-1",original_filename:"bella-vista-menu.jpg",photo_url:"https://via.placeholder.com/100x100/4F46E5/FFFFFF?text=BV",conversion_status:"completed",created_at:new Date(Date.now()-1*24*60*60*1e3).toISOString(),file_size:24e5},{id:"photo-2",original_filename:"golden-dragon-menu.jpg",photo_url:"https://via.placeholder.com/100x100/DC2626/FFFFFF?text=GD",conversion_status:"processing",created_at:new Date(Date.now()-3*24*60*60*1e3).toISOString(),file_size:18e5},{id:"photo-3",original_filename:"cafe-del-sol-menu.jpg",photo_url:"https://via.placeholder.com/100x100/059669/FFFFFF?text=CD",conversion_status:"completed",created_at:new Date(Date.now()-5*24*60*60*1e3).toISOString(),file_size:31e5},{id:"photo-4",original_filename:"pizza-palace-menu.jpg",photo_url:"https://via.placeholder.com/100x100/7C3AED/FFFFFF?text=PP",conversion_status:"pending",created_at:new Date(Date.now()-7*24*60*60*1e3).toISOString(),file_size:27e5},{id:"photo-5",original_filename:"sushi-master-menu.jpg",photo_url:"https://via.placeholder.com/100x100/EA580C/FFFFFF?text=SM",conversion_status:"completed",created_at:new Date(Date.now()-9*24*60*60*1e3).toISOString(),file_size:22e5},{id:"photo-6",original_filename:"thai-garden-menu.jpg",photo_url:"https://via.placeholder.com/100x100/0891B2/FFFFFF?text=TG",conversion_status:"pending",created_at:new Date(Date.now()-11*24*60*60*1e3).toISOString(),file_size:19e5}]}function u(t){const o=document.getElementById("photos-table-body");if(!t||t.length===0){o.innerHTML='<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">No photos uploaded yet</td></tr>';return}o.innerHTML=t.map(e=>`
        <tr class="hover:bg-gray-50">
          <td class="px-6 py-4 whitespace-nowrap">
            ${e.photo_url?`<img src="${e.photo_url}" alt="Menu photo" class="w-12 h-12 rounded object-cover">`:'<div class="w-12 h-12 bg-gray-200 rounded flex items-center justify-center"><svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div>'}
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-900">${e.original_filename||"Unknown"}</div>
            <div class="text-sm text-gray-500">${e.file_size?(e.file_size/1024).toFixed(1)+" KB":"Unknown size"}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${e.conversion_status==="completed"?"bg-green-100 text-green-800":e.conversion_status==="processing"?"bg-yellow-100 text-yellow-800":e.conversion_status==="failed"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}">
              ${e.conversion_status||"pending"}
          </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            ${new Date(e.created_at).toLocaleDateString()}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <button class="text-blue-600 hover:text-blue-900 mr-3" onclick="viewPhoto('${e.id}')">View</button>
            ${e.conversion_status==="completed"?`<button class="text-green-600 hover:text-green-900" onclick="downloadText('`+e.id+`')">Download</button>`:'<button class="text-gray-400 cursor-not-allowed" disabled>Download</button>'}
          </td>
        </tr>
      `).join("")}async function b(){document.getElementById("last-updated").textContent=new Date().toLocaleTimeString()}function M(){document.getElementById("refresh-oms").addEventListener("click",F),document.getElementById("refresh-photos").addEventListener("click",_),document.getElementById("photo-upload-input").addEventListener("change",I)}async function I(t){const o=t.target.files[0];if(o){if(!o.type.startsWith("image/")){alert("Please select an image file");return}if(o.size>10*1024*1024){alert("File size must be less than 10MB");return}try{const e=o.name.split(".").pop(),s=`${f.id}/${Date.now()}.${e}`,{data:a,error:n}=await d.storage.from("menu-photos").upload(s,o);if(n)throw n;const{data:{publicUrl:r}}=d.storage.from("menu-photos").getPublicUrl(s),{data:l,error:c}=await d.from("menu_photos").insert({user_id:f.id,photo_url:r,original_filename:o.name,file_size:o.size,mime_type:o.type,conversion_status:"pending"});if(c)throw c;await _(),await b(),t.target.value="",alert("Photo uploaded successfully!")}catch(e){console.error("Upload error:",e),alert("Error uploading file: "+e.message)}}}window.viewOMSForm=function(t){console.log("View OMS form:",t)};window.processOMSForm=function(t){console.log("Process OMS form:",t)};window.viewPhoto=function(t){console.log("View photo:",t)};window.downloadText=function(t){console.log("Download text for photo:",t)};
