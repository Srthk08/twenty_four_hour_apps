const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/supabase.DeXTyW8I.js","_astro/index.9NDAT-bh.js","_astro/preload-helper.BlTxHScW.js"])))=>i.map(i=>d[i]);
import{_ as E}from"./preload-helper.BlTxHScW.js";class w{constructor(){this.orders=[],this.init()}init(){this.loadOrders().then(()=>this.renderOrders())}async loadOrders(){const o=localStorage.getItem("project-requirements"),t=localStorage.getItem("order-menu-requirements"),s=localStorage.getItem("user-orders");console.log("Loading orders from multiple sources..."),console.log("Project requirements:",o),console.log("Order menu requirements:",t),console.log("User orders:",s),this.orders=[];let i=window.globalAuthManager?.getCurrentUser()||window.simpleAuthManager?.getCurrentUser();if(console.log("Current user (app auth):",i),!i){console.log("No current user found");try{const{supabase:r}=await E(async()=>{const{supabase:n}=await import("./supabase.DeXTyW8I.js");return{supabase:n}},__vite__mapDeps([0,1,2])),{data:{user:d}}=await r.auth.getUser();d&&(i={email:d.email})}catch(r){console.warn("Supabase auth fallback failed:",r)}if(!i)return}const a=(i?.email||null)?.toLowerCase().trim();if(!a){console.log("No user email available â€“ cannot load orders");return}if(console.log("ðŸ“§ Loading orders for user email:",a),o)try{const r=JSON.parse(o),d=r.filter(n=>n.email||n.userId||n.contactEmail?(n.email||n.userId||n.contactEmail)?.toLowerCase().trim()===a:!0);console.log(`ðŸ“¦ Loading ${d.length} project orders from localStorage (filtered from ${r.length} total)`),d.forEach(n=>{this.orders.push({...n,orderId:`PROJ-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,orderDate:n.timestamp||new Date().toISOString(),total:this.extractPrice(n.productPrice)||0,projectName:n.productName||"Custom Project",description:n.productDescription||"Professional digital solution",requirements:n,status:"completed"})})}catch(r){console.error("Error parsing project requirements:",r)}if(t)try{const r=JSON.parse(t),d=r.filter(n=>n.email||n.userId||n.contactEmail?(n.email||n.userId||n.contactEmail)?.toLowerCase().trim()===a:!0);console.log(`ðŸ“¦ Loading ${d.length} menu orders from localStorage (filtered from ${r.length} total)`),d.forEach(n=>{this.orders.push({...n,orderId:`MENU-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,orderDate:n.timestamp||new Date().toISOString(),total:this.extractPrice(n.productPrice)||0,projectName:n.productName||"Order Menu System",description:n.productDescription||"Complete order management system",requirements:n,status:"completed"})})}catch(r){console.error("Error parsing order menu requirements:",r)}if(s)try{const r=JSON.parse(s),d=r.filter(n=>(n.userId||n.email||n.userEmail)?.toLowerCase().trim()===a);console.log(`ðŸ“¦ Loading ${d.length} user orders from localStorage (filtered from ${r.length} total)`),this.orders.push(...d)}catch(r){console.error("Error parsing user orders:",r)}try{await this.loadSupabaseOrders(a)}catch(r){console.warn("Failed to load Supabase orders:",r)}this.orders.sort((r,d)=>new Date(d.orderDate).getTime()-new Date(r.orderDate).getTime()),console.log("âœ…âœ…âœ… TOTAL ORDERS LOADED:",this.orders.length),console.log("ðŸ“‹ Order IDs:",this.orders.map(r=>r.orderId)),console.log("ðŸ“‹ Order details:",this.orders.map(r=>({id:r.orderId,project:r.projectName,status:r.status,date:r.orderDate,total:r.total})));const l={localStorage:this.orders.filter(r=>r.orderId?.startsWith("PROJ-")||r.orderId?.startsWith("MENU-")).length,supabase_order_customizations:this.orders.filter(r=>r.orderId&&!r.orderId.startsWith("PROJ-")&&!r.orderId.startsWith("MENU-")&&!r.orderId.startsWith("CART-")&&!r.orderId.startsWith("CF-")).length,supabase_cart_customizations:this.orders.filter(r=>r.orderId?.startsWith("CART-")).length,supabase_customization_forms:this.orders.filter(r=>r.orderId?.startsWith("CF-")).length};console.log("ðŸ“Š Orders breakdown by source:",l)}async loadSupabaseOrders(o){try{const{supabase:t}=await E(async()=>{const{supabase:e}=await import("./supabase.DeXTyW8I.js");return{supabase:e}},__vite__mapDeps([0,1,2]));console.log("ðŸ” Loading Supabase orders for email:",o);let s=[],i=null;const a=new Set,{data:l,error:r}=await t.from("order_customizations").select("*").ilike("email",o).order("created_at",{ascending:!1});!r&&l&&l.length>0?(l.forEach(e=>{a.has(e.id)||(s.push(e),a.add(e.id))}),console.log("âœ… Found",l.length,'orders using "email" field')):r&&console.log('âš ï¸ Error querying with "email" field:',r.message);const{data:d,error:n}=await t.from("order_customizations").select("*").ilike("user_email",o).order("created_at",{ascending:!1});!n&&d&&d.length>0?(d.forEach(e=>{a.has(e.id)||(s.push(e),a.add(e.id))}),console.log("âœ… Found",d.length,'orders using "user_email" field')):n&&console.log('âš ï¸ Error querying with "user_email" field:',n.message),r&&n&&(i=n||r,console.error("âŒ Both queries failed for order_customizations")),i&&console.warn("âš ï¸ Error loading order_customizations, continuing with other sources...",i),s.sort((e,u)=>{const m=new Date(e.created_at||0);return new Date(u.created_at||0)-m}),console.log("ðŸ“¦ Processing",s.length,"order_customizations..."),(s||[]).forEach((e,u)=>{console.log(`  Order ${u+1}:`,{id:e.id,project_name:e.project_name,email:e.email||e.user_email,status:e.status}),this.orders.push({orderId:e.id||`OC-${Date.now()}-${u}`,orderDate:e.created_at||new Date().toISOString(),total:Number(e.total_amount)||0,projectName:e.project_name||"Order Menu System",description:"Order Menu System customization",status:e.status||"pending",requirements:{projectName:e.project_name,contactPerson:e.contact_person,restaurantName:e.restaurant_name,cuisineType:e.cuisine_type,email:e.email||e.user_email,phone:e.phone_number,additionalRequirements:e.additional_requirements,primaryColor:e.primary_color,secondaryColor:e.secondary_color,accentColor:e.accent_color,textColor:e.text_color}})});const{data:p,error:h}=await t.from("cart_customizations").select("*").ilike("user_email",o).in("cart_status",["completed","pending","confirmed","in_progress","cancelled"]).order("updated_at",{ascending:!1});if(h)throw console.error("âŒ Error loading cart_customizations:",h),h;console.log("ðŸ“¦ Processing",(p||[]).length,"cart_customizations..."),(p||[]).forEach((e,u)=>{const m=e.id||`CART-${Date.now()}-${u}`;if(a.has(m)){console.log(`  Skipping duplicate cart: ${m}`);return}a.add(m),console.log(`  Cart ${u+1}:`,{id:e.id,project_name:e.project_name,user_email:e.user_email,cart_status:e.cart_status});let c=e.status||e.cart_status||"pending";c==="completed"?c="completed":c==="cancelled"?c="cancelled":c==="pending"?c="pending":c==="confirmed"?c="confirmed":(c==="in_progress"||c==="processing")&&(c="in_progress"),this.orders.push({orderId:m,orderDate:e.updated_at||e.created_at||new Date().toISOString(),total:Number(e.total_amount)||0,projectName:e.project_name||"Custom Project",description:e.project_description||"Project purchased",status:c,requirements:{projectName:e.project_name,contactPerson:e.contact_person,restaurantName:e.restaurant_name,cuisineType:e.cuisine_type,email:e.user_email,phone:e.phone_number,additionalRequirements:e.additional_requirements,primaryColor:e.primary_color,secondaryColor:e.secondary_color,accentColor:e.accent_color,textColor:e.text_color}})});const{data:y,error:f}=await t.from("customization_forms").select("*").ilike("contact_email",o).order("created_at",{ascending:!1});f?console.warn("âš ï¸ Error loading customization_forms:",f):(console.log("ðŸ“¦ Processing",(y||[]).length,"customization_forms..."),(y||[]).forEach((e,u)=>{const m=e.id||`CF-${Date.now()}-${u}`;if(a.has(m)){console.log(`  Skipping duplicate customization form: ${m}`);return}a.add(m),console.log(`  Custom Form ${u+1}:`,{id:e.id,project_name:e.project_name,product_name:e.product_name,contact_email:e.contact_email,status:e.status});let c=0;if(e.product_price){const _=String(e.product_price).match(/â‚¹?([\d,]+)/);_&&(c=parseInt(_[1].replace(/,/g,"")))}this.orders.push({orderId:m,orderDate:e.created_at||new Date().toISOString(),total:c,projectName:e.product_name||e.project_name||"Custom Project",description:e.product_description||"Professional digital solution",status:e.status||"pending",requirements:{projectName:e.project_name,contactPerson:e.contact_person,restaurantName:e.restaurant_name,cuisineType:e.cuisine_type,email:e.contact_email,phone:e.contact_phone,additionalRequirements:e.additional_requirements,primaryColor:e.primary_color,secondaryColor:e.secondary_color,accentColor:e.accent_color,textColor:e.text_color,appName:e.app_name,productType:e.product_type}})}))}catch(t){throw console.error("Error loading Supabase orders:",t),t}}extractPrice(o){if(!o)return 0;const t=o.match(/â‚¹?([\d,]+)/);return t?parseInt(t[1].replace(/,/g,"")):0}renderOrders(){const o=document.getElementById("loading-orders"),t=document.getElementById("empty-orders"),s=document.getElementById("orders-list");if(console.log("ðŸŽ¨ Rendering orders. Total orders count:",this.orders.length),console.log("ðŸŽ¨ Orders to render:",this.orders.map(l=>({id:l.orderId,name:l.projectName}))),o?.classList.add("hidden"),this.orders.length===0){console.log("âŒ No orders found, showing empty state"),t?.classList.remove("hidden"),s?.classList.add("hidden"),document.getElementById("orders-summary")?.classList.add("hidden"),document.getElementById("recent-activity")?.classList.add("hidden");return}console.log("âœ… Orders found, showing orders list"),console.log("âœ… Removing hidden class from orders-list"),t?.classList.add("hidden"),s?.classList.remove("hidden"),s&&(s.classList.remove("hidden"),s.style.display="block",s.style.visibility="visible",s.style.opacity="1",console.log("âœ… Orders list container is now visible"),console.log("âœ… Orders list classes:",s.className),console.log("âœ… Orders list display style:",s.style.display)),console.log("âœ… Calling renderOrdersList() to render all orders..."),this.renderOrdersList();const a=s?.querySelectorAll('[id^="order-"]:not(#order-template)')?.length||0;console.log("âœ…âœ…âœ… RENDERED ORDERS COUNT:",a),console.log("âœ…âœ…âœ… Expected orders count:",this.orders.length),console.log("âœ…âœ…âœ… Total children in container:",s?.children.length||0),a!==this.orders.length?console.error("âŒâŒâŒ MISMATCH: Expected",this.orders.length,"orders but only",a,"were rendered!"):console.log("âœ…âœ…âœ… SUCCESS: All",a,"orders rendered correctly!"),this.renderOrdersSummary(),this.renderRecentSummary()}renderOrdersList(){const o=document.getElementById("orders-list");if(!o){console.error("âŒ orders-list container not found!");return}let t=document.getElementById("order-template");if(!t){console.error("âŒ Order template not found before clearing!"),setTimeout(()=>{if(t=document.getElementById("order-template"),!t){console.error("âŒ Order template still not found after retry!");return}this.renderOrdersListWithTemplate(t,o)},100);return}this.renderOrdersListWithTemplate(t,o)}renderOrdersListWithTemplate(o,t){if(!o||!t){console.error("âŒ Template or container not available!");return}console.log("ðŸ§¹ Clearing orders list container (preserving template)..."),t.querySelectorAll('[id^="order-"]:not(#order-template)').forEach(i=>i.remove()),console.log("ðŸ“ Rendering",this.orders.length,"orders..."),this.orders.forEach((i,a)=>{console.log(`  ðŸ“¦ Rendering order ${a+1}/${this.orders.length}:`,i.orderId,"-",i.projectName);const l=this.createOrderElement(i,a,o);l?(t.appendChild(l),console.log(`  âœ… Order ${a+1} appended successfully`)):console.error(`  âŒ Failed to create element for order ${a+1}`)}),console.log("âœ…âœ…âœ… Finished rendering all orders. Container now has",t.children.length,"children")}createOrderElement(o,t,s){if(!s&&(s=document.getElementById("order-template"),!s))return console.error("âŒ Order template not found when creating order element!"),console.error("âŒ Attempted to create order:",t,o.orderId),null;const i=s.cloneNode(!0);return i.classList.remove("hidden"),i.id=`order-${t}`,i.style.display="block",i.style.visibility="visible",i.style.opacity="1",this.populateOrderElement(i,o)}populateOrderElement(o,t){o.querySelector(".order-project-name").textContent=t.projectName||"Custom Project",o.querySelector(".order-project-description").textContent=t.description||"Professional digital solution",o.querySelector(".order-total").textContent=`â‚¹${t.total?.toLocaleString()||"0"}`,o.querySelector(".order-date").textContent=this.formatDate(t.orderDate),o.querySelector(".order-id").textContent=t.orderId||`ORD-${Date.now()}`;const s=o.querySelector(".order-status-badge");if(s){const a=(t.status||"pending").charAt(0).toUpperCase()+(t.status||"pending").slice(1).replace("_"," "),l=t.status==="completed"?"âœ“ ":t.status==="cancelled"?"âœ— ":t.status==="in_progress"?"âŸ³ ":"";s.textContent=l+a,s.className="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium "+this.getStatusColor(t.status)}const i=o.querySelector(".order-view-btn");return i&&(i.onclick=()=>{this.showOrderDetails(t)}),o}formatDate(o){return o?new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}getStatusColor(o){const t=(o||"").toLowerCase();return{pending:"bg-yellow-100 text-yellow-800",confirmed:"bg-blue-100 text-blue-800",in_progress:"bg-purple-100 text-purple-800",processing:"bg-purple-100 text-purple-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800"}renderOrdersSummary(){const o=document.getElementById("orders-summary"),t=document.getElementById("total-orders-count"),s=document.getElementById("orders-summary-text"),i=document.getElementById("total-orders-amount");if(!o||!t||!s||!i)return;const a=this.orders.length,l=this.orders.reduce((r,d)=>r+(Number(d.total)||0),0);if(a===0){o.classList.add("hidden");return}o.classList.remove("hidden"),t.textContent=a,s.textContent=a===1?"order found":"orders found",i.textContent=`â‚¹${l.toLocaleString("en-IN")}`,console.log("ðŸ“Š Orders Summary:",{totalOrders:a,totalAmount:l})}renderRecentSummary(){const o=document.getElementById("recent-order-summary"),t=document.getElementById("recent-order-title"),s=document.getElementById("recent-order-amount"),i=document.getElementById("recent-order-date"),a=document.getElementById("recent-order-status"),l=document.getElementById("recent-order-view-btn");if(!o||!t||!s||!i||!a||!l)return;const r=[...this.orders].sort((p,h)=>new Date(h.orderDate).getTime()-new Date(p.orderDate).getTime());if(r.length===0){o.classList.add("hidden");return}const d=r[0];o.classList.remove("hidden"),t.textContent=d.projectName||"Order",s.textContent=`â‚¹${(d.total||0).toLocaleString("en-IN")}`,i.textContent=this.formatDate(d.orderDate);const n=(d.status||"pending").charAt(0).toUpperCase()+(d.status||"pending").slice(1).replace("_"," ");a.textContent=n,a.className="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium whitespace-nowrap "+this.getStatusColor(d.status),l.onclick=()=>{this.showOrderDetails(d)}}showOrderDetails(o){const t=document.getElementById("order-details-modal");if(!t)return;const s=n=>document.getElementById(n);s("order-modal-title").textContent=o.projectName||"Order Details",s("order-modal-amount").textContent=`â‚¹${(o.total||0).toLocaleString("en-IN")}`,s("order-modal-date").textContent=this.formatDate(o.orderDate),s("order-modal-id").textContent=o.orderId||"-",s("order-modal-desc").textContent=o.description||"-";const i=o.requirements||{};s("order-modal-contact").textContent=i.contactPerson||"-",s("order-modal-email").textContent=i.email||"-",s("order-modal-phone").textContent=i.phone||"-",s("order-modal-restaurant").textContent=i.restaurantName||"-",s("order-modal-additional").textContent=i.additionalRequirements||"â€”",document.body.style.overflow="hidden",t.classList.remove("hidden");const a=()=>{t.classList.add("hidden"),document.body.style.overflow=""},l=document.getElementById("order-modal-backdrop"),r=document.getElementById("order-modal-close"),d=document.getElementById("order-modal-close-bottom");l.onclick=a,r.onclick=a,d.onclick=a}}document.addEventListener("DOMContentLoaded",()=>{new w,new URLSearchParams(window.location.search).get("order")==="success"&&(O(),window.history.replaceState({},document.title,window.location.pathname))});function O(){const g=document.createElement("div");g.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300",g.innerHTML=`
      <div class="flex items-center space-x-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        <span>Order placed successfully! ðŸŽ‰</span>
      </div>
    `,document.body.appendChild(g),setTimeout(()=>{g.remove()},5e3)}
