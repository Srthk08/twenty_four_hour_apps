import"./ProductDialog.astro_astro_type_script_index_0_lang.C4tfig-4.js";import"https://unpkg.com/@supabase/supabase-js@2";const p=document.getElementById("contact-form"),E=document.getElementById("success-message"),I=document.getElementById("error-message"),S=document.getElementById("error-text");function B(){const t=document.getElementById("first_name"),n=document.getElementById("last_name"),o=document.getElementById("email"),u=document.getElementById("phone"),e=document.getElementById("company");return{firstNameInput:t,lastNameInput:n,emailInput:o,phoneInput:u,companyInput:e}}function F(t){t&&(t.setAttribute("autocomplete","off"),t.setAttribute("data-orig-name",t.name||""),t.name=`${t.id}_noautofill`)}function _(t){if(!t)return;const n=t.getAttribute("data-orig-name");n&&(t.name=n)}function v(){const{firstNameInput:t,lastNameInput:n,emailInput:o,phoneInput:u,companyInput:e}=B();[t,n,o,u,e].forEach(l=>{l&&(l.value="",l.disabled=!0,F(l))});const a=p?.querySelector('button[type="submit"]');a&&(a.disabled=!0)}function j(){const{firstNameInput:t,lastNameInput:n,emailInput:o,phoneInput:u,companyInput:e}=B();[t,n,o,u,e].forEach(l=>{l&&(l.disabled=!1,_(l))});const a=p?.querySelector('button[type="submit"]');a&&(a.disabled=!1)}v();window.addEventListener("user-logged-in",()=>{j()});window.addEventListener("user-logged-out",()=>{v()});let d=null;const b=()=>{const t="https://lmrrdcaavwwletcjcpqv.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ";return window.supabase&&typeof window.supabase.createClient=="function"?(d=window.supabase.createClient(t,n),console.log("✅ Supabase client initialized directly"),!0):window.supabase?(d=window.supabase,console.log("✅ Using existing Supabase client"),!0):(console.error("❌ Supabase library not available"),!1)};b()?console.log("✅ Supabase client ready:",!!d):console.error("❌ Failed to initialize Supabase client");function M(){const t=new URLSearchParams(window.location.search);return{product:t.get("product"),projectType:t.get("project_type"),projectDetails:t.get("project_details"),price:t.get("price")}}window.clearForm=function(){console.log("🧹 Clearing contact form fields...");const n=document.getElementById("first_name"),o=document.getElementById("last_name"),u=document.getElementById("email"),e=document.getElementById("phone"),a=document.getElementById("company"),l=document.getElementById("project_type"),c=document.getElementById("message");n&&(n.value="",n.placeholder="Your first name",n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0}))),o&&(o.value="",o.placeholder="Your last name",o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0}))),u&&(u.value="",u.placeholder="your.email@example.com",u.dispatchEvent(new Event("input",{bubbles:!0})),u.dispatchEvent(new Event("change",{bubbles:!0}))),e&&(e.value="",e.placeholder="+1 (555) 123-4567",e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0}))),a&&(a.value="",a.placeholder="Your company name",a.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0}))),l&&(l.value="",l.selectedIndex=0,l.dispatchEvent(new Event("input",{bubbles:!0})),l.dispatchEvent(new Event("change",{bubbles:!0}))),c&&(c.value="",c.placeholder="Tell us about your project...",c.dispatchEvent(new Event("input",{bubbles:!0})),c.dispatchEvent(new Event("change",{bubbles:!0}))),document.querySelectorAll("input, select, textarea").forEach(i=>{i.classList.remove("border-red-500"),i.classList.add("border-gray-300")}),console.log("✅ Contact form cleared")};window.prefillForm=async function(){try{console.log("🔄 Starting form pre-fill process..."),console.log("🔍 Available global objects:",{globalAuthManager:!!window.globalAuthManager,simpleAuthManager:!!window.simpleAuthManager,supabase:!!window.supabase});let n=window.globalAuthManager||window.simpleAuthManager;if(!n){console.log("⏳ Auth manager not available, waiting...");let e=0;for(;!n&&e<50;)await new Promise(a=>setTimeout(a,100)),n=window.globalAuthManager||window.simpleAuthManager,e++}console.log("🧹 Clearing form first to ensure clean state..."),window.clearForm();const o=M(),u=g();if(u?j():v(),u&&o.projectType){const e=document.getElementById("project_type");e&&(e.value=o.projectType,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Pre-filled project type for logged in user:",o.projectType))}if(u&&o.projectDetails){const e=document.getElementById("message");if(e){let a=decodeURIComponent(o.projectDetails);if(o.product&&(a=`Project: ${decodeURIComponent(o.product)}

${a}`),o.price){const l=decodeURIComponent(o.price);a+=`

Budget: ₹${l}`}e.value=a,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Pre-filled project details for logged in user")}}else if(!u){console.log("👤 User not logged in - not pre-filling project details");const e=document.getElementById("project_type"),a=document.getElementById("message");e&&(e.value=""),a&&(a.value="",a.placeholder="Tell us about your project...")}if(d||(console.log("🔄 Supabase not available in prefill, trying to reinitialize..."),b()),console.log("🔍 Checking for logged in user using global auth manager..."),n&&n.isUserLoggedIn()){const e=n.getCurrentUser();if(console.log("👤 User found via global auth manager:",e?.email),e&&e.email){const a=document.getElementById("first_name"),l=document.getElementById("last_name"),c=document.getElementById("email"),r=document.getElementById("phone"),i=document.getElementById("company");if([a,l,c,r,i].forEach(s=>{s&&(s.disabled=!1)}),e&&e.full_name){const s=e.full_name.split(" ");a&&(a.value=s[0]||"",a.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Pre-filled first name:",s[0])),l&&s.length>1&&(l.value=s.slice(1).join(" "),l.dispatchEvent(new Event("input",{bubbles:!0})),l.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Pre-filled last name:",s.slice(1).join(" ")))}c&&(c.value=e.email||"",c.dispatchEvent(new Event("input",{bubbles:!0})),c.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Pre-filled email:",e.email)),r&&e.phone&&(r.value=e.phone),i&&e.company_name&&(i.value=e.company_name)}}else{const e=document.getElementById("first_name"),a=document.getElementById("last_name"),l=document.getElementById("email"),c=document.getElementById("phone"),r=document.getElementById("company");[e,a,l,c,r].forEach(s=>{s&&(s.value="",s.disabled=!0)});const i=document.getElementById("message");i&&(i.placeholder="Please sign in to send us a message."),console.log("🚫 User not logged in - cleared and disabled personal fields")}if(d)try{console.log("🔍 Fallback: Checking Supabase auth...");const{data:{user:e}}=await d.auth.getUser();if(e){console.log("👤 User found via Supabase auth:",e.email);const a=document.getElementById("first_name"),l=document.getElementById("last_name"),c=document.getElementById("email"),r=document.getElementById("phone"),i=document.getElementById("company");c&&e.email&&(c.value=e.email,c.dispatchEvent(new Event("input",{bubbles:!0})),c.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Pre-filled email:",e.email));try{const{data:s}=await d.from("profiles").select("*").eq("id",e.id).single();if(s){if(s.full_name){const m=s.full_name.split(" ");a&&(a.value=m[0]||"",a.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Pre-filled first name:",m[0])),l&&m.length>1&&(l.value=m.slice(1).join(" "),l.dispatchEvent(new Event("input",{bubbles:!0})),l.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Pre-filled last name:",m.slice(1).join(" ")))}r&&s.phone&&(r.value=s.phone,r.dispatchEvent(new Event("input",{bubbles:!0})),r.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Pre-filled phone:",s.phone)),i&&s.company_name&&(i.value=s.company_name,i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Pre-filled company:",s.company_name))}}catch(s){console.log("⚠️ Could not fetch profile data:",s)}console.log("✅ Form pre-filled successfully with Supabase auth data"),setTimeout(()=>U(),100)}else console.log("ℹ️ No user logged in via Supabase auth - clearing form"),window.clearForm()}catch(e){console.log("ℹ️ Supabase auth check failed:",e)}else console.log("ℹ️ Neither global auth manager nor Supabase available - clearing form"),window.clearForm()}catch(n){console.error("❌ Error pre-filling form:",n)}};function g(){const t=window.globalAuthManager||window.simpleAuthManager;if(!t)return console.log("🚫 No auth manager available - user not logged in"),!1;if(!t.isUserLoggedIn())return console.log("🚫 User not logged in via auth manager - clearing form"),window.clearForm(),!1;const o=t.getCurrentUser();return!o||!o.email?(console.log("🚫 Invalid user data - user not logged in"),window.clearForm(),!1):(console.log("✅ User is properly logged in:",o.email),!0)}function U(){console.log("🔄 Forcing form validation..."),document.querySelectorAll("input, select, textarea").forEach(n=>{n.value&&n.value.trim()&&(console.log(`🔍 Forcing validation for field: ${n.id} = "${n.value}"`),n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0})),n.dispatchEvent(new Event("blur",{bubbles:!0})),n.setCustomValidity&&n.setCustomValidity(""))}),console.log("✅ Form validation forced")}function w(){const t=document.createElement("div");t.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    `;const n=document.createElement("div");n.style.cssText=`
      background: white;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      max-width: 400px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    `,n.innerHTML=`
      <h3 style="margin-bottom: 20px; color: #333;">Authentication Required</h3>
      <p style="margin-bottom: 30px; color: #666;">Please sign up or login to submit the contact form.</p>
      <div style="display: flex; gap: 15px; justify-content: center;">
        <button id="signup-btn" style="
          background: #3B82F6;
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
        ">Sign Up</button>
        <button id="login-btn" style="
          background: #6B7280;
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
        ">Login</button>
      </div>
    `,t.appendChild(n),document.body.appendChild(t),document.getElementById("signup-btn").addEventListener("click",()=>{document.body.removeChild(t),window.location.href="/signup"}),document.getElementById("login-btn").addEventListener("click",()=>{document.body.removeChild(t),window.location.href="/login"}),t.addEventListener("click",o=>{o.target===t&&document.body.removeChild(t)})}p?.addEventListener("submit",async t=>{if(t.preventDefault(),!g()){console.log("🚫 Form submission blocked - user not logged in"),w();return}console.log("✅ User is logged in - allowing form submission"),U();const n=new FormData(p),o=Object.fromEntries(n);console.log("📝 Form data collected for validation:",o);const u=[{id:"first_name",name:"First Name",value:o.first_name},{id:"last_name",name:"Last Name",value:o.last_name},{id:"email",name:"Email",value:o.email},{id:"project_type",name:"Project Type",value:o.project_type},{id:"message",name:"Message",value:o.message}];let e=!0;const a=[];for(const r of u){const i=document.getElementById(r.id),s=r.value?r.value.toString().trim():"";console.log(`🔍 Validating ${r.name}: "${s}"`),s?i&&(i.classList.remove("border-red-500"),i.classList.add("border-gray-300")):(e=!1,a.push(r.name),i&&(i.classList.add("border-red-500"),i.classList.remove("border-gray-300")))}if(!e){showError(`Please fill in all required fields: ${a.join(", ")}`);return}console.log("✅ All required fields are filled - proceeding with submission"),E?.classList.add("hidden"),I?.classList.add("hidden");const l=p.querySelector('button[type="submit"]'),c=l.textContent;l.disabled=!0,l.innerHTML=`
      <svg class="animate-spin h-5 w-5 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    `;try{if(!d&&(console.log("🔄 Supabase not available, trying to reinitialize..."),!b()))throw console.error("❌ Failed to initialize Supabase client"),new Error("Database connection not available. Please refresh the page and try again.");if(!d||typeof d.from!="function")throw console.error("❌ Supabase client is not properly initialized"),console.log("Supabase object:",d),console.log("Available methods:",d?Object.keys(d):"No supabase object"),new Error("Database connection not properly initialized. Please refresh the page and try again.");console.log("✅ Supabase client verified and ready");const r=new FormData(p),i=Object.fromEntries(r);console.log("📝 Form data collected:",i);let s=null;try{const{data:{user:y}}=await d.auth.getUser();s=y,console.log("👤 Current user:",s?s.email:"Not logged in")}catch{console.log("ℹ️ User not logged in, proceeding without authentication")}const m={first_name:i.first_name,last_name:i.last_name,email:i.email,phone:i.phone||null,company_name:i.company||null,project_type:i.project_type,project_details:i.message,message:i.message,user_id:s?s.id:null};console.log("📝 Sending contact data to Supabase:",m),console.log("🔍 Testing Supabase connection...");const{data:x,error:f}=await d.from("contact_submissions").select("id").limit(1);if(f)throw console.error("❌ Supabase connection test failed:",f),new Error(`Database connection failed: ${f.message}`);console.log("✅ Supabase connection test successful");const{data:A,error:h}=await d.from("contact_submissions").insert([m]).select();if(h)throw console.error("❌ Error saving contact message:",h),new Error(`Failed to save your message: ${h.message}`);console.log("✅ Contact message saved successfully:",A),E?.classList.remove("hidden"),p.reset(),await prefillForm()}catch(r){console.error("Contact form error:",r),S&&(S.textContent=r.message||"An error occurred while sending your message."),I?.classList.remove("hidden")}finally{l.disabled=!1,l.innerHTML=c}});window.checkUserStatus=function(){console.log("🔍 Checking user status..."),console.log("Global auth manager available:",!!window.globalAuthManager),console.log("Simple auth manager available:",!!window.simpleAuthManager),console.log("Supabase available:",!!window.supabase),window.globalAuthManager&&(console.log("User logged in (global):",window.globalAuthManager.isUserLoggedIn()),console.log("Current user (global):",window.globalAuthManager.getCurrentUser())),window.simpleAuthManager&&(console.log("User logged in (simple):",window.simpleAuthManager.isUserLoggedIn()),console.log("Current user (simple):",window.simpleAuthManager.getCurrentUser()))};window.reinitSupabase=function(){return console.log("🔄 Reinitializing Supabase..."),b()?(console.log("✅ Supabase reinitialized successfully"),!0):(console.log("❌ Failed to reinitialize Supabase"),!1)};window.testSupabaseConnection=async function(){if(!d)return console.log("❌ Supabase not initialized"),!1;try{const{data:t,error:n}=await d.from("contact_submissions").select("id").limit(1);return n?(console.error("❌ Supabase test failed:",n),!1):(console.log("✅ Supabase test successful:",t),!0)}catch(t){return console.error("❌ Supabase test error:",t),!1}};document.addEventListener("DOMContentLoaded",()=>{["first_name","last_name","email","phone","company","project_type","message"].forEach(n=>{const o=document.getElementById(n);o&&(o.addEventListener("focus",()=>{g()||(console.log("🚫 Input focus blocked - user not logged in"),w())}),o.addEventListener("click",()=>{g()||(console.log("🚫 Input click blocked - user not logged in"),w())}))})});g()||(console.log("🚫 User not logged in on page load - clearing form"),window.clearForm());setTimeout(()=>{g()||(console.log("🚫 User still not logged in after delay - clearing form"),window.clearForm())},100);document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{window.checkUserStatus()},100);const t=()=>{window.globalAuthManager||window.simpleAuthManager?(console.log("✅ Auth manager found, checking user status..."),g()?(console.log("👤 User is properly logged in - pre-filling form"),prefillForm()):(console.log("🚫 User is not properly logged in - clearing form"),window.clearForm())):(console.log("⏳ Auth manager not ready yet, retrying in 100ms..."),setTimeout(t,100))};setTimeout(t,200)});window.addEventListener("user-logged-out",()=>{console.log("👤 User logged out - clearing contact form"),window.clearForm()});window.addEventListener("user-logged-in",()=>{console.log("👤 User logged in - pre-filling contact form"),setTimeout(()=>{prefillForm()},100)});window.addEventListener("load",()=>{console.log("🔄 Window loaded - checking authentication status...");const t=()=>{window.globalAuthManager||window.simpleAuthManager?(console.log("✅ Auth manager found on window load, checking user status..."),g()?(console.log("👤 User is properly logged in on window load - pre-filling form"),prefillForm()):(console.log("🚫 User not properly logged in on window load - clearing form"),window.clearForm())):(console.log("⏳ Auth manager not ready on window load, retrying in 100ms..."),setTimeout(t,100))};setTimeout(t,100)});document.addEventListener("visibilitychange",()=>{document.hidden||(console.log("🔄 Page became visible - checking authentication"),g()?console.log("✅ User is properly logged in - keeping form data"):(console.log("🚫 User not properly logged in - clearing form"),window.clearForm()))});
