import"./ProductDialog.astro_astro_type_script_index_0_lang.BY4S3r1x.js";import"https://unpkg.com/@supabase/supabase-js@2";const m=document.getElementById("contact-form"),x=document.getElementById("success-message"),C=document.getElementById("error-message"),L=document.getElementById("error-text");function B(){const e=document.getElementById("first_name"),t=document.getElementById("last_name"),o=document.getElementById("email"),n=document.getElementById("phone"),s=document.getElementById("company");return{firstNameInput:e,lastNameInput:t,emailInput:o,phoneInput:n,companyInput:s}}function A(e){e&&(e.setAttribute("autocomplete","off"),e.setAttribute("data-orig-name",e.name||""),e.name=`${e.id}_noautofill`)}function S(e){if(!e)return;const t=e.getAttribute("data-orig-name");t&&(e.name=t)}function v(){const{firstNameInput:e,lastNameInput:t,emailInput:o,phoneInput:n,companyInput:s}=B();[e,t,o,n,s].forEach(i=>{i&&(i.value="",i.disabled=!0,A(i))});const l=m?.querySelector('button[type="submit"]');l&&(l.disabled=!0)}function p(){const{firstNameInput:e,lastNameInput:t,emailInput:o,phoneInput:n,companyInput:s}=B();[e,t,o,n,s].forEach(a=>{a&&(a.disabled=!1,S(a))});const l=document.getElementById("project_type"),i=document.getElementById("message");l&&(l.disabled=!1),i&&(i.disabled=!1,i.placeholder="Tell us about your project requirements...");const r=m?.querySelector('button[type="submit"]');r&&(r.disabled=!1);const c=document.getElementById("auth-message");c&&c.remove()}window.addEventListener("user-logged-in",()=>{console.log("‚úÖ User logged in event received - enabling contact form"),p(),prefillForm()});window.addEventListener("user-logged-out",()=>{console.log("‚ùå User logged out event received - clearing contact form"),v()});document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{const e=window.globalAuthManager||window.simpleAuthManager;e&&e.isUserLoggedIn()?(console.log("‚úÖ User is authenticated - enabling form and pre-filling"),p(),prefillForm()):(console.log("üö´ User not authenticated - clearing and disabling form"),v(),window.clearForm())},100)});let d=null;const w=()=>{const e="https://lmrrdcaavwwletcjcpqv.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ";return window.supabase&&typeof window.supabase.createClient=="function"?(d=window.supabase.createClient(e,t),console.log("‚úÖ Supabase client initialized directly"),!0):window.supabase?(d=window.supabase,console.log("‚úÖ Using existing Supabase client"),!0):(console.error("‚ùå Supabase library not available"),!1)};w()?console.log("‚úÖ Supabase client ready:",!!d):console.error("‚ùå Failed to initialize Supabase client");window.clearForm=function(){console.log("üßπ Clearing contact form fields...");const t=document.getElementById("first_name"),o=document.getElementById("last_name"),n=document.getElementById("email"),s=document.getElementById("phone"),l=document.getElementById("company"),i=document.getElementById("project_type"),r=document.getElementById("message");t&&(t.value="",t.placeholder="Your first name",t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0}))),o&&(o.value="",o.placeholder="Your last name",o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0}))),n&&(n.value="",n.placeholder="your.email@example.com",n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0}))),s&&(s.value="",s.placeholder="+1 (555) 123-4567",s.dispatchEvent(new Event("input",{bubbles:!0})),s.dispatchEvent(new Event("change",{bubbles:!0}))),l&&(l.value="",l.placeholder="Your company name",l.dispatchEvent(new Event("input",{bubbles:!0})),l.dispatchEvent(new Event("change",{bubbles:!0}))),i&&(i.value="",i.selectedIndex=0,i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0}))),r&&(r.value="",r.placeholder="Tell us about your project...",r.dispatchEvent(new Event("input",{bubbles:!0})),r.dispatchEvent(new Event("change",{bubbles:!0}))),document.querySelectorAll("input, select, textarea").forEach(a=>{a.classList.remove("border-red-500"),a.classList.add("border-gray-300")}),console.log("‚úÖ Contact form cleared")};window.prefillForm=async function(){console.log("üîÑ Checking authentication status...");const t=window.globalAuthManager||window.simpleAuthManager;if(t&&t.isUserLoggedIn()){console.log("‚úÖ User is logged in - enabling form"),p();const n=t.getCurrentUser();if(n&&n.email){const s=document.getElementById("first_name"),l=document.getElementById("last_name"),i=document.getElementById("email"),r=document.getElementById("phone"),c=document.getElementById("company");if(n.full_name){const a=n.full_name.split(" ");s&&(s.value=a[0]||""),l&&a.length>1&&(l.value=a.slice(1).join(" "))}if(i&&(i.value=n.email||""),r&&n.phone){let a=n.phone;a.startsWith("+91")&&(a=a.substring(3)),r.value=a}c&&n.company_name&&(c.value=n.company_name)}}else{console.log("‚ùå User not logged in - clearing and disabling form"),v();const n=document.getElementById("contact-form");if(n){let s=document.getElementById("auth-message");s||(s=document.createElement("div"),s.id="auth-message",s.className="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",n.insertBefore(s,n.firstChild)),s.innerHTML=`
          <div class="flex items-center">
            <svg class="w-5 h-5 text-blue-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div>
              <p class="text-blue-800 font-medium">Authentication Required</p>
              <p class="text-blue-700 text-sm">Please sign in to send us a message or view our products.</p>
              <div class="mt-2">
                <a href="/login" class="text-blue-600 hover:text-blue-800 font-medium text-sm mr-4">Sign In</a>
                <a href="/signup" class="text-blue-600 hover:text-blue-800 font-medium text-sm">Create Account</a>
              </div>
            </div>
          </div>
        `}}};function h(){const e=window.globalAuthManager||window.simpleAuthManager,t=e&&e.isUserLoggedIn();if(!t){console.log("üë§ User not logged in - clearing form and project details"),window.clearForm();const o=document.getElementById("project_type"),n=document.getElementById("message");o&&(o.value="",o.selectedIndex=0),n&&(n.value="",n.placeholder="Tell us about your project...")}return t}function F(){console.log("üîÑ Forcing form validation..."),document.querySelectorAll("input, select, textarea").forEach(t=>{t.value&&t.value.trim()&&(console.log(`üîç Forcing validation for field: ${t.id} = "${t.value}"`),t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),t.dispatchEvent(new Event("blur",{bubbles:!0})),t.setCustomValidity&&t.setCustomValidity(""))}),console.log("‚úÖ Form validation forced")}function y(){const e=document.createElement("div");e.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    `;const t=document.createElement("div");t.style.cssText=`
      background: white;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      max-width: 400px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    `,t.innerHTML=`
      <h3 style="margin-bottom: 20px; color: #333;">Authentication Required</h3>
      <p style="margin-bottom: 30px; color: #666;">Please sign up or login to submit the contact form.</p>
      <div style="display: flex; gap: 15px; justify-content: center;">
        <button id="signup-btn" style="
          background: #3B82F6;
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
        ">Sign Up</button>
        <button id="login-btn" style="
          background: #6B7280;
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
        ">Login</button>
      </div>
    `,e.appendChild(t),document.body.appendChild(e),document.getElementById("signup-btn").addEventListener("click",()=>{document.body.removeChild(e),window.location.href="/signup"}),document.getElementById("login-btn").addEventListener("click",()=>{document.body.removeChild(e),window.location.href="/login"}),e.addEventListener("click",o=>{o.target===e&&document.body.removeChild(e)})}m?.addEventListener("submit",async e=>{if(e.preventDefault(),!h()){y();return}F();const t=new FormData(m),o=Object.fromEntries(t);console.log("üìù Form data collected for validation:",o);const n=[{id:"first_name",name:"First Name",value:o.first_name},{id:"last_name",name:"Last Name",value:o.last_name},{id:"email",name:"Email",value:o.email},{id:"project_type",name:"Project Type",value:o.project_type},{id:"message",name:"Message",value:o.message}];let s=!0;const l=[];for(const c of n){const a=document.getElementById(c.id),u=c.value?c.value.toString().trim():"";console.log(`üîç Validating ${c.name}: "${u}"`),u?a&&(a.classList.remove("border-red-500"),a.classList.add("border-gray-300")):(s=!1,l.push(c.name),a&&(a.classList.add("border-red-500"),a.classList.remove("border-gray-300")))}if(!s){showError(`Please fill in all required fields: ${l.join(", ")}`);return}console.log("‚úÖ All required fields are filled - proceeding with submission"),x?.classList.add("hidden"),C?.classList.add("hidden");const i=m.querySelector('button[type="submit"]'),r=i.textContent;i.disabled=!0,i.innerHTML=`
      <svg class="animate-spin h-5 w-5 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    `;try{if(!d&&(console.log("üîÑ Supabase not available, trying to reinitialize..."),!w()))throw console.error("‚ùå Failed to initialize Supabase client"),new Error("Database connection not available. Please refresh the page and try again.");if(!d||typeof d.from!="function")throw console.error("‚ùå Supabase client is not properly initialized"),console.log("Supabase object:",d),console.log("Available methods:",d?Object.keys(d):"No supabase object"),new Error("Database connection not properly initialized. Please refresh the page and try again.");console.log("‚úÖ Supabase client verified and ready");const c=new FormData(m),a=Object.fromEntries(c);console.log("üìù Form data collected:",a);let u=null;try{const{data:{user:E}}=await d.auth.getUser();u=E,console.log("üë§ Current user:",u?u.email:"Not logged in")}catch{console.log("‚ÑπÔ∏è User not logged in, proceeding without authentication")}const I={first_name:a.first_name,last_name:a.last_name,email:a.email,phone:a.phone||null,company_name:a.company||null,project_type:a.project_type,project_details:a.message,message:a.message,user_id:u?u.id:null};console.log("üìù Sending contact data to Supabase:",I),console.log("üîç Testing Supabase connection...");const{data:_,error:f}=await d.from("contact_submissions").select("id").limit(1);if(f)throw console.error("‚ùå Supabase connection test failed:",f),new Error(`Database connection failed: ${f.message}`);console.log("‚úÖ Supabase connection test successful");const{data:M,error:b}=await d.from("contact_submissions").insert([I]).select();if(b)throw console.error("‚ùå Error saving contact message:",b),new Error(`Failed to save your message: ${b.message}`);console.log("‚úÖ Contact message saved successfully:",M),x?.classList.remove("hidden"),m.reset(),await prefillForm()}catch(c){console.error("Contact form error:",c),L&&(L.textContent=c.message||"An error occurred while sending your message."),C?.classList.remove("hidden")}finally{i.disabled=!1,i.innerHTML=r}});window.checkUserStatus=function(){console.log("üîç Checking user status..."),console.log("Global auth manager available:",!!window.globalAuthManager),console.log("Simple auth manager available:",!!window.simpleAuthManager),console.log("Supabase available:",!!window.supabase),window.globalAuthManager&&(console.log("User logged in (global):",window.globalAuthManager.isUserLoggedIn()),console.log("Current user (global):",window.globalAuthManager.getCurrentUser())),window.simpleAuthManager&&(console.log("User logged in (simple):",window.simpleAuthManager.isUserLoggedIn()),console.log("Current user (simple):",window.simpleAuthManager.getCurrentUser()))};window.reinitSupabase=function(){return console.log("üîÑ Reinitializing Supabase..."),w()?(console.log("‚úÖ Supabase reinitialized successfully"),!0):(console.log("‚ùå Failed to reinitialize Supabase"),!1)};window.testSupabaseConnection=async function(){if(!d)return console.log("‚ùå Supabase not initialized"),!1;try{const{data:e,error:t}=await d.from("contact_submissions").select("id").limit(1);return t?(console.error("‚ùå Supabase test failed:",t),!1):(console.log("‚úÖ Supabase test successful:",e),!0)}catch(e){return console.error("‚ùå Supabase test error:",e),!1}};document.addEventListener("DOMContentLoaded",()=>{["first_name","last_name","email","phone","company","project_type","message"].forEach(t=>{const o=document.getElementById(t);o&&(o.addEventListener("focus",()=>{h()||y()}),o.addEventListener("click",()=>{h()||y()}))})});function g(){console.log("üö´ FORCE CLEARING FORM - NO USER DETAILS ALLOWED WITHOUT LOGIN");const e=document.getElementById("first_name"),t=document.getElementById("last_name"),o=document.getElementById("email"),n=document.getElementById("phone"),s=document.getElementById("company"),l=document.getElementById("project_type"),i=document.getElementById("message");e&&(e.value="",e.disabled=!0,e.placeholder="Please sign in to access this field",e.style.backgroundColor="#f9fafb",e.style.cursor="not-allowed"),t&&(t.value="",t.disabled=!0,t.placeholder="Please sign in to access this field",t.style.backgroundColor="#f9fafb",t.style.cursor="not-allowed"),o&&(o.value="",o.disabled=!0,o.placeholder="Please sign in to access this field",o.style.backgroundColor="#f9fafb",o.style.cursor="not-allowed"),n&&(n.value="",n.disabled=!0,n.placeholder="Please sign in to access this field",n.style.backgroundColor="#f9fafb",n.style.cursor="not-allowed"),s&&(s.value="",s.disabled=!0,s.placeholder="Please sign in to access this field",s.style.backgroundColor="#f9fafb",s.style.cursor="not-allowed"),l&&(l.value="",l.disabled=!0,l.style.backgroundColor="#f9fafb",l.style.cursor="not-allowed"),i&&(i.value="",i.disabled=!0,i.placeholder="Please sign in to send us a message.",i.style.backgroundColor="#f9fafb",i.style.cursor="not-allowed");const r=document.querySelector('button[type="submit"]');r&&(r.disabled=!0,r.style.backgroundColor="#d1d5db",r.style.cursor="not-allowed",r.textContent="Please Sign In to Submit");const c=document.getElementById("contact-form");if(c){let a=document.getElementById("auth-message");a||(a=document.createElement("div"),a.id="auth-message",a.className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",c.insertBefore(a,c.firstChild)),a.innerHTML=`
        <div class="flex items-center">
          <svg class="w-5 h-5 text-red-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
          </svg>
          <div>
            <p class="text-red-800 font-medium">Authentication Required</p>
            <p class="text-red-700 text-sm">You must be logged in to access this form and view our products.</p>
            <div class="mt-2">
              <a href="/login" class="text-red-600 hover:text-red-800 font-medium text-sm mr-4">Sign In</a>
              <a href="/signup" class="text-red-600 hover:text-red-800 font-medium text-sm">Create Account</a>
            </div>
          </div>
        </div>
      `}}g();document.addEventListener("DOMContentLoaded",()=>{g(),setTimeout(()=>{const e=window.globalAuthManager||window.simpleAuthManager;e&&e.isUserLoggedIn()?(console.log("‚úÖ User is logged in - enabling form"),p(),prefillForm()):(console.log("‚ùå User not logged in - keeping form cleared"),g())},200)});(function(){const e=()=>{const t=document.getElementById("first_name"),o=document.getElementById("last_name"),n=document.getElementById("email"),s=document.getElementById("phone"),l=document.getElementById("company"),i=document.getElementById("project_type"),r=document.getElementById("message");t&&(t.value=""),o&&(o.value=""),n&&(n.value=""),s&&(s.value=""),l&&(l.value=""),i&&(i.value=""),r&&(r.value="")};e(),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()})();window.addEventListener("user-logged-out",()=>{console.log("üë§ User logged out - FORCE CLEARING contact form"),g()});window.addEventListener("user-logged-in",()=>{console.log("üë§ User logged in - pre-filling contact form"),setTimeout(()=>{prefillForm()},100)});window.addEventListener("load",()=>{console.log("üîÑ Window loaded - FORCE CLEARING form first..."),g();const e=()=>{const t=window.globalAuthManager||window.simpleAuthManager;t?(console.log("‚úÖ Auth manager found on window load, checking user status..."),t.isUserLoggedIn()?(console.log("üë§ User is logged in on window load - enabling form"),p(),prefillForm()):(console.log("üë§ User not logged in on window load - keeping form cleared"),g())):(console.log("‚è≥ Auth manager not ready on window load, retrying in 100ms..."),setTimeout(e,100))};setTimeout(e,100)});document.addEventListener("visibilitychange",()=>{if(!document.hidden){console.log("üîÑ Page became visible - checking authentication");const e=window.globalAuthManager||window.simpleAuthManager;!e||!e.isUserLoggedIn()?(console.log("üë§ User not logged in - FORCE CLEARING form"),g()):console.log("üë§ User is logged in - keeping form data")}});(function(){console.log("üö´ IMMEDIATE FORM CLEARING - preventing any pre-filled data");function e(){["first_name","last_name","email","phone","company","project_type","message"].forEach(s=>{const l=document.getElementById(s);l&&(l.value="",l.disabled=!0,l.style.backgroundColor="#f9fafb",l.style.cursor="not-allowed",(l.tagName==="INPUT"||l.tagName==="TEXTAREA")&&(l.placeholder="Please sign in to access this field"))});const n=document.querySelector('button[type="submit"]');n&&(n.disabled=!0,n.style.backgroundColor="#d1d5db",n.style.cursor="not-allowed",n.textContent="Please Sign In to Submit")}e(),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e(),window.addEventListener("load",e);let t=setInterval(e,100);setTimeout(()=>t(t),2e3)})();
