import"./Footer.astro_astro_type_script_index_0_lang.DjppUjiM.js";import"https://unpkg.com/@supabase/supabase-js@2";import"./AuthGuard.astro_astro_type_script_index_0_lang.D4Znhmp3.js";let l=null,c=null,a=[{id:"1",email:"test@example.com",fullName:"Test User",phone:"+1234567890",companyName:"Test Company",password:"password123"},{id:"2",email:"admin@example.com",fullName:"Admin User",phone:"+9876543210",companyName:"Admin Company",password:"admin123"},{id:"3",email:"demo@example.com",fullName:"Demo User",phone:"+5555555555",companyName:"Demo Company",password:"demo123"}];const i={getItem:r=>{if(typeof window<"u"&&window.localStorage)try{return window.localStorage.getItem(r)}catch(e){return console.warn("localStorage access failed:",e),null}return null},setItem:(r,e)=>{if(typeof window<"u"&&window.localStorage)try{window.localStorage.setItem(r,e)}catch(t){console.warn("localStorage set failed:",t)}},removeItem:r=>{if(typeof window<"u"&&window.localStorage)try{window.localStorage.removeItem(r)}catch(e){console.warn("localStorage remove failed:",e)}}},p=()=>{if(!(typeof window>"u"))try{const r=i.getItem("simple-auth-users");if(r)try{const o=JSON.parse(r),s=new Set(a.map(n=>n.email));o.forEach(n=>{s.has(n.email)||(a.push(n),s.add(n.email))})}catch(o){console.warn("Failed to parse stored users:",o)}const e=i.getItem("simple-auth-user"),t=i.getItem("simple-auth-session");if(e&&t)try{const o=JSON.parse(e),s=JSON.parse(t);let n=a.find(d=>d.id===o.id);!n&&o.email&&(n=a.find(d=>d.email===o.email)),n||(console.log("User not found in mockUsers, creating from stored data:",o.email),n={id:o.id,email:o.email,fullName:o.fullName||"",phone:o.phone||"",companyName:o.companyName||"",password:"stored_user"},a.push(n),i.setItem("simple-auth-users",JSON.stringify(a)),console.log("Added user to mockUsers:",n.email)),n&&(l=n,c=s,console.log("Restored user session:",n.email))}catch(o){console.warn("Failed to parse stored user/session:",o),i.removeItem("simple-auth-user"),i.removeItem("simple-auth-session")}}catch(r){console.warn("Failed to initialize auth from localStorage:",r)}},f={init:()=>{p()},signUp:async(r,e,t)=>{if(a.find(m=>m.email===r))throw new Error("User already exists");const s={id:Date.now().toString(),email:r,fullName:t.fullName||"",phone:t.phone,companyName:t.companyName,password:e};a.push(s),i.setItem("simple-auth-users",JSON.stringify(a));const n={user:s,accessToken:`token_${Date.now()}`,refreshToken:`refresh_${Date.now()}`};l=s,c=n;const{password:d,...u}=s;return i.setItem("simple-auth-user",JSON.stringify(u)),i.setItem("simple-auth-session",JSON.stringify(n)),console.log("User created successfully:",{email:s.email,id:s.id}),console.log("Total users in system:",a.length),{user:s,session:n}},signIn:async(r,e)=>{console.log("Attempting to sign in with:",r),console.log("Available users:",a.map(d=>({email:d.email,id:d.id})));const t=a.find(d=>d.email===r);if(!t)throw console.log("User not found:",r),new Error("Invalid credentials");if(console.log("User found:",{email:t.email,id:t.id}),t.password!==e)throw console.log("Password mismatch for user:",r),console.log("Expected:",t.password,"Got:",e),new Error("Invalid credentials");console.log("Password verified successfully for user:",r);const o={user:t,accessToken:`token_${Date.now()}`,refreshToken:`refresh_${Date.now()}`};l=t,c=o;const{password:s,...n}=t;return i.setItem("simple-auth-user",JSON.stringify(n)),i.setItem("simple-auth-session",JSON.stringify(o)),console.log("Login successful for user:",r),console.log("Session created:",{accessToken:o.accessToken,refreshToken:o.refreshToken}),{user:t,session:o}},signOut:async()=>{l=null,c=null,i.removeItem("simple-auth-user"),i.removeItem("simple-auth-session")},getCurrentUser:()=>{if(l)return l;const r=i.getItem("simple-auth-user"),e=i.getItem("simple-auth-session");if(r&&e)try{const t=JSON.parse(r),o=JSON.parse(e);let s=a.find(n=>n.id===t.id);if(!s&&t.email&&(s=a.find(n=>n.email===t.email)),s||(s={id:t.id,email:t.email,fullName:t.fullName||"",phone:t.phone||"",companyName:t.companyName||"",password:"stored_user"},a.push(s),i.setItem("simple-auth-users",JSON.stringify(a))),s)return l=s,c=o,l}catch(t){console.warn("Failed to restore user from localStorage:",t),i.removeItem("simple-auth-user"),i.removeItem("simple-auth-session")}return null},isAuthenticated:()=>{if(console.log("Checking authentication status..."),l)return console.log("User authenticated from memory:",l.email),!0;const r=i.getItem("simple-auth-user"),e=i.getItem("simple-auth-session");if(console.log("Stored user:",r?"exists":"none"),console.log("Stored session:",e?"exists":"none"),r&&e)try{const t=JSON.parse(r),o=JSON.parse(e);console.log("Parsed user ID:",t.id);const s=a.find(n=>n.id===t.id);return s?(l=s,c=o,console.log("User authenticated from localStorage:",s.email),!0):(console.log("User not found in mockUsers, clearing invalid data"),i.removeItem("simple-auth-user"),i.removeItem("simple-auth-session"),!1)}catch(t){return console.warn("Failed to parse stored user/session:",t),i.removeItem("simple-auth-user"),i.removeItem("simple-auth-session"),!1}return console.log("No valid authentication found"),!1},getCurrentSession:()=>{if(c)return c;const r=i.getItem("simple-auth-session");if(r)try{return c=JSON.parse(r),c}catch{i.removeItem("simple-auth-session")}return null},debugUsers:()=>(console.log("All users in system:",a),a),checkUserExists:r=>a.some(e=>e.email===r),updateProfile:async r=>{if(!l)throw new Error("No user is currently authenticated");Object.assign(l,r);const{password:e,...t}=l;i.setItem("simple-auth-user",JSON.stringify(t));const o=a.findIndex(s=>s.id===l.id);return o!==-1&&(a[o]={...l}),i.setItem("simple-auth-users",JSON.stringify(a)),console.log("Profile updated successfully for user:",l.email),l},changePassword:async(r,e)=>{if(!l)throw new Error("No user is currently authenticated");if(l.password!==r)throw new Error("Current password is incorrect");l.password=e;const t=a.findIndex(o=>o.id===l.id);t!==-1&&(a[t]={...l}),i.setItem("simple-auth-users",JSON.stringify(a)),console.log("Password changed successfully for user:",l.email)},resetPassword:async(r,e,t)=>{const o=a.find(n=>n.email===r);if(!o)throw new Error("User not found");o.password=t;const s=a.findIndex(n=>n.id===o.id);if(s!==-1&&(a[s]={...o}),i.setItem("simple-auth-users",JSON.stringify(a)),l&&l.email===r){l.password=t;const{password:n,...d}=l;i.setItem("simple-auth-user",JSON.stringify(d))}console.log("Password reset successfully for user:",o.email)}};typeof window<"u"&&(p(),document.readyState==="loading"&&document.addEventListener("DOMContentLoaded",p));class g{constructor(){this.orders=[],this.init()}init(){this.loadOrders(),this.renderOrders()}loadOrders(){const e=localStorage.getItem("user-orders");if(console.log("Raw orders data:",e),e){const t=JSON.parse(e),o=f.getCurrentUser();console.log("All orders:",t),console.log("Current user:",o),o?(this.orders=t.filter(s=>s.userId===o.email),console.log("Filtered orders for user:",this.orders)):(this.orders=[],console.log("No current user found"))}else console.log("No orders data found in localStorage")}renderOrders(){const e=document.getElementById("loading-orders"),t=document.getElementById("empty-orders"),o=document.getElementById("orders-list");console.log("Rendering orders. Orders count:",this.orders.length),setTimeout(()=>{if(e?.classList.add("hidden"),this.orders.length===0){console.log("No orders found, showing empty state"),t?.classList.remove("hidden"),o?.classList.add("hidden");return}console.log("Orders found, showing orders list"),t?.classList.add("hidden"),o?.classList.remove("hidden"),this.renderOrdersList()},1e3)}renderOrdersList(){const e=document.getElementById("orders-list");e&&(e.innerHTML="",this.orders.forEach((t,o)=>{const s=this.createOrderElement(t,o);e.appendChild(s)}))}createOrderElement(e,t){const o=document.getElementById("order-template");if(!o)return document.createElement("div");const s=o.cloneNode(!0);s.classList.remove("hidden"),s.id=`order-${t}`,s.querySelector(".order-project-name").textContent=e.projectName||"Custom Project",s.querySelector(".order-project-description").textContent=e.description||"Professional digital solution",s.querySelector(".order-total").textContent=`₹${e.total?.toLocaleString()||"0"}`,s.querySelector(".order-date").textContent=this.formatDate(e.orderDate),s.querySelector(".order-id").textContent=e.orderId||`ORD-${Date.now()}`,s.querySelector(".order-custom-name").textContent=e.requirements?.projectName||"-",s.querySelector(".order-contact-person").textContent=e.requirements?.contactPerson||"-",s.querySelector(".order-restaurant-name").textContent=e.requirements?.restaurantName||"-",s.querySelector(".order-cuisine-type").textContent=e.requirements?.cuisineType||"-",s.querySelector(".order-email").textContent=e.requirements?.email||"-",s.querySelector(".order-phone").textContent=e.requirements?.phone||"-",e.requirements?.primaryColor&&(s.querySelector(".order-primary-color").style.backgroundColor=e.requirements.primaryColor),e.requirements?.secondaryColor&&(s.querySelector(".order-secondary-color").style.backgroundColor=e.requirements.secondaryColor),e.requirements?.accentColor&&(s.querySelector(".order-accent-color").style.backgroundColor=e.requirements.accentColor),e.requirements?.textColor&&(s.querySelector(".order-text-color").style.backgroundColor=e.requirements.textColor);const n=s.querySelector(".order-features");e.features&&e.features.length>0&&(n.innerHTML=e.features.map(m=>`<span class="inline-block bg-primary-100 text-primary-800 text-xs px-2 py-1 rounded-full mr-2 mb-1">${m}</span>`).join(""));const d=s.querySelector(".order-logo-status");e.logo&&(d.innerHTML='<span class="text-green-600">✓ Logo uploaded</span>');const u=s.querySelector(".order-additional-requirements");return e.requirements?.additionalRequirements&&(u.textContent=e.requirements.additionalRequirements),s}formatDate(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}}document.addEventListener("DOMContentLoaded",()=>{new g,new URLSearchParams(window.location.search).get("order")==="success"&&(h(),window.history.replaceState({},document.title,window.location.pathname))});function h(){const r=document.createElement("div");r.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300",r.innerHTML=`
      <div class="flex items-center space-x-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        <span>Order placed successfully! 🎉</span>
      </div>
    `,document.body.appendChild(r),setTimeout(()=>{r.remove()},5e3)}
