import"./ProductDialog.astro_astro_type_script_index_0_lang.CpUg5vNK.js";import"https://unpkg.com/@supabase/supabase-js@2";import{c as v}from"./index.BymsOcZI.js";import"./preload-helper.CLcXU_4U.js";document.addEventListener("DOMContentLoaded",async()=>{console.log("ğŸš€ Menu Operator Profile Page Loading...");const t=sessionStorage.getItem("simple-auth-session");if(!t){console.log("âŒ No session data found - redirecting to login"),window.location.href="/login";return}let e;try{e=JSON.parse(t)}catch{console.log("âŒ Invalid session data - redirecting to login"),window.location.href="/login";return}if(!e.user||!e.user.email){console.log("âŒ No user data in session - redirecting to login"),window.location.href="/login";return}console.log("âœ… Session found for user:",e.user.email),_(),await E()});function _(){console.log("ğŸ” Debugging storage...");try{const t=sessionStorage.getItem("simple-auth-session");if(console.log("ğŸ“¦ SessionStorage data:",t),t){const e=JSON.parse(t);console.log("ğŸ‘¤ Session user:",e.user)}}catch(t){console.log("âŒ Error reading sessionStorage:",t)}try{const t=localStorage.getItem("simple-auth-user");if(console.log("ğŸ’¾ LocalStorage data:",t),t){const e=JSON.parse(t);console.log("ğŸ‘¤ Local user:",e)}}catch(t){console.log("âŒ Error reading localStorage:",t)}console.log("ğŸ”— Supabase available:",typeof window.supabase<"u"),typeof window.supabase<"u"&&console.log("âœ… Supabase client:",window.supabase)}async function E(){try{console.log("ğŸš€ Starting profile load...");const t=sessionStorage.getItem("simple-auth-session");if(!t){console.log("âŒ No session data - redirecting to login"),window.location.href="/login";return}const o=JSON.parse(t).user;if(!o||!o.email){console.log("âŒ No user data in session - redirecting to login"),window.location.href="/login";return}if(console.log("âœ… User found in session:",o.email),f(o,{full_name:o.full_name||o.name||"Menu Operator",email:o.email,created_at:o.created_at||new Date().toISOString(),last_login:new Date().toISOString(),role:"menu_operator"}),typeof window.supabase>"u"){console.error("âŒ Supabase client not available, using fallback data"),i(o);return}const s=window.supabase;console.log("âœ… Supabase client found");let n=null,l=null;try{const{data:r,error:a}=await s.from("profiles").select("*").eq("id",o.id).eq("role","menu_operator").single();n=r,l=a}catch(r){console.log("âš ï¸ Role-filtered query failed, trying fallback..."),l=r}if(l){console.log("âš ï¸ Role-filtered query failed:",l);try{const{data:r,error:a}=await s.from("profiles").select("*").eq("id",o.id).single();if(a){console.log("âš ï¸ Profile fetch failed (this is normal if profiles table doesn't exist):",a.message),console.log("ğŸ”„ Using fallback profile data..."),i(o);return}if(n=r,console.log("âœ… Fallback profile loaded:",n),n.role&&n.role.toLowerCase().trim()!=="menu_operator")if(console.log("âš ï¸ User does not have menu_operator role in database. Role:",n.role),o.role==="menu_operator"||o.role==="menu operator")console.log("âœ… Using session role instead of database role"),n.role="menu_operator";else{console.log("âŒ No valid role found - redirecting to dashboard"),window.location.href="/dashboard";return}}catch(r){console.error("âŒ Fallback query failed:",r),i(o);return}}if(n){if(n.role&&n.role.toLowerCase().trim()!=="menu_operator")if(console.log("âš ï¸ User does not have menu_operator role in database. Role:",n.role),o.role==="menu_operator"||o.role==="menu operator")console.log("âœ… Using session role instead of database role"),n.role="menu_operator";else{console.log("âŒ No valid role found - redirecting to dashboard"),window.location.href="/dashboard";return}console.log("âœ… Profile loaded successfully:",n),f(o,n)}else console.log("âš ï¸ No profile found, using fallback data"),i(o)}catch(t){console.error("âŒ Error loading user profile:",t),i()}}function i(t=null){console.log("ğŸ”„ Showing fallback profile...");let e=t,o=null;if(!e){try{const s=sessionStorage.getItem("simple-auth-session");if(s){const n=JSON.parse(s);n.user&&n.access_token&&(e=n.user,console.log("âœ… Found user in sessionStorage:",e.email))}}catch(s){console.log("âš ï¸ Error reading sessionStorage:",s)}if(!e)try{const s=localStorage.getItem("simple-auth-user");s&&(e=JSON.parse(s),console.log("âœ… Found user in localStorage:",e.email))}catch(s){console.log("âš ï¸ Error reading localStorage:",s)}}if(!e){console.log("âŒ No authenticated user found - redirecting to login"),window.location.href="/login";return}o={full_name:e.full_name||e.name||"Menu Operator",email:e.email,created_at:e.created_at||new Date().toISOString(),last_login:new Date().toISOString(),role:"menu_operator"},console.log("âœ… Using fallback profile:",o),f(e,o)}function f(t,e){try{const o=e.full_name||t.email,s=e.full_name?e.full_name.split(" ").map(S=>S.charAt(0)).join("").toUpperCase():t.email.charAt(0).toUpperCase(),n=document.getElementById("profile-avatar");n&&(n.textContent=s);const l=document.getElementById("profile-name");l&&(l.textContent=o);const r=document.getElementById("profile-email");r&&(r.textContent=t.email);const a=document.getElementById("profile-full-name");a&&(a.textContent=e.full_name||"Not set");const g=document.getElementById("profile-email-detail");g&&(g.textContent=t.email);const b=e.created_at?new Date(e.created_at).toLocaleDateString():new Date(t.created_at).toLocaleDateString(),w=e.last_login?new Date(e.last_login).toLocaleDateString():new Date().toLocaleDateString(),m=document.getElementById("profile-member-since");m&&(m.textContent=b);const p=document.getElementById("profile-last-login");p&&(p.textContent=w),console.log("âœ… Profile display updated successfully")}catch(o){console.error("Error updating profile display:",o),I("Failed to update profile display.")}}function I(t){const e=document.createElement("div");e.className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",e.textContent=t;const o=document.querySelector(".space-y-6");o&&o.insertBefore(e,o.firstChild)}(function(){if(document.body)document.body.classList.add("menu-operator-panel-active");else{const e=new MutationObserver(function(o){o.forEach(function(s){s.type==="childList"&&document.body&&(document.body.classList.add("menu-operator-panel-active"),e.disconnect())})});e.observe(document.documentElement,{childList:!0})}const t=()=>{const e=document.querySelector("header"),o=document.querySelector("footer");e&&(e.style.display="none",e.style.visibility="hidden",e.style.opacity="0",e.style.height="0",e.style.maxHeight="0",e.style.overflow="hidden",e.style.position="absolute",e.style.top="-9999px",e.style.left="-9999px",e.style.zIndex="-9999",e.style.pointerEvents="none",e.style.transform="translateY(-100vh)"),o&&(o.style.display="none",o.style.visibility="hidden",o.style.opacity="0",o.style.height="0",o.style.maxHeight="0",o.style.overflow="hidden",o.style.position="absolute",o.style.top="-9999px",o.style.left="-9999px",o.style.zIndex="-9999",o.style.pointerEvents="none",o.style.transform="translateY(-100vh)")};t(),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t()})();(function(){document.documentElement.classList.add("menu-operator-panel-active"),document.body.classList.add("menu-operator-panel-active");function t(){const e=document.querySelector("header");e&&(e.style.display="none",e.style.visibility="hidden",e.style.opacity="0",e.style.height="0",e.style.maxHeight="0",e.style.overflow="hidden",e.style.position="absolute",e.style.top="-9999px",e.style.left="-9999px",e.style.zIndex="-9999",e.style.pointerEvents="none",e.style.transform="translateY(-100vh)",e.style.transition="none",e.style.animation="none")}t(),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t(),window.addEventListener("load",t),window.addEventListener("popstate",t),setInterval(t,100)})();const d={ASSETS_PREFIX:void 0,BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SITE:void 0,SSR:!1};var u={};const y={url:"https://lmrrdcaavwwletcjcpqv.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ"},h=t=>typeof import.meta<"u"&&d&&d[t]?d[t]:typeof process<"u"&&u&&u[t]?u[t]:typeof window<"u"&&window.__ENV__&&window.__ENV__[t]?window.__ENV__[t]:"",x=h("VITE_SUPABASE_URL")||y.url,D=h("VITE_SUPABASE_ANON_KEY")||y.anonKey,N=v(x,D);async function O(){try{console.log("ğŸ” MenuOperatorGuard - Checking access...");const t=sessionStorage.getItem("simple-auth-session");if(!t)return console.log("âŒ No session data found - redirecting to login"),window.location.href="/login",!1;let e;try{e=JSON.parse(t)}catch{return console.log("âŒ Invalid session data - redirecting to login"),window.location.href="/login",!1}if(!e.user||!e.user.email)return console.log("âŒ No user data in session - redirecting to login"),window.location.href="/login",!1;if(console.log("âœ… Session found for user:",e.user.email),e.user.role==="menu_operator"||e.user.role==="menu operator")return console.log("âœ… Menu operator role found in session"),!0;console.log("âš ï¸ No role in session, checking Supabase...");const{data:o,error:s}=await N.from("profiles").select("role, status").eq("id",e.user.id).single();return s||!o?(console.log("âŒ No profile found in Supabase"),c("You need menu operator role to access this page. Please contact support to assign the role."),!1):(console.log("ğŸ” MenuOperatorGuard - Profile loaded:",o),console.log("ğŸ” MenuOperatorGuard - Role value:",JSON.stringify(o.role)),o.status&&o.status!=="active"?(c("Your menu operator access is currently inactive."),!1):!o.role||o.role.toLowerCase().trim()!=="menu_operator"?(c("You need menu operator role to access this page. Current role: "+o.role),!1):(e.user.role=o.role,sessionStorage.setItem("simple-auth-session",JSON.stringify(e)),console.log("âœ… Updated session with role information"),!0))}catch(t){return console.error("Error checking menu operator access:",t),c("Error verifying your access. Please try again."),!1}}function c(t){document.body.innerHTML=`
      <div class="min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8">
        <div class="sm:mx-auto sm:w-full sm:max-w-md">
          <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
            <div class="text-center">
              <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
                <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
              </div>
              <h2 class="mt-6 text-3xl font-extrabold text-gray-900">Access Denied</h2>
              <p class="mt-2 text-sm text-gray-600">${t}</p>
              <div class="mt-6">
                <a href="/dashboard" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                  Go to Dashboard
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    `}document.addEventListener("DOMContentLoaded",async()=>{await O()});
