import"./ProductDialog.astro_astro_type_script_index_0_lang.CpUg5vNK.js";import"https://unpkg.com/@supabase/supabase-js@2";import"./AdminLayout.astro_astro_type_script_index_3_lang.Bf11ZY-L.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2";const u="https://lmrrdcaavwwletcjcpqv.supabase.co",g="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ";function s(t){try{const n=new Date(t);if(isNaN(n.getTime()))return"Invalid Date";const a=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0"),o=n.getFullYear();return`${a}/${r}/${o}`}catch(n){return console.error("Error formatting date:",n),"Invalid Date"}}let i=null;function l(){return new Promise(t=>{window.supabase?(i=window.supabase.createClient(u,g),t(i)):setTimeout(()=>l().then(t),100)})}document.addEventListener("DOMContentLoaded",async()=>{console.log("üîÑ Loading admin profile..."),await p(),await f(),await h(),w()});async function p(){try{console.log("üîÑ Loading admin info..."),i||await l();const{data:{user:t},error:n}=await i.auth.getUser();if(n){console.error("Error getting user:",n);return}if(t){const{data:a,error:r}=await i.from("profiles").select("*").eq("id",t.id).single();if(r)console.log("‚ö†Ô∏è Profile fetch failed (this is normal if profiles table doesn't exist):",r.message),document.getElementById("admin-full-name").textContent=t.user_metadata?.full_name||"Admin User",document.getElementById("admin-email").textContent=t.email||"No email";else{document.getElementById("admin-full-name").textContent=a.full_name||"Admin User",document.getElementById("admin-email").textContent=a.email||t.email||"No email",document.getElementById("admin-display-name").textContent=a.full_name||"Admin User",document.getElementById("admin-display-email").textContent=a.email||t.email||"No email";const o=document.getElementById("admin-avatar-large");if(o){const e=a.full_name||t.user_metadata?.full_name||t.email||"A";o.textContent=e.charAt(0).toUpperCase()}a.created_at&&(document.getElementById("admin-created-at").textContent=s(a.created_at)),t.last_sign_in_at&&(document.getElementById("admin-last-login").textContent=s(t.last_sign_in_at))}}else document.getElementById("admin-full-name").textContent="No user logged in",document.getElementById("admin-email").textContent="No email"}catch(t){console.error("Error loading admin info:",t)}}async function f(){try{console.log("üîÑ Loading admin stats..."),i||await l();const[t,n,a,r]=await Promise.all([i.from("profiles").select("*",{count:"exact",head:!0}),i.from("contact_submissions").select("*",{count:"exact",head:!0}),i.from("support_tickets").select("*",{count:"exact",head:!0}),i.from("customization_forms").select("*",{count:"exact",head:!0})]),o=t.count||0,e=n.count||0,c=a.count||0,d=r.count||0;document.getElementById("orders-managed").textContent=d.toString(),document.getElementById("users-managed").textContent=o.toString(),document.getElementById("tickets-resolved").textContent=c.toString(),document.getElementById("contact-forms").textContent=e.toString(),console.log("‚úÖ Admin stats loaded:",{totalUsers:o,totalContacts:e,totalTickets:c,totalCarts:d})}catch(t){console.error("Error loading admin stats:",t)}}async function h(){const t=document.getElementById("recent-activity");if(t)try{console.log("üîÑ Loading recent activity..."),i||await l();const[n,a,r]=await Promise.all([i.from("contact_submissions").select("*").order("created_at",{ascending:!1}).limit(3),i.from("support_tickets").select("*").order("created_at",{ascending:!1}).limit(3),i.from("customization_forms").select("*").order("created_at",{ascending:!1}).limit(3)]),o=[];if(n.data&&n.data.forEach(e=>{o.push({type:"contact",icon:"user-plus",color:"green",title:"New Contact Submission",description:`${e.first_name} ${e.last_name} - ${e.project_type||"General Inquiry"}`,time:s(e.created_at)})}),a.data&&a.data.forEach(e=>{o.push({type:"ticket",icon:"question-mark-circle",color:"yellow",title:`Support Ticket ${e.status||"New"}`,description:`${e.subject||"No subject"} - ${e.category||"General"}`,time:s(e.created_at)})}),r.data&&r.data.forEach(e=>{o.push({type:"cart",icon:"shopping-cart",color:"blue",title:"New Cart Customization",description:`${e.project_name||"Custom Project"} - ‚Çπ${e.total_amount||"0"}`,time:s(e.created_at)})}),o.sort((e,c)=>new Date(c.time).getTime()-new Date(e.time).getTime()),o.splice(5),o.length===0){t.innerHTML=`
          <div class="text-center py-8 text-gray-500">
            <p>No recent activity</p>
          </div>
        `;return}t.innerHTML=o.map(e=>`
        <div class="flex items-center space-x-4 p-3 bg-gray-50 rounded-lg">
          <div class="w-8 h-8 bg-${e.color}-100 rounded-full flex items-center justify-center">
            <svg class="w-4 h-4 text-${e.color}-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              ${y(e.icon)}
            </svg>
          </div>
          <div class="flex-1">
            <p class="text-sm font-medium text-gray-900">${e.title}</p>
            <p class="text-sm text-gray-500">${e.description}</p>
          </div>
          <span class="text-sm text-gray-400">${e.time}</span>
        </div>
      `).join(""),console.log("‚úÖ Recent activity loaded:",o.length,"activities")}catch(n){console.error("Error loading recent activity:",n),t.innerHTML=`
        <div class="text-center py-8 text-gray-500">
          <p>Error loading recent activity</p>
        </div>
      `}}function y(t){switch(t){case"shopping-cart":return'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>';case"question-mark-circle":return'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>';case"user-plus":return'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>';default:return'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>'}}function w(){console.log("‚úÖ Profile page loaded - edit functionality removed"),document.addEventListener("keydown",t=>{t.key==="Escape"&&(console.log("‚å®Ô∏è Escape key pressed - going back to admin dashboard"),m())})}function m(){console.log("üîÑ Navigating back to admin dashboard..."),window.location.href="/admin"}window.goBackToAdminDashboard=m;
