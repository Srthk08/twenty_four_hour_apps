const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/supabase.DO6XXPT9.js","_astro/index.BFAZBQoJ.js"])))=>i.map(i=>d[i]);
import{_ as T}from"./index.BFAZBQoJ.js";import{s as z}from"./customization-db.DL2D4DLQ.js";import"./ProductDialog.astro_astro_type_script_index_0_lang.C4tfig-4.js";import"https://unpkg.com/@supabase/supabase-js@2";import"./AuthGuard.astro_astro_type_script_index_0_lang.D4Znhmp3.js";console.log("Dashboard loaded - using global auth manager");async function D(e){try{console.log("🔍 Fetching user profile from Supabase for user:",e);const{supabase:l}=await T(async()=>{const{supabase:t}=await import("./supabase.DO6XXPT9.js");return{supabase:t}},__vite__mapDeps([0,1])),{data:a,error:f}=await l.from("profiles").select("*").eq("id",e).single();return f?(console.error("Error fetching user profile:",f),null):(console.log("✅ User profile fetched from Supabase:",a),a)}catch(l){return console.error("Error in fetchUserProfile:",l),null}}async function L(){console.log("🔄 Updating user info...");let e=null,l="";const a=[{key:"simple-auth-session",storage:sessionStorage,path:"user"},{key:"simple-auth-user",storage:localStorage,path:null},{key:"simple-auth-session",storage:localStorage,path:"user"}];for(const t of a)try{const u=t.storage.getItem(t.key);if(u){const s=JSON.parse(u);if(e=t.path?s[t.path]:s,e&&e.email){l=t.key,console.log(`✅ Found user data in ${t.key}:`,e.email);break}}}catch(u){console.log(`Error reading ${t.key}:`,u)}if(!e){console.log("No stored user data found, checking URL...");const t=new URLSearchParams(window.location.search),u=t.get("email")||"user@example.com",s=t.get("name")||"User";e={email:u,full_name:s,phone:"Not set",company_name:"Not set"},l="URL parameters",console.log("Using fallback data:",e)}if(e){if(e.user_metadata&&(e.full_name=e.user_metadata.full_name||e.full_name,e.phone=e.user_metadata.phone||e.phone,e.company_name=e.user_metadata.company_name||e.company_name),e.id&&(!e.full_name||e.full_name==="User"||!e.phone||e.phone==="Not set")){console.log("🔄 Incomplete user data, fetching from Supabase...");try{const t=await D(e.id);t&&(e={...e,...t,email:e.email||t.email},console.log("✅ Enhanced user data with profile:",e))}catch(t){console.log("Error fetching profile data:",t)}}e.full_name=e.full_name||e.fullName||"User",e.phone=e.phone||"Not set",e.company_name=e.company_name||e.companyName||"Not set",e.email=e.email||"user@example.com",console.log("📋 Final normalized user data:",e)}const f=document.getElementById("user-welcome");if(f){const t=e.full_name||e.fullName||e.email?.split("@")[0]||"User";f.textContent=t,console.log("👋 Welcome message updated to:",t)}console.log(`✅ Dashboard updated successfully from ${l}`),setTimeout(()=>{console.log("🔄 Force update welcome message...");const t=document.getElementById("user-welcome");if(t){const u=e.full_name||e.fullName||e.email?.split("@")[0]||"User";t.textContent=u,console.log("Force updated welcome to:",t.textContent)}},100)}function U(){const e=new URLSearchParams(window.location.search),l=e.get("product"),a=e.get("price");if(console.log("🔍 Checking for product selection:",{productId:l,price:a}),l&&a){console.log("✅ Product selected, showing customization form");const t=[{id:"1",name:"Restaurant Menu System",description:"Digital menu system with QR code integration, online ordering, and real-time updates. Perfect for restaurants looking to modernize their customer experience.",price:25e3,type:"restaurant"},{id:"2",name:"Android TV App",description:"Custom Android TV applications with beautiful UI, content management, and remote control support. Perfect for streaming services and media companies.",price:55e3,type:"non-restaurant"},{id:"3",name:"Streaming Mobile App",description:"Mobile streaming applications for iOS and Android with custom features, user authentication, and content management.",price:35e3,type:"non-restaurant"},{id:"4",name:"Restaurant Website",description:"Professional restaurant website with online ordering, menu display, and customer management features.",price:2e4,type:"restaurant"},{id:"5",name:"Order Menu System",description:"Complete order management system with digital menu integration, real-time order tracking, and payment processing. Perfect for restaurants looking to streamline their ordering process.",price:999,type:"order-menu"}].find(u=>u.id===l);if(t){const u=document.getElementById("product-customization-form"),s=document.getElementById("order-menu-customization-form"),p=document.getElementById("recent-activity");u&&!u.classList.contains("hidden")&&(u.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",u.style.opacity="0",u.style.transform="translateY(-10px)",setTimeout(()=>u.classList.add("hidden"),300)),s&&!s.classList.contains("hidden")&&(s.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",s.style.opacity="0",s.style.transform="translateY(-10px)",setTimeout(()=>s.classList.add("hidden"),300)),p&&!p.classList.contains("hidden")&&(p.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",p.style.opacity="0",p.style.transform="translateY(-10px)",setTimeout(()=>p.classList.add("hidden"),300)),setTimeout(()=>{const o=t.type==="order-menu"?999:parseInt(a);if(t.type==="order-menu"){document.getElementById("order-menu-product-name").textContent=t.name,document.getElementById("order-menu-product-price").textContent=`₹${o.toLocaleString()}`;const i=document.getElementById("order-menu-customization-form");i.classList.remove("hidden"),i.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",i.style.opacity="0",i.style.transform="translateY(10px)",setTimeout(()=>{i.style.opacity="1",i.style.transform="translateY(0)"},50)}else{document.getElementById("selected-product-name").textContent=t.name,document.getElementById("selected-product-price").textContent=`₹${o.toLocaleString()}`;const i=document.getElementById("cuisine-type-field"),m=document.getElementById("restaurant-name-field");t.type==="restaurant"?(i.classList.remove("hidden"),i.querySelector("select").required=!0,m.classList.remove("hidden"),m.querySelector("input").required=!0):(i.classList.add("hidden"),i.querySelector("select").required=!1,m.classList.add("hidden"),m.querySelector("input").required=!1);const r=document.getElementById("product-customization-form");r.classList.remove("hidden"),r.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",r.style.opacity="0",r.style.transform="translateY(10px)",setTimeout(()=>{r.style.opacity="1",r.style.transform="translateY(0)"},50)}},350),setTimeout(()=>A(),500)}}}function R(){const e=document.getElementById("order-menu-form"),l=document.getElementById("close-order-menu-form"),a=document.getElementById("cancel-order-menu"),f=document.getElementById("order-menu-logo-upload"),t=document.querySelector("#order-menu-customization-form .border-dashed"),u=document.getElementById("add-menu-item"),s=document.getElementById("menu-items-container"),p=document.getElementById("oms-category-input"),o=document.getElementById("oms-add-category-btn"),i=document.getElementById("oms-clear-all-categories-btn"),m=document.getElementById("oms-category-pills"),r=document.getElementById("oms-current-category"),_=document.getElementById("oms-prev-page"),I=document.getElementById("oms-next-page"),q=document.getElementById("oms-page-indicator"),v=[];let E=-1;const F=6;let S=1;function B(){m.innerHTML="",v.forEach((c,h)=>{const n=document.createElement("button");n.type="button",n.className=`px-3 py-1 rounded-full text-sm ${h===E?"bg-amber-600 text-white":"bg-gray-100"} flex items-center`;const g=document.createElement("span");g.textContent=c,g.className="mr-2",n.appendChild(g);const d=document.createElement("span");d.textContent="✕",d.className="text-xs opacity-70 hover:opacity-100 ml-1",d.addEventListener("click",y=>{y.stopPropagation();const k=v.splice(h,1)[0];E>=v.length&&(E=v.length-1),s.querySelectorAll(".menu-item-row").forEach(b=>{const P=b.querySelector(".oms-category-field");P&&P.value===k&&(P.value="")}),r.textContent=v[E]||"Uncategorized",B(),w()}),n.appendChild(d),n.addEventListener("click",()=>{E=h,r.textContent=c,B(),w()}),m.appendChild(n)})}i?.addEventListener("click",()=>{v.splice(0,v.length),E=-1,r.textContent="Uncategorized",B(),w(),s.querySelectorAll(".oms-category-field").forEach(c=>c.value="")}),o?.addEventListener("click",()=>{const c=p.value.trim();c&&(v.includes(c)||(v.push(c),E=v.length-1,r.textContent=c,B(),s.querySelectorAll(".oms-category-field").forEach(h=>{h.value||(h.value=c)}),p.value=""))});function w(){const c=Array.from(s.querySelectorAll(".menu-item-row"));if(c.forEach(g=>g.style.display=""),E>=0){const g=v[E];c.forEach(d=>{const y=d.querySelector(".oms-category-field");y&&y.value&&y.value!==g&&(d.style.display="none")})}const h=c.filter(g=>g.style.display!=="none"),n=Math.max(1,Math.ceil(h.length/F));S=Math.min(S,n),q.textContent=`Page ${S} / ${n}`,h.forEach((g,d)=>{const y=Math.floor(d/F)+1;g.style.display=y===S?"":"none"})}_?.addEventListener("click",()=>{S>1&&(S-=1,w())}),I?.addEventListener("click",()=>{S+=1,w()}),t?.addEventListener("click",()=>{f?.click()}),f?.addEventListener("change",c=>{const h=c.target.files[0];if(h){const n=h.name,g=(h.size/1024/1024).toFixed(2);t.innerHTML=`
          <div class="flex flex-col items-center">
            <svg class="w-12 h-12 text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <p class="text-green-600 mb-1 font-medium">Logo uploaded successfully</p>
            <p class="text-sm text-gray-500">${n} (${g} MB)</p>
          </div>
        `}});function C(){const c=e?.querySelectorAll('input[type="color"]'),h=e?.querySelectorAll('input[name$="ColorText"]');c?.forEach((n,g)=>{const d=h?.[g];d&&(n.addEventListener("input",()=>{d.value=n.value}),d.addEventListener("input",()=>{/^#[0-9A-F]{6}$/i.test(d.value)&&(n.value=d.value)}))})}C();let x=1;u?.addEventListener("click",()=>{const c=document.createElement("div");if(c.className="menu-item-row grid grid-cols-1 md:grid-cols-4 gap-4 mb-4 p-4 border border-gray-200 rounded-lg",c.innerHTML=`
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Item Name</label>
          <input type="text" name="menuItems[${x}][item_name]" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500" placeholder="e.g., Margherita Pizza" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Price (₹)</label>
          <input type="number" name="menuItems[${x}][price]" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500" placeholder="299" step="0.01" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
          <input type="text" name="menuItems[${x}][item_category]" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 oms-category-field" placeholder="Type or pick from pills" required>
        </div>
        <div class="flex items-end">
          <button type="button" class="remove-menu-item px-3 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 text-sm">
            Remove
          </button>
        </div>
      `,s?.appendChild(c),x++,E>=0){const h=v[E],n=c.querySelector(".oms-category-field");n&&!n.value&&(n.value=h)}w()}),s?.addEventListener("click",c=>{c.target.classList.contains("remove-menu-item")&&(c.target.closest(".menu-item-row").remove(),w())}),w(),l?.addEventListener("click",()=>{N(),window.history.replaceState({},document.title,window.location.pathname)}),a?.addEventListener("click",()=>{N(),window.history.replaceState({},document.title,window.location.pathname)}),e?.addEventListener("submit",async c=>{c.preventDefault();const h=new FormData(e),n=Object.fromEntries(h);console.log("📝 Order Menu requirements saved:",n);const g={productId:"5",productName:"Order Menu System",productDescription:"Complete order management system with digital menu integration, real-time order tracking, and payment processing. Perfect for restaurants looking to streamline their ordering process.",productPrice:"₹25,000",projectName:n.projectName,restaurantName:n.restaurantName,ownerName:n.ownerName,restaurantAddress:n.restaurantAddress,contactPerson:n.contactPerson,email:n.email,phone:n.phone,additionalRequirements:n.additionalRequirements,restaurantLogo:n.restaurantLogo,primaryColor:n.primaryColor,secondaryColor:n.secondaryColor,accentColor:n.accentColor,textColor:n.textColor,menuItems:Array.from(document.querySelectorAll(".menu-item-row")).map((d,y)=>({item_name:d.querySelector(`input[name="menuItems[${y}][item_name]"]`)?.value||"",price:d.querySelector(`input[name="menuItems[${y}][price]"]`)?.value||"",item_category:d.querySelector(`input[name="menuItems[${y}][item_category]"]`)?.value||""})).filter(d=>d.item_name),timestamp:new Date().toISOString()};try{console.log("💾 Saving OMS data to Supabase...");const{supabase:d}=await T(async()=>{const{supabase:y}=await import("./supabase.DO6XXPT9.js");return{supabase:y}},__vite__mapDeps([0,1]));if(d){const{data:y,error:k}=await d.rpc("upsert_oms_customization",{p_user_email:n.email,p_project_name:n.projectName,p_restaurant_name:n.restaurantName,p_owner_name:n.ownerName,p_restaurant_address:n.restaurantAddress,p_contact_person:n.contactPerson,p_phone_number:n.phone,p_user_id:null,p_logo_url:null,p_logo_filename:null,p_logo_size:null,p_menu_categories:g.menuItems?JSON.stringify(Array.from(new Set(g.menuItems.map(b=>b.item_category).filter(b=>b&&b.trim()!==""))).map((b,P)=>({id:`cat_${P+1}`,name:b}))):"[]",p_menu_items:g.menuItems?JSON.stringify(g.menuItems):"[]",p_primary_color:n.primaryColor||"#3B82F6",p_secondary_color:n.secondaryColor||"#10B981",p_accent_color:n.accentColor||"#F59E0B",p_text_color:n.textColor||"#1F2937",p_additional_requirements:n.additionalRequirements||""});if(k){console.error("❌ Error saving to Supabase:",k);const b=JSON.parse(localStorage.getItem("order-menu-requirements")||"[]");b.push(g),localStorage.setItem("order-menu-requirements",JSON.stringify(b)),alert("Order Menu requirements saved locally! Our team will contact you soon.")}else if(y&&y.length>0){const b=y[0];if(b.is_duplicate)alert(`⚠️ Data Already Exists!

${b.message}

Record ID: ${b.data_id}`);else if(console.log("✅ OMS data saved to Supabase with ID:",b.data_id),alert("Order Menu requirements saved successfully! Opening payment page..."),window.open("https://payments.pabbly.com/subscribe/68c084369dbcfe4b619b80ce/six-months-inr","_blank"))setTimeout(()=>{window.location.href="/orders?order=success&product=order-menu-system"},2e3);else{alert("Please allow popups for this site to proceed with payment, or click the payment link manually.");const O=document.createElement("div");O.innerHTML=`
                  <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                              background: white; padding: 20px; border: 2px solid #4CAF50; 
                              border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 9999;">
                    <h3 style="color: #4CAF50; margin-bottom: 15px;">Payment Required</h3>
                    <p style="margin-bottom: 15px;">Please complete your payment to proceed:</p>
                    <a href="https://payments.pabbly.com/subscribe/68c084369dbcfe4b619b80ce/six-months-inr" 
                       target="_blank" style="display: inline-block; padding: 10px 20px; 
                       background: #4CAF50; color: white; text-decoration: none; border-radius: 5px;">
                      Open Payment Page
                    </a>
                    <button onclick="this.parentElement.remove()" style="margin-left: 10px; padding: 10px 15px; 
                            background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer;">
                      Close
                    </button>
                  </div>
                `,document.body.appendChild(O)}}else{console.error("❌ No data returned from OMS function");const b=JSON.parse(localStorage.getItem("order-menu-requirements")||"[]");b.push(g),localStorage.setItem("order-menu-requirements",JSON.stringify(b)),alert("Order Menu requirements saved locally! Our team will contact you soon.")}}else{console.error("❌ Supabase not available, saving locally only");const y=JSON.parse(localStorage.getItem("order-menu-requirements")||"[]");y.push(g),localStorage.setItem("order-menu-requirements",JSON.stringify(y)),alert("Order Menu requirements saved locally! Our team will contact you soon.")}window.history.replaceState({},document.title,window.location.pathname),N(),e.reset()}catch(d){console.error("Error saving order menu requirements:",d),alert("Error saving order menu requirements. Please try again.")}})}function $(){const e=document.getElementById("customization-form"),l=document.getElementById("close-customization-form"),a=document.getElementById("cancel-customization"),f=document.getElementById("restaurant-logo-upload"),t=document.querySelector("#product-customization-form .border-dashed");t?.addEventListener("click",()=>{f?.click()}),f?.addEventListener("change",s=>{const p=s.target.files[0];if(p){const o=p.name,i=(p.size/1024/1024).toFixed(2);t.innerHTML=`
          <div class="flex flex-col items-center">
            <svg class="w-12 h-12 text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <p class="text-green-600 mb-1 font-medium">Logo uploaded successfully</p>
            <p class="text-sm text-gray-500">${o} (${i} MB)</p>
          </div>
        `}});function u(){const s=e?.querySelectorAll('input[type="color"]'),p=e?.querySelectorAll('input[name$="ColorText"]');s?.forEach((o,i)=>{const m=p?.[i];m&&(o.addEventListener("input",()=>{m.value=o.value}),m.addEventListener("input",()=>{/^#[0-9A-F]{6}$/i.test(m.value)&&(o.value=m.value)}))})}u(),l?.addEventListener("click",()=>{N(),window.history.replaceState({},document.title,window.location.pathname)}),a?.addEventListener("click",()=>{N(),window.history.replaceState({},document.title,window.location.pathname)}),e?.addEventListener("submit",async s=>{s.preventDefault();const p=new FormData(e),o=Object.fromEntries(p);console.log("📝 Project requirements saved:",o);const i=document.getElementById("selected-product-name").textContent,m=document.getElementById("selected-product-price").textContent,r={productId:new URLSearchParams(window.location.search).get("product")||"1",productName:i,productPrice:m,projectName:o.projectName,appName:o.appName,contactPerson:o.contactPerson,productDescriptionCustom:o.productDescription,email:o.email,phone:o.phone,additionalRequirements:o.additionalRequirements,restaurantLogo:o.restaurantLogo,primaryColor:o.primaryColor,secondaryColor:o.secondaryColor,accentColor:o.accentColor,textColor:o.textColor,timestamp:new Date().toISOString()};r.restaurantName=o.restaurantName||r.restaurantName||"",r.cuisineType=o.cuisineType||r.cuisineType||"";try{console.log("💾 Saving project form to database...");const I=(C=>(C||"").toLowerCase())(i);let q="restaurant-website";I.includes("order menu")?q="restaurant-menu-system":I.includes("restaurant website")?q="restaurant-website":I.includes("android tv")?q="android-tv-app":I.includes("streaming")&&(q="streaming-mobile-app");let v=r.logoUrl||null,E=r.logoFilename||null,F=r.logoMimeType||null,S=r.logoSize||null;try{const x=e.querySelector('input[name="restaurantLogo"]')?.files?.[0];if(x){const{supabase:c}=await T(async()=>{const{supabase:y}=await import("./supabase.DO6XXPT9.js");return{supabase:y}},__vite__mapDeps([0,1])),h=x.name.replace(/\s+/g,"_");if(x.size>10*1024*1024)throw new Error("Logo file exceeds 10MB limit");const n=`${Date.now()}_${h}`,g=await x.arrayBuffer(),{error:d}=await c.storage.from("logos").upload(n,g,{upsert:!0,contentType:x.type,cacheControl:"3600"});if(!d){const{data:y}=c.storage.from("logos").getPublicUrl(n);if(v=y?.publicUrl||null,!v){const{data:k,error:b}=await c.storage.from("logos").createSignedUrl(n,31536e3);b||(v=k?.signedUrl||null)}E=x.name,F=x.type,S=x.size}}}catch(C){console.warn("Logo upload skipped:",C)}const B={productName:i,productPrice:m,projectName:r.projectName,contactPerson:r.contactPerson,appName:r.appName,productDescription:r.productDescriptionCustom,restaurantName:r.restaurantName,cuisineType:r.cuisineType,email:r.email,phone:r.phone,primaryColor:r.primaryColor,secondaryColor:r.secondaryColor,accentColor:r.accentColor,textColor:r.textColor,additionalRequirements:r.additionalRequirements,logoUrl:v,logoFilename:E,logoMimeType:F,logoSize:S},w=await z(B,q);if(w.success)console.log("✅ Project form saved to Supabase database:",w.data),alert(`✅ Project requirements saved to database successfully!

Record ID: ${w.data.id}
Project: ${w.data.project_name}
Restaurant: ${w.data.restaurant_name||"N/A"}
Cuisine: ${w.data.cuisine_type||"N/A"}

Our team will contact you soon!`);else{console.error("❌ Error saving to database:",w.error);const C=JSON.parse(localStorage.getItem("project-requirements")||"[]");C.push(r),localStorage.setItem("project-requirements",JSON.stringify(C)),alert(`❌ Database save failed: ${w.error}

Data saved locally as backup. Our team will contact you soon.`)}window.history.replaceState({},document.title,window.location.pathname),N(),e.reset(),t&&(t.innerHTML=`
            <div class="flex flex-col items-center">
              <svg class="w-12 h-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              <p class="text-gray-600 mb-2">Click to upload restaurant logo</p>
              <p class="text-sm text-gray-500">PNG, JPG, SVG up to 10MB</p>
            </div>
          `)}catch(_){console.error("Error saving requirements:",_),alert("Error saving project requirements. Please try again.")}})}function N(){const e=document.getElementById("product-customization-form"),l=document.getElementById("order-menu-customization-form"),a=document.getElementById("recent-activity");e&&!e.classList.contains("hidden")&&(e.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",e.style.opacity="0",e.style.transform="translateY(-10px)",setTimeout(()=>e.classList.add("hidden"),300)),l&&!l.classList.contains("hidden")&&(l.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",l.style.opacity="0",l.style.transform="translateY(-10px)",setTimeout(()=>l.classList.add("hidden"),300)),setTimeout(()=>{a&&(a.style.display="block",a.classList.remove("hidden"),a.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",a.style.opacity="0",a.style.transform="translateY(10px)",setTimeout(()=>{a.style.opacity="1",a.style.transform="translateY(0)"},50))},350)}function A(){console.log("🔄 Attempting to auto-fill user details...");const e=()=>{const l=window.globalAuthManager||window.simpleAuthManager;if(l&&l.isUserLoggedIn()){const a=l.getCurrentUser();return console.log("👤 Current user from auth manager:",a),a&&a.email&&(console.log("📧 Auto-filling email:",a.email),document.querySelectorAll('input[name="email"], input[type="email"]').forEach(t=>{t.value=a.email,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Filled email field:",t)})),a&&a.phone&&(console.log("📱 Auto-filling phone:",a.phone),document.querySelectorAll('input[name="phone"], input[type="tel"]').forEach(t=>{t.value=a.phone,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Filled phone field:",t)})),a&&a.full_name&&(console.log("👤 Auto-filling contact person:",a.full_name),document.querySelectorAll('input[name="contactPerson"]').forEach(t=>{t.value=a.full_name,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Filled contact person field:",t)})),console.log("✅ Auto-fill completed with auth manager data"),!0}return!1};if(!e()){let l=0;const a=50,f=setInterval(()=>{if(l++,(e()||l>=a)&&(clearInterval(f),l>=a)){console.log("⏰ Auth manager timeout, trying fallback methods...");const t=sessionStorage.getItem("simple-auth-session");if(t)try{const s=JSON.parse(t).user;s&&s.email&&document.querySelectorAll('input[name="email"], input[type="email"]').forEach(o=>{o.value=s.email,o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0}))}),s&&s.phone&&document.querySelectorAll('input[name="phone"], input[type="tel"]').forEach(o=>{o.value=s.phone,o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0}))}),s&&s.full_name&&document.querySelectorAll('input[name="contactPerson"]').forEach(o=>{o.value=s.full_name,o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0}))}),console.log("✅ Auto-fill completed with session storage fallback")}catch(u){console.error("❌ Error parsing session data:",u)}}},100)}}document.addEventListener("DOMContentLoaded",()=>{console.log("Dashboard DOM loaded - initializing with global auth manager");const e=new URLSearchParams(window.location.search),l=e.get("product"),a=e.get("price"),f=document.getElementById("recent-activity");if(!l||!a?f&&(f.style.display="block",console.log("✅ Showing browse products section - no product selected")):f&&(f.style.display="none",console.log("✅ Hiding browse products section - product selected")),document.body.style.transition="opacity 0.3s ease-in-out",document.body.style.opacity="0",setTimeout(()=>{document.body.style.opacity="1"},50),l&&a){const o=[{id:"1",name:"Restaurant Menu System",description:"Digital menu system with QR code integration, online ordering, and real-time updates. Perfect for restaurants looking to modernize their customer experience.",price:25e3,type:"restaurant"},{id:"2",name:"Android TV App",description:"Custom Android TV applications with beautiful UI, content management, and remote control support. Perfect for streaming services and media companies.",price:55e3,type:"non-restaurant"},{id:"3",name:"Streaming Mobile App",description:"Mobile streaming applications for iOS and Android with custom features, user authentication, and content management.",price:35e3,type:"non-restaurant"},{id:"4",name:"Restaurant Website",description:"Professional restaurant website with online ordering, menu display, and customer management features.",price:2e4,type:"restaurant"},{id:"5",name:"Order Menu System",description:"Complete order management system with digital menu integration, real-time order tracking, and payment processing. Perfect for restaurants looking to streamline their ordering process.",price:999,type:"order-menu"}].find(i=>i.id===l);if(o){document.getElementById("selected-product-name").textContent=o.name,document.getElementById("selected-product-price").textContent=`₹${o.price.toLocaleString()}`,document.getElementById("order-menu-product-name").textContent=o.name,document.getElementById("order-menu-product-price").textContent=`₹${o.price.toLocaleString()}`;const i=document.getElementById("recent-activity"),m=document.getElementById("product-customization-form"),r=document.getElementById("order-menu-customization-form");i&&(i.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",i.style.opacity="0",i.style.transform="translateY(-10px)",setTimeout(()=>{i.classList.add("hidden")},300)),setTimeout(()=>{if(o.type==="order-menu")r&&(r.classList.remove("hidden"),r.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",r.style.opacity="0",r.style.transform="translateY(10px)",setTimeout(()=>{r.style.opacity="1",r.style.transform="translateY(0)"},50));else{m&&(m.classList.remove("hidden"),m.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",m.style.opacity="0",m.style.transform="translateY(10px)",setTimeout(()=>{m.style.opacity="1",m.style.transform="translateY(0)"},50));const _=document.getElementById("cuisine-type-field"),I=document.getElementById("restaurant-name-field");o.type==="restaurant"?(_.classList.remove("hidden"),_.querySelector("select").setAttribute("required","required"),I.classList.remove("hidden"),I.querySelector("input").setAttribute("required","required")):(_.classList.add("hidden"),_.querySelector("select").removeAttribute("required"),I.classList.add("hidden"),I.querySelector("input").removeAttribute("required"))}},300),setTimeout(()=>A(),500)}}U(),$(),R(),A(),setTimeout(()=>A(),1e3),setTimeout(()=>A(),2e3);const t=new MutationObserver(p=>{p.forEach(o=>{if(o.type==="attributes"&&o.attributeName==="class"){const i=o.target;(i.id==="product-customization-form"||i.id==="order-menu-customization-form")&&(i.classList.contains("hidden")||(console.log("👁️ Form became visible, auto-filling..."),setTimeout(()=>A(),100)))}})}),u=document.getElementById("product-customization-form"),s=document.getElementById("order-menu-customization-form");u&&t.observe(u,{attributes:!0,attributeFilter:["class"]}),s&&t.observe(s,{attributes:!0,attributeFilter:["class"]}),L(),setTimeout(()=>L(),100),setTimeout(()=>L(),500),setTimeout(()=>L(),1e3),setTimeout(()=>L(),2e3),setTimeout(()=>{const p=new URLSearchParams(window.location.search),o=p.get("product"),i=p.get("price"),m=document.getElementById("recent-activity");!o||!i?m&&(m.style.display="block",m.classList.remove("hidden"),console.log("✅ Browse products section confirmed visible - no product selected")):m&&(m.style.display="none",console.log("✅ Browse products section confirmed hidden - product selected"))},1e3)});window.addEventListener("load",()=>{console.log("Window loaded - trying again"),L()});let M=0;const j=5,Y=setInterval(()=>{M++,console.log(`Attempt ${M} to load user data...`),L(),M>=j&&(clearInterval(Y),console.log("Max attempts reached"))},2e3);window.addEventListener("user-logged-in",()=>{console.log("User logged in event received in dashboard"),L()});window.addEventListener("user-logged-out",()=>{console.log("User logged out event received in dashboard"),L()});console.log("✅ Dashboard script initialized with global auth manager");
