import"./ProductDialog.astro_astro_type_script_index_0_lang.CG_DSVmw.js";import"https://unpkg.com/@supabase/supabase-js@2";const m=document.getElementById("contact-form"),x=document.getElementById("success-message"),L=document.getElementById("error-message"),B=document.getElementById("error-text");function M(){const e=document.getElementById("first_name"),t=document.getElementById("last_name"),a=document.getElementById("email"),o=document.getElementById("phone"),s=document.getElementById("company");return{firstNameInput:e,lastNameInput:t,emailInput:a,phoneInput:o,companyInput:s}}function A(e){e&&(e.setAttribute("autocomplete","off"),e.setAttribute("data-orig-name",e.name||""),e.name=`${e.id}_noautofill`)}function S(e){if(!e)return;const t=e.getAttribute("data-orig-name");t&&(e.name=t)}function g(){const{firstNameInput:e,lastNameInput:t,emailInput:a,phoneInput:o,companyInput:s}=M();[e,t,a,o,s].forEach(i=>{i&&(i.value="",i.disabled=!0,A(i))});const l=m?.querySelector('button[type="submit"]');l&&(l.disabled=!0)}function p(){const{firstNameInput:e,lastNameInput:t,emailInput:a,phoneInput:o,companyInput:s}=M();[e,t,a,o,s].forEach(n=>{n&&(n.disabled=!1,S(n))});const l=document.getElementById("project_type"),i=document.getElementById("message");l&&(l.disabled=!1),i&&(i.disabled=!1,i.placeholder="Tell us about your project requirements...");const c=m?.querySelector('button[type="submit"]');c&&(c.disabled=!1);const r=document.getElementById("auth-message");r&&r.remove()}g();window.addEventListener("user-logged-in",()=>{p()});window.addEventListener("user-logged-out",()=>{g()});document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{const e=window.globalAuthManager||window.simpleAuthManager;(!e||!e.isUserLoggedIn())&&(console.log("üö´ User not authenticated - forcing form clear"),g(),window.clearForm())},100)});let d=null;const y=()=>{const e="https://lmrrdcaavwwletcjcpqv.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ";return window.supabase&&typeof window.supabase.createClient=="function"?(d=window.supabase.createClient(e,t),console.log("‚úÖ Supabase client initialized directly"),!0):window.supabase?(d=window.supabase,console.log("‚úÖ Using existing Supabase client"),!0):(console.error("‚ùå Supabase library not available"),!1)};y()?console.log("‚úÖ Supabase client ready:",!!d):console.error("‚ùå Failed to initialize Supabase client");window.clearForm=function(){console.log("üßπ Clearing contact form fields...");const t=document.getElementById("first_name"),a=document.getElementById("last_name"),o=document.getElementById("email"),s=document.getElementById("phone"),l=document.getElementById("company"),i=document.getElementById("project_type"),c=document.getElementById("message");t&&(t.value="",t.placeholder="Your first name",t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0}))),a&&(a.value="",a.placeholder="Your last name",a.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0}))),o&&(o.value="",o.placeholder="your.email@example.com",o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0}))),s&&(s.value="",s.placeholder="+1 (555) 123-4567",s.dispatchEvent(new Event("input",{bubbles:!0})),s.dispatchEvent(new Event("change",{bubbles:!0}))),l&&(l.value="",l.placeholder="Your company name",l.dispatchEvent(new Event("input",{bubbles:!0})),l.dispatchEvent(new Event("change",{bubbles:!0}))),i&&(i.value="",i.selectedIndex=0,i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0}))),c&&(c.value="",c.placeholder="Tell us about your project...",c.dispatchEvent(new Event("input",{bubbles:!0})),c.dispatchEvent(new Event("change",{bubbles:!0}))),document.querySelectorAll("input, select, textarea").forEach(n=>{n.classList.remove("border-red-500"),n.classList.add("border-gray-300")}),console.log("‚úÖ Contact form cleared")};window.prefillForm=async function(){console.log("üîÑ Checking authentication status...");const t=window.globalAuthManager||window.simpleAuthManager;if(t&&t.isUserLoggedIn()){console.log("‚úÖ User is logged in - enabling form"),p();const o=t.getCurrentUser();if(o&&o.email){const s=document.getElementById("first_name"),l=document.getElementById("last_name"),i=document.getElementById("email"),c=document.getElementById("phone"),r=document.getElementById("company");if(o.full_name){const n=o.full_name.split(" ");s&&(s.value=n[0]||""),l&&n.length>1&&(l.value=n.slice(1).join(" "))}if(i&&(i.value=o.email||""),c&&o.phone){let n=o.phone;n.startsWith("+91")&&(n=n.substring(3)),c.value=n}r&&o.company_name&&(r.value=o.company_name)}}else{console.log("‚ùå User not logged in - clearing and disabling form"),g();const o=document.getElementById("contact-form");if(o){let s=document.getElementById("auth-message");s||(s=document.createElement("div"),s.id="auth-message",s.className="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",o.insertBefore(s,o.firstChild)),s.innerHTML=`
          <div class="flex items-center">
            <svg class="w-5 h-5 text-blue-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div>
              <p class="text-blue-800 font-medium">Authentication Required</p>
              <p class="text-blue-700 text-sm">Please sign in to send us a message or view our products.</p>
              <div class="mt-2">
                <a href="/login" class="text-blue-600 hover:text-blue-800 font-medium text-sm mr-4">Sign In</a>
                <a href="/signup" class="text-blue-600 hover:text-blue-800 font-medium text-sm">Create Account</a>
              </div>
            </div>
          </div>
        `}}};function w(){const e=window.globalAuthManager||window.simpleAuthManager,t=e&&e.isUserLoggedIn();if(!t){console.log("üë§ User not logged in - clearing form and project details"),window.clearForm();const a=document.getElementById("project_type"),o=document.getElementById("message");a&&(a.value="",a.selectedIndex=0),o&&(o.value="",o.placeholder="Tell us about your project...")}return t}function U(){console.log("üîÑ Forcing form validation..."),document.querySelectorAll("input, select, textarea").forEach(t=>{t.value&&t.value.trim()&&(console.log(`üîç Forcing validation for field: ${t.id} = "${t.value}"`),t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),t.dispatchEvent(new Event("blur",{bubbles:!0})),t.setCustomValidity&&t.setCustomValidity(""))}),console.log("‚úÖ Form validation forced")}function v(){const e=document.createElement("div");e.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    `;const t=document.createElement("div");t.style.cssText=`
      background: white;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      max-width: 400px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    `,t.innerHTML=`
      <h3 style="margin-bottom: 20px; color: #333;">Authentication Required</h3>
      <p style="margin-bottom: 30px; color: #666;">Please sign up or login to submit the contact form.</p>
      <div style="display: flex; gap: 15px; justify-content: center;">
        <button id="signup-btn" style="
          background: #3B82F6;
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
        ">Sign Up</button>
        <button id="login-btn" style="
          background: #6B7280;
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
        ">Login</button>
      </div>
    `,e.appendChild(t),document.body.appendChild(e),document.getElementById("signup-btn").addEventListener("click",()=>{document.body.removeChild(e),window.location.href="/signup"}),document.getElementById("login-btn").addEventListener("click",()=>{document.body.removeChild(e),window.location.href="/login"}),e.addEventListener("click",a=>{a.target===e&&document.body.removeChild(e)})}m?.addEventListener("submit",async e=>{if(e.preventDefault(),!w()){v();return}U();const t=new FormData(m),a=Object.fromEntries(t);console.log("üìù Form data collected for validation:",a);const o=[{id:"first_name",name:"First Name",value:a.first_name},{id:"last_name",name:"Last Name",value:a.last_name},{id:"email",name:"Email",value:a.email},{id:"project_type",name:"Project Type",value:a.project_type},{id:"message",name:"Message",value:a.message}];let s=!0;const l=[];for(const r of o){const n=document.getElementById(r.id),u=r.value?r.value.toString().trim():"";console.log(`üîç Validating ${r.name}: "${u}"`),u?n&&(n.classList.remove("border-red-500"),n.classList.add("border-gray-300")):(s=!1,l.push(r.name),n&&(n.classList.add("border-red-500"),n.classList.remove("border-gray-300")))}if(!s){showError(`Please fill in all required fields: ${l.join(", ")}`);return}console.log("‚úÖ All required fields are filled - proceeding with submission"),x?.classList.add("hidden"),L?.classList.add("hidden");const i=m.querySelector('button[type="submit"]'),c=i.textContent;i.disabled=!0,i.innerHTML=`
      <svg class="animate-spin h-5 w-5 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    `;try{if(!d&&(console.log("üîÑ Supabase not available, trying to reinitialize..."),!y()))throw console.error("‚ùå Failed to initialize Supabase client"),new Error("Database connection not available. Please refresh the page and try again.");if(!d||typeof d.from!="function")throw console.error("‚ùå Supabase client is not properly initialized"),console.log("Supabase object:",d),console.log("Available methods:",d?Object.keys(d):"No supabase object"),new Error("Database connection not properly initialized. Please refresh the page and try again.");console.log("‚úÖ Supabase client verified and ready");const r=new FormData(m),n=Object.fromEntries(r);console.log("üìù Form data collected:",n);let u=null;try{const{data:{user:I}}=await d.auth.getUser();u=I,console.log("üë§ Current user:",u?u.email:"Not logged in")}catch{console.log("‚ÑπÔ∏è User not logged in, proceeding without authentication")}const E={first_name:n.first_name,last_name:n.last_name,email:n.email,phone:n.phone||null,company_name:n.company||null,project_type:n.project_type,project_details:n.message,message:n.message,user_id:u?u.id:null};console.log("üìù Sending contact data to Supabase:",E),console.log("üîç Testing Supabase connection...");const{data:F,error:b}=await d.from("contact_submissions").select("id").limit(1);if(b)throw console.error("‚ùå Supabase connection test failed:",b),new Error(`Database connection failed: ${b.message}`);console.log("‚úÖ Supabase connection test successful");const{data:C,error:h}=await d.from("contact_submissions").insert([E]).select();if(h)throw console.error("‚ùå Error saving contact message:",h),new Error(`Failed to save your message: ${h.message}`);console.log("‚úÖ Contact message saved successfully:",C),x?.classList.remove("hidden"),m.reset(),await prefillForm()}catch(r){console.error("Contact form error:",r),B&&(B.textContent=r.message||"An error occurred while sending your message."),L?.classList.remove("hidden")}finally{i.disabled=!1,i.innerHTML=c}});window.checkUserStatus=function(){console.log("üîç Checking user status..."),console.log("Global auth manager available:",!!window.globalAuthManager),console.log("Simple auth manager available:",!!window.simpleAuthManager),console.log("Supabase available:",!!window.supabase),window.globalAuthManager&&(console.log("User logged in (global):",window.globalAuthManager.isUserLoggedIn()),console.log("Current user (global):",window.globalAuthManager.getCurrentUser())),window.simpleAuthManager&&(console.log("User logged in (simple):",window.simpleAuthManager.isUserLoggedIn()),console.log("Current user (simple):",window.simpleAuthManager.getCurrentUser()))};window.reinitSupabase=function(){return console.log("üîÑ Reinitializing Supabase..."),y()?(console.log("‚úÖ Supabase reinitialized successfully"),!0):(console.log("‚ùå Failed to reinitialize Supabase"),!1)};window.testSupabaseConnection=async function(){if(!d)return console.log("‚ùå Supabase not initialized"),!1;try{const{data:e,error:t}=await d.from("contact_submissions").select("id").limit(1);return t?(console.error("‚ùå Supabase test failed:",t),!1):(console.log("‚úÖ Supabase test successful:",e),!0)}catch(e){return console.error("‚ùå Supabase test error:",e),!1}};document.addEventListener("DOMContentLoaded",()=>{["first_name","last_name","email","phone","company","project_type","message"].forEach(t=>{const a=document.getElementById(t);a&&(a.addEventListener("focus",()=>{w()||v()}),a.addEventListener("click",()=>{w()||v()}))})});function f(){console.log("üö´ FORCE CLEARING FORM - NO USER DETAILS ALLOWED WITHOUT LOGIN");const e=document.getElementById("first_name"),t=document.getElementById("last_name"),a=document.getElementById("email"),o=document.getElementById("phone"),s=document.getElementById("company"),l=document.getElementById("project_type"),i=document.getElementById("message");e&&(e.value="",e.disabled=!0),t&&(t.value="",t.disabled=!0),a&&(a.value="",a.disabled=!0),o&&(o.value="",o.disabled=!0),s&&(s.value="",s.disabled=!0),l&&(l.value="",l.disabled=!0),i&&(i.value="",i.disabled=!0,i.placeholder="Please sign in to send us a message.");const c=document.querySelector('button[type="submit"]');c&&(c.disabled=!0);const r=document.getElementById("contact-form");if(r){let n=document.getElementById("auth-message");n||(n=document.createElement("div"),n.id="auth-message",n.className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",r.insertBefore(n,r.firstChild)),n.innerHTML=`
        <div class="flex items-center">
          <svg class="w-5 h-5 text-red-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
          </svg>
          <div>
            <p class="text-red-800 font-medium">Authentication Required</p>
            <p class="text-red-700 text-sm">You must be logged in to access this form and view our products.</p>
            <div class="mt-2">
              <a href="/login" class="text-red-600 hover:text-red-800 font-medium text-sm mr-4">Sign In</a>
              <a href="/signup" class="text-red-600 hover:text-red-800 font-medium text-sm">Create Account</a>
            </div>
          </div>
        </div>
      `}}document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{const e=window.globalAuthManager||window.simpleAuthManager;e&&e.isUserLoggedIn()?(console.log("‚úÖ User is logged in - enabling form"),p(),prefillForm()):(console.log("‚ùå User not logged in - clearing form"),f())},100)});window.addEventListener("user-logged-out",()=>{console.log("üë§ User logged out - FORCE CLEARING contact form"),f()});window.addEventListener("user-logged-in",()=>{console.log("üë§ User logged in - pre-filling contact form"),setTimeout(()=>{prefillForm()},100)});window.addEventListener("load",()=>{console.log("üîÑ Window loaded - checking authentication status...");const e=()=>{const t=window.globalAuthManager||window.simpleAuthManager;t?(console.log("‚úÖ Auth manager found on window load, checking user status..."),t.isUserLoggedIn()?(console.log("üë§ User is logged in on window load - enabling form"),p(),prefillForm()):(console.log("üë§ User not logged in on window load - clearing form"),f())):(console.log("‚è≥ Auth manager not ready on window load, retrying in 100ms..."),setTimeout(e,100))};setTimeout(e,100)});document.addEventListener("visibilitychange",()=>{if(!document.hidden){console.log("üîÑ Page became visible - checking authentication");const e=window.globalAuthManager||window.simpleAuthManager;!e||!e.isUserLoggedIn()?(console.log("üë§ User not logged in - FORCE CLEARING form"),f()):console.log("üë§ User is logged in - keeping form data")}});
