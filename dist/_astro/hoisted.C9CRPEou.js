const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/supabase.DFVW9e3y.js","_astro/index.BymsOcZI.js","_astro/preload-helper.CLcXU_4U.js"])))=>i.map(i=>d[i]);
import{_ as y}from"./preload-helper.CLcXU_4U.js";import"./ProductDialog.astro_astro_type_script_index_0_lang.CpUg5vNK.js";import"https://unpkg.com/@supabase/supabase-js@2";import"./AuthGuard.astro_astro_type_script_index_0_lang.DULNhCHQ.js";class f{constructor(){this.orders=[],this.init()}init(){this.loadOrders().then(()=>this.renderOrders())}async loadOrders(){const e=localStorage.getItem("project-requirements"),a=localStorage.getItem("order-menu-requirements"),s=localStorage.getItem("user-orders");console.log("Loading orders from multiple sources..."),console.log("Project requirements:",e),console.log("Order menu requirements:",a),console.log("User orders:",s),this.orders=[];let r=window.globalAuthManager?.getCurrentUser()||window.simpleAuthManager?.getCurrentUser();if(console.log("Current user (app auth):",r),!r){console.log("No current user found");try{const{supabase:o}=await y(async()=>{const{supabase:i}=await import("./supabase.DFVW9e3y.js");return{supabase:i}},__vite__mapDeps([0,1,2])),{data:{user:n}}=await o.auth.getUser();n&&(r={email:n.email})}catch(o){console.warn("Supabase auth fallback failed:",o)}if(!r)return}const d=r?.email||null;if(!d){console.log("No user email available â€“ cannot load orders");return}if(e)try{JSON.parse(e).forEach(n=>{this.orders.push({...n,orderId:`PROJ-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,orderDate:n.timestamp||new Date().toISOString(),total:this.extractPrice(n.productPrice)||0,projectName:n.productName||"Custom Project",description:n.productDescription||"Professional digital solution",requirements:n,status:"completed"})})}catch(o){console.error("Error parsing project requirements:",o)}if(a)try{JSON.parse(a).forEach(n=>{this.orders.push({...n,orderId:`MENU-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,orderDate:n.timestamp||new Date().toISOString(),total:this.extractPrice(n.productPrice)||0,projectName:n.productName||"Order Menu System",description:n.productDescription||"Complete order management system",requirements:n,status:"completed"})})}catch(o){console.error("Error parsing order menu requirements:",o)}if(s)try{const n=JSON.parse(s).filter(i=>i.userId===d);this.orders.push(...n)}catch(o){console.error("Error parsing user orders:",o)}try{await this.loadSupabaseOrders(d)}catch(o){console.warn("Failed to load Supabase orders:",o)}this.orders.sort((o,n)=>new Date(n.orderDate).getTime()-new Date(o.orderDate).getTime()),console.log("âœ… Total orders loaded:",this.orders.length),console.log("ðŸ“‹ Order IDs:",this.orders.map(o=>o.orderId)),console.log("ðŸ“‹ Order details:",this.orders.map(o=>({id:o.orderId,project:o.projectName,status:o.status,date:o.orderDate})))}async loadSupabaseOrders(e){try{const{supabase:a}=await y(async()=>{const{supabase:t}=await import("./supabase.DFVW9e3y.js");return{supabase:t}},__vite__mapDeps([0,1,2]));console.log("ðŸ” Loading Supabase orders for email:",e);let s=[],r=null;const d=new Set,{data:o,error:n}=await a.from("order_customizations").select("*").eq("email",e).order("created_at",{ascending:!1});!n&&o&&o.length>0?(o.forEach(t=>{d.has(t.id)||(s.push(t),d.add(t.id))}),console.log("âœ… Found",o.length,'orders using "email" field')):n&&console.log('âš ï¸ Error querying with "email" field:',n.message);const{data:i,error:l}=await a.from("order_customizations").select("*").eq("user_email",e).order("created_at",{ascending:!1});!l&&i&&i.length>0?(i.forEach(t=>{d.has(t.id)||(s.push(t),d.add(t.id))}),console.log("âœ… Found",i.length,'orders using "user_email" field')):l&&console.log('âš ï¸ Error querying with "user_email" field:',l.message),n&&l&&(r=l||n,console.error("âŒ Both queries failed for order_customizations")),r&&console.warn("âš ï¸ Error loading order_customizations, continuing with other sources...",r),s.sort((t,g)=>{const c=new Date(t.created_at||0);return new Date(g.created_at||0)-c}),console.log("ðŸ“¦ Processing",s.length,"order_customizations..."),(s||[]).forEach((t,g)=>{console.log(`  Order ${g+1}:`,{id:t.id,project_name:t.project_name,email:t.email||t.user_email,status:t.status}),this.orders.push({orderId:t.id||`OC-${Date.now()}-${g}`,orderDate:t.created_at||new Date().toISOString(),total:Number(t.total_amount)||0,projectName:t.project_name||"Order Menu System",description:"Order Menu System customization",status:t.status||"pending",requirements:{projectName:t.project_name,contactPerson:t.contact_person,restaurantName:t.restaurant_name,cuisineType:t.cuisine_type,email:t.email||t.user_email,phone:t.phone_number,additionalRequirements:t.additional_requirements,primaryColor:t.primary_color,secondaryColor:t.secondary_color,accentColor:t.accent_color,textColor:t.text_color}})});const{data:u,error:m}=await a.from("cart_customizations").select("*").eq("user_email",e).in("cart_status",["completed","pending","confirmed","in_progress","cancelled"]).order("updated_at",{ascending:!1});if(m)throw console.error("âŒ Error loading cart_customizations:",m),m;console.log("ðŸ“¦ Processing",(u||[]).length,"cart_customizations..."),(u||[]).forEach((t,g)=>{console.log(`  Cart ${g+1}:`,{id:t.id,project_name:t.project_name,user_email:t.user_email,cart_status:t.cart_status});let c=t.status||t.cart_status||"pending";c==="completed"?c="completed":c==="cancelled"?c="cancelled":c==="pending"?c="pending":c==="confirmed"?c="confirmed":(c==="in_progress"||c==="processing")&&(c="in_progress"),this.orders.push({orderId:t.id||`CART-${Date.now()}`,orderDate:t.updated_at||t.created_at||new Date().toISOString(),total:Number(t.total_amount)||0,projectName:t.project_name||"Custom Project",description:t.project_description||"Project purchased",status:c,requirements:{projectName:t.project_name,contactPerson:t.contact_person,restaurantName:t.restaurant_name,cuisineType:t.cuisine_type,email:t.user_email,phone:t.phone_number,additionalRequirements:t.additional_requirements,primaryColor:t.primary_color,secondaryColor:t.secondary_color,accentColor:t.accent_color,textColor:t.text_color}})})}catch(a){throw console.error("Error loading Supabase orders:",a),a}}extractPrice(e){if(!e)return 0;const a=e.match(/â‚¹?([\d,]+)/);return a?parseInt(a[1].replace(/,/g,"")):0}renderOrders(){const e=document.getElementById("loading-orders"),a=document.getElementById("empty-orders"),s=document.getElementById("orders-list");if(console.log("Rendering orders. Orders count:",this.orders.length),e?.classList.add("hidden"),this.orders.length===0){console.log("No orders found, showing empty state"),a?.classList.remove("hidden"),s?.classList.add("hidden"),document.getElementById("recent-activity")?.classList.add("hidden");return}console.log("Orders found, showing orders list"),a?.classList.add("hidden"),s?.classList.remove("hidden"),this.renderOrdersList(),this.renderRecentSummary()}renderOrdersList(){const e=document.getElementById("orders-list");e&&(e.innerHTML="",this.orders.forEach((a,s)=>{const r=this.createOrderElement(a,s);e.appendChild(r)}))}createOrderElement(e,a){const s=document.getElementById("order-template");if(!s)return document.createElement("div");const r=s.cloneNode(!0);r.classList.remove("hidden"),r.id=`order-${a}`,r.querySelector(".order-project-name").textContent=e.projectName||"Custom Project",r.querySelector(".order-project-description").textContent=e.description||"Professional digital solution",r.querySelector(".order-total").textContent=`â‚¹${e.total?.toLocaleString()||"0"}`,r.querySelector(".order-date").textContent=this.formatDate(e.orderDate),r.querySelector(".order-id").textContent=e.orderId||`ORD-${Date.now()}`,r.querySelector(".order-custom-name").textContent=e.requirements?.projectName||"-",r.querySelector(".order-contact-person").textContent=e.requirements?.contactPerson||"-",r.querySelector(".order-restaurant-name").textContent=e.requirements?.restaurantName||"-",r.querySelector(".order-cuisine-type").textContent=e.requirements?.cuisineType||"-",r.querySelector(".order-email").textContent=e.requirements?.email||"-",r.querySelector(".order-phone").textContent=e.requirements?.phone||"-",e.requirements?.primaryColor&&(r.querySelector(".order-primary-color").style.backgroundColor=e.requirements.primaryColor),e.requirements?.secondaryColor&&(r.querySelector(".order-secondary-color").style.backgroundColor=e.requirements.secondaryColor),e.requirements?.accentColor&&(r.querySelector(".order-accent-color").style.backgroundColor=e.requirements.accentColor),e.requirements?.textColor&&(r.querySelector(".order-text-color").style.backgroundColor=e.requirements.textColor);const d=r.querySelector(".order-features");e.features&&e.features.length>0&&(d.innerHTML=e.features.map(u=>`<span class="inline-block bg-primary-100 text-primary-800 text-xs px-2 py-1 rounded-full mr-2 mb-1">${u}</span>`).join(""));const o=r.querySelector(".order-logo-status");e.logo&&(o.innerHTML='<span class="text-green-600">âœ“ Logo uploaded</span>');const n=r.querySelector(".order-additional-requirements");e.requirements?.additionalRequirements&&(n.textContent=e.requirements.additionalRequirements);const i=r.querySelector(".order-status-badge")||r.querySelector("span.bg-green-100");if(i){const u=(e.status||"pending").charAt(0).toUpperCase()+(e.status||"pending").slice(1).replace("_"," "),m=e.status==="completed"?"âœ“ ":e.status==="cancelled"?"âœ— ":e.status==="in_progress"?"âŸ³ ":"";i.textContent=m+u,i.className="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium "+this.getStatusColor(e.status)}const l=r.querySelector(".order-status-section");if(l){const u=l.querySelector(".w-3.h-3"),m=l.querySelector("span.text-green-700");if(u&&m){const t={pending:"bg-yellow-500",confirmed:"bg-blue-500",in_progress:"bg-purple-500",processing:"bg-purple-500",completed:"bg-green-500",cancelled:"bg-red-500"},g=(e.status||"pending").toLowerCase();u.className="w-3 h-3 "+(t[g]||"bg-gray-500")+" rounded-full";const c={pending:"text-yellow-700",confirmed:"text-blue-700",in_progress:"text-purple-700",processing:"text-purple-700",completed:"text-green-700",cancelled:"text-red-700"},h=(e.status||"pending").charAt(0).toUpperCase()+(e.status||"pending").slice(1).replace("_"," ");m.textContent="Order "+h,m.className=(c[g]||"text-gray-700")+" font-medium"}}return r}formatDate(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}getStatusColor(e){const a=(e||"").toLowerCase();return{pending:"bg-yellow-100 text-yellow-800",confirmed:"bg-blue-100 text-blue-800",in_progress:"bg-purple-100 text-purple-800",processing:"bg-purple-100 text-purple-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"}[a]||"bg-gray-100 text-gray-800"}renderRecentSummary(){const e=document.getElementById("recent-order-summary"),a=document.getElementById("recent-order-title"),s=document.getElementById("recent-order-amount"),r=document.getElementById("recent-order-date"),d=document.getElementById("recent-order-status"),o=document.getElementById("recent-order-view-btn");if(!e||!a||!s||!r||!d||!o)return;const n=[...this.orders].sort((u,m)=>new Date(m.orderDate).getTime()-new Date(u.orderDate).getTime());if(n.length===0){e.classList.add("hidden");return}const i=n[0];e.classList.remove("hidden"),a.textContent=i.projectName||"Order",s.textContent=`â‚¹${(i.total||0).toLocaleString("en-IN")}`,r.textContent=this.formatDate(i.orderDate);const l=(i.status||"pending").charAt(0).toUpperCase()+(i.status||"pending").slice(1).replace("_"," ");d.textContent=l,d.className="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium whitespace-nowrap "+this.getStatusColor(i.status),o.onclick=()=>{this.showOrderDetails(i)}}showOrderDetails(e){const a=document.getElementById("order-details-modal");if(!a)return;const s=l=>document.getElementById(l);s("order-modal-title").textContent=e.projectName||"Order Details",s("order-modal-amount").textContent=`â‚¹${(e.total||0).toLocaleString("en-IN")}`,s("order-modal-date").textContent=this.formatDate(e.orderDate),s("order-modal-id").textContent=e.orderId||"-",s("order-modal-desc").textContent=e.description||"-";const r=e.requirements||{};s("order-modal-contact").textContent=r.contactPerson||"-",s("order-modal-email").textContent=r.email||"-",s("order-modal-phone").textContent=r.phone||"-",s("order-modal-restaurant").textContent=r.restaurantName||"-",s("order-modal-cuisine").textContent=r.cuisineType||"-",s("order-modal-additional").textContent=r.additionalRequirements||"â€”",document.body.style.overflow="hidden",a.classList.remove("hidden");const d=()=>{a.classList.add("hidden"),document.body.style.overflow=""},o=document.getElementById("order-modal-backdrop"),n=document.getElementById("order-modal-close"),i=document.getElementById("order-modal-close-bottom");o.onclick=d,n.onclick=d,i.onclick=d}}document.addEventListener("DOMContentLoaded",()=>{new f,new URLSearchParams(window.location.search).get("order")==="success"&&(_(),window.history.replaceState({},document.title,window.location.pathname))});function _(){const p=document.createElement("div");p.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300",p.innerHTML=`
      <div class="flex items-center space-x-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        <span>Order placed successfully! ðŸŽ‰</span>
      </div>
    `,document.body.appendChild(p),setTimeout(()=>{p.remove()},5e3)}document.addEventListener("DOMContentLoaded",function(){const p=new URLSearchParams(window.location.search),e=p.get("order"),a=p.get("product");if(e==="success"){console.log("âœ… Order success detected, redirecting to congratulations page..."),window.location.href="/order-success?product="+(a||"order-menu-system");return}});
