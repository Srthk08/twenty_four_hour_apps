import{c as b}from"./index.BFAZBQoJ.js";window.handleMenuOperatorLogout=async function(){if(console.log("🚪 Global logout function called!"),confirm("Are you sure you want to logout?"))try{if(console.log("🚪 Logging out from Menu Operator Dashboard..."),sessionStorage.removeItem("simple-auth-session"),sessionStorage.removeItem("simple-auth-user"),sessionStorage.clear(),localStorage.removeItem("simple-auth-user"),localStorage.removeItem("simple-auth-session"),localStorage.clear(),window.supabase)try{await window.supabase.auth.signOut(),console.log("✅ Supabase sign out successful")}catch(a){console.log("⚠️ Supabase sign out error (continuing anyway):",a)}const t=document.getElementById("user-name"),e=document.getElementById("menu-operator-avatar");t&&(t.textContent="Signing out..."),e&&(e.textContent="..."),setTimeout(()=>{window.location.href="/login",console.log("✅ Redirected to login page")},500)}catch(t){console.error("❌ Error during logout:",t),window.location.href="/login"}};(function(){console.log("🚨 LOADING REAL USER PROFILE...");async function t(){try{let e=null,a=null;try{const o=sessionStorage.getItem("simple-auth-session");if(o){const s=JSON.parse(o);s.user&&s.access_token&&(e=s.user,console.log("✅ Found real user in sessionStorage:",e.email))}}catch(o){console.log("⚠️ Error reading sessionStorage:",o)}if(!e)try{const o=localStorage.getItem("simple-auth-user");o&&(e=JSON.parse(o),console.log("✅ Found real user in localStorage:",e.email))}catch(o){console.log("⚠️ Error reading localStorage:",o)}if(e){const o=document.getElementById("menu-operator-avatar"),s=document.getElementById("user-name");if(o){let n="MO";if(e.full_name||e.name){const i=(e.full_name||e.name).trim().split(" ");i.length>=2?n=(i[0][0]+i[i.length-1][0]).toUpperCase():i.length===1&&(n=i[0].substring(0,2).toUpperCase())}else e.email&&(n=e.email.substring(0,2).toUpperCase());o.textContent=n,console.log("✅ Avatar updated with real initials:",n)}if(s){const n=e.full_name||e.name||e.email||"Menu Operator";s.textContent=n,console.log("✅ Name updated with real name:",n)}}else console.log("⚠️ No real user data found, keeping default")}catch(e){console.error("❌ Error loading real user profile:",e)}}t(),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t(),setTimeout(t,100),setTimeout(t,500),setTimeout(t,1e3)})();const w=void 0,x=void 0;b(w,x);console.log("🔧 MenuOperatorLayout Supabase configuration:");console.log("- URL:",w);console.log("- Key:","Missing");document.addEventListener("DOMContentLoaded",async()=>{document.body.classList.add("menu-operator-panel-active"),await m(),C()});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",async()=>{await m()}):m();document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{document.body.classList.add("menu-operator-panel-active")}):document.body.classList.add("menu-operator-panel-active");function g(){console.log("🚨 FORCING AVATAR UPDATE...");const t=document.getElementById("menu-operator-avatar"),e=document.getElementById("user-name");t?(t.textContent="JD",console.log("✅ Avatar forced to JD")):console.log("❌ Avatar element not found"),e?(e.textContent="John Doe",console.log("✅ Name forced to John Doe")):console.log("❌ Name element not found")}setTimeout(g,50);setTimeout(g,200);setTimeout(g,500);document.addEventListener("DOMContentLoaded",()=>{console.log("📄 DOM Content Loaded - forcing avatar update"),g()});window.addEventListener("load",()=>{console.log("🪟 Window Loaded - forcing avatar update"),g()});setTimeout(()=>{const t=document.getElementById("user-name"),e=document.getElementById("menu-operator-avatar");t&&(t.textContent==="Loading..."||t.textContent==="Menu Operator")&&(console.log("⚠️ User info still loading, trying fallback..."),m()),e&&e.textContent==="MO"&&(console.log("⚠️ Avatar still showing MO, trying to update..."),m())},1e3);setTimeout(()=>{const t=document.getElementById("user-name"),e=document.getElementById("menu-operator-avatar");t&&(t.textContent==="Loading..."||t.textContent==="Menu Operator")&&(console.log("⚠️ User info still loading, forcing fallback display..."),r(null,null)),e&&e.textContent==="MO"&&(console.log("⚠️ Avatar still showing MO, forcing fallback display..."),r(null,null))},3e3);setTimeout(()=>{const t=document.getElementById("menu-operator-avatar");t&&t.textContent==="MO"&&(console.log("🔄 Immediate avatar update attempt..."),m())},100);function L(){console.log("🧪 Testing avatar update with sample data...");const t=document.getElementById("menu-operator-avatar"),e=document.getElementById("user-name");t&&(t.textContent="JD",console.log("✅ Avatar updated to JD")),e&&(e.textContent="John Doe",console.log("✅ Name updated to John Doe"))}setTimeout(()=>{const t=document.getElementById("menu-operator-avatar");t&&t.textContent==="MO"&&(console.log("🧪 Avatar still MO, running test update..."),L())},2e3);async function m(){try{if(console.log("🚀 Loading user info..."),typeof window.supabase>"u"){console.error("❌ Supabase client not available, using fallback"),r(null,null);return}const t=window.supabase;console.log("✅ Supabase client found");const{data:{user:e},error:a}=await t.auth.getUser();if(a||!e){console.error("❌ Error getting user:",a),r(null,null);return}console.log("✅ User found:",e.email);let o=null,s=null;try{const{data:n,error:l}=await t.from("profiles").select("full_name, email, role").eq("id",e.id).eq("role","menu_operator").single();o=n,s=l}catch(n){console.log("⚠️ Role-filtered query failed, trying fallback..."),s=n}if(s){console.log("⚠️ Role-filtered query failed:",s);try{const{data:n,error:l}=await t.from("profiles").select("full_name, email, role").eq("id",e.id).single();if(l){console.error("❌ Fallback profile query failed:",l),r(e,null);return}if(o=n,console.log("✅ Fallback profile loaded:",o),o.role&&o.role.toLowerCase().trim()!=="menu_operator"){console.log("❌ User does not have menu_operator role. Role:",o.role),r(e,null);return}}catch(n){console.error("❌ Fallback query failed:",n),r(e,null);return}}if(o){if(o.role&&o.role.toLowerCase().trim()!=="menu_operator"){console.log("❌ User does not have menu_operator role. Role:",o.role),r(e,null);return}console.log("✅ User info loaded successfully:",o),r(e,o)}else console.log("⚠️ No profile found, using fallback data"),r(e,null)}catch(t){console.error("❌ Error loading user info:",t),r(null,null)}}function r(t,e){try{if(console.log("🔄 Updating user display...",{user:t?.email,profile:e?.full_name}),!t){let n=null;try{const u=sessionStorage.getItem("simple-auth-session");if(u){const c=JSON.parse(u);c.user&&c.access_token&&c.user.email?(n=c.user,console.log("✅ Found authenticated user in sessionStorage:",n.email)):console.log("❌ Invalid session data - missing user, token, or email")}}catch(u){console.log("⚠️ Error reading sessionStorage:",u)}if(!n){console.log("❌ No authenticated user found - redirecting to login"),window.location.href="/login";return}if(n){const u=n.full_name||n.name||n.email,c=document.getElementById("user-name");c&&(c.textContent=u);const p=document.getElementById("menu-operator-avatar");if(p)if(n.full_name||n.name){const d=(n.full_name||n.name).trim().split(" ");let y="";d.length>=2?y=(d[0][0]+d[d.length-1][0]).toUpperCase():d.length===1&&(y=d[0].substring(0,2).toUpperCase()),p.textContent=y}else{const E=n.email.substring(0,2).toUpperCase();p.textContent=E}console.log("✅ Fallback user display updated with cached data");return}const l=document.getElementById("user-name");l&&(l.textContent="Menu Operator");const i=document.getElementById("menu-operator-avatar");i&&(i.textContent="MO"),console.log("✅ Ultimate fallback user display updated");return}const a=e&&e.full_name||t.email,o=document.getElementById("user-name");o&&(o.textContent=a);const s=document.getElementById("menu-operator-avatar");if(s)if(e&&e.full_name){const n=e.full_name.trim().split(" ");let l="";n.length>=2?l=(n[0][0]+n[n.length-1][0]).toUpperCase():n.length===1&&(l=n[0].substring(0,2).toUpperCase()),s.textContent=l}else if(t.email){const n=t.email.substring(0,2).toUpperCase();s.textContent=n}else s.textContent="MO";console.log("✅ User display updated successfully"),console.log("🔍 Final avatar text:",s?s.textContent:"avatar not found"),console.log("🔍 Final name text:",o?o.textContent:"name not found")}catch(a){console.error("❌ Error updating user display:",a);const o=document.getElementById("user-name");o&&(o.textContent="Menu Operator");const s=document.getElementById("menu-operator-avatar");s&&(s.textContent="MO")}}function C(){console.log("🔧 Setting up event listeners...");function t(){const o=document.getElementById("logout-btn");console.log("🔍 Looking for logout button:",o),o?(console.log("✅ Logout button found, attaching event listener"),o.removeEventListener("click",e),o.addEventListener("click",e),console.log("✅ Logout event listener attached")):(console.log("❌ Logout button not found, retrying..."),setTimeout(t,100))}async function e(o){if(o.preventDefault(),o.stopPropagation(),console.log("🚪 Logout button clicked!"),confirm("Are you sure you want to logout?"))try{if(console.log("🚪 Logging out from Menu Operator Dashboard..."),sessionStorage.removeItem("simple-auth-session"),sessionStorage.removeItem("simple-auth-user"),sessionStorage.clear(),localStorage.removeItem("simple-auth-user"),localStorage.removeItem("simple-auth-session"),localStorage.clear(),window.supabase)try{await window.supabase.auth.signOut(),console.log("✅ Supabase sign out successful")}catch(l){console.log("⚠️ Supabase sign out error (continuing anyway):",l)}const s=document.getElementById("user-name"),n=document.getElementById("menu-operator-avatar");s&&(s.textContent="Signing out..."),n&&(n.textContent="..."),setTimeout(()=>{window.location.href="/login",console.log("✅ Redirected to login page")},500)}catch(s){console.error("❌ Error during logout:",s),window.location.href="/login"}}t(),setTimeout(t,500),setTimeout(t,1e3),document.querySelectorAll('a[href="/"]').forEach(o=>{o.addEventListener("click",s=>{console.log('🔄 Menu Operator clicked "Back to Site" - preparing to show user navbar'),document.body.classList.remove("menu-operator-panel-active"),document.documentElement.classList.remove("menu-operator-panel-active"),setTimeout(()=>{window.showUserNavbar&&(window.showUserNavbar(),console.log("✅ User navbar shown after delay"))},50)})})}(function(){if(document.body)document.body.classList.add("menu-operator-panel-active");else{const e=new MutationObserver(function(a){a.forEach(function(o){o.type==="childList"&&document.body&&(document.body.classList.add("menu-operator-panel-active"),e.disconnect())})});e.observe(document.documentElement,{childList:!0})}const t=()=>{const e=document.querySelector("header"),a=document.querySelector("footer");e&&(e.style.display="none",e.style.visibility="hidden",e.style.opacity="0",e.style.height="0",e.style.maxHeight="0",e.style.overflow="hidden",e.style.position="absolute",e.style.top="-9999px",e.style.left="-9999px",e.style.zIndex="-9999",e.style.pointerEvents="none",e.style.transform="translateY(-100vh)"),a&&(a.style.display="none",a.style.visibility="hidden",a.style.opacity="0",a.style.height="0",a.style.maxHeight="0",a.style.overflow="hidden",a.style.position="absolute",a.style.top="-9999px",a.style.left="-9999px",a.style.zIndex="-9999",a.style.pointerEvents="none",a.style.transform="translateY(-100vh)")};t(),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t()})();(function(){document.documentElement.classList.add("menu-operator-panel-active"),document.body.classList.add("menu-operator-panel-active");function t(){const e=document.querySelector("header");e&&(e.style.display="none",e.style.visibility="hidden",e.style.opacity="0",e.style.height="0",e.style.maxHeight="0",e.style.overflow="hidden",e.style.position="absolute",e.style.top="-9999px",e.style.left="-9999px",e.style.zIndex="-9999",e.style.pointerEvents="none",e.style.transform="translateY(-100vh)",e.style.transition="none",e.style.animation="none")}t(),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t(),window.addEventListener("load",t),window.addEventListener("popstate",t),setInterval(t,100)})();const h={ASSETS_PREFIX:void 0,BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SITE:void 0,SSR:!1};var v={};const I={url:"https://lmrrdcaavwwletcjcpqv.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ"},S=t=>typeof import.meta<"u"&&h&&h[t]?h[t]:typeof process<"u"&&v&&v[t]?v[t]:typeof window<"u"&&window.__ENV__&&window.__ENV__[t]?window.__ENV__[t]:"",O=S("VITE_SUPABASE_URL")||I.url,_=S("VITE_SUPABASE_ANON_KEY")||I.anonKey,M=b(O,_);async function U(){try{console.log("🔍 MenuOperatorGuard - Checking access...");const t=sessionStorage.getItem("simple-auth-session");if(!t)return console.log("❌ No session data found - redirecting to login"),window.location.href="/login",!1;let e;try{e=JSON.parse(t)}catch{return console.log("❌ Invalid session data - redirecting to login"),window.location.href="/login",!1}if(!e.user||!e.user.email)return console.log("❌ No user data in session - redirecting to login"),window.location.href="/login",!1;if(console.log("✅ Session found for user:",e.user.email),e.user.role==="menu_operator"||e.user.role==="menu operator")return console.log("✅ Menu operator role found in session"),!0;console.log("⚠️ No role in session, checking Supabase...");const{data:a,error:o}=await M.from("profiles").select("role, status").eq("id",e.user.id).single();return o||!a?(console.log("❌ No profile found in Supabase"),f("You need menu operator role to access this page. Please contact support to assign the role."),!1):(console.log("🔍 MenuOperatorGuard - Profile loaded:",a),console.log("🔍 MenuOperatorGuard - Role value:",JSON.stringify(a.role)),a.status&&a.status!=="active"?(f("Your menu operator access is currently inactive."),!1):!a.role||a.role.toLowerCase().trim()!=="menu_operator"?(f("You need menu operator role to access this page. Current role: "+a.role),!1):(e.user.role=a.role,sessionStorage.setItem("simple-auth-session",JSON.stringify(e)),console.log("✅ Updated session with role information"),!0))}catch(t){return console.error("Error checking menu operator access:",t),f("Error verifying your access. Please try again."),!1}}function f(t){document.body.innerHTML=`
      <div class="min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8">
        <div class="sm:mx-auto sm:w-full sm:max-w-md">
          <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
            <div class="text-center">
              <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
                <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
              </div>
              <h2 class="mt-6 text-3xl font-extrabold text-gray-900">Access Denied</h2>
              <p class="mt-2 text-sm text-gray-600">${t}</p>
              <div class="mt-6">
                <a href="/dashboard" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                  Go to Dashboard
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    `}document.addEventListener("DOMContentLoaded",async()=>{await U()});
