const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/supabase.C3b_eKiV.js","_astro/index.BymsOcZI.js","_astro/preload-helper.CLcXU_4U.js"])))=>i.map(i=>d[i]);
import{_ as b}from"./preload-helper.CLcXU_4U.js";import"./Toast.astro_astro_type_script_index_0_lang.FM9xDykS.js";import"https://unpkg.com/@supabase/supabase-js@2";import"./AuthGuard.astro_astro_type_script_index_0_lang.D4Znhmp3.js";console.log("Dashboard loaded - using global auth manager");async function w(e){try{console.log("🔍 Fetching user profile from Supabase for user:",e);const{supabase:a}=await b(async()=>{const{supabase:o}=await import("./supabase.C3b_eKiV.js");return{supabase:o}},__vite__mapDeps([0,1,2])),{data:n,error:u}=await a.from("profiles").select("*").eq("id",e).single();return u?(console.error("Error fetching user profile:",u),null):(console.log("✅ User profile fetched from Supabase:",n),n)}catch(a){return console.error("Error in fetchUserProfile:",a),null}}async function g(){console.log("🔄 Updating user info...");let e=null,a="";const n=[{key:"simple-auth-session",storage:sessionStorage,path:"user"},{key:"simple-auth-user",storage:localStorage,path:null},{key:"simple-auth-session",storage:localStorage,path:"user"}];for(const o of n)try{const l=o.storage.getItem(o.key);if(l){const i=JSON.parse(l);if(e=o.path?i[o.path]:i,e&&e.email){a=o.key,console.log(`✅ Found user data in ${o.key}:`,e.email);break}}}catch(l){console.log(`Error reading ${o.key}:`,l)}if(!e){console.log("No stored user data found, checking URL...");const o=new URLSearchParams(window.location.search),l=o.get("email")||"user@example.com",i=o.get("name")||"User";e={email:l,full_name:i,phone:"Not set",company_name:"Not set"},a="URL parameters",console.log("Using fallback data:",e)}if(e){if(e.user_metadata&&(e.full_name=e.user_metadata.full_name||e.full_name,e.phone=e.user_metadata.phone||e.phone,e.company_name=e.user_metadata.company_name||e.company_name),e.id&&(!e.full_name||e.full_name==="User"||!e.phone||e.phone==="Not set")){console.log("🔄 Incomplete user data, fetching from Supabase...");try{const o=await w(e.id);o&&(e={...e,...o,email:e.email||o.email},console.log("✅ Enhanced user data with profile:",e))}catch(o){console.log("Error fetching profile data:",o)}}e.full_name=e.full_name||e.fullName||"User",e.phone=e.phone||"Not set",e.company_name=e.company_name||e.companyName||"Not set",e.email=e.email||"user@example.com",console.log("📋 Final normalized user data:",e)}const u=document.getElementById("user-welcome");if(u){const o=e.full_name||e.fullName||e.email?.split("@")[0]||"User";u.textContent=o,console.log("👋 Welcome message updated to:",o)}console.log(`✅ Dashboard updated successfully from ${a}`),setTimeout(()=>{console.log("🔄 Force update welcome message...");const o=document.getElementById("user-welcome");if(o){const l=e.full_name||e.fullName||e.email?.split("@")[0]||"User";o.textContent=l,console.log("Force updated welcome to:",o.textContent)}},100)}function E(){const e=new URLSearchParams(window.location.search),a=e.get("product"),n=e.get("price");if(console.log("🔍 Checking for product selection:",{productId:a,price:n}),a&&n){console.log("✅ Product selected, showing customization form");const o=[{id:"1",name:"Restaurant Menu System",description:"Digital menu system with QR code integration, online ordering, and real-time updates. Perfect for restaurants looking to modernize their customer experience.",price:25e3,type:"restaurant"},{id:"2",name:"Android TV App",description:"Custom Android TV applications with beautiful UI, content management, and remote control support. Perfect for streaming services and media companies.",price:55e3,type:"non-restaurant"},{id:"3",name:"Streaming Mobile App",description:"Mobile streaming applications for iOS and Android with custom features, user authentication, and content management.",price:35e3,type:"non-restaurant"},{id:"4",name:"Restaurant Website",description:"Professional restaurant website with online ordering, menu display, and customer management features.",price:2e4,type:"restaurant"},{id:"5",name:"Order Menu System",description:"Complete order management system with digital menu integration, real-time order tracking, and payment processing. Perfect for restaurants looking to streamline their ordering process.",price:25e3,type:"order-menu"}].find(l=>l.id===a);if(o){const l=document.getElementById("product-customization-form"),i=document.getElementById("order-menu-customization-form"),d=document.getElementById("recent-activity");l&&!l.classList.contains("hidden")&&(l.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",l.style.opacity="0",l.style.transform="translateY(-10px)",setTimeout(()=>l.classList.add("hidden"),300)),i&&!i.classList.contains("hidden")&&(i.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",i.style.opacity="0",i.style.transform="translateY(-10px)",setTimeout(()=>i.classList.add("hidden"),300)),d&&!d.classList.contains("hidden")&&(d.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",d.style.opacity="0",d.style.transform="translateY(-10px)",setTimeout(()=>d.classList.add("hidden"),300)),setTimeout(()=>{if(o.type==="order-menu"){document.getElementById("order-menu-product-name").textContent=o.name,document.getElementById("order-menu-product-description").textContent=o.description,document.getElementById("order-menu-product-price").textContent=`₹${parseInt(n).toLocaleString()}`;const t=document.getElementById("order-menu-customization-form");t.classList.remove("hidden"),t.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",t.style.opacity="0",t.style.transform="translateY(10px)",setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0)"},50)}else{document.getElementById("selected-product-name").textContent=o.name,document.getElementById("selected-product-description").textContent=o.description,document.getElementById("selected-product-price").textContent=`₹${parseInt(n).toLocaleString()}`;const t=document.getElementById("cuisine-type-field"),r=document.getElementById("restaurant-name-field");o.type==="restaurant"?(t.classList.remove("hidden"),t.querySelector("select").required=!0,r.classList.remove("hidden"),r.querySelector("input").required=!0):(t.classList.add("hidden"),t.querySelector("select").required=!1,r.classList.add("hidden"),r.querySelector("input").required=!1);const s=document.getElementById("product-customization-form");s.classList.remove("hidden"),s.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",s.style.opacity="0",s.style.transform="translateY(10px)",setTimeout(()=>{s.style.opacity="1",s.style.transform="translateY(0)"},50)}},350),setTimeout(()=>f(),500)}}}function I(){const e=document.getElementById("order-menu-form"),a=document.getElementById("close-order-menu-form"),n=document.getElementById("cancel-order-menu"),u=document.getElementById("order-menu-logo-upload"),o=document.querySelector("#order-menu-customization-form .border-dashed"),l=document.getElementById("add-menu-item"),i=document.getElementById("menu-items-container");o?.addEventListener("click",()=>{u?.click()}),u?.addEventListener("change",r=>{const s=r.target.files[0];if(s){const c=s.name,p=(s.size/1024/1024).toFixed(2);o.innerHTML=`
          <div class="flex flex-col items-center">
            <svg class="w-12 h-12 text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <p class="text-green-600 mb-1 font-medium">Logo uploaded successfully</p>
            <p class="text-sm text-gray-500">${c} (${p} MB)</p>
          </div>
        `}});function d(){const r=e?.querySelectorAll('input[type="color"]'),s=e?.querySelectorAll('input[name$="ColorText"]');r?.forEach((c,p)=>{const m=s?.[p];m&&(c.addEventListener("input",()=>{m.value=c.value}),m.addEventListener("input",()=>{/^#[0-9A-F]{6}$/i.test(m.value)&&(c.value=m.value)}))})}d();let t=1;l?.addEventListener("click",()=>{const r=document.createElement("div");r.className="menu-item-row grid grid-cols-1 md:grid-cols-4 gap-4 mb-4 p-4 border border-gray-200 rounded-lg",r.innerHTML=`
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Item Name</label>
          <input type="text" name="menuItems[${t}][item_name]" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500" placeholder="e.g., Margherita Pizza" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Price (₹)</label>
          <input type="number" name="menuItems[${t}][price]" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500" placeholder="299" step="0.01" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
          <select name="menuItems[${t}][item_category]" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500" required>
            <option value="">Select Category</option>
            <option value="appetizers">Appetizers</option>
            <option value="main-course">Main Course</option>
            <option value="desserts">Desserts</option>
            <option value="beverages">Beverages</option>
            <option value="sides">Sides</option>
          </select>
        </div>
        <div class="flex items-end">
          <button type="button" class="remove-menu-item px-3 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 text-sm">
            Remove
          </button>
        </div>
      `,i?.appendChild(r),t++}),i?.addEventListener("click",r=>{r.target.classList.contains("remove-menu-item")&&r.target.closest(".menu-item-row").remove()}),a?.addEventListener("click",()=>{h(),window.history.replaceState({},document.title,window.location.pathname)}),n?.addEventListener("click",()=>{h(),window.history.replaceState({},document.title,window.location.pathname)}),e?.addEventListener("submit",async r=>{r.preventDefault();const s=new FormData(e),c=Object.fromEntries(s);console.log("📝 Order Menu requirements saved:",c);const p={productId:"5",productName:"Order Menu System",productDescription:"Complete order management system with digital menu integration, real-time order tracking, and payment processing. Perfect for restaurants looking to streamline their ordering process.",productPrice:"₹25,000",projectName:c.projectName,restaurantName:c.restaurantName,ownerName:c.ownerName,restaurantAddress:c.restaurantAddress,contactPerson:c.contactPerson,email:c.email,phone:c.phone,additionalRequirements:c.additionalRequirements,restaurantLogo:c.restaurantLogo,primaryColor:c.primaryColor,secondaryColor:c.secondaryColor,accentColor:c.accentColor,textColor:c.textColor,menuItems:Array.from(document.querySelectorAll(".menu-item-row")).map((m,y)=>({item_name:m.querySelector(`input[name="menuItems[${y}][item_name]"]`)?.value||"",price:m.querySelector(`input[name="menuItems[${y}][price]"]`)?.value||"",item_category:m.querySelector(`select[name="menuItems[${y}][item_category]"]`)?.value||""})).filter(m=>m.item_name),timestamp:new Date().toISOString()};try{const m=JSON.parse(localStorage.getItem("order-menu-requirements")||"[]");m.push(p),localStorage.setItem("order-menu-requirements",JSON.stringify(m)),alert("Order Menu requirements saved successfully! Our team will contact you soon."),window.history.replaceState({},document.title,window.location.pathname),h(),e.reset()}catch(m){console.error("Error saving order menu requirements:",m),alert("Error saving order menu requirements. Please try again.")}})}function x(){const e=document.getElementById("customization-form"),a=document.getElementById("close-customization-form"),n=document.getElementById("cancel-customization"),u=document.getElementById("restaurant-logo-upload"),o=document.querySelector("#product-customization-form .border-dashed");o?.addEventListener("click",()=>{u?.click()}),u?.addEventListener("change",i=>{const d=i.target.files[0];if(d){const t=d.name,r=(d.size/1024/1024).toFixed(2);o.innerHTML=`
          <div class="flex flex-col items-center">
            <svg class="w-12 h-12 text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <p class="text-green-600 mb-1 font-medium">Logo uploaded successfully</p>
            <p class="text-sm text-gray-500">${t} (${r} MB)</p>
          </div>
        `}});function l(){const i=e?.querySelectorAll('input[type="color"]'),d=e?.querySelectorAll('input[name$="ColorText"]');i?.forEach((t,r)=>{const s=d?.[r];s&&(t.addEventListener("input",()=>{s.value=t.value}),s.addEventListener("input",()=>{/^#[0-9A-F]{6}$/i.test(s.value)&&(t.value=s.value)}))})}l(),a?.addEventListener("click",()=>{h(),window.history.replaceState({},document.title,window.location.pathname)}),n?.addEventListener("click",()=>{h(),window.history.replaceState({},document.title,window.location.pathname)}),e?.addEventListener("submit",async i=>{i.preventDefault();const d=new FormData(e),t=Object.fromEntries(d);console.log("📝 Project requirements saved:",t);const r=document.getElementById("selected-product-name").textContent,s=document.getElementById("selected-product-price").textContent,c={productId:new URLSearchParams(window.location.search).get("product")||"1",productName:r,productDescription:document.getElementById("selected-product-description").textContent,productPrice:s,projectName:t.projectName,appName:t.appName,contactPerson:t.contactPerson,productDescriptionCustom:t.productDescription,email:t.email,phone:t.phone,additionalRequirements:t.additionalRequirements,restaurantLogo:t.restaurantLogo,primaryColor:t.primaryColor,secondaryColor:t.secondaryColor,accentColor:t.accentColor,textColor:t.textColor,timestamp:new Date().toISOString()},p=new URLSearchParams(window.location.search).get("product")||"1";["3","4"].includes(p)&&(c.restaurantName=t.restaurantName,c.cuisineType=t.cuisineType);try{const y=JSON.parse(localStorage.getItem("project-requirements")||"[]");y.push(c),localStorage.setItem("project-requirements",JSON.stringify(y)),alert("Project requirements saved successfully! Our team will contact you soon."),window.history.replaceState({},document.title,window.location.pathname),h(),e.reset(),o&&(o.innerHTML=`
            <div class="flex flex-col items-center">
              <svg class="w-12 h-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              <p class="text-gray-600 mb-2">Click to upload restaurant logo</p>
              <p class="text-sm text-gray-500">PNG, JPG, SVG up to 10MB</p>
            </div>
          `)}catch(y){console.error("Error saving requirements:",y),alert("Error saving project requirements. Please try again.")}})}function h(){const e=document.getElementById("product-customization-form"),a=document.getElementById("order-menu-customization-form"),n=document.getElementById("recent-activity");e&&!e.classList.contains("hidden")&&(e.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",e.style.opacity="0",e.style.transform="translateY(-10px)",setTimeout(()=>e.classList.add("hidden"),300)),a&&!a.classList.contains("hidden")&&(a.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",a.style.opacity="0",a.style.transform="translateY(-10px)",setTimeout(()=>a.classList.add("hidden"),300)),setTimeout(()=>{n&&(n.style.display="block",n.classList.remove("hidden"),n.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",n.style.opacity="0",n.style.transform="translateY(10px)",setTimeout(()=>{n.style.opacity="1",n.style.transform="translateY(0)"},50))},350)}function f(){console.log("🔄 Attempting to auto-fill user details...");const e=()=>{const a=window.globalAuthManager||window.simpleAuthManager;if(a&&a.isUserLoggedIn()){const n=a.getCurrentUser();return console.log("👤 Current user from auth manager:",n),n&&n.email&&(console.log("📧 Auto-filling email:",n.email),document.querySelectorAll('input[name="email"], input[type="email"]').forEach(o=>{o.value=n.email,o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Filled email field:",o)})),n&&n.phone&&(console.log("📱 Auto-filling phone:",n.phone),document.querySelectorAll('input[name="phone"], input[type="tel"]').forEach(o=>{o.value=n.phone,o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Filled phone field:",o)})),n&&n.full_name&&(console.log("👤 Auto-filling contact person:",n.full_name),document.querySelectorAll('input[name="contactPerson"]').forEach(o=>{o.value=n.full_name,o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0})),console.log("✅ Filled contact person field:",o)})),console.log("✅ Auto-fill completed with auth manager data"),!0}return!1};if(!e()){let a=0;const n=50,u=setInterval(()=>{if(a++,(e()||a>=n)&&(clearInterval(u),a>=n)){console.log("⏰ Auth manager timeout, trying fallback methods...");const o=sessionStorage.getItem("simple-auth-session");if(o)try{const i=JSON.parse(o).user;i&&i.email&&document.querySelectorAll('input[name="email"], input[type="email"]').forEach(t=>{t.value=i.email,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0}))}),i&&i.phone&&document.querySelectorAll('input[name="phone"], input[type="tel"]').forEach(t=>{t.value=i.phone,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0}))}),i&&i.full_name&&document.querySelectorAll('input[name="contactPerson"]').forEach(t=>{t.value=i.full_name,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0}))}),console.log("✅ Auto-fill completed with session storage fallback")}catch(l){console.error("❌ Error parsing session data:",l)}}},100)}}document.addEventListener("DOMContentLoaded",()=>{console.log("Dashboard DOM loaded - initializing with global auth manager");const e=new URLSearchParams(window.location.search),a=e.get("product"),n=e.get("price"),u=document.getElementById("recent-activity");if(!a||!n?u&&(u.style.display="block",console.log("✅ Showing browse products section - no product selected")):u&&(u.style.display="none",console.log("✅ Hiding browse products section - product selected")),document.body.style.transition="opacity 0.3s ease-in-out",document.body.style.opacity="0",setTimeout(()=>{document.body.style.opacity="1"},50),a&&n){const t=[{id:"1",name:"Restaurant Menu System",description:"Digital menu system with QR code integration, online ordering, and real-time updates. Perfect for restaurants looking to modernize their customer experience.",price:25e3,type:"restaurant"},{id:"2",name:"Android TV App",description:"Custom Android TV applications with beautiful UI, content management, and remote control support. Perfect for streaming services and media companies.",price:55e3,type:"non-restaurant"},{id:"3",name:"Streaming Mobile App",description:"Mobile streaming applications for iOS and Android with custom features, user authentication, and content management.",price:35e3,type:"non-restaurant"},{id:"4",name:"Restaurant Website",description:"Professional restaurant website with online ordering, menu display, and customer management features.",price:2e4,type:"restaurant"},{id:"5",name:"Order Menu System",description:"Complete order management system with digital menu integration, real-time order tracking, and payment processing. Perfect for restaurants looking to streamline their ordering process.",price:25e3,type:"order-menu"}].find(r=>r.id===a);if(t){document.getElementById("selected-product-name").textContent=t.name,document.getElementById("selected-product-description").textContent=t.description,document.getElementById("selected-product-price").textContent=`₹${t.price.toLocaleString()}`,document.getElementById("order-menu-product-name").textContent=t.name,document.getElementById("order-menu-product-description").textContent=t.description,document.getElementById("order-menu-product-price").textContent=`₹${t.price.toLocaleString()}`;const r=document.getElementById("recent-activity"),s=document.getElementById("product-customization-form"),c=document.getElementById("order-menu-customization-form");r&&(r.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",r.style.opacity="0",r.style.transform="translateY(-10px)",setTimeout(()=>{r.classList.add("hidden")},300)),setTimeout(()=>{if(t.type==="order-menu")c&&(c.classList.remove("hidden"),c.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",c.style.opacity="0",c.style.transform="translateY(10px)",setTimeout(()=>{c.style.opacity="1",c.style.transform="translateY(0)"},50));else{s&&(s.classList.remove("hidden"),s.style.transition="opacity 0.3s ease-in-out, transform 0.3s ease-in-out",s.style.opacity="0",s.style.transform="translateY(10px)",setTimeout(()=>{s.style.opacity="1",s.style.transform="translateY(0)"},50));const p=document.getElementById("cuisine-type-field"),m=document.getElementById("restaurant-name-field");t.type==="restaurant"?(p.classList.remove("hidden"),p.querySelector("select").setAttribute("required","required"),m.classList.remove("hidden"),m.querySelector("input").setAttribute("required","required")):(p.classList.add("hidden"),p.querySelector("select").removeAttribute("required"),m.classList.add("hidden"),m.querySelector("input").removeAttribute("required"))}},300),setTimeout(()=>f(),500)}}E(),x(),I(),f(),setTimeout(()=>f(),1e3),setTimeout(()=>f(),2e3);const o=new MutationObserver(d=>{d.forEach(t=>{if(t.type==="attributes"&&t.attributeName==="class"){const r=t.target;(r.id==="product-customization-form"||r.id==="order-menu-customization-form")&&(r.classList.contains("hidden")||(console.log("👁️ Form became visible, auto-filling..."),setTimeout(()=>f(),100)))}})}),l=document.getElementById("product-customization-form"),i=document.getElementById("order-menu-customization-form");l&&o.observe(l,{attributes:!0,attributeFilter:["class"]}),i&&o.observe(i,{attributes:!0,attributeFilter:["class"]}),g(),setTimeout(()=>g(),100),setTimeout(()=>g(),500),setTimeout(()=>g(),1e3),setTimeout(()=>g(),2e3),setTimeout(()=>{const d=new URLSearchParams(window.location.search),t=d.get("product"),r=d.get("price"),s=document.getElementById("recent-activity");!t||!r?s&&(s.style.display="block",s.classList.remove("hidden"),console.log("✅ Browse products section confirmed visible - no product selected")):s&&(s.style.display="none",console.log("✅ Browse products section confirmed hidden - product selected"))},1e3)});window.addEventListener("load",()=>{console.log("Window loaded - trying again"),g()});let v=0;const S=5,L=setInterval(()=>{v++,console.log(`Attempt ${v} to load user data...`),g(),v>=S&&(clearInterval(L),console.log("Max attempts reached"))},2e3);window.addEventListener("user-logged-in",()=>{console.log("User logged in event received in dashboard"),g()});window.addEventListener("user-logged-out",()=>{console.log("User logged out event received in dashboard"),g()});console.log("✅ Dashboard script initialized with global auth manager");
