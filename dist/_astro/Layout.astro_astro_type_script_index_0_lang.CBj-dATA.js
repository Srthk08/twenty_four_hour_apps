class u{constructor(){this.isAuthenticated=!1,this.currentUser=null,this.isNavigating=!1,this.init()}init(){this.checkExistingSession(),window.addEventListener("user-logged-in",e=>{this.handleLogin(e.detail)}),window.addEventListener("user-logged-out",()=>{this.handleLogout()}),window.globalAuthManager=this,window.simpleAuthManager=this,console.log("âœ… Global Auth Manager initialized")}checkExistingSession(){try{const e=sessionStorage.getItem("simple-auth-session");if(e){const t=JSON.parse(e);if(t.user&&t.access_token){this.isAuthenticated=!0,this.currentUser=t.user,console.log("âœ… Existing session found:",this.currentUser.email),this.updateGlobalUI();return}}const n=localStorage.getItem("simple-auth-user");if(n){const t=JSON.parse(n);if(t&&t.email){this.isAuthenticated=!0,this.currentUser=t,console.log("âœ… Existing user found in localStorage:",this.currentUser.email),this.updateGlobalUI();return}}console.log("â„¹ï¸ No existing session found")}catch(e){console.error("Error checking existing session:",e)}}handleLogin(e){this.isAuthenticated=!0,this.currentUser=e;const n={user:e,access_token:"simple-token-"+Date.now(),timestamp:Date.now()};sessionStorage.setItem("simple-auth-session",JSON.stringify(n)),localStorage.setItem("simple-auth-user",JSON.stringify(e)),console.log("âœ… User logged in globally:",e.email),this.updateGlobalUI()}handleLogout(){this.isAuthenticated=!1,this.currentUser=null,sessionStorage.removeItem("simple-auth-session"),localStorage.removeItem("simple-auth-user"),sessionStorage.removeItem("has-visited-cart"),console.log("âœ… User logged out globally"),this.updateGlobalUI()}updateGlobalUI(){this.updateHeader(),this.updateDashboard(),this.updateOtherComponents()}updateHeader(){const e=document.getElementById("auth-buttons"),n=document.getElementById("user-menu"),t=document.getElementById("mobile-auth-buttons"),i=document.getElementById("mobile-user-menu"),o=document.getElementById("admin-panel-link"),a=document.getElementById("mobile-admin-panel-link");if(e&&e.classList.remove("hidden"),n&&n.classList.add("hidden"),t&&t.classList.remove("hidden"),i&&i.classList.add("hidden"),o&&o.classList.add("hidden"),a&&a.classList.add("hidden"),this.isAuthenticated&&this.currentUser){e&&e.classList.add("hidden"),n&&n.classList.remove("hidden"),t&&t.classList.add("hidden"),i&&i.classList.remove("hidden");const l=this.currentUser.role==="admin"||this.currentUser.role==="developer"||this.currentUser.role==="support";o&&l&&o.classList.remove("hidden"),a&&l&&a.classList.remove("hidden"),this.updateHeaderUserInfo()}}updateHeaderUserInfo(){if(!this.isAuthenticated||!this.currentUser||!this.currentUser.email){console.log("âŒ User not authenticated - clearing header info"),this.clearHeaderUserInfo();return}const e=document.getElementById("user-email"),n=document.getElementById("user-name"),t=document.getElementById("user-avatar"),i=document.getElementById("mobile-user-email");e&&(e.textContent=this.currentUser.email||""),n&&(n.textContent=this.currentUser.full_name||this.currentUser.email?.split("@")[0]||"User"),t&&(t.textContent=(this.currentUser.full_name||this.currentUser.email||"U").charAt(0).toUpperCase()),i&&(i.textContent=this.currentUser.email||"")}clearHeaderUserInfo(){const e=document.getElementById("user-email"),n=document.getElementById("user-name"),t=document.getElementById("user-avatar"),i=document.getElementById("mobile-user-email");e&&(e.textContent=""),n&&(n.textContent="Guest"),t&&(t.textContent="G"),i&&(i.textContent="")}updateDashboard(){const e=document.getElementById("user-welcome"),n=document.getElementById("user-full-name"),t=document.getElementById("user-email"),i=document.getElementById("user-phone"),o=document.getElementById("user-company");this.isAuthenticated&&this.currentUser&&this.currentUser.email?(e&&(e.textContent=this.currentUser.full_name||this.currentUser.email?.split("@")[0]||"User"),n&&(n.textContent=this.currentUser.full_name||"Not set"),t&&(t.textContent=this.currentUser.email||"Not set"),i&&(i.textContent=this.currentUser.phone||"Not set"),o&&(o.textContent=this.currentUser.company_name||"Not set")):(e&&(e.textContent="Guest"),n&&(n.textContent="Not logged in"),t&&(t.textContent="Not logged in"),i&&(i.textContent="Not logged in"),o&&(o.textContent="Not logged in"))}updateOtherComponents(){}getCurrentUser(){return this.currentUser}isUserLoggedIn(){return this.isAuthenticated}logout(){this.handleLogout(),window.location.href="/"}requireAuth(e="/login"){return this.isAuthenticated?!0:(console.log("ðŸ”’ Authentication required, redirecting to:",e),window.location.href=e,!1)}updateProfile(e){if(this.currentUser){this.currentUser={...this.currentUser,...e};const n=sessionStorage.getItem("simple-auth-session");if(n){const t=JSON.parse(n);t.user=this.currentUser,sessionStorage.setItem("simple-auth-session",JSON.stringify(t))}localStorage.setItem("simple-auth-user",JSON.stringify(this.currentUser)),console.log("âœ… Profile updated in global auth manager:",this.currentUser),this.updateGlobalUI()}}}window.hideUserNavbar=function(){if(window.location.pathname.startsWith("/admin")||window.location.pathname.startsWith("/menu-operator")){const s=document.querySelector("header:not(.menu-operator-header)");s&&(s.classList.add("admin-hidden"),console.log("âœ… User navbar hidden for admin/menu operator panel"))}};window.showUserNavbar=function(){if(!window.location.pathname.startsWith("/admin")&&!window.location.pathname.startsWith("/menu-operator")){const s=document.querySelector("header:not(.menu-operator-header)");s&&(s.classList.remove("admin-hidden"),s.removeAttribute("style"),console.log("âœ… User navbar shown"))}};function c(){const s=window.location.pathname;s.startsWith("/admin")?(document.body.classList.add("admin-panel-active"),window.hideUserNavbar()):s.startsWith("/menu-operator")?(document.body.classList.add("menu-operator-panel-active"),document.documentElement.classList.add("menu-operator-panel-active"),window.hideUserNavbar()):(document.body.classList.remove("admin-panel-active"),document.body.classList.remove("menu-operator-panel-active"),document.documentElement.classList.remove("admin-panel-active"),document.documentElement.classList.remove("menu-operator-panel-active"),window.showUserNavbar())}function r(){const s=window.location.pathname;!s.startsWith("/admin")&&!s.startsWith("/menu-operator")&&(document.documentElement.classList.remove("admin-panel-active"),document.documentElement.classList.remove("menu-operator-panel-active"),document.body.classList.remove("admin-panel-active"),document.body.classList.remove("menu-operator-panel-active"))}document.addEventListener("DOMContentLoaded",()=>{new u,c(),r()});window.addEventListener("popstate",r);window.addEventListener("beforeunload",r);document.addEventListener("click",function(s){const e=s.target.closest("a[href]");e&&e.href.includes("#")});window.addEventListener("load",function(){});function d(){const s=window.location.pathname;if(!s.startsWith("/admin")&&!s.startsWith("/menu-operator")){const e=document.querySelector("header:not(.menu-operator-header)");e&&(e.style.display="block",e.style.visibility="visible",e.style.opacity="1",e.style.height="auto",e.style.maxHeight="none",e.style.overflow="visible",e.style.position="static",e.style.top="auto",e.style.left="auto",e.style.zIndex="50",e.style.pointerEvents="auto",e.style.transform="none",e.style.transition="none",e.style.animation="none")}}d();document.addEventListener("DOMContentLoaded",d);
