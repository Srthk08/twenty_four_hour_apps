const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/supabase.B9-RI-CL.js","_astro/index.BymsOcZI.js","_astro/preload-helper.CLcXU_4U.js"])))=>i.map(i=>d[i]);
import{_ as l}from"./preload-helper.CLcXU_4U.js";import"./ProductDialog.astro_astro_type_script_index_0_lang.C1LHbjNP.js";import"https://unpkg.com/@supabase/supabase-js@2";import"./AuthGuard.astro_astro_type_script_index_0_lang.DULNhCHQ.js";class u{constructor(){this.orders=[],this.init()}init(){this.loadOrders().then(()=>this.renderOrders())}async loadOrders(){const t=localStorage.getItem("project-requirements"),o=localStorage.getItem("order-menu-requirements"),n=localStorage.getItem("user-orders");console.log("Loading orders from multiple sources..."),console.log("Project requirements:",t),console.log("Order menu requirements:",o),console.log("User orders:",n),this.orders=[];let r=window.globalAuthManager?.getCurrentUser()||window.simpleAuthManager?.getCurrentUser();if(console.log("Current user (app auth):",r),!r){console.log("No current user found");try{const{supabase:s}=await l(async()=>{const{supabase:d}=await import("./supabase.B9-RI-CL.js");return{supabase:d}},__vite__mapDeps([0,1,2])),{data:{user:e}}=await s.auth.getUser();e&&(r={email:e.email})}catch(s){console.warn("Supabase auth fallback failed:",s)}if(!r)return}const a=r?.email||null;if(!a){console.log("No user email available – cannot load orders");return}if(t)try{JSON.parse(t).forEach(e=>{this.orders.push({...e,orderId:`PROJ-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,orderDate:e.timestamp||new Date().toISOString(),total:this.extractPrice(e.productPrice)||0,projectName:e.productName||"Custom Project",description:e.productDescription||"Professional digital solution",requirements:e,status:"completed"})})}catch(s){console.error("Error parsing project requirements:",s)}if(o)try{JSON.parse(o).forEach(e=>{this.orders.push({...e,orderId:`MENU-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,orderDate:e.timestamp||new Date().toISOString(),total:this.extractPrice(e.productPrice)||0,projectName:e.productName||"Order Menu System",description:e.productDescription||"Complete order management system",requirements:e,status:"completed"})})}catch(s){console.error("Error parsing order menu requirements:",s)}if(n)try{const e=JSON.parse(n).filter(d=>d.userId===a);this.orders.push(...e)}catch(s){console.error("Error parsing user orders:",s)}try{await this.loadSupabaseOrders(a)}catch(s){console.warn("Failed to load Supabase orders:",s)}this.orders.sort((s,e)=>new Date(e.orderDate).getTime()-new Date(s.orderDate).getTime()),console.log("Total orders loaded:",this.orders.length)}async loadSupabaseOrders(t){try{const{supabase:o}=await l(async()=>{const{supabase:e}=await import("./supabase.B9-RI-CL.js");return{supabase:e}},__vite__mapDeps([0,1,2])),{data:n,error:r}=await o.from("order_customizations").select("*").eq("email",t).order("created_at",{ascending:!1});if(r)throw r;(n||[]).forEach(e=>{this.orders.push({orderId:e.id||`OC-${Date.now()}`,orderDate:e.created_at||new Date().toISOString(),total:Number(e.total_amount)||0,projectName:e.project_name||"Order Menu System",description:"Order Menu System customization",status:"completed",requirements:{projectName:e.project_name,contactPerson:e.contact_person,restaurantName:e.restaurant_name,cuisineType:e.cuisine_type,email:e.email,phone:e.phone_number,additionalRequirements:e.additional_requirements,primaryColor:e.primary_color,secondaryColor:e.secondary_color,accentColor:e.accent_color,textColor:e.text_color}})});const{data:a,error:s}=await o.from("cart_customizations").select("*").eq("user_email",t).eq("cart_status","completed").order("updated_at",{ascending:!1});if(s)throw s;(a||[]).forEach(e=>{this.orders.push({orderId:e.id||`CART-${Date.now()}`,orderDate:e.updated_at||e.created_at||new Date().toISOString(),total:Number(e.total_amount)||0,projectName:e.project_name||"Custom Project",description:e.project_description||"Project purchased",status:"completed",requirements:{projectName:e.project_name,contactPerson:e.contact_person,restaurantName:e.restaurant_name,cuisineType:e.cuisine_type,email:e.user_email,phone:e.phone_number,additionalRequirements:e.additional_requirements,primaryColor:e.primary_color,secondaryColor:e.secondary_color,accentColor:e.accent_color,textColor:e.text_color}})})}catch(o){throw console.error("Error loading Supabase orders:",o),o}}extractPrice(t){if(!t)return 0;const o=t.match(/₹?([\d,]+)/);return o?parseInt(o[1].replace(/,/g,"")):0}renderOrders(){const t=document.getElementById("loading-orders"),o=document.getElementById("empty-orders"),n=document.getElementById("orders-list");if(console.log("Rendering orders. Orders count:",this.orders.length),t?.classList.add("hidden"),this.orders.length===0){console.log("No orders found, showing empty state"),o?.classList.remove("hidden"),n?.classList.add("hidden"),document.getElementById("recent-activity")?.classList.add("hidden");return}console.log("Orders found, showing orders list"),o?.classList.add("hidden"),n?.classList.remove("hidden"),this.renderOrdersList(),this.renderRecentSummary()}renderOrdersList(){const t=document.getElementById("orders-list");t&&(t.innerHTML="",this.orders.forEach((o,n)=>{const r=this.createOrderElement(o,n);t.appendChild(r)}))}createOrderElement(t,o){const n=document.getElementById("order-template");if(!n)return document.createElement("div");const r=n.cloneNode(!0);r.classList.remove("hidden"),r.id=`order-${o}`,r.querySelector(".order-project-name").textContent=t.projectName||"Custom Project",r.querySelector(".order-project-description").textContent=t.description||"Professional digital solution",r.querySelector(".order-total").textContent=`₹${t.total?.toLocaleString()||"0"}`,r.querySelector(".order-date").textContent=this.formatDate(t.orderDate),r.querySelector(".order-id").textContent=t.orderId||`ORD-${Date.now()}`,r.querySelector(".order-custom-name").textContent=t.requirements?.projectName||"-",r.querySelector(".order-contact-person").textContent=t.requirements?.contactPerson||"-",r.querySelector(".order-restaurant-name").textContent=t.requirements?.restaurantName||"-",r.querySelector(".order-cuisine-type").textContent=t.requirements?.cuisineType||"-",r.querySelector(".order-email").textContent=t.requirements?.email||"-",r.querySelector(".order-phone").textContent=t.requirements?.phone||"-",t.requirements?.primaryColor&&(r.querySelector(".order-primary-color").style.backgroundColor=t.requirements.primaryColor),t.requirements?.secondaryColor&&(r.querySelector(".order-secondary-color").style.backgroundColor=t.requirements.secondaryColor),t.requirements?.accentColor&&(r.querySelector(".order-accent-color").style.backgroundColor=t.requirements.accentColor),t.requirements?.textColor&&(r.querySelector(".order-text-color").style.backgroundColor=t.requirements.textColor);const a=r.querySelector(".order-features");t.features&&t.features.length>0&&(a.innerHTML=t.features.map(d=>`<span class="inline-block bg-primary-100 text-primary-800 text-xs px-2 py-1 rounded-full mr-2 mb-1">${d}</span>`).join(""));const s=r.querySelector(".order-logo-status");t.logo&&(s.innerHTML='<span class="text-green-600">✓ Logo uploaded</span>');const e=r.querySelector(".order-additional-requirements");return t.requirements?.additionalRequirements&&(e.textContent=t.requirements.additionalRequirements),r}formatDate(t){return t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}renderRecentSummary(){const t=document.getElementById("recent-order-summary"),o=document.getElementById("recent-order-title"),n=document.getElementById("recent-order-amount"),r=document.getElementById("recent-order-date"),a=document.getElementById("recent-order-status"),s=document.getElementById("recent-order-view-btn");if(!t||!o||!n||!r||!a||!s)return;const e=this.orders.filter(c=>(c.status||"").toLowerCase()==="completed").sort((c,m)=>new Date(m.orderDate).getTime()-new Date(c.orderDate).getTime());if(e.length===0){t.classList.add("hidden");return}const d=e[0];t.classList.remove("hidden"),o.textContent=d.projectName||"Order",n.textContent=`₹${(d.total||0).toLocaleString("en-IN")}`,r.textContent=this.formatDate(d.orderDate),a.textContent=(d.status||"Completed").charAt(0).toUpperCase()+(d.status||"Completed").slice(1),s.onclick=()=>{this.showOrderDetails(d)}}showOrderDetails(t){const o=document.getElementById("order-details-modal");if(!o)return;const n=c=>document.getElementById(c);n("order-modal-title").textContent=t.projectName||"Order Details",n("order-modal-amount").textContent=`₹${(t.total||0).toLocaleString("en-IN")}`,n("order-modal-date").textContent=this.formatDate(t.orderDate),n("order-modal-id").textContent=t.orderId||"-",n("order-modal-desc").textContent=t.description||"-";const r=t.requirements||{};n("order-modal-contact").textContent=r.contactPerson||"-",n("order-modal-email").textContent=r.email||"-",n("order-modal-phone").textContent=r.phone||"-",n("order-modal-restaurant").textContent=r.restaurantName||"-",n("order-modal-cuisine").textContent=r.cuisineType||"-",n("order-modal-additional").textContent=r.additionalRequirements||"—",o.classList.remove("hidden");const a=()=>o.classList.add("hidden"),s=document.getElementById("order-modal-backdrop"),e=document.getElementById("order-modal-close"),d=document.getElementById("order-modal-close-bottom");s.onclick=a,e.onclick=a,d.onclick=a}}document.addEventListener("DOMContentLoaded",()=>{new u,new URLSearchParams(window.location.search).get("order")==="success"&&(p(),window.history.replaceState({},document.title,window.location.pathname))});function p(){const i=document.createElement("div");i.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300",i.innerHTML=`
      <div class="flex items-center space-x-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        <span>Order placed successfully! 🎉</span>
      </div>
    `,document.body.appendChild(i),setTimeout(()=>{i.remove()},5e3)}document.addEventListener("DOMContentLoaded",function(){const i=new URLSearchParams(window.location.search),t=i.get("order"),o=i.get("product");if(t==="success"){console.log("✅ Order success detected, redirecting to congratulations page..."),window.location.href="/order-success?product="+(o||"order-menu-system");return}});
