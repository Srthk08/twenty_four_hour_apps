document.querySelectorAll(".faq-button").forEach(o=>{o.addEventListener("click",()=>{const t=o.nextElementSibling,e=o.querySelector("svg");t.classList.toggle("hidden"),e.classList.toggle("rotate-180")})});window.redirectToCart=function(o,t){console.log("ðŸ›’ redirectToCart called with:",{productId:o,price:t});const e=window.globalAuthManager||window.simpleAuthManager,s=sessionStorage.getItem("simple-auth-session"),r=s&&s!=="null"&&s!=="{}",i=e&&e.isUserLoggedIn();let a=!1;if(r)try{const n=JSON.parse(s);a=n&&n.user&&n.access_token}catch(n){console.log("Session parse error:",n)}const c=i||a;if(console.log("ðŸ” Auth check:",{authManager:!!e,isLoggedInViaManager:i,hasValidSession:r,isLoggedInViaSession:a,isAuthenticated:c}),c){console.log("âœ… User authenticated, redirecting to dashboard");const n=`/dashboard?product=${o}&price=${t}`;console.log("ðŸ”— Redirecting to:",n),window.location.href=n}else{console.log("âŒ User not authenticated, redirecting to login");const n=`/login?redirect=/dashboard?product=${o}&price=${t}`;console.log("ðŸ”— Redirecting to:",n),window.location.href=n}};function d(){console.log("Checking authentication status...");const o=()=>{const t=window.globalAuthManager||window.simpleAuthManager;if(t)if(console.log("âœ… Auth manager found, checking status..."),t.isUserLoggedIn()){console.log("âœ… User is authenticated, hiding login prompt");const e=document.getElementById("login-prompt");e&&(e.classList.add("hidden"),console.log("Login prompt hidden"));const s=document.getElementById("add-to-cart-btn");s&&(s.classList.remove("hidden"),console.log("Add to cart button shown"))}else{console.log("âŒ User is not authenticated, showing login prompt");const e=document.getElementById("login-prompt");e&&(e.classList.remove("hidden"),console.log("Login prompt shown"));const s=document.getElementById("add-to-cart-btn");s&&(s.classList.add("hidden"),console.log("Add to cart button hidden"))}else console.log("â³ Auth manager not ready, retrying..."),setTimeout(o,100)};o()}document.addEventListener("DOMContentLoaded",d);document.addEventListener("DOMContentLoaded",function(){const o=window.location.pathname,t=o.split("/").pop();if(console.log("Product page loaded:",t),["restaurant-menu-system","android-tv-app","streaming-mobile-app","restaurant-website"].includes(t)){console.log("ðŸš« Blocked product detected - showing dialog, allowing page view"),document.body&&(document.body.style.opacity="1"),window.showProductDialog&&window.showProductDialog();return}if(window.location.pathname!==o)return;const r=window.globalAuthManager||window.simpleAuthManager,i=sessionStorage.getItem("simple-auth-session"),a=i&&i!=="null"&&i!=="{}";if(!(r&&r.isUserLoggedIn()&&a)){console.log("âŒ User not logged in - redirecting to login (authentication required)");const g=`/login?redirect=${encodeURIComponent(o)}`;document.body&&(document.body.style.transition="opacity 0.3s ease-out",document.body.style.opacity="0"),document.documentElement&&(document.documentElement.style.transition="opacity 0.3s ease-out",document.documentElement.style.opacity="0"),setTimeout(()=>{window.location.href=g},200);return}if(t==="order-menu-system"){console.log("âœ… Order Menu System - allowing access for logged-in user"),document.body&&(document.body.style.opacity="1"),document.documentElement&&(document.documentElement.style.opacity="1");return}const l=u();console.log("Is admin:",l),l?(console.log("Admin user - no restrictions"),document.body&&(document.body.style.opacity="1")):(console.log("Non-admin user - showing dialog"),document.body&&(document.body.style.opacity="1"),window.showProductDialog?window.showProductDialog():(console.log("Dialog not available - redirecting to contact"),window.location.href="/contact"))});function u(){try{if(window.globalAuthManager&&window.globalAuthManager.isUserLoggedIn()){const e=window.globalAuthManager.getCurrentUser();if(e&&e.role==="admin")return!0}if(window.simpleAuthManager&&window.simpleAuthManager.isUserLoggedIn()){const e=window.simpleAuthManager.getCurrentUser();if(e&&e.role==="admin")return!0}const o=sessionStorage.getItem("simple-auth-session");if(o)try{const e=JSON.parse(o);if(e.user&&e.user.role==="admin")return!0}catch(e){console.log("Session data parse error:",e)}const t=localStorage.getItem("simple-auth-session");if(t)try{const e=JSON.parse(t);if(e.user&&e.user.role==="admin")return!0}catch(e){console.log("Local session data parse error:",e)}return!1}catch(o){return console.error("Error checking admin status:",o),!1}}window.addEventListener("user-logged-in",o=>{console.log("âœ… User logged in event received, updating UI..."),d()});window.addEventListener("user-logged-out",()=>{console.log("âŒ User logged out event received, updating UI..."),d()});const m=new IntersectionObserver(o=>{o.forEach(t=>{t.isIntersecting&&t.target.classList.add("animate-fade-in")})});document.querySelectorAll(".animate-fade-in").forEach(o=>{m.observe(o)});document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".contact-us-btn").forEach(t=>{t.addEventListener("mouseenter",function(){this.style.color="#000000",this.style.backgroundColor="white"}),t.addEventListener("mouseleave",function(){this.style.color="white",this.style.backgroundColor="transparent"})})});
