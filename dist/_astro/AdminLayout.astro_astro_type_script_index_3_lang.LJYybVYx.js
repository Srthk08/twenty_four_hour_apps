const m="https://lmrrdcaavwwletcjcpqv.supabase.co",f="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ";let o=null;function r(){return new Promise(e=>{window.supabase?(o=window.supabase.createClient(m,f),e(o)):setTimeout(()=>r().then(e),100)})}async function s(){try{console.log("üîí AdminGuard: Checking admin access..."),o||await r();const{data:{user:e},error:t}=await o.auth.getUser();if(t){console.error("‚ùå AdminGuard: Error getting user:",t),a("Authentication error. Please login again.");return}if(!e){console.log("‚ùå AdminGuard: No user logged in"),a("Please login to access admin panel");return}console.log("‚úÖ AdminGuard: User found:",e.email);const{data:n,error:i}=await o.from("profiles").select("role").eq("id",e.id).single();if(i){console.error("‚ùå AdminGuard: Error getting profile:",i),a("Error checking user permissions");return}if(n.role!=="admin"){console.log("‚ùå AdminGuard: User does not have admin role. Role:",n.role),a("Access denied. Admin privileges required.");return}console.log("‚úÖ AdminGuard: Admin access granted for user:",e.email),c()}catch(e){console.error("‚ùå AdminGuard: Error checking admin access:",e),a("Error checking admin access. Please try again.")}}function a(e){const t=document.getElementById("admin-guard");t&&(t.innerHTML=`
          <div class="text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
              <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
              </svg>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">Access Denied</h3>
            <p class="text-gray-600 mb-6">${e}</p>
            <div class="space-x-3">
              <a href="/login" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                Go to Login
              </a>
              <a href="/" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                Back to Home
              </a>
            </div>
          </div>
        `)}function c(){const e=document.getElementById("admin-guard");if(e){e.style.display="none",e.style.visibility="hidden",e.style.opacity="0",e.style.height="0",e.style.overflow="hidden";const t=document.getElementById("admin-layout");t&&(t.classList.remove("hidden"),t.style.display="block",t.style.visibility="visible",t.style.opacity="1",g()),window.dispatchEvent(new CustomEvent("admin-access-granted"))}}async function g(){try{o||await r();const{data:{user:e}}=await o.auth.getUser();if(e){const{data:t}=await o.from("profiles").select("full_name").eq("id",e.id).single(),n=document.getElementById("admin-name");n&&(n.textContent=t?.full_name||e.user_metadata?.full_name||e.email||"Admin");const i=document.getElementById("admin-avatar");if(i){const u=t?.full_name||e.user_metadata?.full_name||e.email||"A";i.textContent=u.charAt(0).toUpperCase()}}}catch(e){console.warn("Could not update admin info:",e)}}async function y(){try{console.log("Admin signing out..."),o||await r(),await o.auth.signOut(),sessionStorage.clear(),localStorage.removeItem("supabase-auth-session"),window.location.href="/"}catch(e){console.error("Error during admin sign out:",e),window.location.href="/"}}window.handleAdminSignOut=y;document.addEventListener("DOMContentLoaded",s);window.addEventListener("auth-state-changed",s);document.readyState==="loading"?document.addEventListener("DOMContentLoaded",s):s();setTimeout(()=>{const e=document.getElementById("admin-guard");e&&e.style.display!=="none"&&(console.warn("‚ö†Ô∏è Admin access check timed out, showing content anyway"),c())},1e4);console.log("AdminLayout loaded successfully");function d(){console.log("üîß Fixing text visibility..."),document.querySelectorAll(".text-white, .text-light, .text-muted").forEach(n=>{(n.style.color==="white"||n.style.color==="#ffffff"||n.style.color==="#fff")&&(n.style.color="#1f2937",n.style.backgroundColor="#f8fafc",n.style.padding="2px 4px",n.style.borderRadius="4px")}),document.querySelectorAll("input, textarea, select").forEach(n=>{(n.style.color==="white"||n.style.color==="#ffffff")&&(n.style.color="#1f2937",n.style.backgroundColor="#ffffff",n.style.border="2px solid #d1d5db")}),console.log("‚úÖ Text visibility fixed!")}function l(){document.body.classList.add("admin-panel-active"),window.hideUserNavbar&&window.hideUserNavbar(),document.addEventListener("click",function(e){const t=e.target.closest('a[href="/"]');t&&t.textContent.includes("Back to Site")&&(console.log('üîÑ Admin clicked "Back to Site" - preparing to show user navbar'),document.body.classList.remove("admin-panel-active"),setTimeout(()=>{window.showUserNavbar&&(window.showUserNavbar(),console.log("‚úÖ User navbar shown after delay"))},50))}),window.addEventListener("beforeunload",function(){window.location.pathname.startsWith("/admin")||(document.body.classList.remove("admin-panel-active"),window.showUserNavbar&&window.showUserNavbar())})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){d(),l()}):(d(),l());(function(){document.documentElement.classList.add("admin-panel-active"),document.body.classList.add("admin-panel-active");function e(){const t=document.querySelector("header");t&&(t.style.display="none",t.style.visibility="hidden",t.style.opacity="0",t.style.height="0",t.style.maxHeight="0",t.style.overflow="hidden",t.style.position="absolute",t.style.top="-9999px",t.style.left="-9999px",t.style.zIndex="-9999",t.style.pointerEvents="none",t.style.transform="translateY(-100vh)",t.style.transition="none",t.style.animation="none")}e(),document.readyState==="loading"&&document.addEventListener("DOMContentLoaded",e),setTimeout(e,0),setTimeout(e,10),setTimeout(e,50)})();
