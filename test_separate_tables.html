<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Separate Tables - OMS vs Other Products</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    </style>
</head>
<body>
    <h1>Test Separate Tables - OMS vs Other Products</h1>
    
    <div class="grid">
        <div class="test-section info">
            <h3>üîß OMS (Order Menu System) Tests</h3>
            <p>These should use the <code>oms_customizations</code> table</p>
            <button onclick="testOMSTable()">Check OMS Table</button>
            <button onclick="testOMSInsert()">Test OMS Insert</button>
            <button onclick="testOMSData()">Check OMS Data</button>
            <div id="oms-results"></div>
        </div>
        
        <div class="test-section info">
            <h3>üè¢ Other 4 Products Tests</h3>
            <p>These should use the <code>customization_forms</code> table</p>
            <button onclick="testOtherTable()">Check Other Table</button>
            <button onclick="testOtherInsert()">Test Other Insert</button>
            <button onclick="testOtherData()">Check Other Data</button>
            <div id="other-results"></div>
        </div>
    </div>
    
    <div class="test-section info">
        <h3>üìä Compare Both Tables</h3>
        <button onclick="compareTables()">Compare Table Data</button>
        <div id="compare-results"></div>
    </div>

    <script>
        // Initialize Supabase
        const supabaseUrl = 'https://lmrrdcaavwwletcjcpqv.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        // OMS Tests
        async function testOMSTable() {
            const resultDiv = document.getElementById('oms-results');
            try {
                const { data, error } = await supabase
                    .from('oms_customizations')
                    .select('id')
                    .limit(1);
                
                if (error) {
                    resultDiv.innerHTML = `<div class="error">‚ùå OMS table error: ${error.message}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="success">‚úÖ OMS table exists and accessible</div>`;
                }
            } catch (err) {
                resultDiv.innerHTML = `<div class="error">‚ùå OMS table error: ${err.message}</div>`;
            }
        }
        
        async function testOMSInsert() {
            const resultDiv = document.getElementById('oms-results');
            try {
                const { data, error } = await supabase.rpc('upsert_oms_customization', {
                    p_user_email: 'oms-test@example.com',
                    p_project_name: 'Test OMS Project',
                    p_restaurant_name: 'Test OMS Restaurant',
                    p_owner_name: 'Test OMS Owner',
                    p_restaurant_address: '123 OMS Test Street',
                    p_contact_person: 'Test OMS Contact',
                    p_phone_number: '+91 9999999999',
                    p_additional_requirements: 'Test OMS requirements'
                });
                
                if (error) {
                    resultDiv.innerHTML = `<div class="error">‚ùå OMS insert error: ${error.message}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="success">‚úÖ OMS insert successful! ID: ${data}</div>`;
                }
            } catch (err) {
                resultDiv.innerHTML = `<div class="error">‚ùå OMS insert error: ${err.message}</div>`;
            }
        }
        
        async function testOMSData() {
            const resultDiv = document.getElementById('oms-results');
            try {
                const { data, error } = await supabase
                    .from('oms_customizations')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(3);
                
                if (error) {
                    resultDiv.innerHTML = `<div class="error">‚ùå OMS data error: ${error.message}</div>`;
                } else {
                    resultDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ OMS data (${data.length} records):<br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (err) {
                resultDiv.innerHTML = `<div class="error">‚ùå OMS data error: ${err.message}</div>`;
            }
        }
        
        // Other Products Tests
        async function testOtherTable() {
            const resultDiv = document.getElementById('other-results');
            try {
                const { data, error } = await supabase
                    .from('customization_forms')
                    .select('id')
                    .limit(1);
                
                if (error) {
                    resultDiv.innerHTML = `<div class="error">‚ùå Other table error: ${error.message}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="success">‚úÖ Other products table exists and accessible</div>`;
                }
            } catch (err) {
                resultDiv.innerHTML = `<div class="error">‚ùå Other table error: ${err.message}</div>`;
            }
        }
        
        async function testOtherInsert() {
            const resultDiv = document.getElementById('other-results');
            try {
                const { data, error } = await supabase
                    .from('customization_forms')
                    .insert({
                        product_type: 'restaurant-website',
                        product_name: 'Restaurant Website',
                        product_price: '‚Çπ5000',
                        project_name: 'Test Other Project',
                        contact_person: 'Test Other Contact',
                        contact_email: 'other-test@example.com',
                        contact_phone: '+91 8888888888',
                        additional_requirements: 'Test other requirements',
                        status: 'pending'
                    })
                    .select()
                    .single();
                
                if (error) {
                    resultDiv.innerHTML = `<div class="error">‚ùå Other insert error: ${error.message}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="success">‚úÖ Other insert successful! ID: ${data.id}</div>`;
                }
            } catch (err) {
                resultDiv.innerHTML = `<div class="error">‚ùå Other insert error: ${err.message}</div>`;
            }
        }
        
        async function testOtherData() {
            const resultDiv = document.getElementById('other-results');
            try {
                const { data, error } = await supabase
                    .from('customization_forms')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(3);
                
                if (error) {
                    resultDiv.innerHTML = `<div class="error">‚ùå Other data error: ${error.message}</div>`;
                } else {
                    resultDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ Other data (${data.length} records):<br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (err) {
                resultDiv.innerHTML = `<div class="error">‚ùå Other data error: ${err.message}</div>`;
            }
        }
        
        // Compare Tables
        async function compareTables() {
            const resultDiv = document.getElementById('compare-results');
            try {
                const [omsResult, otherResult] = await Promise.all([
                    supabase.from('oms_customizations').select('id, user_email, project_name, product_type, created_at').limit(5),
                    supabase.from('customization_forms').select('id, contact_email, project_name, product_type, created_at').limit(5)
                ]);
                
                resultDiv.innerHTML = `
                    <div class="success">
                        <h4>üìä Table Comparison:</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <h5>OMS Customizations Table:</h5>
                                <pre>${JSON.stringify(omsResult.data, null, 2)}</pre>
                            </div>
                            <div>
                                <h5>Customization Forms Table:</h5>
                                <pre>${JSON.stringify(otherResult.data, null, 2)}</pre>
                            </div>
                        </div>
                    </div>
                `;
            } catch (err) {
                resultDiv.innerHTML = `<div class="error">‚ùå Compare error: ${err.message}</div>`;
            }
        }
        
        // Auto-run basic checks on page load
        window.addEventListener('load', () => {
            testOMSTable();
            testOtherTable();
        });
    </script>
</body>
</html>
