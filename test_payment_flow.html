<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Payment Flow - Order Menu System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        .success { border-left: 4px solid #4CAF50; }
        .info { border-left: 4px solid #2196F3; }
        .warning { border-left: 4px solid #FF9800; }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #45a049; }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Payment Flow - Order Menu System</h1>
    
    <div class="test-card success">
        <h2>‚úÖ Payment Flow Fixed!</h2>
        <p><strong>Issues Resolved:</strong></p>
        <ul>
            <li>‚úÖ Console errors fixed by opening payment in new tab</li>
            <li>‚úÖ No page refresh - opens in new window</li>
            <li>‚úÖ Congratulations page created for after payment</li>
            <li>‚úÖ Popup blocker handling added</li>
        </ul>
    </div>
    
    <div class="test-card info">
        <h3>üîÑ New Payment Flow:</h3>
        <ol>
            <li>User fills Order Menu System form</li>
            <li>Clicks "Save and Make Payment"</li>
            <li>Data saves to Supabase</li>
            <li>Payment page opens in <strong>new tab</strong></li>
            <li>User completes payment on Pabbly</li>
            <li>User returns to app</li>
            <li>App shows congratulations page</li>
        </ol>
    </div>
    
    <div class="test-section">
        <h3>üß™ Test Scenarios:</h3>
        
        <h4>1. Test Payment Popup (New Tab)</h4>
        <button onclick="testPaymentPopup()">Test Payment Popup</button>
        <p><small>This will open the payment page in a new tab</small></p>
        
        <h4>2. Test Popup Blocker Handling</h4>
        <button onclick="testPopupBlocker()">Test Popup Blocker</button>
        <p><small>This simulates when popup is blocked</small></p>
        
        <h4>3. Test Congratulations Page</h4>
        <button onclick="testCongratulations()">Test Congratulations Page</button>
        <p><small>This will redirect to the success page</small></p>
    </div>
    
    <div class="test-card warning">
        <h3>‚ö†Ô∏è Important Notes:</h3>
        <ul>
            <li>Payment page opens in <strong>new tab</strong> to avoid console errors</li>
            <li>If popup is blocked, shows fallback payment link</li>
            <li>After payment, user sees congratulations page</li>
            <li>No page refresh or navigation issues</li>
        </ul>
    </div>
    
    <div class="test-card info">
        <h3>üîó Payment Link:</h3>
        <p><strong>URL:</strong> <code>https://payments.pabbly.com/subscribe/68c084369dbcfe4b619b80ce/six-months-inr</code></p>
        <p><strong>Service:</strong> Six Months INR Subscription</p>
        <p><strong>Amount:</strong> ‚Çπ999</p>
    </div>

    <script>
        function testPaymentPopup() {
            console.log('üß™ Testing payment popup...');
            const paymentWindow = window.open('https://payments.pabbly.com/subscribe/68c084369dbcfe4b619b80ce/six-months-inr', '_blank');
            
            if (!paymentWindow) {
                alert('Popup was blocked! This is the fallback behavior.');
                showFallbackPayment();
            } else {
                alert('Payment popup opened successfully!');
                // Simulate success after 3 seconds
                setTimeout(() => {
                    alert('Payment completed! Redirecting to congratulations page...');
                    window.location.href = '/order-success?product=order-menu-system';
                }, 3000);
            }
        }
        
        function testPopupBlocker() {
            console.log('üß™ Testing popup blocker handling...');
            // Simulate popup being blocked
            showFallbackPayment();
        }
        
        function testCongratulations() {
            console.log('üß™ Testing congratulations page...');
            window.location.href = '/order-success?product=order-menu-system';
        }
        
        function showFallbackPayment() {
            const paymentLink = document.createElement('div');
            paymentLink.innerHTML = `
                <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                            background: white; padding: 20px; border: 2px solid #4CAF50; 
                            border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 9999;">
                    <h3 style="color: #4CAF50; margin-bottom: 15px;">Payment Required</h3>
                    <p style="margin-bottom: 15px;">Please complete your payment to proceed:</p>
                    <a href="https://payments.pabbly.com/subscribe/68c084369dbcfe4b619b80ce/six-months-inr" 
                       target="_blank" style="display: inline-block; padding: 10px 20px; 
                       background: #4CAF50; color: white; text-decoration: none; border-radius: 5px;">
                        Open Payment Page
                    </a>
                    <button onclick="this.parentElement.remove()" style="margin-left: 10px; padding: 10px 15px; 
                            background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        Close
                    </button>
                </div>
            `;
            document.body.appendChild(paymentLink);
        }
        
        // Auto-test on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üß™ Payment Flow Test Page Loaded');
            console.log('‚úÖ All fixes implemented:');
            console.log('  - Payment opens in new tab');
            console.log('  - Popup blocker handling');
            console.log('  - Congratulations page ready');
        });
    </script>
</body>
</html>
